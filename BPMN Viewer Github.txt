{"created_by":"Tampermonkey","version":"1","scripts":[{"name":"BPMN Viewer","options":{"check_for_updates":true,"comment":null,"compatopts_for_requires":true,"compat_wrappedjsobject":false,"compat_metadata":false,"compat_foreach":false,"compat_arrayleft":false,"compat_uW_gmonkey":false,"compat_forvarin":false,"noframes":null,"awareOfChrome":false,"run_at":"document-start","override":{"merge_connects":true,"merge_excludes":true,"merge_includes":true,"merge_matches":true,"orig_connects":[],"orig_excludes":[],"orig_includes":[],"orig_matches":["https://github.com/*/pull/*/files"],"orig_noframes":null,"orig_run_at":"document-idle","use_blockers":[],"use_connects":[],"use_excludes":[],"use_includes":[],"use_matches":[]}},"storage":{"ts":1573246707757,"data":{}},"enabled":true,"position":1,"uuid":"e197d8e6-5d08-4a13-9557-bbb442900655","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgICBCUE1OIFZpZXdlcgovLyBAbmFtZXNwYWNlICAgIGh0dHA6Ly90YW1wZXJtb25rZXkubmV0LwovLyBAdmVyc2lvbiAgICAgIDAuMQovLyBAZGVzY3JpcHRpb24gIENyZWF0ZSBhIGJ1dHRvbiB0byBpbnNwZWN0IEJQTU4gZmlsZXMgaW4gZ2l0aHViIHB1bGwgcmVxdWVzdCByZXZpZXcgcGFnZQovLyBAYXV0aG9yICAgICAgIE1hcmNlbG8KLy8gQG1hdGNoICAgICAgICBodHRwczovL2dpdGh1Yi5jb20vKi9wdWxsLyovZmlsZXMKLy8gQGdyYW50ICAgICAgICBub25lCi8vIEByZXF1aXJlICAgICAgaHR0cHM6Ly91bnBrZy5jb20vYnBtbi1qc0A1LjEuMi9kaXN0L2JwbW4tdmlld2VyLmRldmVsb3BtZW50LmpzCi8vID09L1VzZXJTY3JpcHQ9PQoKZnVuY3Rpb24gaW5qZWN0SnMobGluaykgewogICAgdmFyIHNjciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpOwogICAgc2NyLnR5cGU9InRleHQvamF2YXNjcmlwdCI7CiAgICBzY3Iuc3JjPWxpbms7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnaGVhZCcpWzBdLmFwcGVuZENoaWxkKHNjcik7Cn0KdmFyIGJwbW47CmZ1bmN0aW9uIHNob3dQcmV2aWV3KGVsZW1lbnRSZWYpIHsKICAgIHZhciB4bWxCUE1XaXRoSGVhZGVyID0gZWxlbWVudFJlZi5wYXJlbnRFbGVtZW50LnBhcmVudEVsZW1lbnQucGFyZW50RWxlbWVudC5sYXN0RWxlbWVudENoaWxkLmlubmVyVGV4dDsKICAgIHZhciB4bWxCUE0gPSB4bWxCUE1XaXRoSGVhZGVyLnN1YnN0cih4bWxCUE1XaXRoSGVhZGVyLmluZGV4T2YoIkBAIiwgeG1sQlBNV2l0aEhlYWRlci5pbmRleE9mKCJAQCIpKzEpKzIpOwogICAgdG9nZ2xlTW9kYWwoKTsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdicG1uUHJldmlld0NhbnZhcycpLmlubmVySFRNTCA9ICcnOwogICAgYnBtbiA9IG5ldyBCcG1uSlMoe2NvbnRhaW5lcjogJyNicG1uUHJldmlld0NhbnZhcyd9KTsKICAgIGJwbW4uaW1wb3J0WE1MKHhtbEJQTSk7Cn0KCmZ1bmN0aW9uIHRvZ2dsZU1vZGFsKCkgewogICAgdmFyIG1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLm1vZGFsIik7CiAgICBtb2RhbC5jbGFzc0xpc3QudG9nZ2xlKCJzaG93LW1vZGFsIik7Cn0KCmZ1bmN0aW9uIHdpbmRvd09uQ2xpY2soZXZlbnQpIHsKICAgIHZhciBtb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi5tb2RhbCIpOwogICAgaWYgKGV2ZW50LnRhcmdldCA9PT0gbW9kYWwpIHsKICAgICAgICB0b2dnbGVNb2RhbCgpOwogICAgfQp9CgoKZnVuY3Rpb24gY3JlYXRlQnV0dG9uKGZpbGVJbmZvRWxlbWVudCkgewogICAgdmFyIGJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImJ1dHRvbiIpOwogICAgYnV0dG9uLmlubmVySFRNTD0KICAgICAgICBgPHN2ZyBjbGFzcz0ib2N0aWNvbiBvY3RpY29uLXNlYXJjaCIgdmlld0JveD0iMCAwIDE2IDE2IiB2ZXJzaW9uPSIxLjEiIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgYXJpYS1oaWRkZW49InRydWUiPjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgZD0iTTE1LjcgMTMuM2wtMy44MS0zLjgzQTUuOTMgNS45MyAwIDAwMTMgNmMwLTMuMzEtMi42OS02LTYtNlMxIDIuNjkgMSA2czIuNjkgNiA2IDZjMS4zIDAgMi40OC0uNDEgMy40Ny0xLjExbDMuODMgMy44MWMuMTkuMi40NS4zLjcuMy4yNSAwIC41Mi0uMDkuNy0uM2EuOTk2Ljk5NiAwIDAwMC0xLjQxdi4wMXpNNyAxMC43Yy0yLjU5IDAtNC43LTIuMTEtNC43LTQuNyAwLTIuNTkgMi4xMS00LjcgNC43LTQuNyAyLjU5IDAgNC43IDIuMTEgNC43IDQuNyAwIDIuNTktMi4xMSA0LjctNC43IDQuN3oiPjwvcGF0aD48L3N2Zz5gOwogICAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgKCkgPT4geyBzaG93UHJldmlldyhidXR0b24pIH0gKTsKICAgIGZpbGVJbmZvRWxlbWVudC5hcHBlbmRDaGlsZChidXR0b24pOwp9CgpmdW5jdGlvbiBkb2NSZWFkeShmbikgewogICAgLy8gc2VlIGlmIERPTSBpcyBhbHJlYWR5IGF2YWlsYWJsZQogICAgaWYgKGRvY3VtZW50LnJlYWR5U3RhdGUgPT09ICJjb21wbGV0ZSIgfHwgZG9jdW1lbnQucmVhZHlTdGF0ZSA9PT0gImludGVyYWN0aXZlIikgewogICAgICAgIC8vIGNhbGwgb24gbmV4dCBhdmFpbGFibGUgdGljawogICAgICAgIHNldFRpbWVvdXQoZm4sIDEpOwogICAgfSBlbHNlIHsKICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJET01Db250ZW50TG9hZGVkIiwgKCk9PiBzZXRUaW1lb3V0KGZuLCAzMDAwKSk7CiAgICB9Cn0KCmRvY1JlYWR5KGZ1bmN0aW9uKCkgewogICAgdmFyIHBhcmVudE9mUHJldmlld0NhbnZhcyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ2FwcGxpY2F0aW9uLW1haW4gJylbMF07LyoKdmFyIGJwbW5QcmV2aWV3Q2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICBicG1uUHJldmlld0NhbnZhcy5pZCA9ICdicG1uUHJldmlld0NhbnZhcyc7CmJwbW5QcmV2aWV3Q2FudmFzLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CnBhcmVudE9mUHJldmlld0NhbnZhcy5hcHBlbmRDaGlsZChicG1uUHJldmlld0NhbnZhcyk7Ki8KICAgIHZhciBuZXdDaGlsZCA9IGAKPHN0eWxlPi5tb2RhbCB7CnBvc2l0aW9uOiBmaXhlZDsKbGVmdDogMDsKdG9wOiAwOwp3aWR0aDogMTAwJTsKaGVpZ2h0OiAxMDAlOwpiYWNrZ3JvdW5kLWNvbG9yOiByZ2JhKDAsIDAsIDAsIDAuNSk7Cm9wYWNpdHk6IDA7CnZpc2liaWxpdHk6IGhpZGRlbjsKdHJhbnNmb3JtOiBzY2FsZSgxLjEpOwp0cmFuc2l0aW9uOiB2aXNpYmlsaXR5IDBzIGxpbmVhciAwLjI1cywgb3BhY2l0eSAwLjI1cyAwcywgdHJhbnNmb3JtIDAuMjVzOwp9Ci5tb2RhbC1jb250ZW50IHsKcG9zaXRpb246IGFic29sdXRlOwp0b3A6IDUwJTsKbGVmdDogNTAlOwp0cmFuc2Zvcm06IHRyYW5zbGF0ZSgtNTAlLCAtNTAlKTsKYmFja2dyb3VuZC1jb2xvcjogd2hpdGU7CnBhZGRpbmc6IDFyZW0gMS41cmVtOwp3aWR0aDogOTAlOwpoZWlnaHQ6IDkwJTsKYm9yZGVyLXJhZGl1czogMC41cmVtOwp9Ci5jbG9zZS1idXR0b24gewpmbG9hdDogcmlnaHQ7CndpZHRoOiAxLjVyZW07CmxpbmUtaGVpZ2h0OiAxLjVyZW07CnRleHQtYWxpZ246IGNlbnRlcjsKY3Vyc29yOiBwb2ludGVyOwpib3JkZXItcmFkaXVzOiAwLjI1cmVtOwpiYWNrZ3JvdW5kLWNvbG9yOiBsaWdodGdyYXk7Cn0KLmNsb3NlLWJ1dHRvbjpob3ZlciB7CmJhY2tncm91bmQtY29sb3I6IGRhcmtncmF5Owp9Ci5zaG93LW1vZGFsIHsKb3BhY2l0eTogMTsKdmlzaWJpbGl0eTogdmlzaWJsZTsKdHJhbnNmb3JtOiBzY2FsZSgxLjApOwp0cmFuc2l0aW9uOiB2aXNpYmlsaXR5IDBzIGxpbmVhciAwcywgb3BhY2l0eSAwLjI1cyAwcywgdHJhbnNmb3JtIDAuMjVzOwp6LWluZGV4OiA5OTk5OTsKfQo8L3N0eWxlPgo8ZGl2IGNsYXNzPSJtb2RhbCIgaWQgPSJtb2RhbEJwbW5QcmV2aWV3Q2FudmFzIj4KPGRpdiBjbGFzcz0ibW9kYWwtY29udGVudCI+CjxzcGFuIGlkPSJjbG9zZUJ1dHRvbiIgY2xhc3M9ImNsb3NlLWJ1dHRvbiI+JnRpbWVzOzwvc3Bhbj4KPGRpdiBpZD0iYnBtblByZXZpZXdDYW52YXMiIHN0eWxlPSJ3aWR0aDogMTAwJTtoZWlnaHQ6IDEwMCU7bWFyZ2luLXRvcDoxLjVyZW07Ij48L2Rpdj4KPC9kaXY+CjwvZGl2Pgo8c2NyaXB0Pgo8L3NjcmlwdD4KYDsKICAgIHBhcmVudE9mUHJldmlld0NhbnZhcy5pbm5lckhUTUwgKz0gbmV3Q2hpbGQ7CiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCJbZGF0YS1maWxlLXR5cGU9Jy5icG1uJ10gZGl2LmZpbGUtaW5mbyIpLmZvckVhY2goKGVsKT0+Y3JlYXRlQnV0dG9uKGVsKSk7CiAgICB2YXIgY2xvc2VCdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY2xvc2VCdXR0b24iKTsKICAgIGNsb3NlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgdG9nZ2xlTW9kYWwpOwogICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgd2luZG93T25DbGljayk7Cn0pOwoKCnZhciBtb2RhbFN0eWxlID0gYC8qIFRoZSBNb2RhbCAoYmFja2dyb3VuZCkgKi8KLm1vZGFsIHsKZGlzcGxheTogbm9uZTsgLyogSGlkZGVuIGJ5IGRlZmF1bHQgKi8KcG9zaXRpb246IGZpeGVkOyAvKiBTdGF5IGluIHBsYWNlICovCnotaW5kZXg6IDE7IC8qIFNpdCBvbiB0b3AgKi8KbGVmdDogMDsKdG9wOiAwOwp3aWR0aDogMTAwJTsgLyogRnVsbCB3aWR0aCAqLwpoZWlnaHQ6IDEwMCU7IC8qIEZ1bGwgaGVpZ2h0ICovCm92ZXJmbG93OiBhdXRvOyAvKiBFbmFibGUgc2Nyb2xsIGlmIG5lZWRlZCAqLwpiYWNrZ3JvdW5kLWNvbG9yOiByZ2IoMCwwLDApOyAvKiBGYWxsYmFjayBjb2xvciAqLwpiYWNrZ3JvdW5kLWNvbG9yOiByZ2JhKDAsMCwwLDAuNCk7IC8qIEJsYWNrIHcvIG9wYWNpdHkgKi8KfQoKLyogTW9kYWwgQ29udGVudC9Cb3ggKi8KLm1vZGFsLWNvbnRlbnQgewpiYWNrZ3JvdW5kLWNvbG9yOiAjZmVmZWZlOwptYXJnaW46IDE1JSBhdXRvOyAvKiAxNSUgZnJvbSB0aGUgdG9wIGFuZCBjZW50ZXJlZCAqLwpwYWRkaW5nOiAyMHB4Owpib3JkZXI6IDFweCBzb2xpZCAjODg4Owp3aWR0aDogODAlOyAvKiBDb3VsZCBiZSBtb3JlIG9yIGxlc3MsIGRlcGVuZGluZyBvbiBzY3JlZW4gc2l6ZSAqLwp9CgovKiBUaGUgQ2xvc2UgQnV0dG9uICovCi5jbG9zZSB7CmNvbG9yOiAjYWFhOwpmbG9hdDogcmlnaHQ7CmZvbnQtc2l6ZTogMjhweDsKZm9udC13ZWlnaHQ6IGJvbGQ7Cn0KCi5jbG9zZTpob3ZlciwKLmNsb3NlOmZvY3VzIHsKY29sb3I6IGJsYWNrOwp0ZXh0LWRlY29yYXRpb246IG5vbmU7CmN1cnNvcjogcG9pbnRlcjsKfWA=","requires":[{"meta":{"name":"bpmn-viewer.development.js","url":"https://unpkg.com/bpmn-js@5.1.2/dist/bpmn-viewer.development.js","ts":1573251324030,"mimetype":"text/javascript"},"source":"LyohCiAqIGJwbW4tanMgLSBicG1uLXZpZXdlciB2NS4xLjIKICoKICogQ29weXJpZ2h0IChjKSAyMDE0LXByZXNlbnQsIGNhbXVuZGEgU2VydmljZXMgR21iSAogKgogKiBSZWxlYXNlZCB1bmRlciB0aGUgYnBtbi5pbyBsaWNlbnNlCiAqIGh0dHA6Ly9icG1uLmlvL2xpY2Vuc2UKICoKICogU291cmNlIENvZGU6IGh0dHBzOi8vZ2l0aHViLmNvbS9icG1uLWlvL2JwbW4tanMKICoKICogRGF0ZTogMjAxOS0xMC0yNQogKi8KKGZ1bmN0aW9uIChnbG9iYWwsIGZhY3RvcnkpIHsKICB0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIG1vZHVsZSAhPT0gJ3VuZGVmaW5lZCcgPyBtb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkoKSA6CiAgdHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kID8gZGVmaW5lKGZhY3RvcnkpIDoKICAoZ2xvYmFsID0gZ2xvYmFsIHx8IHNlbGYsIGdsb2JhbC5CcG1uSlMgPSBmYWN0b3J5KCkpOwp9KHRoaXMsIGZ1bmN0aW9uICgpIHsgJ3VzZSBzdHJpY3QnOwoKICAvKioKICAgKiBGbGF0dGVuIGFycmF5LCBvbmUgbGV2ZWwgZGVlcC4KICAgKgogICAqIEBwYXJhbSB7QXJyYXk8Pz59IGFycgogICAqCiAgICogQHJldHVybiB7QXJyYXk8Pz59CiAgICovCgogIHZhciBuYXRpdmVUb1N0cmluZyA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmc7CiAgdmFyIG5hdGl2ZUhhc093blByb3BlcnR5ID0gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eTsKICBmdW5jdGlvbiBpc1VuZGVmaW5lZChvYmopIHsKICAgIHJldHVybiBvYmogPT09IHVuZGVmaW5lZDsKICB9CiAgZnVuY3Rpb24gaXNEZWZpbmVkKG9iaikgewogICAgcmV0dXJuIG9iaiAhPT0gdW5kZWZpbmVkOwogIH0KICBmdW5jdGlvbiBpc0FycmF5KG9iaikgewogICAgcmV0dXJuIG5hdGl2ZVRvU3RyaW5nLmNhbGwob2JqKSA9PT0gJ1tvYmplY3QgQXJyYXldJzsKICB9CiAgZnVuY3Rpb24gaXNPYmplY3Qob2JqKSB7CiAgICByZXR1cm4gbmF0aXZlVG9TdHJpbmcuY2FsbChvYmopID09PSAnW29iamVjdCBPYmplY3RdJzsKICB9CiAgZnVuY3Rpb24gaXNOdW1iZXIob2JqKSB7CiAgICByZXR1cm4gbmF0aXZlVG9TdHJpbmcuY2FsbChvYmopID09PSAnW29iamVjdCBOdW1iZXJdJzsKICB9CiAgZnVuY3Rpb24gaXNGdW5jdGlvbihvYmopIHsKICAgIHZhciB0YWcgPSBuYXRpdmVUb1N0cmluZy5jYWxsKG9iaik7CiAgICByZXR1cm4gdGFnID09PSAnW29iamVjdCBGdW5jdGlvbl0nIHx8IHRhZyA9PT0gJ1tvYmplY3QgQXN5bmNGdW5jdGlvbl0nIHx8IHRhZyA9PT0gJ1tvYmplY3QgR2VuZXJhdG9yRnVuY3Rpb25dJyB8fCB0YWcgPT09ICdbb2JqZWN0IEFzeW5jR2VuZXJhdG9yRnVuY3Rpb25dJyB8fCB0YWcgPT09ICdbb2JqZWN0IFByb3h5XSc7CiAgfQogIGZ1bmN0aW9uIGlzU3RyaW5nKG9iaikgewogICAgcmV0dXJuIG5hdGl2ZVRvU3RyaW5nLmNhbGwob2JqKSA9PT0gJ1tvYmplY3QgU3RyaW5nXSc7CiAgfQogIC8qKgogICAqIFJldHVybiB0cnVlLCBpZiB0YXJnZXQgb3ducyBhIHByb3BlcnR5IHdpdGggdGhlIGdpdmVuIGtleS4KICAgKgogICAqIEBwYXJhbSB7T2JqZWN0fSB0YXJnZXQKICAgKiBAcGFyYW0ge1N0cmluZ30ga2V5CiAgICoKICAgKiBAcmV0dXJuIHtCb29sZWFufQogICAqLwoKICBmdW5jdGlvbiBoYXModGFyZ2V0LCBrZXkpIHsKICAgIHJldHVybiBuYXRpdmVIYXNPd25Qcm9wZXJ0eS5jYWxsKHRhcmdldCwga2V5KTsKICB9CgogIC8qKgogICAqIEZpbmQgZWxlbWVudCBpbiBjb2xsZWN0aW9uLgogICAqCiAgICogQHBhcmFtICB7QXJyYXl8T2JqZWN0fSBjb2xsZWN0aW9uCiAgICogQHBhcmFtICB7RnVuY3Rpb258T2JqZWN0fSBtYXRjaGVyCiAgICoKICAgKiBAcmV0dXJuIHtPYmplY3R9CiAgICovCgogIGZ1bmN0aW9uIGZpbmQoY29sbGVjdGlvbiwgbWF0Y2hlcikgewogICAgbWF0Y2hlciA9IHRvTWF0Y2hlcihtYXRjaGVyKTsKICAgIHZhciBtYXRjaDsKICAgIGZvckVhY2goY29sbGVjdGlvbiwgZnVuY3Rpb24gKHZhbCwga2V5KSB7CiAgICAgIGlmIChtYXRjaGVyKHZhbCwga2V5KSkgewogICAgICAgIG1hdGNoID0gdmFsOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gbWF0Y2g7CiAgfQogIC8qKgogICAqIEZpbmQgZWxlbWVudCBpbiBjb2xsZWN0aW9uLgogICAqCiAgICogQHBhcmFtICB7QXJyYXl8T2JqZWN0fSBjb2xsZWN0aW9uCiAgICogQHBhcmFtICB7RnVuY3Rpb259IG1hdGNoZXIKICAgKgogICAqIEByZXR1cm4ge0FycmF5fSByZXN1bHQKICAgKi8KCiAgZnVuY3Rpb24gZmlsdGVyKGNvbGxlY3Rpb24sIG1hdGNoZXIpIHsKICAgIHZhciByZXN1bHQgPSBbXTsKICAgIGZvckVhY2goY29sbGVjdGlvbiwgZnVuY3Rpb24gKHZhbCwga2V5KSB7CiAgICAgIGlmIChtYXRjaGVyKHZhbCwga2V5KSkgewogICAgICAgIHJlc3VsdC5wdXNoKHZhbCk7CiAgICAgIH0KICAgIH0pOwogICAgcmV0dXJuIHJlc3VsdDsKICB9CiAgLyoqCiAgICogSXRlcmF0ZSBvdmVyIGNvbGxlY3Rpb247IHJldHVybmluZyBzb21ldGhpbmcKICAgKiAobm9uLXVuZGVmaW5lZCkgd2lsbCBzdG9wIGl0ZXJhdGlvbi4KICAgKgogICAqIEBwYXJhbSAge0FycmF5fE9iamVjdH0gY29sbGVjdGlvbgogICAqIEBwYXJhbSAge0Z1bmN0aW9ufSBpdGVyYXRvcgogICAqCiAgICogQHJldHVybiB7T2JqZWN0fSByZXR1cm4gcmVzdWx0IHRoYXQgc3RvcHBlZCB0aGUgaXRlcmF0aW9uCiAgICovCgogIGZ1bmN0aW9uIGZvckVhY2goY29sbGVjdGlvbiwgaXRlcmF0b3IpIHsKICAgIHZhciB2YWwsIHJlc3VsdDsKCiAgICBpZiAoaXNVbmRlZmluZWQoY29sbGVjdGlvbikpIHsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIHZhciBjb252ZXJ0S2V5ID0gaXNBcnJheShjb2xsZWN0aW9uKSA/IHRvTnVtIDogaWRlbnRpdHk7CgogICAgZm9yICh2YXIga2V5IGluIGNvbGxlY3Rpb24pIHsKICAgICAgaWYgKGhhcyhjb2xsZWN0aW9uLCBrZXkpKSB7CiAgICAgICAgdmFsID0gY29sbGVjdGlvbltrZXldOwogICAgICAgIHJlc3VsdCA9IGl0ZXJhdG9yKHZhbCwgY29udmVydEtleShrZXkpKTsKCiAgICAgICAgaWYgKHJlc3VsdCA9PT0gZmFsc2UpIHsKICAgICAgICAgIHJldHVybiB2YWw7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQogIC8qKgogICAqIFJlZHVjZSBjb2xsZWN0aW9uLCByZXR1cm5pbmcgYSBzaW5nbGUgcmVzdWx0LgogICAqCiAgICogQHBhcmFtICB7T2JqZWN0fEFycmF5fSBjb2xsZWN0aW9uCiAgICogQHBhcmFtICB7RnVuY3Rpb259IGl0ZXJhdG9yCiAgICogQHBhcmFtICB7QW55fSByZXN1bHQKICAgKgogICAqIEByZXR1cm4ge0FueX0gcmVzdWx0IHJldHVybmVkIGZyb20gbGFzdCBpdGVyYXRvcgogICAqLwoKICBmdW5jdGlvbiByZWR1Y2UoY29sbGVjdGlvbiwgaXRlcmF0b3IsIHJlc3VsdCkgewogICAgZm9yRWFjaChjb2xsZWN0aW9uLCBmdW5jdGlvbiAodmFsdWUsIGlkeCkgewogICAgICByZXN1bHQgPSBpdGVyYXRvcihyZXN1bHQsIHZhbHVlLCBpZHgpOwogICAgfSk7CiAgICByZXR1cm4gcmVzdWx0OwogIH0KICAvKioKICAgKiBSZXR1cm4gdHJ1ZSBpZiBldmVyeSBlbGVtZW50IGluIHRoZSBjb2xsZWN0aW9uCiAgICogbWF0Y2hlcyB0aGUgY3JpdGVyaWEuCiAgICoKICAgKiBAcGFyYW0gIHtPYmplY3R8QXJyYXl9IGNvbGxlY3Rpb24KICAgKiBAcGFyYW0gIHtGdW5jdGlvbn0gbWF0Y2hlcgogICAqCiAgICogQHJldHVybiB7Qm9vbGVhbn0KICAgKi8KCiAgZnVuY3Rpb24gZXZlcnkoY29sbGVjdGlvbiwgbWF0Y2hlcikgewogICAgcmV0dXJuICEhcmVkdWNlKGNvbGxlY3Rpb24sIGZ1bmN0aW9uIChtYXRjaGVzLCB2YWwsIGtleSkgewogICAgICByZXR1cm4gbWF0Y2hlcyAmJiBtYXRjaGVyKHZhbCwga2V5KTsKICAgIH0sIHRydWUpOwogIH0KICAvKioKICAgKiBSZXR1cm4gdHJ1ZSBpZiBzb21lIGVsZW1lbnRzIGluIHRoZSBjb2xsZWN0aW9uCiAgICogbWF0Y2ggdGhlIGNyaXRlcmlhLgogICAqCiAgICogQHBhcmFtICB7T2JqZWN0fEFycmF5fSBjb2xsZWN0aW9uCiAgICogQHBhcmFtICB7RnVuY3Rpb259IG1hdGNoZXIKICAgKgogICAqIEByZXR1cm4ge0Jvb2xlYW59CiAgICovCgogIGZ1bmN0aW9uIHNvbWUoY29sbGVjdGlvbiwgbWF0Y2hlcikgewogICAgcmV0dXJuICEhZmluZChjb2xsZWN0aW9uLCBtYXRjaGVyKTsKICB9CiAgLyoqCiAgICogVHJhbnNmb3JtIGEgY29sbGVjdGlvbiBpbnRvIGFub3RoZXIgY29sbGVjdGlvbgogICAqIGJ5IHBpcGluZyBlYWNoIG1lbWJlciB0aHJvdWdoIHRoZSBnaXZlbiBmbi4KICAgKgogICAqIEBwYXJhbSAge09iamVjdHxBcnJheX0gICBjb2xsZWN0aW9uCiAgICogQHBhcmFtICB7RnVuY3Rpb259IGZuCiAgICoKICAgKiBAcmV0dXJuIHtBcnJheX0gdHJhbnNmb3JtZWQgY29sbGVjdGlvbgogICAqLwoKICBmdW5jdGlvbiBtYXAoY29sbGVjdGlvbiwgZm4pIHsKICAgIHZhciByZXN1bHQgPSBbXTsKICAgIGZvckVhY2goY29sbGVjdGlvbiwgZnVuY3Rpb24gKHZhbCwga2V5KSB7CiAgICAgIHJlc3VsdC5wdXNoKGZuKHZhbCwga2V5KSk7CiAgICB9KTsKICAgIHJldHVybiByZXN1bHQ7CiAgfQogIC8qKgogICAqIENyZWF0ZSBhbiBvYmplY3QgcGF0dGVybiBtYXRjaGVyLgogICAqCiAgICogQGV4YW1wbGUKICAgKgogICAqIGNvbnN0IG1hdGNoZXIgPSBtYXRjaFBhdHRlcm4oeyBpZDogMSB9KTsKICAgKgogICAqIHZhciBlbGVtZW50ID0gZmluZChlbGVtZW50cywgbWF0Y2hlcik7CiAgICoKICAgKiBAcGFyYW0gIHtPYmplY3R9IHBhdHRlcm4KICAgKgogICAqIEByZXR1cm4ge0Z1bmN0aW9ufSBtYXRjaGVyRm4KICAgKi8KCiAgZnVuY3Rpb24gbWF0Y2hQYXR0ZXJuKHBhdHRlcm4pIHsKICAgIHJldHVybiBmdW5jdGlvbiAoZWwpIHsKICAgICAgcmV0dXJuIGV2ZXJ5KHBhdHRlcm4sIGZ1bmN0aW9uICh2YWwsIGtleSkgewogICAgICAgIHJldHVybiBlbFtrZXldID09PSB2YWw7CiAgICAgIH0pOwogICAgfTsKICB9CgogIGZ1bmN0aW9uIHRvTWF0Y2hlcihtYXRjaGVyKSB7CiAgICByZXR1cm4gaXNGdW5jdGlvbihtYXRjaGVyKSA/IG1hdGNoZXIgOiBmdW5jdGlvbiAoZSkgewogICAgICByZXR1cm4gZSA9PT0gbWF0Y2hlcjsKICAgIH07CiAgfQoKICBmdW5jdGlvbiBpZGVudGl0eShhcmcpIHsKICAgIHJldHVybiBhcmc7CiAgfQoKICBmdW5jdGlvbiB0b051bShhcmcpIHsKICAgIHJldHVybiBOdW1iZXIoYXJnKTsKICB9CgogIC8qKgogICAqIERlYm91bmNlIGZuLCBjYWxsaW5nIGl0IG9ubHkgb25jZSBpZgogICAqIHRoZSBnaXZlbiB0aW1lIGVsYXBzZWQgYmV0d2VlbiBjYWxscy4KICAgKgogICAqIEBwYXJhbSAge0Z1bmN0aW9ufSBmbgogICAqIEBwYXJhbSAge051bWJlcn0gdGltZW91dAogICAqCiAgICogQHJldHVybiB7RnVuY3Rpb259IGRlYm91bmNlZCBmdW5jdGlvbgogICAqLwogIGZ1bmN0aW9uIGRlYm91bmNlKGZuLCB0aW1lb3V0KSB7CiAgICB2YXIgdGltZXI7CiAgICB2YXIgbGFzdEFyZ3M7CiAgICB2YXIgbGFzdFRoaXM7CiAgICB2YXIgbGFzdE5vdzsKCiAgICBmdW5jdGlvbiBmaXJlKCkgewogICAgICB2YXIgbm93ID0gRGF0ZS5ub3coKTsKICAgICAgdmFyIHNjaGVkdWxlZERpZmYgPSBsYXN0Tm93ICsgdGltZW91dCAtIG5vdzsKCiAgICAgIGlmIChzY2hlZHVsZWREaWZmID4gMCkgewogICAgICAgIHJldHVybiBzY2hlZHVsZShzY2hlZHVsZWREaWZmKTsKICAgICAgfQoKICAgICAgZm4uYXBwbHkobGFzdFRoaXMsIGxhc3RBcmdzKTsKICAgICAgdGltZXIgPSBsYXN0Tm93ID0gbGFzdEFyZ3MgPSBsYXN0VGhpcyA9IHVuZGVmaW5lZDsKICAgIH0KCiAgICBmdW5jdGlvbiBzY2hlZHVsZSh0aW1lb3V0KSB7CiAgICAgIHRpbWVyID0gc2V0VGltZW91dChmaXJlLCB0aW1lb3V0KTsKICAgIH0KCiAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICBsYXN0Tm93ID0gRGF0ZS5ub3coKTsKCiAgICAgIGZvciAodmFyIF9sZW4gPSBhcmd1bWVudHMubGVuZ3RoLCBhcmdzID0gbmV3IEFycmF5KF9sZW4pLCBfa2V5ID0gMDsgX2tleSA8IF9sZW47IF9rZXkrKykgewogICAgICAgIGFyZ3NbX2tleV0gPSBhcmd1bWVudHNbX2tleV07CiAgICAgIH0KCiAgICAgIGxhc3RBcmdzID0gYXJnczsKICAgICAgbGFzdFRoaXMgPSB0aGlzOyAvLyBlbnN1cmUgYW4gZXhlY3V0aW9uIGlzIHNjaGVkdWxlZAoKICAgICAgaWYgKCF0aW1lcikgewogICAgICAgIHNjaGVkdWxlKHRpbWVvdXQpOwogICAgICB9CiAgICB9OwogIH0KICAvKioKICAgKiBCaW5kIGZ1bmN0aW9uIGFnYWluc3QgdGFyZ2V0IDx0aGlzPi4KICAgKgogICAqIEBwYXJhbSAge0Z1bmN0aW9ufSBmbgogICAqIEBwYXJhbSAge09iamVjdH0gICB0YXJnZXQKICAgKgogICAqIEByZXR1cm4ge0Z1bmN0aW9ufSBib3VuZCBmdW5jdGlvbgogICAqLwoKICBmdW5jdGlvbiBiaW5kKGZuLCB0YXJnZXQpIHsKICAgIHJldHVybiBmbi5iaW5kKHRhcmdldCk7CiAgfQoKICBmdW5jdGlvbiBfZXh0ZW5kcygpIHsKICAgIF9leHRlbmRzID0gT2JqZWN0LmFzc2lnbiB8fCBmdW5jdGlvbiAodGFyZ2V0KSB7CiAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpXTsKCiAgICAgICAgZm9yICh2YXIga2V5IGluIHNvdXJjZSkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzb3VyY2UsIGtleSkpIHsKICAgICAgICAgICAgdGFyZ2V0W2tleV0gPSBzb3VyY2Vba2V5XTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9OwoKICAgIHJldHVybiBfZXh0ZW5kcy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogIH0KCiAgLyoqCiAgICogQ29udmVuaWVuY2Ugd3JhcHBlciBmb3IgYE9iamVjdC5hc3NpZ25gLgogICAqCiAgICogQHBhcmFtIHtPYmplY3R9IHRhcmdldAogICAqIEBwYXJhbSB7Li4uT2JqZWN0fSBvdGhlcnMKICAgKgogICAqIEByZXR1cm4ge09iamVjdH0gdGhlIHRhcmdldAogICAqLwoKICBmdW5jdGlvbiBhc3NpZ24odGFyZ2V0KSB7CiAgICBmb3IgKHZhciBfbGVuID0gYXJndW1lbnRzLmxlbmd0aCwgb3RoZXJzID0gbmV3IEFycmF5KF9sZW4gPiAxID8gX2xlbiAtIDEgOiAwKSwgX2tleSA9IDE7IF9rZXkgPCBfbGVuOyBfa2V5KyspIHsKICAgICAgb3RoZXJzW19rZXkgLSAxXSA9IGFyZ3VtZW50c1tfa2V5XTsKICAgIH0KCiAgICByZXR1cm4gX2V4dGVuZHMuYXBwbHkodm9pZCAwLCBbdGFyZ2V0XS5jb25jYXQob3RoZXJzKSk7CiAgfQogIC8qKgogICAqIFBpY2sgZ2l2ZW4gcHJvcGVydGllcyBmcm9tIHRoZSB0YXJnZXQgb2JqZWN0LgogICAqCiAgICogQHBhcmFtIHtPYmplY3R9IHRhcmdldAogICAqIEBwYXJhbSB7QXJyYXl9IHByb3BlcnRpZXMKICAgKgogICAqIEByZXR1cm4ge09iamVjdH0gdGFyZ2V0CiAgICovCgogIGZ1bmN0aW9uIHBpY2sodGFyZ2V0LCBwcm9wZXJ0aWVzKSB7CiAgICB2YXIgcmVzdWx0ID0ge307CiAgICB2YXIgb2JqID0gT2JqZWN0KHRhcmdldCk7CiAgICBmb3JFYWNoKHByb3BlcnRpZXMsIGZ1bmN0aW9uIChwcm9wKSB7CiAgICAgIGlmIChwcm9wIGluIG9iaikgewogICAgICAgIHJlc3VsdFtwcm9wXSA9IHRhcmdldFtwcm9wXTsKICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gcmVzdWx0OwogIH0KICAvKioKICAgKiBQaWNrIGFsbCB0YXJnZXQgcHJvcGVydGllcywgZXhjbHVkaW5nIHRoZSBnaXZlbiBvbmVzLgogICAqCiAgICogQHBhcmFtIHtPYmplY3R9IHRhcmdldAogICAqIEBwYXJhbSB7QXJyYXl9IHByb3BlcnRpZXMKICAgKgogICAqIEByZXR1cm4ge09iamVjdH0gdGFyZ2V0CiAgICovCgogIGZ1bmN0aW9uIG9taXQodGFyZ2V0LCBwcm9wZXJ0aWVzKSB7CiAgICB2YXIgcmVzdWx0ID0ge307CiAgICB2YXIgb2JqID0gT2JqZWN0KHRhcmdldCk7CiAgICBmb3JFYWNoKG9iaiwgZnVuY3Rpb24gKHByb3AsIGtleSkgewogICAgICBpZiAocHJvcGVydGllcy5pbmRleE9mKGtleSkgPT09IC0xKSB7CiAgICAgICAgcmVzdWx0W2tleV0gPSBwcm9wOwogICAgICB9CiAgICB9KTsKICAgIHJldHVybiByZXN1bHQ7CiAgfQoKICAvKioKICAgKiBTZXQgYXR0cmlidXRlIGBuYW1lYCB0byBgdmFsYCwgb3IgZ2V0IGF0dHIgYG5hbWVgLgogICAqCiAgICogQHBhcmFtIHtFbGVtZW50fSBlbAogICAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lCiAgICogQHBhcmFtIHtTdHJpbmd9IFt2YWxdCiAgICogQGFwaSBwdWJsaWMKICAgKi8KICBmdW5jdGlvbiBhdHRyKGVsLCBuYW1lLCB2YWwpIHsKICAgIC8vIGdldAogICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT0gMikgewogICAgICByZXR1cm4gZWwuZ2V0QXR0cmlidXRlKG5hbWUpOwogICAgfQoKICAgIC8vIHJlbW92ZQogICAgaWYgKHZhbCA9PT0gbnVsbCkgewogICAgICByZXR1cm4gZWwucmVtb3ZlQXR0cmlidXRlKG5hbWUpOwogICAgfQoKICAgIC8vIHNldAogICAgZWwuc2V0QXR0cmlidXRlKG5hbWUsIHZhbCk7CgogICAgcmV0dXJuIGVsOwogIH0KCiAgdmFyIGluZGV4T2YgPSBbXS5pbmRleE9mOwoKICB2YXIgaW5kZXhvZiA9IGZ1bmN0aW9uKGFyciwgb2JqKXsKICAgIGlmIChpbmRleE9mKSByZXR1cm4gYXJyLmluZGV4T2Yob2JqKTsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXJyLmxlbmd0aDsgKytpKSB7CiAgICAgIGlmIChhcnJbaV0gPT09IG9iaikgcmV0dXJuIGk7CiAgICB9CiAgICByZXR1cm4gLTE7CiAgfTsKCiAgLyoqCiAgICogVGFrZW4gZnJvbSBodHRwczovL2dpdGh1Yi5jb20vY29tcG9uZW50L2NsYXNzZXMKICAgKgogICAqIFdpdGhvdXQgdGhlIGNvbXBvbmVudCBiaXRzLgogICAqLwoKICAvKioKICAgKiBXaGl0ZXNwYWNlIHJlZ2V4cC4KICAgKi8KCiAgdmFyIHJlID0gL1xzKy87CgogIC8qKgogICAqIHRvU3RyaW5nIHJlZmVyZW5jZS4KICAgKi8KCiAgdmFyIHRvU3RyaW5nID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZzsKCiAgLyoqCiAgICogV3JhcCBgZWxgIGluIGEgYENsYXNzTGlzdGAuCiAgICoKICAgKiBAcGFyYW0ge0VsZW1lbnR9IGVsCiAgICogQHJldHVybiB7Q2xhc3NMaXN0fQogICAqIEBhcGkgcHVibGljCiAgICovCgogIGZ1bmN0aW9uIGNsYXNzZXMoZWwpIHsKICAgIHJldHVybiBuZXcgQ2xhc3NMaXN0KGVsKTsKICB9CgogIC8qKgogICAqIEluaXRpYWxpemUgYSBuZXcgQ2xhc3NMaXN0IGZvciBgZWxgLgogICAqCiAgICogQHBhcmFtIHtFbGVtZW50fSBlbAogICAqIEBhcGkgcHJpdmF0ZQogICAqLwoKICBmdW5jdGlvbiBDbGFzc0xpc3QoZWwpIHsKICAgIGlmICghZWwgfHwgIWVsLm5vZGVUeXBlKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcignQSBET00gZWxlbWVudCByZWZlcmVuY2UgaXMgcmVxdWlyZWQnKTsKICAgIH0KICAgIHRoaXMuZWwgPSBlbDsKICAgIHRoaXMubGlzdCA9IGVsLmNsYXNzTGlzdDsKICB9CgogIC8qKgogICAqIEFkZCBjbGFzcyBgbmFtZWAgaWYgbm90IGFscmVhZHkgcHJlc2VudC4KICAgKgogICAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lCiAgICogQHJldHVybiB7Q2xhc3NMaXN0fQogICAqIEBhcGkgcHVibGljCiAgICovCgogIENsYXNzTGlzdC5wcm90b3R5cGUuYWRkID0gZnVuY3Rpb24gKG5hbWUpIHsKICAgIC8vIGNsYXNzTGlzdAogICAgaWYgKHRoaXMubGlzdCkgewogICAgICB0aGlzLmxpc3QuYWRkKG5hbWUpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KCiAgICAvLyBmYWxsYmFjawogICAgdmFyIGFyciA9IHRoaXMuYXJyYXkoKTsKICAgIHZhciBpID0gaW5kZXhvZihhcnIsIG5hbWUpOwogICAgaWYgKCF+aSkgYXJyLnB1c2gobmFtZSk7CiAgICB0aGlzLmVsLmNsYXNzTmFtZSA9IGFyci5qb2luKCcgJyk7CiAgICByZXR1cm4gdGhpczsKICB9OwoKICAvKioKICAgKiBSZW1vdmUgY2xhc3MgYG5hbWVgIHdoZW4gcHJlc2VudCwgb3IKICAgKiBwYXNzIGEgcmVndWxhciBleHByZXNzaW9uIHRvIHJlbW92ZQogICAqIGFueSB3aGljaCBtYXRjaC4KICAgKgogICAqIEBwYXJhbSB7U3RyaW5nfFJlZ0V4cH0gbmFtZQogICAqIEByZXR1cm4ge0NsYXNzTGlzdH0KICAgKiBAYXBpIHB1YmxpYwogICAqLwoKICBDbGFzc0xpc3QucHJvdG90eXBlLnJlbW92ZSA9IGZ1bmN0aW9uIChuYW1lKSB7CiAgICBpZiAoJ1tvYmplY3QgUmVnRXhwXScgPT0gdG9TdHJpbmcuY2FsbChuYW1lKSkgewogICAgICByZXR1cm4gdGhpcy5yZW1vdmVNYXRjaGluZyhuYW1lKTsKICAgIH0KCiAgICAvLyBjbGFzc0xpc3QKICAgIGlmICh0aGlzLmxpc3QpIHsKICAgICAgdGhpcy5saXN0LnJlbW92ZShuYW1lKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogICAgLy8gZmFsbGJhY2sKICAgIHZhciBhcnIgPSB0aGlzLmFycmF5KCk7CiAgICB2YXIgaSA9IGluZGV4b2YoYXJyLCBuYW1lKTsKICAgIGlmICh+aSkgYXJyLnNwbGljZShpLCAxKTsKICAgIHRoaXMuZWwuY2xhc3NOYW1lID0gYXJyLmpvaW4oJyAnKTsKICAgIHJldHVybiB0aGlzOwogIH07CgogIC8qKgogICAqIFJlbW92ZSBhbGwgY2xhc3NlcyBtYXRjaGluZyBgcmVgLgogICAqCiAgICogQHBhcmFtIHtSZWdFeHB9IHJlCiAgICogQHJldHVybiB7Q2xhc3NMaXN0fQogICAqIEBhcGkgcHJpdmF0ZQogICAqLwoKICBDbGFzc0xpc3QucHJvdG90eXBlLnJlbW92ZU1hdGNoaW5nID0gZnVuY3Rpb24gKHJlKSB7CiAgICB2YXIgYXJyID0gdGhpcy5hcnJheSgpOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcnIubGVuZ3RoOyBpKyspIHsKICAgICAgaWYgKHJlLnRlc3QoYXJyW2ldKSkgewogICAgICAgIHRoaXMucmVtb3ZlKGFycltpXSk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiB0aGlzOwogIH07CgogIC8qKgogICAqIFRvZ2dsZSBjbGFzcyBgbmFtZWAsIGNhbiBmb3JjZSBzdGF0ZSB2aWEgYGZvcmNlYC4KICAgKgogICAqIEZvciBicm93c2VycyB0aGF0IHN1cHBvcnQgY2xhc3NMaXN0LCBidXQgZG8gbm90IHN1cHBvcnQgYGZvcmNlYCB5ZXQsCiAgICogdGhlIG1pc3Rha2Ugd2lsbCBiZSBkZXRlY3RlZCBhbmQgY29ycmVjdGVkLgogICAqCiAgICogQHBhcmFtIHtTdHJpbmd9IG5hbWUKICAgKiBAcGFyYW0ge0Jvb2xlYW59IGZvcmNlCiAgICogQHJldHVybiB7Q2xhc3NMaXN0fQogICAqIEBhcGkgcHVibGljCiAgICovCgogIENsYXNzTGlzdC5wcm90b3R5cGUudG9nZ2xlID0gZnVuY3Rpb24gKG5hbWUsIGZvcmNlKSB7CiAgICAvLyBjbGFzc0xpc3QKICAgIGlmICh0aGlzLmxpc3QpIHsKICAgICAgaWYgKCd1bmRlZmluZWQnICE9PSB0eXBlb2YgZm9yY2UpIHsKICAgICAgICBpZiAoZm9yY2UgIT09IHRoaXMubGlzdC50b2dnbGUobmFtZSwgZm9yY2UpKSB7CiAgICAgICAgICB0aGlzLmxpc3QudG9nZ2xlKG5hbWUpOyAvLyB0b2dnbGUgYWdhaW4gdG8gY29ycmVjdAogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmxpc3QudG9nZ2xlKG5hbWUpOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzOwogICAgfQoKICAgIC8vIGZhbGxiYWNrCiAgICBpZiAoJ3VuZGVmaW5lZCcgIT09IHR5cGVvZiBmb3JjZSkgewogICAgICBpZiAoIWZvcmNlKSB7CiAgICAgICAgdGhpcy5yZW1vdmUobmFtZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5hZGQobmFtZSk7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGlmICh0aGlzLmhhcyhuYW1lKSkgewogICAgICAgIHRoaXMucmVtb3ZlKG5hbWUpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYWRkKG5hbWUpOwogICAgICB9CiAgICB9CgogICAgcmV0dXJuIHRoaXM7CiAgfTsKCiAgLyoqCiAgICogUmV0dXJuIGFuIGFycmF5IG9mIGNsYXNzZXMuCiAgICoKICAgKiBAcmV0dXJuIHtBcnJheX0KICAgKiBAYXBpIHB1YmxpYwogICAqLwoKICBDbGFzc0xpc3QucHJvdG90eXBlLmFycmF5ID0gZnVuY3Rpb24gKCkgewogICAgdmFyIGNsYXNzTmFtZSA9IHRoaXMuZWwuZ2V0QXR0cmlidXRlKCdjbGFzcycpIHx8ICcnOwogICAgdmFyIHN0ciA9IGNsYXNzTmFtZS5yZXBsYWNlKC9eXHMrfFxzKyQvZywgJycpOwogICAgdmFyIGFyciA9IHN0ci5zcGxpdChyZSk7CiAgICBpZiAoJycgPT09IGFyclswXSkgYXJyLnNoaWZ0KCk7CiAgICByZXR1cm4gYXJyOwogIH07CgogIC8qKgogICAqIENoZWNrIGlmIGNsYXNzIGBuYW1lYCBpcyBwcmVzZW50LgogICAqCiAgICogQHBhcmFtIHtTdHJpbmd9IG5hbWUKICAgKiBAcmV0dXJuIHtDbGFzc0xpc3R9CiAgICogQGFwaSBwdWJsaWMKICAgKi8KCiAgQ2xhc3NMaXN0LnByb3RvdHlwZS5oYXMgPSBDbGFzc0xpc3QucHJvdG90eXBlLmNvbnRhaW5zID0gZnVuY3Rpb24gKG5hbWUpIHsKICAgIHJldHVybiB0aGlzLmxpc3QgPyB0aGlzLmxpc3QuY29udGFpbnMobmFtZSkgOiAhIX5pbmRleG9mKHRoaXMuYXJyYXkoKSwgbmFtZSk7CiAgfTsKCiAgLyoqCiAgICogUmVtb3ZlIGFsbCBjaGlsZHJlbiBmcm9tIHRoZSBnaXZlbiBlbGVtZW50LgogICAqLwogIGZ1bmN0aW9uIGNsZWFyKGVsKSB7CgogICAgdmFyIGM7CgogICAgd2hpbGUgKGVsLmNoaWxkTm9kZXMubGVuZ3RoKSB7CiAgICAgIGMgPSBlbC5jaGlsZE5vZGVzWzBdOwogICAgICBlbC5yZW1vdmVDaGlsZChjKTsKICAgIH0KCiAgICByZXR1cm4gZWw7CiAgfQoKICAvKioNCiAgICogRWxlbWVudCBwcm90b3R5cGUuDQogICAqLw0KDQogIHZhciBwcm90byA9IEVsZW1lbnQucHJvdG90eXBlOw0KDQogIC8qKg0KICAgKiBWZW5kb3IgZnVuY3Rpb24uDQogICAqLw0KDQogIHZhciB2ZW5kb3IgPSBwcm90by5tYXRjaGVzU2VsZWN0b3INCiAgICB8fCBwcm90by53ZWJraXRNYXRjaGVzU2VsZWN0b3INCiAgICB8fCBwcm90by5tb3pNYXRjaGVzU2VsZWN0b3INCiAgICB8fCBwcm90by5tc01hdGNoZXNTZWxlY3Rvcg0KICAgIHx8IHByb3RvLm9NYXRjaGVzU2VsZWN0b3I7DQoNCiAgLyoqDQogICAqIEV4cG9zZSBgbWF0Y2goKWAuDQogICAqLw0KDQogIHZhciBtYXRjaGVzU2VsZWN0b3IgPSBtYXRjaDsNCg0KICAvKioNCiAgICogTWF0Y2ggYGVsYCB0byBgc2VsZWN0b3JgLg0KICAgKg0KICAgKiBAcGFyYW0ge0VsZW1lbnR9IGVsDQogICAqIEBwYXJhbSB7U3RyaW5nfSBzZWxlY3Rvcg0KICAgKiBAcmV0dXJuIHtCb29sZWFufQ0KICAgKiBAYXBpIHB1YmxpYw0KICAgKi8NCg0KICBmdW5jdGlvbiBtYXRjaChlbCwgc2VsZWN0b3IpIHsNCiAgICBpZiAodmVuZG9yKSByZXR1cm4gdmVuZG9yLmNhbGwoZWwsIHNlbGVjdG9yKTsNCiAgICB2YXIgbm9kZXMgPSBlbC5wYXJlbnROb2RlLnF1ZXJ5U2VsZWN0b3JBbGwoc2VsZWN0b3IpOw0KICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbm9kZXMubGVuZ3RoOyArK2kpIHsNCiAgICAgIGlmIChub2Rlc1tpXSA9PSBlbCkgcmV0dXJuIHRydWU7DQogICAgfQ0KICAgIHJldHVybiBmYWxzZTsNCiAgfQoKICB2YXIgY2xvc2VzdCA9IGZ1bmN0aW9uIChlbGVtZW50LCBzZWxlY3RvciwgY2hlY2tZb1NlbGYpIHsNCiAgICB2YXIgcGFyZW50ID0gY2hlY2tZb1NlbGYgPyBlbGVtZW50IDogZWxlbWVudC5wYXJlbnROb2RlOw0KDQogICAgd2hpbGUgKHBhcmVudCAmJiBwYXJlbnQgIT09IGRvY3VtZW50KSB7DQogICAgICBpZiAobWF0Y2hlc1NlbGVjdG9yKHBhcmVudCwgc2VsZWN0b3IpKSByZXR1cm4gcGFyZW50Ow0KICAgICAgcGFyZW50ID0gcGFyZW50LnBhcmVudE5vZGU7DQogICAgfQ0KICB9OwoKICB2YXIgYmluZCQxID0gd2luZG93LmFkZEV2ZW50TGlzdGVuZXIgPyAnYWRkRXZlbnRMaXN0ZW5lcicgOiAnYXR0YWNoRXZlbnQnLAogICAgICB1bmJpbmQgPSB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lciA/ICdyZW1vdmVFdmVudExpc3RlbmVyJyA6ICdkZXRhY2hFdmVudCcsCiAgICAgIHByZWZpeCA9IGJpbmQkMSAhPT0gJ2FkZEV2ZW50TGlzdGVuZXInID8gJ29uJyA6ICcnOwoKICAvKioKICAgKiBCaW5kIGBlbGAgZXZlbnQgYHR5cGVgIHRvIGBmbmAuCiAgICoKICAgKiBAcGFyYW0ge0VsZW1lbnR9IGVsCiAgICogQHBhcmFtIHtTdHJpbmd9IHR5cGUKICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmbgogICAqIEBwYXJhbSB7Qm9vbGVhbn0gY2FwdHVyZQogICAqIEByZXR1cm4ge0Z1bmN0aW9ufQogICAqIEBhcGkgcHVibGljCiAgICovCgogIHZhciBiaW5kXzEgPSBmdW5jdGlvbihlbCwgdHlwZSwgZm4sIGNhcHR1cmUpewogICAgZWxbYmluZCQxXShwcmVmaXggKyB0eXBlLCBmbiwgY2FwdHVyZSB8fCBmYWxzZSk7CiAgICByZXR1cm4gZm47CiAgfTsKCiAgLyoqCiAgICogVW5iaW5kIGBlbGAgZXZlbnQgYHR5cGVgJ3MgY2FsbGJhY2sgYGZuYC4KICAgKgogICAqIEBwYXJhbSB7RWxlbWVudH0gZWwKICAgKiBAcGFyYW0ge1N0cmluZ30gdHlwZQogICAqIEBwYXJhbSB7RnVuY3Rpb259IGZuCiAgICogQHBhcmFtIHtCb29sZWFufSBjYXB0dXJlCiAgICogQHJldHVybiB7RnVuY3Rpb259CiAgICogQGFwaSBwdWJsaWMKICAgKi8KCiAgdmFyIHVuYmluZF8xID0gZnVuY3Rpb24oZWwsIHR5cGUsIGZuLCBjYXB0dXJlKXsKICAgIGVsW3VuYmluZF0ocHJlZml4ICsgdHlwZSwgZm4sIGNhcHR1cmUgfHwgZmFsc2UpOwogICAgcmV0dXJuIGZuOwogIH07CgogIHZhciBjb21wb25lbnRFdmVudCA9IHsKICAJYmluZDogYmluZF8xLAogIAl1bmJpbmQ6IHVuYmluZF8xCiAgfTsKCiAgLyoqCiAgICogTW9kdWxlIGRlcGVuZGVuY2llcy4KICAgKi8KCgoKICAvKioKICAgKiBEZWxlZ2F0ZSBldmVudCBgdHlwZWAgdG8gYHNlbGVjdG9yYAogICAqIGFuZCBpbnZva2UgYGZuKGUpYC4gQSBjYWxsYmFjayBmdW5jdGlvbgogICAqIGlzIHJldHVybmVkIHdoaWNoIG1heSBiZSBwYXNzZWQgdG8gYC51bmJpbmQoKWAuCiAgICoKICAgKiBAcGFyYW0ge0VsZW1lbnR9IGVsCiAgICogQHBhcmFtIHtTdHJpbmd9IHNlbGVjdG9yCiAgICogQHBhcmFtIHtTdHJpbmd9IHR5cGUKICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmbgogICAqIEBwYXJhbSB7Qm9vbGVhbn0gY2FwdHVyZQogICAqIEByZXR1cm4ge0Z1bmN0aW9ufQogICAqIEBhcGkgcHVibGljCiAgICovCgogIC8vIFNvbWUgZXZlbnRzIGRvbid0IGJ1YmJsZSwgc28gd2Ugd2FudCB0byBiaW5kIHRvIHRoZSBjYXB0dXJlIHBoYXNlIGluc3RlYWQKICAvLyB3aGVuIGRlbGVnYXRpbmcuCiAgdmFyIGZvcmNlQ2FwdHVyZUV2ZW50cyA9IFsnZm9jdXMnLCAnYmx1ciddOwoKICB2YXIgYmluZCQxJDEgPSBmdW5jdGlvbihlbCwgc2VsZWN0b3IsIHR5cGUsIGZuLCBjYXB0dXJlKXsKICAgIGlmIChmb3JjZUNhcHR1cmVFdmVudHMuaW5kZXhPZih0eXBlKSAhPT0gLTEpIGNhcHR1cmUgPSB0cnVlOwoKICAgIHJldHVybiBjb21wb25lbnRFdmVudC5iaW5kKGVsLCB0eXBlLCBmdW5jdGlvbihlKXsKICAgICAgdmFyIHRhcmdldCA9IGUudGFyZ2V0IHx8IGUuc3JjRWxlbWVudDsKICAgICAgZS5kZWxlZ2F0ZVRhcmdldCA9IGNsb3Nlc3QodGFyZ2V0LCBzZWxlY3RvciwgdHJ1ZSk7CiAgICAgIGlmIChlLmRlbGVnYXRlVGFyZ2V0KSBmbi5jYWxsKGVsLCBlKTsKICAgIH0sIGNhcHR1cmUpOwogIH07CgogIC8qKgogICAqIFVuYmluZCBldmVudCBgdHlwZWAncyBjYWxsYmFjayBgZm5gLgogICAqCiAgICogQHBhcmFtIHtFbGVtZW50fSBlbAogICAqIEBwYXJhbSB7U3RyaW5nfSB0eXBlCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gZm4KICAgKiBAcGFyYW0ge0Jvb2xlYW59IGNhcHR1cmUKICAgKiBAYXBpIHB1YmxpYwogICAqLwoKICB2YXIgdW5iaW5kJDEgPSBmdW5jdGlvbihlbCwgdHlwZSwgZm4sIGNhcHR1cmUpewogICAgaWYgKGZvcmNlQ2FwdHVyZUV2ZW50cy5pbmRleE9mKHR5cGUpICE9PSAtMSkgY2FwdHVyZSA9IHRydWU7CgogICAgY29tcG9uZW50RXZlbnQudW5iaW5kKGVsLCB0eXBlLCBmbiwgY2FwdHVyZSk7CiAgfTsKCiAgdmFyIGRlbGVnYXRlRXZlbnRzID0gewogIAliaW5kOiBiaW5kJDEkMSwKICAJdW5iaW5kOiB1bmJpbmQkMQogIH07CgogIC8qKgogICAqIEV4cG9zZSBgcGFyc2VgLgogICAqLwoKICB2YXIgZG9taWZ5ID0gcGFyc2U7CgogIC8qKgogICAqIFRlc3RzIGZvciBicm93c2VyIHN1cHBvcnQuCiAgICovCgogIHZhciBpbm5lckhUTUxCdWcgPSBmYWxzZTsKICB2YXIgYnVnVGVzdERpdjsKICBpZiAodHlwZW9mIGRvY3VtZW50ICE9PSAndW5kZWZpbmVkJykgewogICAgYnVnVGVzdERpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgLy8gU2V0dXAKICAgIGJ1Z1Rlc3REaXYuaW5uZXJIVE1MID0gJyAgPGxpbmsvPjx0YWJsZT48L3RhYmxlPjxhIGhyZWY9Ii9hIj5hPC9hPjxpbnB1dCB0eXBlPSJjaGVja2JveCIvPic7CiAgICAvLyBNYWtlIHN1cmUgdGhhdCBsaW5rIGVsZW1lbnRzIGdldCBzZXJpYWxpemVkIGNvcnJlY3RseSBieSBpbm5lckhUTUwKICAgIC8vIFRoaXMgcmVxdWlyZXMgYSB3cmFwcGVyIGVsZW1lbnQgaW4gSUUKICAgIGlubmVySFRNTEJ1ZyA9ICFidWdUZXN0RGl2LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdsaW5rJykubGVuZ3RoOwogICAgYnVnVGVzdERpdiA9IHVuZGVmaW5lZDsKICB9CgogIC8qKgogICAqIFdyYXAgbWFwIGZyb20ganF1ZXJ5LgogICAqLwoKICB2YXIgbWFwJDEgPSB7CiAgICBsZWdlbmQ6IFsxLCAnPGZpZWxkc2V0PicsICc8L2ZpZWxkc2V0PiddLAogICAgdHI6IFsyLCAnPHRhYmxlPjx0Ym9keT4nLCAnPC90Ym9keT48L3RhYmxlPiddLAogICAgY29sOiBbMiwgJzx0YWJsZT48dGJvZHk+PC90Ym9keT48Y29sZ3JvdXA+JywgJzwvY29sZ3JvdXA+PC90YWJsZT4nXSwKICAgIC8vIGZvciBzY3JpcHQvbGluay9zdHlsZSB0YWdzIHRvIHdvcmsgaW4gSUU2LTgsIHlvdSBoYXZlIHRvIHdyYXAKICAgIC8vIGluIGEgZGl2IHdpdGggYSBub24td2hpdGVzcGFjZSBjaGFyYWN0ZXIgaW4gZnJvbnQsIGhhIQogICAgX2RlZmF1bHQ6IGlubmVySFRNTEJ1ZyA/IFsxLCAnWDxkaXY+JywgJzwvZGl2PiddIDogWzAsICcnLCAnJ10KICB9OwoKICBtYXAkMS50ZCA9CiAgbWFwJDEudGggPSBbMywgJzx0YWJsZT48dGJvZHk+PHRyPicsICc8L3RyPjwvdGJvZHk+PC90YWJsZT4nXTsKCiAgbWFwJDEub3B0aW9uID0KICBtYXAkMS5vcHRncm91cCA9IFsxLCAnPHNlbGVjdCBtdWx0aXBsZT0ibXVsdGlwbGUiPicsICc8L3NlbGVjdD4nXTsKCiAgbWFwJDEudGhlYWQgPQogIG1hcCQxLnRib2R5ID0KICBtYXAkMS5jb2xncm91cCA9CiAgbWFwJDEuY2FwdGlvbiA9CiAgbWFwJDEudGZvb3QgPSBbMSwgJzx0YWJsZT4nLCAnPC90YWJsZT4nXTsKCiAgbWFwJDEucG9seWxpbmUgPQogIG1hcCQxLmVsbGlwc2UgPQogIG1hcCQxLnBvbHlnb24gPQogIG1hcCQxLmNpcmNsZSA9CiAgbWFwJDEudGV4dCA9CiAgbWFwJDEubGluZSA9CiAgbWFwJDEucGF0aCA9CiAgbWFwJDEucmVjdCA9CiAgbWFwJDEuZyA9IFsxLCAnPHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZlcnNpb249IjEuMSI+JywnPC9zdmc+J107CgogIC8qKgogICAqIFBhcnNlIGBodG1sYCBhbmQgcmV0dXJuIGEgRE9NIE5vZGUgaW5zdGFuY2UsIHdoaWNoIGNvdWxkIGJlIGEgVGV4dE5vZGUsCiAgICogSFRNTCBET00gTm9kZSBvZiBzb21lIGtpbmQgKDxkaXY+IGZvciBleGFtcGxlKSwgb3IgYSBEb2N1bWVudEZyYWdtZW50CiAgICogaW5zdGFuY2UsIGRlcGVuZGluZyBvbiB0aGUgY29udGVudHMgb2YgdGhlIGBodG1sYCBzdHJpbmcuCiAgICoKICAgKiBAcGFyYW0ge1N0cmluZ30gaHRtbCAtIEhUTUwgc3RyaW5nIHRvICJkb21pZnkiCiAgICogQHBhcmFtIHtEb2N1bWVudH0gZG9jIC0gVGhlIGBkb2N1bWVudGAgaW5zdGFuY2UgdG8gY3JlYXRlIHRoZSBOb2RlIGZvcgogICAqIEByZXR1cm4ge0RPTU5vZGV9IHRoZSBUZXh0Tm9kZSwgRE9NIE5vZGUsIG9yIERvY3VtZW50RnJhZ21lbnQgaW5zdGFuY2UKICAgKiBAYXBpIHByaXZhdGUKICAgKi8KCiAgZnVuY3Rpb24gcGFyc2UoaHRtbCwgZG9jKSB7CiAgICBpZiAoJ3N0cmluZycgIT0gdHlwZW9mIGh0bWwpIHRocm93IG5ldyBUeXBlRXJyb3IoJ1N0cmluZyBleHBlY3RlZCcpOwoKICAgIC8vIGRlZmF1bHQgdG8gdGhlIGdsb2JhbCBgZG9jdW1lbnRgIG9iamVjdAogICAgaWYgKCFkb2MpIGRvYyA9IGRvY3VtZW50OwoKICAgIC8vIHRhZyBuYW1lCiAgICB2YXIgbSA9IC88KFtcdzpdKykvLmV4ZWMoaHRtbCk7CiAgICBpZiAoIW0pIHJldHVybiBkb2MuY3JlYXRlVGV4dE5vZGUoaHRtbCk7CgogICAgaHRtbCA9IGh0bWwucmVwbGFjZSgvXlxzK3xccyskL2csICcnKTsgLy8gUmVtb3ZlIGxlYWRpbmcvdHJhaWxpbmcgd2hpdGVzcGFjZQoKICAgIHZhciB0YWcgPSBtWzFdOwoKICAgIC8vIGJvZHkgc3VwcG9ydAogICAgaWYgKHRhZyA9PSAnYm9keScpIHsKICAgICAgdmFyIGVsID0gZG9jLmNyZWF0ZUVsZW1lbnQoJ2h0bWwnKTsKICAgICAgZWwuaW5uZXJIVE1MID0gaHRtbDsKICAgICAgcmV0dXJuIGVsLnJlbW92ZUNoaWxkKGVsLmxhc3RDaGlsZCk7CiAgICB9CgogICAgLy8gd3JhcCBtYXAKICAgIHZhciB3cmFwID0gbWFwJDFbdGFnXSB8fCBtYXAkMS5fZGVmYXVsdDsKICAgIHZhciBkZXB0aCA9IHdyYXBbMF07CiAgICB2YXIgcHJlZml4ID0gd3JhcFsxXTsKICAgIHZhciBzdWZmaXggPSB3cmFwWzJdOwogICAgdmFyIGVsID0gZG9jLmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgZWwuaW5uZXJIVE1MID0gcHJlZml4ICsgaHRtbCArIHN1ZmZpeDsKICAgIHdoaWxlIChkZXB0aC0tKSBlbCA9IGVsLmxhc3RDaGlsZDsKCiAgICAvLyBvbmUgZWxlbWVudAogICAgaWYgKGVsLmZpcnN0Q2hpbGQgPT0gZWwubGFzdENoaWxkKSB7CiAgICAgIHJldHVybiBlbC5yZW1vdmVDaGlsZChlbC5maXJzdENoaWxkKTsKICAgIH0KCiAgICAvLyBzZXZlcmFsIGVsZW1lbnRzCiAgICB2YXIgZnJhZ21lbnQgPSBkb2MuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpOwogICAgd2hpbGUgKGVsLmZpcnN0Q2hpbGQpIHsKICAgICAgZnJhZ21lbnQuYXBwZW5kQ2hpbGQoZWwucmVtb3ZlQ2hpbGQoZWwuZmlyc3RDaGlsZCkpOwogICAgfQoKICAgIHJldHVybiBmcmFnbWVudDsKICB9CgogIHZhciBwcm90byQxID0gdHlwZW9mIEVsZW1lbnQgIT09ICd1bmRlZmluZWQnID8gRWxlbWVudC5wcm90b3R5cGUgOiB7fTsKICB2YXIgdmVuZG9yJDEgPSBwcm90byQxLm1hdGNoZXMKICAgIHx8IHByb3RvJDEubWF0Y2hlc1NlbGVjdG9yCiAgICB8fCBwcm90byQxLndlYmtpdE1hdGNoZXNTZWxlY3RvcgogICAgfHwgcHJvdG8kMS5tb3pNYXRjaGVzU2VsZWN0b3IKICAgIHx8IHByb3RvJDEubXNNYXRjaGVzU2VsZWN0b3IKICAgIHx8IHByb3RvJDEub01hdGNoZXNTZWxlY3RvcjsKCiAgZnVuY3Rpb24gcXVlcnkoc2VsZWN0b3IsIGVsKSB7CiAgICBlbCA9IGVsIHx8IGRvY3VtZW50OwoKICAgIHJldHVybiBlbC5xdWVyeVNlbGVjdG9yKHNlbGVjdG9yKTsKICB9CgogIGZ1bmN0aW9uIGFsbChzZWxlY3RvciwgZWwpIHsKICAgIGVsID0gZWwgfHwgZG9jdW1lbnQ7CgogICAgcmV0dXJuIGVsLnF1ZXJ5U2VsZWN0b3JBbGwoc2VsZWN0b3IpOwogIH0KCiAgZnVuY3Rpb24gcmVtb3ZlKGVsKSB7CiAgICBlbC5wYXJlbnROb2RlICYmIGVsLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoZWwpOwogIH0KCiAgZnVuY3Rpb24gZW5zdXJlSW1wb3J0ZWQoZWxlbWVudCwgdGFyZ2V0KSB7CgogICAgaWYgKGVsZW1lbnQub3duZXJEb2N1bWVudCAhPT0gdGFyZ2V0Lm93bmVyRG9jdW1lbnQpIHsKICAgICAgdHJ5IHsKICAgICAgICAvLyBtYXkgZmFpbCBvbiB3ZWJraXQKICAgICAgICByZXR1cm4gdGFyZ2V0Lm93bmVyRG9jdW1lbnQuaW1wb3J0Tm9kZShlbGVtZW50LCB0cnVlKTsKICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIC8vIGlnbm9yZQogICAgICB9CiAgICB9CgogICAgcmV0dXJuIGVsZW1lbnQ7CiAgfQoKICAvKioKICAgKiBhcHBlbmRUbyB1dGlsaXR5CiAgICovCgogIC8qKgogICAqIEFwcGVuZCBhIG5vZGUgdG8gYSB0YXJnZXQgZWxlbWVudCBhbmQgcmV0dXJuIHRoZSBhcHBlbmRlZCBub2RlLgogICAqCiAgICogQHBhcmFtICB7U1ZHRWxlbWVudH0gZWxlbWVudAogICAqIEBwYXJhbSAge1NWR0VsZW1lbnR9IHRhcmdldAogICAqCiAgICogQHJldHVybiB7U1ZHRWxlbWVudH0gdGhlIGFwcGVuZGVkIG5vZGUKICAgKi8KICBmdW5jdGlvbiBhcHBlbmRUbyhlbGVtZW50LCB0YXJnZXQpIHsKICAgIHJldHVybiB0YXJnZXQuYXBwZW5kQ2hpbGQoZW5zdXJlSW1wb3J0ZWQoZWxlbWVudCwgdGFyZ2V0KSk7CiAgfQoKICAvKioKICAgKiBhcHBlbmQgdXRpbGl0eQogICAqLwoKICAvKioKICAgKiBBcHBlbmQgYSBub2RlIHRvIGFuIGVsZW1lbnQKICAgKgogICAqIEBwYXJhbSAge1NWR0VsZW1lbnR9IGVsZW1lbnQKICAgKiBAcGFyYW0gIHtTVkdFbGVtZW50fSBub2RlCiAgICoKICAgKiBAcmV0dXJuIHtTVkdFbGVtZW50fSB0aGUgZWxlbWVudAogICAqLwogIGZ1bmN0aW9uIGFwcGVuZCh0YXJnZXQsIG5vZGUpIHsKICAgIGFwcGVuZFRvKG5vZGUsIHRhcmdldCk7CiAgICByZXR1cm4gdGFyZ2V0OwogIH0KCiAgLyoqCiAgICogYXR0cmlidXRlIGFjY2Vzc29yIHV0aWxpdHkKICAgKi8KCiAgdmFyIExFTkdUSF9BVFRSID0gMjsKCiAgdmFyIENTU19QUk9QRVJUSUVTID0gewogICAgJ2FsaWdubWVudC1iYXNlbGluZSc6IDEsCiAgICAnYmFzZWxpbmUtc2hpZnQnOiAxLAogICAgJ2NsaXAnOiAxLAogICAgJ2NsaXAtcGF0aCc6IDEsCiAgICAnY2xpcC1ydWxlJzogMSwKICAgICdjb2xvcic6IDEsCiAgICAnY29sb3ItaW50ZXJwb2xhdGlvbic6IDEsCiAgICAnY29sb3ItaW50ZXJwb2xhdGlvbi1maWx0ZXJzJzogMSwKICAgICdjb2xvci1wcm9maWxlJzogMSwKICAgICdjb2xvci1yZW5kZXJpbmcnOiAxLAogICAgJ2N1cnNvcic6IDEsCiAgICAnZGlyZWN0aW9uJzogMSwKICAgICdkaXNwbGF5JzogMSwKICAgICdkb21pbmFudC1iYXNlbGluZSc6IDEsCiAgICAnZW5hYmxlLWJhY2tncm91bmQnOiAxLAogICAgJ2ZpbGwnOiAxLAogICAgJ2ZpbGwtb3BhY2l0eSc6IDEsCiAgICAnZmlsbC1ydWxlJzogMSwKICAgICdmaWx0ZXInOiAxLAogICAgJ2Zsb29kLWNvbG9yJzogMSwKICAgICdmbG9vZC1vcGFjaXR5JzogMSwKICAgICdmb250JzogMSwKICAgICdmb250LWZhbWlseSc6IDEsCiAgICAnZm9udC1zaXplJzogTEVOR1RIX0FUVFIsCiAgICAnZm9udC1zaXplLWFkanVzdCc6IDEsCiAgICAnZm9udC1zdHJldGNoJzogMSwKICAgICdmb250LXN0eWxlJzogMSwKICAgICdmb250LXZhcmlhbnQnOiAxLAogICAgJ2ZvbnQtd2VpZ2h0JzogMSwKICAgICdnbHlwaC1vcmllbnRhdGlvbi1ob3Jpem9udGFsJzogMSwKICAgICdnbHlwaC1vcmllbnRhdGlvbi12ZXJ0aWNhbCc6IDEsCiAgICAnaW1hZ2UtcmVuZGVyaW5nJzogMSwKICAgICdrZXJuaW5nJzogMSwKICAgICdsZXR0ZXItc3BhY2luZyc6IDEsCiAgICAnbGlnaHRpbmctY29sb3InOiAxLAogICAgJ21hcmtlcic6IDEsCiAgICAnbWFya2VyLWVuZCc6IDEsCiAgICAnbWFya2VyLW1pZCc6IDEsCiAgICAnbWFya2VyLXN0YXJ0JzogMSwKICAgICdtYXNrJzogMSwKICAgICdvcGFjaXR5JzogMSwKICAgICdvdmVyZmxvdyc6IDEsCiAgICAncG9pbnRlci1ldmVudHMnOiAxLAogICAgJ3NoYXBlLXJlbmRlcmluZyc6IDEsCiAgICAnc3RvcC1jb2xvcic6IDEsCiAgICAnc3RvcC1vcGFjaXR5JzogMSwKICAgICdzdHJva2UnOiAxLAogICAgJ3N0cm9rZS1kYXNoYXJyYXknOiAxLAogICAgJ3N0cm9rZS1kYXNob2Zmc2V0JzogMSwKICAgICdzdHJva2UtbGluZWNhcCc6IDEsCiAgICAnc3Ryb2tlLWxpbmVqb2luJzogMSwKICAgICdzdHJva2UtbWl0ZXJsaW1pdCc6IDEsCiAgICAnc3Ryb2tlLW9wYWNpdHknOiAxLAogICAgJ3N0cm9rZS13aWR0aCc6IExFTkdUSF9BVFRSLAogICAgJ3RleHQtYW5jaG9yJzogMSwKICAgICd0ZXh0LWRlY29yYXRpb24nOiAxLAogICAgJ3RleHQtcmVuZGVyaW5nJzogMSwKICAgICd1bmljb2RlLWJpZGknOiAxLAogICAgJ3Zpc2liaWxpdHknOiAxLAogICAgJ3dvcmQtc3BhY2luZyc6IDEsCiAgICAnd3JpdGluZy1tb2RlJzogMQogIH07CgoKICBmdW5jdGlvbiBnZXRBdHRyaWJ1dGUobm9kZSwgbmFtZSkgewogICAgaWYgKENTU19QUk9QRVJUSUVTW25hbWVdKSB7CiAgICAgIHJldHVybiBub2RlLnN0eWxlW25hbWVdOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIG5vZGUuZ2V0QXR0cmlidXRlTlMobnVsbCwgbmFtZSk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBzZXRBdHRyaWJ1dGUobm9kZSwgbmFtZSwgdmFsdWUpIHsKICAgIHZhciBoeXBoZW5hdGVkID0gbmFtZS5yZXBsYWNlKC8oW2Etel0pKFtBLVpdKS9nLCAnJDEtJDInKS50b0xvd2VyQ2FzZSgpOwoKICAgIHZhciB0eXBlID0gQ1NTX1BST1BFUlRJRVNbaHlwaGVuYXRlZF07CgogICAgaWYgKHR5cGUpIHsKICAgICAgLy8gYXBwZW5kIHBpeGVsIHVuaXQsIHVubGVzcyBwcmVzZW50CiAgICAgIGlmICh0eXBlID09PSBMRU5HVEhfQVRUUiAmJiB0eXBlb2YgdmFsdWUgPT09ICdudW1iZXInKSB7CiAgICAgICAgdmFsdWUgPSBTdHJpbmcodmFsdWUpICsgJ3B4JzsKICAgICAgfQoKICAgICAgbm9kZS5zdHlsZVtoeXBoZW5hdGVkXSA9IHZhbHVlOwogICAgfSBlbHNlIHsKICAgICAgbm9kZS5zZXRBdHRyaWJ1dGVOUyhudWxsLCBuYW1lLCB2YWx1ZSk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBzZXRBdHRyaWJ1dGVzKG5vZGUsIGF0dHJzKSB7CgogICAgdmFyIG5hbWVzID0gT2JqZWN0LmtleXMoYXR0cnMpLCBpLCBuYW1lOwoKICAgIGZvciAoaSA9IDAsIG5hbWU7IChuYW1lID0gbmFtZXNbaV0pOyBpKyspIHsKICAgICAgc2V0QXR0cmlidXRlKG5vZGUsIG5hbWUsIGF0dHJzW25hbWVdKTsKICAgIH0KICB9CgogIC8qKgogICAqIEdldHMgb3Igc2V0cyByYXcgYXR0cmlidXRlcyBvbiBhIG5vZGUuCiAgICoKICAgKiBAcGFyYW0gIHtTVkdFbGVtZW50fSBub2RlCiAgICogQHBhcmFtICB7T2JqZWN0fSBbYXR0cnNdCiAgICogQHBhcmFtICB7U3RyaW5nfSBbbmFtZV0KICAgKiBAcGFyYW0gIHtTdHJpbmd9IFt2YWx1ZV0KICAgKgogICAqIEByZXR1cm4ge1N0cmluZ30KICAgKi8KICBmdW5jdGlvbiBhdHRyJDEobm9kZSwgbmFtZSwgdmFsdWUpIHsKICAgIGlmICh0eXBlb2YgbmFtZSA9PT0gJ3N0cmluZycpIHsKICAgICAgaWYgKHZhbHVlICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBzZXRBdHRyaWJ1dGUobm9kZSwgbmFtZSwgdmFsdWUpOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBnZXRBdHRyaWJ1dGUobm9kZSwgbmFtZSk7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHNldEF0dHJpYnV0ZXMobm9kZSwgbmFtZSk7CiAgICB9CgogICAgcmV0dXJuIG5vZGU7CiAgfQoKICAvKioNCiAgICogQ2xlYXIgdXRpbGl0eQ0KICAgKi8NCiAgZnVuY3Rpb24gaW5kZXgoYXJyLCBvYmopIHsNCiAgICBpZiAoYXJyLmluZGV4T2YpIHsNCiAgICAgIHJldHVybiBhcnIuaW5kZXhPZihvYmopOw0KICAgIH0NCg0KDQogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcnIubGVuZ3RoOyArK2kpIHsNCiAgICAgIGlmIChhcnJbaV0gPT09IG9iaikgew0KICAgICAgICByZXR1cm4gaTsNCiAgICAgIH0NCiAgICB9DQoNCiAgICByZXR1cm4gLTE7DQogIH0NCg0KICB2YXIgcmUkMSA9IC9ccysvOw0KDQogIHZhciB0b1N0cmluZyQxID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZzsNCg0KICBmdW5jdGlvbiBkZWZpbmVkKG8pIHsNCiAgICByZXR1cm4gdHlwZW9mIG8gIT09ICd1bmRlZmluZWQnOw0KICB9DQoNCiAgLyoqDQogICAqIFdyYXAgYGVsYCBpbiBhIGBDbGFzc0xpc3RgLg0KICAgKg0KICAgKiBAcGFyYW0ge0VsZW1lbnR9IGVsDQogICAqIEByZXR1cm4ge0NsYXNzTGlzdH0NCiAgICogQGFwaSBwdWJsaWMNCiAgICovDQoNCiAgZnVuY3Rpb24gY2xhc3NlcyQxKGVsKSB7DQogICAgcmV0dXJuIG5ldyBDbGFzc0xpc3QkMShlbCk7DQogIH0NCg0KICBmdW5jdGlvbiBDbGFzc0xpc3QkMShlbCkgew0KICAgIGlmICghZWwgfHwgIWVsLm5vZGVUeXBlKSB7DQogICAgICB0aHJvdyBuZXcgRXJyb3IoJ0EgRE9NIGVsZW1lbnQgcmVmZXJlbmNlIGlzIHJlcXVpcmVkJyk7DQogICAgfQ0KICAgIHRoaXMuZWwgPSBlbDsNCiAgICB0aGlzLmxpc3QgPSBlbC5jbGFzc0xpc3Q7DQogIH0NCg0KICAvKioNCiAgICogQWRkIGNsYXNzIGBuYW1lYCBpZiBub3QgYWxyZWFkeSBwcmVzZW50Lg0KICAgKg0KICAgKiBAcGFyYW0ge1N0cmluZ30gbmFtZQ0KICAgKiBAcmV0dXJuIHtDbGFzc0xpc3R9DQogICAqIEBhcGkgcHVibGljDQogICAqLw0KDQogIENsYXNzTGlzdCQxLnByb3RvdHlwZS5hZGQgPSBmdW5jdGlvbihuYW1lKSB7DQoNCiAgICAvLyBjbGFzc0xpc3QNCiAgICBpZiAodGhpcy5saXN0KSB7DQogICAgICB0aGlzLmxpc3QuYWRkKG5hbWUpOw0KICAgICAgcmV0dXJuIHRoaXM7DQogICAgfQ0KDQogICAgLy8gZmFsbGJhY2sNCiAgICB2YXIgYXJyID0gdGhpcy5hcnJheSgpOw0KICAgIHZhciBpID0gaW5kZXgoYXJyLCBuYW1lKTsNCiAgICBpZiAoIX5pKSB7DQogICAgICBhcnIucHVzaChuYW1lKTsNCiAgICB9DQoNCiAgICBpZiAoZGVmaW5lZCh0aGlzLmVsLmNsYXNzTmFtZS5iYXNlVmFsKSkgew0KICAgICAgdGhpcy5lbC5jbGFzc05hbWUuYmFzZVZhbCA9IGFyci5qb2luKCcgJyk7DQogICAgfSBlbHNlIHsNCiAgICAgIHRoaXMuZWwuY2xhc3NOYW1lID0gYXJyLmpvaW4oJyAnKTsNCiAgICB9DQoNCiAgICByZXR1cm4gdGhpczsNCiAgfTsNCg0KICAvKioNCiAgICogUmVtb3ZlIGNsYXNzIGBuYW1lYCB3aGVuIHByZXNlbnQsIG9yDQogICAqIHBhc3MgYSByZWd1bGFyIGV4cHJlc3Npb24gdG8gcmVtb3ZlDQogICAqIGFueSB3aGljaCBtYXRjaC4NCiAgICoNCiAgICogQHBhcmFtIHtTdHJpbmd8UmVnRXhwfSBuYW1lDQogICAqIEByZXR1cm4ge0NsYXNzTGlzdH0NCiAgICogQGFwaSBwdWJsaWMNCiAgICovDQoNCiAgQ2xhc3NMaXN0JDEucHJvdG90eXBlLnJlbW92ZSA9IGZ1bmN0aW9uKG5hbWUpIHsNCiAgICBpZiAoJ1tvYmplY3QgUmVnRXhwXScgPT09IHRvU3RyaW5nJDEuY2FsbChuYW1lKSkgew0KICAgICAgcmV0dXJuIHRoaXMucmVtb3ZlTWF0Y2hpbmcobmFtZSk7DQogICAgfQ0KDQogICAgLy8gY2xhc3NMaXN0DQogICAgaWYgKHRoaXMubGlzdCkgew0KICAgICAgdGhpcy5saXN0LnJlbW92ZShuYW1lKTsNCiAgICAgIHJldHVybiB0aGlzOw0KICAgIH0NCg0KICAgIC8vIGZhbGxiYWNrDQogICAgdmFyIGFyciA9IHRoaXMuYXJyYXkoKTsNCiAgICB2YXIgaSA9IGluZGV4KGFyciwgbmFtZSk7DQogICAgaWYgKH5pKSB7DQogICAgICBhcnIuc3BsaWNlKGksIDEpOw0KICAgIH0NCiAgICB0aGlzLmVsLmNsYXNzTmFtZS5iYXNlVmFsID0gYXJyLmpvaW4oJyAnKTsNCiAgICByZXR1cm4gdGhpczsNCiAgfTsNCg0KICAvKioNCiAgICogUmVtb3ZlIGFsbCBjbGFzc2VzIG1hdGNoaW5nIGByZWAuDQogICAqDQogICAqIEBwYXJhbSB7UmVnRXhwfSByZQ0KICAgKiBAcmV0dXJuIHtDbGFzc0xpc3R9DQogICAqIEBhcGkgcHJpdmF0ZQ0KICAgKi8NCg0KICBDbGFzc0xpc3QkMS5wcm90b3R5cGUucmVtb3ZlTWF0Y2hpbmcgPSBmdW5jdGlvbihyZSkgew0KICAgIHZhciBhcnIgPSB0aGlzLmFycmF5KCk7DQogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcnIubGVuZ3RoOyBpKyspIHsNCiAgICAgIGlmIChyZS50ZXN0KGFycltpXSkpIHsNCiAgICAgICAgdGhpcy5yZW1vdmUoYXJyW2ldKTsNCiAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuIHRoaXM7DQogIH07DQoNCiAgLyoqDQogICAqIFRvZ2dsZSBjbGFzcyBgbmFtZWAsIGNhbiBmb3JjZSBzdGF0ZSB2aWEgYGZvcmNlYC4NCiAgICoNCiAgICogRm9yIGJyb3dzZXJzIHRoYXQgc3VwcG9ydCBjbGFzc0xpc3QsIGJ1dCBkbyBub3Qgc3VwcG9ydCBgZm9yY2VgIHlldCwNCiAgICogdGhlIG1pc3Rha2Ugd2lsbCBiZSBkZXRlY3RlZCBhbmQgY29ycmVjdGVkLg0KICAgKg0KICAgKiBAcGFyYW0ge1N0cmluZ30gbmFtZQ0KICAgKiBAcGFyYW0ge0Jvb2xlYW59IGZvcmNlDQogICAqIEByZXR1cm4ge0NsYXNzTGlzdH0NCiAgICogQGFwaSBwdWJsaWMNCiAgICovDQoNCiAgQ2xhc3NMaXN0JDEucHJvdG90eXBlLnRvZ2dsZSA9IGZ1bmN0aW9uKG5hbWUsIGZvcmNlKSB7DQogICAgLy8gY2xhc3NMaXN0DQogICAgaWYgKHRoaXMubGlzdCkgew0KICAgICAgaWYgKGRlZmluZWQoZm9yY2UpKSB7DQogICAgICAgIGlmIChmb3JjZSAhPT0gdGhpcy5saXN0LnRvZ2dsZShuYW1lLCBmb3JjZSkpIHsNCiAgICAgICAgICB0aGlzLmxpc3QudG9nZ2xlKG5hbWUpOyAvLyB0b2dnbGUgYWdhaW4gdG8gY29ycmVjdA0KICAgICAgICB9DQogICAgICB9IGVsc2Ugew0KICAgICAgICB0aGlzLmxpc3QudG9nZ2xlKG5hbWUpOw0KICAgICAgfQ0KICAgICAgcmV0dXJuIHRoaXM7DQogICAgfQ0KDQogICAgLy8gZmFsbGJhY2sNCiAgICBpZiAoZGVmaW5lZChmb3JjZSkpIHsNCiAgICAgIGlmICghZm9yY2UpIHsNCiAgICAgICAgdGhpcy5yZW1vdmUobmFtZSk7DQogICAgICB9IGVsc2Ugew0KICAgICAgICB0aGlzLmFkZChuYW1lKTsNCiAgICAgIH0NCiAgICB9IGVsc2Ugew0KICAgICAgaWYgKHRoaXMuaGFzKG5hbWUpKSB7DQogICAgICAgIHRoaXMucmVtb3ZlKG5hbWUpOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgdGhpcy5hZGQobmFtZSk7DQogICAgICB9DQogICAgfQ0KDQogICAgcmV0dXJuIHRoaXM7DQogIH07DQoNCiAgLyoqDQogICAqIFJldHVybiBhbiBhcnJheSBvZiBjbGFzc2VzLg0KICAgKg0KICAgKiBAcmV0dXJuIHtBcnJheX0NCiAgICogQGFwaSBwdWJsaWMNCiAgICovDQoNCiAgQ2xhc3NMaXN0JDEucHJvdG90eXBlLmFycmF5ID0gZnVuY3Rpb24oKSB7DQogICAgdmFyIGNsYXNzTmFtZSA9IHRoaXMuZWwuZ2V0QXR0cmlidXRlKCdjbGFzcycpIHx8ICcnOw0KICAgIHZhciBzdHIgPSBjbGFzc05hbWUucmVwbGFjZSgvXlxzK3xccyskL2csICcnKTsNCiAgICB2YXIgYXJyID0gc3RyLnNwbGl0KHJlJDEpOw0KICAgIGlmICgnJyA9PT0gYXJyWzBdKSB7DQogICAgICBhcnIuc2hpZnQoKTsNCiAgICB9DQogICAgcmV0dXJuIGFycjsNCiAgfTsNCg0KICAvKioNCiAgICogQ2hlY2sgaWYgY2xhc3MgYG5hbWVgIGlzIHByZXNlbnQuDQogICAqDQogICAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lDQogICAqIEByZXR1cm4ge0NsYXNzTGlzdH0NCiAgICogQGFwaSBwdWJsaWMNCiAgICovDQoNCiAgQ2xhc3NMaXN0JDEucHJvdG90eXBlLmhhcyA9DQogIENsYXNzTGlzdCQxLnByb3RvdHlwZS5jb250YWlucyA9IGZ1bmN0aW9uKG5hbWUpIHsNCiAgICByZXR1cm4gKA0KICAgICAgdGhpcy5saXN0ID8NCiAgICAgICAgdGhpcy5saXN0LmNvbnRhaW5zKG5hbWUpIDoNCiAgICAgICAgISEgfmluZGV4KHRoaXMuYXJyYXkoKSwgbmFtZSkNCiAgICApOw0KICB9OwoKICBmdW5jdGlvbiByZW1vdmUkMShlbGVtZW50KSB7CiAgICB2YXIgcGFyZW50ID0gZWxlbWVudC5wYXJlbnROb2RlOwoKICAgIGlmIChwYXJlbnQpIHsKICAgICAgcGFyZW50LnJlbW92ZUNoaWxkKGVsZW1lbnQpOwogICAgfQoKICAgIHJldHVybiBlbGVtZW50OwogIH0KCiAgLyoqCiAgICogQ2xlYXIgdXRpbGl0eQogICAqLwoKICAvKioKICAgKiBSZW1vdmVzIGFsbCBjaGlsZHJlbiBmcm9tIHRoZSBnaXZlbiBlbGVtZW50CiAgICoKICAgKiBAcGFyYW0gIHtET01FbGVtZW50fSBlbGVtZW50CiAgICogQHJldHVybiB7RE9NRWxlbWVudH0gdGhlIGVsZW1lbnQgKGZvciBjaGFpbmluZykKICAgKi8KICBmdW5jdGlvbiBjbGVhciQxKGVsZW1lbnQpIHsKICAgIHZhciBjaGlsZDsKCiAgICB3aGlsZSAoKGNoaWxkID0gZWxlbWVudC5maXJzdENoaWxkKSkgewogICAgICByZW1vdmUkMShjaGlsZCk7CiAgICB9CgogICAgcmV0dXJuIGVsZW1lbnQ7CiAgfQoKICB2YXIgbnMgPSB7CiAgICBzdmc6ICdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZycKICB9OwoKICAvKioKICAgKiBET00gcGFyc2luZyB1dGlsaXR5CiAgICovCgogIHZhciBTVkdfU1RBUlQgPSAnPHN2ZyB4bWxucz0iJyArIG5zLnN2ZyArICciJzsKCiAgZnVuY3Rpb24gcGFyc2UkMShzdmcpIHsKCiAgICB2YXIgdW53cmFwID0gZmFsc2U7CgogICAgLy8gZW5zdXJlIHdlIGltcG9ydCBhIHZhbGlkIHN2ZyBkb2N1bWVudAogICAgaWYgKHN2Zy5zdWJzdHJpbmcoMCwgNCkgPT09ICc8c3ZnJykgewogICAgICBpZiAoc3ZnLmluZGV4T2YobnMuc3ZnKSA9PT0gLTEpIHsKICAgICAgICBzdmcgPSBTVkdfU1RBUlQgKyBzdmcuc3Vic3RyaW5nKDQpOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICAvLyBuYW1lc3BhY2Ugc3ZnCiAgICAgIHN2ZyA9IFNWR19TVEFSVCArICc+JyArIHN2ZyArICc8L3N2Zz4nOwogICAgICB1bndyYXAgPSB0cnVlOwogICAgfQoKICAgIHZhciBwYXJzZWQgPSBwYXJzZURvY3VtZW50KHN2Zyk7CgogICAgaWYgKCF1bndyYXApIHsKICAgICAgcmV0dXJuIHBhcnNlZDsKICAgIH0KCiAgICB2YXIgZnJhZ21lbnQgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7CgogICAgdmFyIHBhcmVudCA9IHBhcnNlZC5maXJzdENoaWxkOwoKICAgIHdoaWxlIChwYXJlbnQuZmlyc3RDaGlsZCkgewogICAgICBmcmFnbWVudC5hcHBlbmRDaGlsZChwYXJlbnQuZmlyc3RDaGlsZCk7CiAgICB9CgogICAgcmV0dXJuIGZyYWdtZW50OwogIH0KCiAgZnVuY3Rpb24gcGFyc2VEb2N1bWVudChzdmcpIHsKCiAgICB2YXIgcGFyc2VyOwoKICAgIC8vIHBhcnNlCiAgICBwYXJzZXIgPSBuZXcgRE9NUGFyc2VyKCk7CiAgICBwYXJzZXIuYXN5bmMgPSBmYWxzZTsKCiAgICByZXR1cm4gcGFyc2VyLnBhcnNlRnJvbVN0cmluZyhzdmcsICd0ZXh0L3htbCcpOwogIH0KCiAgLyoqCiAgICogQ3JlYXRlIHV0aWxpdHkgZm9yIFNWRyBlbGVtZW50cwogICAqLwoKCiAgLyoqCiAgICogQ3JlYXRlIGEgc3BlY2lmaWMgdHlwZSBmcm9tIG5hbWUgb3IgU1ZHIG1hcmt1cC4KICAgKgogICAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lIHRoZSBuYW1lIG9yIG1hcmt1cCBvZiB0aGUgZWxlbWVudAogICAqIEBwYXJhbSB7T2JqZWN0fSBbYXR0cnNdIGF0dHJpYnV0ZXMgdG8gc2V0IG9uIHRoZSBlbGVtZW50CiAgICoKICAgKiBAcmV0dXJucyB7U1ZHRWxlbWVudH0KICAgKi8KICBmdW5jdGlvbiBjcmVhdGUobmFtZSwgYXR0cnMpIHsKICAgIHZhciBlbGVtZW50OwoKICAgIGlmIChuYW1lLmNoYXJBdCgwKSA9PT0gJzwnKSB7CiAgICAgIGVsZW1lbnQgPSBwYXJzZSQxKG5hbWUpLmZpcnN0Q2hpbGQ7CiAgICAgIGVsZW1lbnQgPSBkb2N1bWVudC5pbXBvcnROb2RlKGVsZW1lbnQsIHRydWUpOwogICAgfSBlbHNlIHsKICAgICAgZWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhucy5zdmcsIG5hbWUpOwogICAgfQoKICAgIGlmIChhdHRycykgewogICAgICBhdHRyJDEoZWxlbWVudCwgYXR0cnMpOwogICAgfQoKICAgIHJldHVybiBlbGVtZW50OwogIH0KCiAgLyoqCiAgICogR2VvbWV0cnkgaGVscGVycwogICAqLwoKICAvLyBmYWtlIG5vZGUgdXNlZCB0byBpbnN0YW50aWF0ZSBzdmcgZ2VvbWV0cnkgZWxlbWVudHMKICB2YXIgbm9kZSA9IGNyZWF0ZSgnc3ZnJyk7CgogIGZ1bmN0aW9uIGV4dGVuZChvYmplY3QsIHByb3BzKSB7CiAgICB2YXIgaSwgaywga2V5cyA9IE9iamVjdC5rZXlzKHByb3BzKTsKCiAgICBmb3IgKGkgPSAwOyAoayA9IGtleXNbaV0pOyBpKyspIHsKICAgICAgb2JqZWN0W2tdID0gcHJvcHNba107CiAgICB9CgogICAgcmV0dXJuIG9iamVjdDsKICB9CgogIC8qKgogICAqIENyZWF0ZSBtYXRyaXggdmlhIGFyZ3MuCiAgICoKICAgKiBAZXhhbXBsZQogICAqCiAgICogY3JlYXRlTWF0cml4KHsgYTogMSwgYjogMSB9KTsKICAgKiBjcmVhdGVNYXRyaXgoKTsKICAgKiBjcmVhdGVNYXRyaXgoMSwgMiwgMCwgMCwgMzAsIDIwKTsKICAgKgogICAqIEByZXR1cm4ge1NWR01hdHJpeH0KICAgKi8KICBmdW5jdGlvbiBjcmVhdGVNYXRyaXgoYSwgYiwgYywgZCwgZSwgZikgewogICAgdmFyIG1hdHJpeCA9IG5vZGUuY3JlYXRlU1ZHTWF0cml4KCk7CgogICAgc3dpdGNoIChhcmd1bWVudHMubGVuZ3RoKSB7CiAgICBjYXNlIDA6CiAgICAgIHJldHVybiBtYXRyaXg7CiAgICBjYXNlIDE6CiAgICAgIHJldHVybiBleHRlbmQobWF0cml4LCBhKTsKICAgIGNhc2UgNjoKICAgICAgcmV0dXJuIGV4dGVuZChtYXRyaXgsIHsKICAgICAgICBhOiBhLAogICAgICAgIGI6IGIsCiAgICAgICAgYzogYywKICAgICAgICBkOiBkLAogICAgICAgIGU6IGUsCiAgICAgICAgZjogZgogICAgICB9KTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIGNyZWF0ZVRyYW5zZm9ybShtYXRyaXgpIHsKICAgIGlmIChtYXRyaXgpIHsKICAgICAgcmV0dXJuIG5vZGUuY3JlYXRlU1ZHVHJhbnNmb3JtRnJvbU1hdHJpeChtYXRyaXgpOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIG5vZGUuY3JlYXRlU1ZHVHJhbnNmb3JtKCk7CiAgICB9CiAgfQoKICAvKioKICAgKiBTZXJpYWxpemF0aW9uIHV0aWwKICAgKi8KCiAgdmFyIFRFWFRfRU5USVRJRVMgPSAvKFsmPD5dezF9KS9nOwogIHZhciBBVFRSX0VOVElUSUVTID0gLyhbXG5cciJdezF9KS9nOwoKICB2YXIgRU5USVRZX1JFUExBQ0VNRU5UID0gewogICAgJyYnOiAnJmFtcDsnLAogICAgJzwnOiAnJmx0OycsCiAgICAnPic6ICcmZ3Q7JywKICAgICciJzogJ1wnJwogIH07CgogIGZ1bmN0aW9uIGVzY2FwZShzdHIsIHBhdHRlcm4pIHsKCiAgICBmdW5jdGlvbiByZXBsYWNlRm4obWF0Y2gsIGVudGl0eSkgewogICAgICByZXR1cm4gRU5USVRZX1JFUExBQ0VNRU5UW2VudGl0eV0gfHwgZW50aXR5OwogICAgfQoKICAgIHJldHVybiBzdHIucmVwbGFjZShwYXR0ZXJuLCByZXBsYWNlRm4pOwogIH0KCiAgZnVuY3Rpb24gc2VyaWFsaXplKG5vZGUsIG91dHB1dCkgewoKICAgIHZhciBpLCBsZW4sIGF0dHJNYXAsIGF0dHJOb2RlLCBjaGlsZE5vZGVzOwoKICAgIHN3aXRjaCAobm9kZS5ub2RlVHlwZSkgewogICAgLy8gVEVYVAogICAgY2FzZSAzOgogICAgICAvLyByZXBsYWNlIHNwZWNpYWwgWE1MIGNoYXJhY3RlcnMKICAgICAgb3V0cHV0LnB1c2goZXNjYXBlKG5vZGUudGV4dENvbnRlbnQsIFRFWFRfRU5USVRJRVMpKTsKICAgICAgYnJlYWs7CgogICAgLy8gRUxFTUVOVAogICAgY2FzZSAxOgogICAgICBvdXRwdXQucHVzaCgnPCcsIG5vZGUudGFnTmFtZSk7CgogICAgICBpZiAobm9kZS5oYXNBdHRyaWJ1dGVzKCkpIHsKICAgICAgICBhdHRyTWFwID0gbm9kZS5hdHRyaWJ1dGVzOwogICAgICAgIGZvciAoaSA9IDAsIGxlbiA9IGF0dHJNYXAubGVuZ3RoOyBpIDwgbGVuOyArK2kpIHsKICAgICAgICAgIGF0dHJOb2RlID0gYXR0ck1hcC5pdGVtKGkpOwogICAgICAgICAgb3V0cHV0LnB1c2goJyAnLCBhdHRyTm9kZS5uYW1lLCAnPSInLCBlc2NhcGUoYXR0ck5vZGUudmFsdWUsIEFUVFJfRU5USVRJRVMpLCAnIicpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKG5vZGUuaGFzQ2hpbGROb2RlcygpKSB7CiAgICAgICAgb3V0cHV0LnB1c2goJz4nKTsKICAgICAgICBjaGlsZE5vZGVzID0gbm9kZS5jaGlsZE5vZGVzOwogICAgICAgIGZvciAoaSA9IDAsIGxlbiA9IGNoaWxkTm9kZXMubGVuZ3RoOyBpIDwgbGVuOyArK2kpIHsKICAgICAgICAgIHNlcmlhbGl6ZShjaGlsZE5vZGVzLml0ZW0oaSksIG91dHB1dCk7CiAgICAgICAgfQogICAgICAgIG91dHB1dC5wdXNoKCc8LycsIG5vZGUudGFnTmFtZSwgJz4nKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBvdXRwdXQucHVzaCgnLz4nKTsKICAgICAgfQogICAgICBicmVhazsKCiAgICAvLyBDT01NRU5UCiAgICBjYXNlIDg6CiAgICAgIG91dHB1dC5wdXNoKCc8IS0tJywgZXNjYXBlKG5vZGUubm9kZVZhbHVlLCBURVhUX0VOVElUSUVTKSwgJy0tPicpOwogICAgICBicmVhazsKCiAgICAvLyBDREFUQQogICAgY2FzZSA0OgogICAgICBvdXRwdXQucHVzaCgnPCFbQ0RBVEFbJywgbm9kZS5ub2RlVmFsdWUsICddXT4nKTsKICAgICAgYnJlYWs7CgogICAgZGVmYXVsdDoKICAgICAgdGhyb3cgbmV3IEVycm9yKCd1bmFibGUgdG8gaGFuZGxlIG5vZGUgJyArIG5vZGUubm9kZVR5cGUpOwogICAgfQoKICAgIHJldHVybiBvdXRwdXQ7CiAgfQoKICAvKioKICAgKiBpbm5lckhUTUwgbGlrZSBmdW5jdGlvbmFsaXR5IGZvciBTVkcgZWxlbWVudHMuCiAgICogYmFzZWQgb24gaW5uZXJTVkcgKGh0dHBzOi8vY29kZS5nb29nbGUuY29tL3AvaW5uZXJzdmcpCiAgICovCgoKICBmdW5jdGlvbiBzZXQoZWxlbWVudCwgc3ZnKSB7CgogICAgdmFyIHBhcnNlZCA9IHBhcnNlJDEoc3ZnKTsKCiAgICAvLyBjbGVhciBlbGVtZW50IGNvbnRlbnRzCiAgICBjbGVhciQxKGVsZW1lbnQpOwoKICAgIGlmICghc3ZnKSB7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBpZiAoIWlzRnJhZ21lbnQocGFyc2VkKSkgewogICAgICAvLyBleHRyYWN0IDxzdmc+IGZyb20gcGFyc2VkIGRvY3VtZW50CiAgICAgIHBhcnNlZCA9IHBhcnNlZC5kb2N1bWVudEVsZW1lbnQ7CiAgICB9CgogICAgdmFyIG5vZGVzID0gc2xpY2UocGFyc2VkLmNoaWxkTm9kZXMpOwoKICAgIC8vIGltcG9ydCArIGFwcGVuZCBlYWNoIG5vZGUKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbm9kZXMubGVuZ3RoOyBpKyspIHsKICAgICAgYXBwZW5kVG8obm9kZXNbaV0sIGVsZW1lbnQpOwogICAgfQoKICB9CgogIGZ1bmN0aW9uIGdldChlbGVtZW50KSB7CiAgICB2YXIgY2hpbGQgPSBlbGVtZW50LmZpcnN0Q2hpbGQsCiAgICAgICAgb3V0cHV0ID0gW107CgogICAgd2hpbGUgKGNoaWxkKSB7CiAgICAgIHNlcmlhbGl6ZShjaGlsZCwgb3V0cHV0KTsKICAgICAgY2hpbGQgPSBjaGlsZC5uZXh0U2libGluZzsKICAgIH0KCiAgICByZXR1cm4gb3V0cHV0LmpvaW4oJycpOwogIH0KCiAgZnVuY3Rpb24gaXNGcmFnbWVudChub2RlKSB7CiAgICByZXR1cm4gbm9kZS5ub2RlTmFtZSA9PT0gJyNkb2N1bWVudC1mcmFnbWVudCc7CiAgfQoKICBmdW5jdGlvbiBpbm5lclNWRyhlbGVtZW50LCBzdmcpIHsKCiAgICBpZiAoc3ZnICE9PSB1bmRlZmluZWQpIHsKCiAgICAgIHRyeSB7CiAgICAgICAgc2V0KGVsZW1lbnQsIHN2Zyk7CiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2Vycm9yIHBhcnNpbmcgU1ZHOiAnICsgZS5tZXNzYWdlKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGVsZW1lbnQ7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gZ2V0KGVsZW1lbnQpOwogICAgfQogIH0KCgogIGZ1bmN0aW9uIHNsaWNlKGFycikgewogICAgcmV0dXJuIEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFycik7CiAgfQoKICAvKioKICAgKiB0cmFuc2Zvcm0gYWNjZXNzb3IgdXRpbGl0eQogICAqLwoKICBmdW5jdGlvbiB3cmFwTWF0cml4KHRyYW5zZm9ybUxpc3QsIHRyYW5zZm9ybSkgewogICAgaWYgKHRyYW5zZm9ybSBpbnN0YW5jZW9mIFNWR01hdHJpeCkgewogICAgICByZXR1cm4gdHJhbnNmb3JtTGlzdC5jcmVhdGVTVkdUcmFuc2Zvcm1Gcm9tTWF0cml4KHRyYW5zZm9ybSk7CiAgICB9CgogICAgcmV0dXJuIHRyYW5zZm9ybTsKICB9CgoKICBmdW5jdGlvbiBzZXRUcmFuc2Zvcm1zKHRyYW5zZm9ybUxpc3QsIHRyYW5zZm9ybXMpIHsKICAgIHZhciBpLCB0OwoKICAgIHRyYW5zZm9ybUxpc3QuY2xlYXIoKTsKCiAgICBmb3IgKGkgPSAwOyAodCA9IHRyYW5zZm9ybXNbaV0pOyBpKyspIHsKICAgICAgdHJhbnNmb3JtTGlzdC5hcHBlbmRJdGVtKHdyYXBNYXRyaXgodHJhbnNmb3JtTGlzdCwgdCkpOwogICAgfQogIH0KCiAgLyoqCiAgICogR2V0IG9yIHNldCB0aGUgdHJhbnNmb3JtcyBvbiB0aGUgZ2l2ZW4gbm9kZS4KICAgKgogICAqIEBwYXJhbSB7U1ZHRWxlbWVudH0gbm9kZQogICAqIEBwYXJhbSAge1NWR1RyYW5zZm9ybXxTVkdNYXRyaXh8QXJyYXk8U1ZHVHJhbnNmb3JtfFNWR01hdHJpeD59IFt0cmFuc2Zvcm1zXQogICAqCiAgICogQHJldHVybiB7U1ZHVHJhbnNmb3JtfSB0aGUgY29uc29saWRhdGVkIHRyYW5zZm9ybQogICAqLwogIGZ1bmN0aW9uIHRyYW5zZm9ybShub2RlLCB0cmFuc2Zvcm1zKSB7CiAgICB2YXIgdHJhbnNmb3JtTGlzdCA9IG5vZGUudHJhbnNmb3JtLmJhc2VWYWw7CgogICAgaWYgKHRyYW5zZm9ybXMpIHsKCiAgICAgIGlmICghQXJyYXkuaXNBcnJheSh0cmFuc2Zvcm1zKSkgewogICAgICAgIHRyYW5zZm9ybXMgPSBbIHRyYW5zZm9ybXMgXTsKICAgICAgfQoKICAgICAgc2V0VHJhbnNmb3Jtcyh0cmFuc2Zvcm1MaXN0LCB0cmFuc2Zvcm1zKTsKICAgIH0KCiAgICByZXR1cm4gdHJhbnNmb3JtTGlzdC5jb25zb2xpZGF0ZSgpOwogIH0KCiAgdmFyIENMQVNTX1BBVFRFUk4gPSAvXmNsYXNzIC87CgogIGZ1bmN0aW9uIGlzQ2xhc3MoZm4pIHsKICAgIHJldHVybiBDTEFTU19QQVRURVJOLnRlc3QoZm4udG9TdHJpbmcoKSk7CiAgfQoKICBmdW5jdGlvbiBpc0FycmF5JDEob2JqKSB7CiAgICByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG9iaikgPT09ICdbb2JqZWN0IEFycmF5XSc7CiAgfQoKICBmdW5jdGlvbiBhbm5vdGF0ZSgpIHsKICAgIHZhciBhcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzKTsKCiAgICBpZiAoYXJncy5sZW5ndGggPT09IDEgJiYgaXNBcnJheSQxKGFyZ3NbMF0pKSB7CiAgICAgIGFyZ3MgPSBhcmdzWzBdOwogICAgfQoKICAgIHZhciBmbiA9IGFyZ3MucG9wKCk7CgogICAgZm4uJGluamVjdCA9IGFyZ3M7CgogICAgcmV0dXJuIGZuOwogIH0KCiAgLy8gQ3VycmVudCBsaW1pdGF0aW9uczoKICAvLyAtIGNhbid0IHB1dCBpbnRvICJmdW5jdGlvbiBhcmciIGNvbW1lbnRzCiAgLy8gZnVuY3Rpb24gLyogKG5vIHBhcmVudGhlc2lzIGxpa2UgdGhpcykgKi8gKCl7fQogIC8vIGZ1bmN0aW9uIGFiYyggLyogeHggKG5vIHBhcmVudGhlc2lzIGxpa2UgdGhpcykgKi8gYSwgYikge30KICAvLwogIC8vIEp1c3QgcHV0IHRoZSBjb21tZW50IGJlZm9yZSBmdW5jdGlvbiBvciBpbnNpZGU6CiAgLy8gLyogKCgodGhpcyBpcyBmaW5lKSkpICovIGZ1bmN0aW9uKGEsIGIpIHt9CiAgLy8gZnVuY3Rpb24gYWJjKGEpIHsgLyogKCgodGhpcyBpcyBmaW5lKSkpICovfQogIC8vCiAgLy8gLSBjYW4ndCByZWxpYWJseSBhdXRvLWFubm90YXRlIGNvbnN0cnVjdG9yOyB3ZSdsbCBtYXRjaCB0aGUKICAvLyBmaXJzdCBjb25zdHJ1Y3RvciguLi4pIHBhdHRlcm4gZm91bmQgd2hpY2ggbWF5IGJlIHRoZSBvbmUKICAvLyBvZiBhIG5lc3RlZCBjbGFzcywgdG9vLgoKICB2YXIgQ09OU1RSVUNUT1JfQVJHUyA9IC9jb25zdHJ1Y3RvclxzKlteKF0qXChccyooW14pXSopXCkvbTsKICB2YXIgRk5fQVJHUyA9IC9eZnVuY3Rpb25ccypbXihdKlwoXHMqKFteKV0qKVwpL207CiAgdmFyIEZOX0FSRyA9IC9cL1wqKFteKl0qKVwqXC8vbTsKCiAgZnVuY3Rpb24gcGFyc2UkMihmbikgewoKICAgIGlmICh0eXBlb2YgZm4gIT09ICdmdW5jdGlvbicpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdDYW5ub3QgYW5ub3RhdGUgIicgKyBmbiArICciLiBFeHBlY3RlZCBhIGZ1bmN0aW9uIScpOwogICAgfQoKICAgIHZhciBtYXRjaCA9IGZuLnRvU3RyaW5nKCkubWF0Y2goaXNDbGFzcyhmbikgPyBDT05TVFJVQ1RPUl9BUkdTIDogRk5fQVJHUyk7CgogICAgLy8gbWF5IHBhcnNlIGNsYXNzIHdpdGhvdXQgY29uc3RydWN0b3IKICAgIGlmICghbWF0Y2gpIHsKICAgICAgcmV0dXJuIFtdOwogICAgfQoKICAgIHJldHVybiBtYXRjaFsxXSAmJiBtYXRjaFsxXS5zcGxpdCgnLCcpLm1hcChmdW5jdGlvbiAoYXJnKSB7CiAgICAgIG1hdGNoID0gYXJnLm1hdGNoKEZOX0FSRyk7CiAgICAgIHJldHVybiBtYXRjaCA/IG1hdGNoWzFdLnRyaW0oKSA6IGFyZy50cmltKCk7CiAgICB9KSB8fCBbXTsKICB9CgogIGZ1bmN0aW9uIE1vZHVsZSgpIHsKICAgIHZhciBwcm92aWRlcnMgPSBbXTsKCiAgICB0aGlzLmZhY3RvcnkgPSBmdW5jdGlvbiAobmFtZSwgZmFjdG9yeSkgewogICAgICBwcm92aWRlcnMucHVzaChbbmFtZSwgJ2ZhY3RvcnknLCBmYWN0b3J5XSk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfTsKCiAgICB0aGlzLnZhbHVlID0gZnVuY3Rpb24gKG5hbWUsIHZhbHVlKSB7CiAgICAgIHByb3ZpZGVycy5wdXNoKFtuYW1lLCAndmFsdWUnLCB2YWx1ZV0pOwogICAgICByZXR1cm4gdGhpczsKICAgIH07CgogICAgdGhpcy50eXBlID0gZnVuY3Rpb24gKG5hbWUsIHR5cGUpIHsKICAgICAgcHJvdmlkZXJzLnB1c2goW25hbWUsICd0eXBlJywgdHlwZV0pOwogICAgICByZXR1cm4gdGhpczsKICAgIH07CgogICAgdGhpcy5mb3JFYWNoID0gZnVuY3Rpb24gKGl0ZXJhdG9yKSB7CiAgICAgIHByb3ZpZGVycy5mb3JFYWNoKGl0ZXJhdG9yKTsKICAgIH07CiAgfQoKICB2YXIgX3R5cGVvZiA9IHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA9PT0gInN5bWJvbCIgPyBmdW5jdGlvbiAob2JqKSB7IHJldHVybiB0eXBlb2Ygb2JqOyB9IDogZnVuY3Rpb24gKG9iaikgeyByZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiB0eXBlb2Ygb2JqOyB9OwoKICBmdW5jdGlvbiBfdG9Db25zdW1hYmxlQXJyYXkoYXJyKSB7IGlmIChBcnJheS5pc0FycmF5KGFycikpIHsgZm9yICh2YXIgaSA9IDAsIGFycjIgPSBBcnJheShhcnIubGVuZ3RoKTsgaSA8IGFyci5sZW5ndGg7IGkrKykgeyBhcnIyW2ldID0gYXJyW2ldOyB9IHJldHVybiBhcnIyOyB9IGVsc2UgeyByZXR1cm4gQXJyYXkuZnJvbShhcnIpOyB9IH0KCiAgZnVuY3Rpb24gSW5qZWN0b3IobW9kdWxlcywgcGFyZW50KSB7CiAgICBwYXJlbnQgPSBwYXJlbnQgfHwgewogICAgICBnZXQ6IGZ1bmN0aW9uIGdldChuYW1lLCBzdHJpY3QpIHsKICAgICAgICBjdXJyZW50bHlSZXNvbHZpbmcucHVzaChuYW1lKTsKCiAgICAgICAgaWYgKHN0cmljdCA9PT0gZmFsc2UpIHsKICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aHJvdyBlcnJvcignTm8gcHJvdmlkZXIgZm9yICInICsgbmFtZSArICciIScpOwogICAgICAgIH0KICAgICAgfQogICAgfTsKCiAgICB2YXIgY3VycmVudGx5UmVzb2x2aW5nID0gW107CiAgICB2YXIgcHJvdmlkZXJzID0gdGhpcy5fcHJvdmlkZXJzID0gT2JqZWN0LmNyZWF0ZShwYXJlbnQuX3Byb3ZpZGVycyB8fCBudWxsKTsKICAgIHZhciBpbnN0YW5jZXMgPSB0aGlzLl9pbnN0YW5jZXMgPSBPYmplY3QuY3JlYXRlKG51bGwpOwoKICAgIHZhciBzZWxmID0gaW5zdGFuY2VzLmluamVjdG9yID0gdGhpczsKCiAgICB2YXIgZXJyb3IgPSBmdW5jdGlvbiBlcnJvcihtc2cpIHsKICAgICAgdmFyIHN0YWNrID0gY3VycmVudGx5UmVzb2x2aW5nLmpvaW4oJyAtPiAnKTsKICAgICAgY3VycmVudGx5UmVzb2x2aW5nLmxlbmd0aCA9IDA7CiAgICAgIHJldHVybiBuZXcgRXJyb3Ioc3RhY2sgPyBtc2cgKyAnIChSZXNvbHZpbmc6ICcgKyBzdGFjayArICcpJyA6IG1zZyk7CiAgICB9OwoKICAgIC8qKgogICAgICogUmV0dXJuIGEgbmFtZWQgc2VydmljZS4KICAgICAqCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gbmFtZQogICAgICogQHBhcmFtIHtCb29sZWFufSBbc3RyaWN0PXRydWVdIGlmIGZhbHNlLCByZXNvbHZlIG1pc3Npbmcgc2VydmljZXMgdG8gbnVsbAogICAgICoKICAgICAqIEByZXR1cm4ge09iamVjdH0KICAgICAqLwogICAgdmFyIGdldCA9IGZ1bmN0aW9uIGdldChuYW1lLCBzdHJpY3QpIHsKICAgICAgaWYgKCFwcm92aWRlcnNbbmFtZV0gJiYgbmFtZS5pbmRleE9mKCcuJykgIT09IC0xKSB7CiAgICAgICAgdmFyIHBhcnRzID0gbmFtZS5zcGxpdCgnLicpOwogICAgICAgIHZhciBwaXZvdCA9IGdldChwYXJ0cy5zaGlmdCgpKTsKCiAgICAgICAgd2hpbGUgKHBhcnRzLmxlbmd0aCkgewogICAgICAgICAgcGl2b3QgPSBwaXZvdFtwYXJ0cy5zaGlmdCgpXTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBwaXZvdDsKICAgICAgfQoKICAgICAgaWYgKGhhc1Byb3AoaW5zdGFuY2VzLCBuYW1lKSkgewogICAgICAgIHJldHVybiBpbnN0YW5jZXNbbmFtZV07CiAgICAgIH0KCiAgICAgIGlmIChoYXNQcm9wKHByb3ZpZGVycywgbmFtZSkpIHsKICAgICAgICBpZiAoY3VycmVudGx5UmVzb2x2aW5nLmluZGV4T2YobmFtZSkgIT09IC0xKSB7CiAgICAgICAgICBjdXJyZW50bHlSZXNvbHZpbmcucHVzaChuYW1lKTsKICAgICAgICAgIHRocm93IGVycm9yKCdDYW5ub3QgcmVzb2x2ZSBjaXJjdWxhciBkZXBlbmRlbmN5IScpOwogICAgICAgIH0KCiAgICAgICAgY3VycmVudGx5UmVzb2x2aW5nLnB1c2gobmFtZSk7CiAgICAgICAgaW5zdGFuY2VzW25hbWVdID0gcHJvdmlkZXJzW25hbWVdWzBdKHByb3ZpZGVyc1tuYW1lXVsxXSk7CiAgICAgICAgY3VycmVudGx5UmVzb2x2aW5nLnBvcCgpOwoKICAgICAgICByZXR1cm4gaW5zdGFuY2VzW25hbWVdOwogICAgICB9CgogICAgICByZXR1cm4gcGFyZW50LmdldChuYW1lLCBzdHJpY3QpOwogICAgfTsKCiAgICB2YXIgZm5EZWYgPSBmdW5jdGlvbiBmbkRlZihmbikgewogICAgICB2YXIgbG9jYWxzID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiB7fTsKCiAgICAgIGlmICh0eXBlb2YgZm4gIT09ICdmdW5jdGlvbicpIHsKICAgICAgICBpZiAoaXNBcnJheSQxKGZuKSkgewogICAgICAgICAgZm4gPSBhbm5vdGF0ZShmbi5zbGljZSgpKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdDYW5ub3QgaW52b2tlICInICsgZm4gKyAnIi4gRXhwZWN0ZWQgYSBmdW5jdGlvbiEnKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHZhciBpbmplY3QgPSBmbi4kaW5qZWN0IHx8IHBhcnNlJDIoZm4pOwogICAgICB2YXIgZGVwZW5kZW5jaWVzID0gaW5qZWN0Lm1hcChmdW5jdGlvbiAoZGVwKSB7CiAgICAgICAgaWYgKGhhc1Byb3AobG9jYWxzLCBkZXApKSB7CiAgICAgICAgICByZXR1cm4gbG9jYWxzW2RlcF07CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJldHVybiBnZXQoZGVwKTsKICAgICAgICB9CiAgICAgIH0pOwoKICAgICAgcmV0dXJuIHsKICAgICAgICBmbjogZm4sCiAgICAgICAgZGVwZW5kZW5jaWVzOiBkZXBlbmRlbmNpZXMKICAgICAgfTsKICAgIH07CgogICAgdmFyIGluc3RhbnRpYXRlID0gZnVuY3Rpb24gaW5zdGFudGlhdGUoVHlwZSkgewogICAgICB2YXIgX2ZuRGVmID0gZm5EZWYoVHlwZSksCiAgICAgICAgICBkZXBlbmRlbmNpZXMgPSBfZm5EZWYuZGVwZW5kZW5jaWVzLAogICAgICAgICAgZm4gPSBfZm5EZWYuZm47CgogICAgICByZXR1cm4gbmV3IChGdW5jdGlvbi5wcm90b3R5cGUuYmluZC5hcHBseShmbiwgW251bGxdLmNvbmNhdChfdG9Db25zdW1hYmxlQXJyYXkoZGVwZW5kZW5jaWVzKSkpKSgpOwogICAgfTsKCiAgICB2YXIgaW52b2tlID0gZnVuY3Rpb24gaW52b2tlKGZ1bmMsIGNvbnRleHQsIGxvY2FscykgewogICAgICB2YXIgX2ZuRGVmMiA9IGZuRGVmKGZ1bmMsIGxvY2FscyksCiAgICAgICAgICBkZXBlbmRlbmNpZXMgPSBfZm5EZWYyLmRlcGVuZGVuY2llcywKICAgICAgICAgIGZuID0gX2ZuRGVmMi5mbjsKCiAgICAgIHJldHVybiBmbi5jYWxsLmFwcGx5KGZuLCBbY29udGV4dF0uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheShkZXBlbmRlbmNpZXMpKSk7CiAgICB9OwoKICAgIHZhciBjcmVhdGVQcml2YXRlSW5qZWN0b3JGYWN0b3J5ID0gZnVuY3Rpb24gY3JlYXRlUHJpdmF0ZUluamVjdG9yRmFjdG9yeShwcml2YXRlQ2hpbGRJbmplY3RvcikgewogICAgICByZXR1cm4gYW5ub3RhdGUoZnVuY3Rpb24gKGtleSkgewogICAgICAgIHJldHVybiBwcml2YXRlQ2hpbGRJbmplY3Rvci5nZXQoa2V5KTsKICAgICAgfSk7CiAgICB9OwoKICAgIHZhciBjcmVhdGVDaGlsZCA9IGZ1bmN0aW9uIGNyZWF0ZUNoaWxkKG1vZHVsZXMsIGZvcmNlTmV3SW5zdGFuY2VzKSB7CiAgICAgIGlmIChmb3JjZU5ld0luc3RhbmNlcyAmJiBmb3JjZU5ld0luc3RhbmNlcy5sZW5ndGgpIHsKICAgICAgICB2YXIgZnJvbVBhcmVudE1vZHVsZSA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgICAgdmFyIG1hdGNoZWRTY29wZXMgPSBPYmplY3QuY3JlYXRlKG51bGwpOwoKICAgICAgICB2YXIgcHJpdmF0ZUluamVjdG9yc0NhY2hlID0gW107CiAgICAgICAgdmFyIHByaXZhdGVDaGlsZEluamVjdG9ycyA9IFtdOwogICAgICAgIHZhciBwcml2YXRlQ2hpbGRGYWN0b3JpZXMgPSBbXTsKCiAgICAgICAgdmFyIHByb3ZpZGVyOwogICAgICAgIHZhciBjYWNoZUlkeDsKICAgICAgICB2YXIgcHJpdmF0ZUNoaWxkSW5qZWN0b3I7CiAgICAgICAgdmFyIHByaXZhdGVDaGlsZEluamVjdG9yRmFjdG9yeTsKICAgICAgICBmb3IgKHZhciBuYW1lIGluIHByb3ZpZGVycykgewogICAgICAgICAgcHJvdmlkZXIgPSBwcm92aWRlcnNbbmFtZV07CgogICAgICAgICAgaWYgKGZvcmNlTmV3SW5zdGFuY2VzLmluZGV4T2YobmFtZSkgIT09IC0xKSB7CiAgICAgICAgICAgIGlmIChwcm92aWRlclsyXSA9PT0gJ3ByaXZhdGUnKSB7CiAgICAgICAgICAgICAgY2FjaGVJZHggPSBwcml2YXRlSW5qZWN0b3JzQ2FjaGUuaW5kZXhPZihwcm92aWRlclszXSk7CiAgICAgICAgICAgICAgaWYgKGNhY2hlSWR4ID09PSAtMSkgewogICAgICAgICAgICAgICAgcHJpdmF0ZUNoaWxkSW5qZWN0b3IgPSBwcm92aWRlclszXS5jcmVhdGVDaGlsZChbXSwgZm9yY2VOZXdJbnN0YW5jZXMpOwogICAgICAgICAgICAgICAgcHJpdmF0ZUNoaWxkSW5qZWN0b3JGYWN0b3J5ID0gY3JlYXRlUHJpdmF0ZUluamVjdG9yRmFjdG9yeShwcml2YXRlQ2hpbGRJbmplY3Rvcik7CiAgICAgICAgICAgICAgICBwcml2YXRlSW5qZWN0b3JzQ2FjaGUucHVzaChwcm92aWRlclszXSk7CiAgICAgICAgICAgICAgICBwcml2YXRlQ2hpbGRJbmplY3RvcnMucHVzaChwcml2YXRlQ2hpbGRJbmplY3Rvcik7CiAgICAgICAgICAgICAgICBwcml2YXRlQ2hpbGRGYWN0b3JpZXMucHVzaChwcml2YXRlQ2hpbGRJbmplY3RvckZhY3RvcnkpOwogICAgICAgICAgICAgICAgZnJvbVBhcmVudE1vZHVsZVtuYW1lXSA9IFtwcml2YXRlQ2hpbGRJbmplY3RvckZhY3RvcnksIG5hbWUsICdwcml2YXRlJywgcHJpdmF0ZUNoaWxkSW5qZWN0b3JdOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBmcm9tUGFyZW50TW9kdWxlW25hbWVdID0gW3ByaXZhdGVDaGlsZEZhY3Rvcmllc1tjYWNoZUlkeF0sIG5hbWUsICdwcml2YXRlJywgcHJpdmF0ZUNoaWxkSW5qZWN0b3JzW2NhY2hlSWR4XV07CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGZyb21QYXJlbnRNb2R1bGVbbmFtZV0gPSBbcHJvdmlkZXJbMl0sIHByb3ZpZGVyWzFdXTsKICAgICAgICAgICAgfQogICAgICAgICAgICBtYXRjaGVkU2NvcGVzW25hbWVdID0gdHJ1ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoKHByb3ZpZGVyWzJdID09PSAnZmFjdG9yeScgfHwgcHJvdmlkZXJbMl0gPT09ICd0eXBlJykgJiYgcHJvdmlkZXJbMV0uJHNjb3BlKSB7CiAgICAgICAgICAgIC8qIGpzaGludCAtVzA4MyAqLwogICAgICAgICAgICBmb3JjZU5ld0luc3RhbmNlcy5mb3JFYWNoKGZ1bmN0aW9uIChzY29wZSkgewogICAgICAgICAgICAgIGlmIChwcm92aWRlclsxXS4kc2NvcGUuaW5kZXhPZihzY29wZSkgIT09IC0xKSB7CiAgICAgICAgICAgICAgICBmcm9tUGFyZW50TW9kdWxlW25hbWVdID0gW3Byb3ZpZGVyWzJdLCBwcm92aWRlclsxXV07CiAgICAgICAgICAgICAgICBtYXRjaGVkU2NvcGVzW3Njb3BlXSA9IHRydWU7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZvcmNlTmV3SW5zdGFuY2VzLmZvckVhY2goZnVuY3Rpb24gKHNjb3BlKSB7CiAgICAgICAgICBpZiAoIW1hdGNoZWRTY29wZXNbc2NvcGVdKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignTm8gcHJvdmlkZXIgZm9yICInICsgc2NvcGUgKyAnIi4gQ2Fubm90IHVzZSBwcm92aWRlciBmcm9tIHRoZSBwYXJlbnQhJyk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIG1vZHVsZXMudW5zaGlmdChmcm9tUGFyZW50TW9kdWxlKTsKICAgICAgfQoKICAgICAgcmV0dXJuIG5ldyBJbmplY3Rvcihtb2R1bGVzLCBzZWxmKTsKICAgIH07CgogICAgdmFyIGZhY3RvcnlNYXAgPSB7CiAgICAgIGZhY3Rvcnk6IGludm9rZSwKICAgICAgdHlwZTogaW5zdGFudGlhdGUsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZShfdmFsdWUpIHsKICAgICAgICByZXR1cm4gX3ZhbHVlOwogICAgICB9CiAgICB9OwoKICAgIG1vZHVsZXMuZm9yRWFjaChmdW5jdGlvbiAobW9kdWxlKSB7CgogICAgICBmdW5jdGlvbiBhcnJheVVud3JhcCh0eXBlLCB2YWx1ZSkgewogICAgICAgIGlmICh0eXBlICE9PSAndmFsdWUnICYmIGlzQXJyYXkkMSh2YWx1ZSkpIHsKICAgICAgICAgIHZhbHVlID0gYW5ub3RhdGUodmFsdWUuc2xpY2UoKSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgIH0KCiAgICAgIC8vIFRPRE8odm9qdGEpOiBoYW5kbGUgd3JvbmcgaW5wdXRzIChtb2R1bGVzKQogICAgICBpZiAobW9kdWxlIGluc3RhbmNlb2YgTW9kdWxlKSB7CiAgICAgICAgbW9kdWxlLmZvckVhY2goZnVuY3Rpb24gKHByb3ZpZGVyKSB7CiAgICAgICAgICB2YXIgbmFtZSA9IHByb3ZpZGVyWzBdOwogICAgICAgICAgdmFyIHR5cGUgPSBwcm92aWRlclsxXTsKICAgICAgICAgIHZhciB2YWx1ZSA9IHByb3ZpZGVyWzJdOwoKICAgICAgICAgIHByb3ZpZGVyc1tuYW1lXSA9IFtmYWN0b3J5TWFwW3R5cGVdLCBhcnJheVVud3JhcCh0eXBlLCB2YWx1ZSksIHR5cGVdOwogICAgICAgIH0pOwogICAgICB9IGVsc2UgaWYgKCh0eXBlb2YgbW9kdWxlID09PSAndW5kZWZpbmVkJyA/ICd1bmRlZmluZWQnIDogX3R5cGVvZihtb2R1bGUpKSA9PT0gJ29iamVjdCcpIHsKICAgICAgICBpZiAobW9kdWxlLl9fZXhwb3J0c19fKSB7CiAgICAgICAgICB2YXIgY2xvbmVkTW9kdWxlID0gT2JqZWN0LmtleXMobW9kdWxlKS5yZWR1Y2UoZnVuY3Rpb24gKG0sIGtleSkgewogICAgICAgICAgICBpZiAoa2V5LnN1YnN0cmluZygwLCAyKSAhPT0gJ19fJykgewogICAgICAgICAgICAgIG1ba2V5XSA9IG1vZHVsZVtrZXldOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBtOwogICAgICAgICAgfSwgT2JqZWN0LmNyZWF0ZShudWxsKSk7CgogICAgICAgICAgdmFyIHByaXZhdGVJbmplY3RvciA9IG5ldyBJbmplY3RvcigobW9kdWxlLl9fbW9kdWxlc19fIHx8IFtdKS5jb25jYXQoW2Nsb25lZE1vZHVsZV0pLCBzZWxmKTsKICAgICAgICAgIHZhciBnZXRGcm9tUHJpdmF0ZUluamVjdG9yID0gYW5ub3RhdGUoZnVuY3Rpb24gKGtleSkgewogICAgICAgICAgICByZXR1cm4gcHJpdmF0ZUluamVjdG9yLmdldChrZXkpOwogICAgICAgICAgfSk7CiAgICAgICAgICBtb2R1bGUuX19leHBvcnRzX18uZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgICAgIHByb3ZpZGVyc1trZXldID0gW2dldEZyb21Qcml2YXRlSW5qZWN0b3IsIGtleSwgJ3ByaXZhdGUnLCBwcml2YXRlSW5qZWN0b3JdOwogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIE9iamVjdC5rZXlzKG1vZHVsZSkuZm9yRWFjaChmdW5jdGlvbiAobmFtZSkgewogICAgICAgICAgICBpZiAobW9kdWxlW25hbWVdWzJdID09PSAncHJpdmF0ZScpIHsKICAgICAgICAgICAgICBwcm92aWRlcnNbbmFtZV0gPSBtb2R1bGVbbmFtZV07CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgdHlwZSA9IG1vZHVsZVtuYW1lXVswXTsKICAgICAgICAgICAgdmFyIHZhbHVlID0gbW9kdWxlW25hbWVdWzFdOwoKICAgICAgICAgICAgcHJvdmlkZXJzW25hbWVdID0gW2ZhY3RvcnlNYXBbdHlwZV0sIGFycmF5VW53cmFwKHR5cGUsIHZhbHVlKSwgdHlwZV07CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0pOwoKICAgIC8vIHB1YmxpYyBBUEkKICAgIHRoaXMuZ2V0ID0gZ2V0OwogICAgdGhpcy5pbnZva2UgPSBpbnZva2U7CiAgICB0aGlzLmluc3RhbnRpYXRlID0gaW5zdGFudGlhdGU7CiAgICB0aGlzLmNyZWF0ZUNoaWxkID0gY3JlYXRlQ2hpbGQ7CiAgfQoKICAvLyBoZWxwZXJzIC8vLy8vLy8vLy8vLy8vLy8vCgogIGZ1bmN0aW9uIGhhc1Byb3Aob2JqLCBwcm9wKSB7CiAgICByZXR1cm4gT2JqZWN0Lmhhc093blByb3BlcnR5LmNhbGwob2JqLCBwcm9wKTsKICB9CgogIGZ1bmN0aW9uIGNyZWF0ZUNvbW1vbmpzTW9kdWxlKGZuLCBtb2R1bGUpIHsKICAJcmV0dXJuIG1vZHVsZSA9IHsgZXhwb3J0czoge30gfSwgZm4obW9kdWxlLCBtb2R1bGUuZXhwb3J0cyksIG1vZHVsZS5leHBvcnRzOwogIH0KCiAgdmFyIGluaGVyaXRzX2Jyb3dzZXIgPSBjcmVhdGVDb21tb25qc01vZHVsZShmdW5jdGlvbiAobW9kdWxlKSB7CiAgaWYgKHR5cGVvZiBPYmplY3QuY3JlYXRlID09PSAnZnVuY3Rpb24nKSB7CiAgICAvLyBpbXBsZW1lbnRhdGlvbiBmcm9tIHN0YW5kYXJkIG5vZGUuanMgJ3V0aWwnIG1vZHVsZQogICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiBpbmhlcml0cyhjdG9yLCBzdXBlckN0b3IpIHsKICAgICAgY3Rvci5zdXBlcl8gPSBzdXBlckN0b3I7CiAgICAgIGN0b3IucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShzdXBlckN0b3IucHJvdG90eXBlLCB7CiAgICAgICAgY29uc3RydWN0b3I6IHsKICAgICAgICAgIHZhbHVlOiBjdG9yLAogICAgICAgICAgZW51bWVyYWJsZTogZmFsc2UsCiAgICAgICAgICB3cml0YWJsZTogdHJ1ZSwKICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogICAgICAgIH0KICAgICAgfSk7CiAgICB9OwogIH0gZWxzZSB7CiAgICAvLyBvbGQgc2Nob29sIHNoaW0gZm9yIG9sZCBicm93c2VycwogICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiBpbmhlcml0cyhjdG9yLCBzdXBlckN0b3IpIHsKICAgICAgY3Rvci5zdXBlcl8gPSBzdXBlckN0b3I7CiAgICAgIHZhciBUZW1wQ3RvciA9IGZ1bmN0aW9uICgpIHt9OwogICAgICBUZW1wQ3Rvci5wcm90b3R5cGUgPSBzdXBlckN0b3IucHJvdG90eXBlOwogICAgICBjdG9yLnByb3RvdHlwZSA9IG5ldyBUZW1wQ3RvcigpOwogICAgICBjdG9yLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IGN0b3I7CiAgICB9OwogIH0KICB9KTsKCiAgdmFyIERFRkFVTFRfUkVOREVSX1BSSU9SSVRZID0gMTAwMDsKCiAgLyoqCiAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2Ygc2hhcGUgYW5kIGNvbm5lY3Rpb24gcmVuZGVyZXJzLgogICAqCiAgICogQHBhcmFtIHtFdmVudEJ1c30gZXZlbnRCdXMKICAgKiBAcGFyYW0ge051bWJlcn0gW3JlbmRlclByaW9yaXR5PTEwMDBdCiAgICovCiAgZnVuY3Rpb24gQmFzZVJlbmRlcmVyKGV2ZW50QnVzLCByZW5kZXJQcmlvcml0eSkgewogICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgIHJlbmRlclByaW9yaXR5ID0gcmVuZGVyUHJpb3JpdHkgfHwgREVGQVVMVF9SRU5ERVJfUFJJT1JJVFk7CgogICAgZXZlbnRCdXMub24oWyAncmVuZGVyLnNoYXBlJywgJ3JlbmRlci5jb25uZWN0aW9uJyBdLCByZW5kZXJQcmlvcml0eSwgZnVuY3Rpb24oZXZ0LCBjb250ZXh0KSB7CiAgICAgIHZhciB0eXBlID0gZXZ0LnR5cGUsCiAgICAgICAgICBlbGVtZW50ID0gY29udGV4dC5lbGVtZW50LAogICAgICAgICAgdmlzdWFscyA9IGNvbnRleHQuZ2Z4OwoKICAgICAgaWYgKHNlbGYuY2FuUmVuZGVyKGVsZW1lbnQpKSB7CiAgICAgICAgaWYgKHR5cGUgPT09ICdyZW5kZXIuc2hhcGUnKSB7CiAgICAgICAgICByZXR1cm4gc2VsZi5kcmF3U2hhcGUodmlzdWFscywgZWxlbWVudCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJldHVybiBzZWxmLmRyYXdDb25uZWN0aW9uKHZpc3VhbHMsIGVsZW1lbnQpOwogICAgICAgIH0KICAgICAgfQogICAgfSk7CgogICAgZXZlbnRCdXMub24oWyAncmVuZGVyLmdldFNoYXBlUGF0aCcsICdyZW5kZXIuZ2V0Q29ubmVjdGlvblBhdGgnXSwgcmVuZGVyUHJpb3JpdHksIGZ1bmN0aW9uKGV2dCwgZWxlbWVudCkgewogICAgICBpZiAoc2VsZi5jYW5SZW5kZXIoZWxlbWVudCkpIHsKICAgICAgICBpZiAoZXZ0LnR5cGUgPT09ICdyZW5kZXIuZ2V0U2hhcGVQYXRoJykgewogICAgICAgICAgcmV0dXJuIHNlbGYuZ2V0U2hhcGVQYXRoKGVsZW1lbnQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXR1cm4gc2VsZi5nZXRDb25uZWN0aW9uUGF0aChlbGVtZW50KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0pOwogIH0KCiAgLyoqCiAgICogU2hvdWxkIGNoZWNrIHdoZXRoZXIgKnRoaXMqIHJlbmRlcmVyIGNhbiByZW5kZXIKICAgKiB0aGUgZWxlbWVudC9jb25uZWN0aW9uLgogICAqCiAgICogQHBhcmFtIHtlbGVtZW50fSBlbGVtZW50CiAgICoKICAgKiBAcmV0dXJucyB7Qm9vbGVhbn0KICAgKi8KICBCYXNlUmVuZGVyZXIucHJvdG90eXBlLmNhblJlbmRlciA9IGZ1bmN0aW9uKCkge307CgogIC8qKgogICAqIFByb3ZpZGVzIHRoZSBzaGFwZSdzIHNuYXAgc3ZnIGVsZW1lbnQgdG8gYmUgZHJhd24gb24gdGhlIGBjYW52YXNgLgogICAqCiAgICogQHBhcmFtIHtkanMuR3JhcGhpY3N9IHZpc3VhbHMKICAgKiBAcGFyYW0ge1NoYXBlfSBzaGFwZQogICAqCiAgICogQHJldHVybnMge1NuYXAuc3ZnfSBbcmV0dXJucyBhIFNuYXAuc3ZnIHBhcGVyIGVsZW1lbnQgXQogICAqLwogIEJhc2VSZW5kZXJlci5wcm90b3R5cGUuZHJhd1NoYXBlID0gZnVuY3Rpb24oKSB7fTsKCiAgLyoqCiAgICogUHJvdmlkZXMgdGhlIHNoYXBlJ3Mgc25hcCBzdmcgZWxlbWVudCB0byBiZSBkcmF3biBvbiB0aGUgYGNhbnZhc2AuCiAgICoKICAgKiBAcGFyYW0ge2Rqcy5HcmFwaGljc30gdmlzdWFscwogICAqIEBwYXJhbSB7Q29ubmVjdGlvbn0gY29ubmVjdGlvbgogICAqCiAgICogQHJldHVybnMge1NuYXAuc3ZnfSBbcmV0dXJucyBhIFNuYXAuc3ZnIHBhcGVyIGVsZW1lbnQgXQogICAqLwogIEJhc2VSZW5kZXJlci5wcm90b3R5cGUuZHJhd0Nvbm5lY3Rpb24gPSBmdW5jdGlvbigpIHt9OwoKICAvKioKICAgKiBHZXRzIHRoZSBTVkcgcGF0aCBvZiBhIHNoYXBlIHRoYXQgcmVwcmVzZW50cyBpdCdzIHZpc3VhbCBib3VuZHMuCiAgICoKICAgKiBAcGFyYW0ge1NoYXBlfSBzaGFwZQogICAqCiAgICogQHJldHVybiB7c3RyaW5nfSBzdmcgcGF0aAogICAqLwogIEJhc2VSZW5kZXJlci5wcm90b3R5cGUuZ2V0U2hhcGVQYXRoID0gZnVuY3Rpb24oKSB7fTsKCiAgLyoqCiAgICogR2V0cyB0aGUgU1ZHIHBhdGggb2YgYSBjb25uZWN0aW9uIHRoYXQgcmVwcmVzZW50cyBpdCdzIHZpc3VhbCBib3VuZHMuCiAgICoKICAgKiBAcGFyYW0ge0Nvbm5lY3Rpb259IGNvbm5lY3Rpb24KICAgKgogICAqIEByZXR1cm4ge3N0cmluZ30gc3ZnIHBhdGgKICAgKi8KICBCYXNlUmVuZGVyZXIucHJvdG90eXBlLmdldENvbm5lY3Rpb25QYXRoID0gZnVuY3Rpb24oKSB7fTsKCiAgZnVuY3Rpb24gY29tcG9uZW50c1RvUGF0aChlbGVtZW50cykgewogICAgcmV0dXJuIGVsZW1lbnRzLmpvaW4oJywnKS5yZXBsYWNlKC8sPyhbQS16XSksPy9nLCAnJDEnKTsKICB9CgogIGZ1bmN0aW9uIHRvU1ZHUG9pbnRzKHBvaW50cykgewogICAgdmFyIHJlc3VsdCA9ICcnOwoKICAgIGZvciAodmFyIGkgPSAwLCBwOyAocCA9IHBvaW50c1tpXSk7IGkrKykgewogICAgICByZXN1bHQgKz0gcC54ICsgJywnICsgcC55ICsgJyAnOwogICAgfQoKICAgIHJldHVybiByZXN1bHQ7CiAgfQoKICBmdW5jdGlvbiBjcmVhdGVMaW5lKHBvaW50cywgYXR0cnMpIHsKCiAgICB2YXIgbGluZSA9IGNyZWF0ZSgncG9seWxpbmUnKTsKICAgIGF0dHIkMShsaW5lLCB7IHBvaW50czogdG9TVkdQb2ludHMocG9pbnRzKSB9KTsKCiAgICBpZiAoYXR0cnMpIHsKICAgICAgYXR0ciQxKGxpbmUsIGF0dHJzKTsKICAgIH0KCiAgICByZXR1cm4gbGluZTsKICB9CgogIGZ1bmN0aW9uIHVwZGF0ZUxpbmUoZ2Z4LCBwb2ludHMpIHsKICAgIGF0dHIkMShnZngsIHsgcG9pbnRzOiB0b1NWR1BvaW50cyhwb2ludHMpIH0pOwoKICAgIHJldHVybiBnZng7CiAgfQoKICAvKioKICAgKiBSZXR1cm5zIHRoZSBzdXJyb3VuZGluZyBiYm94IGZvciBhbGwgZWxlbWVudHMgaW4KICAgKiB0aGUgYXJyYXkgb3IgdGhlIGVsZW1lbnQgcHJpbWl0aXZlLgogICAqCiAgICogQHBhcmFtIHtBcnJheTxkanMubW9kZWwuU2hhcGU+fGRqcy5tb2RlbC5TaGFwZX0gZWxlbWVudHMKICAgKiBAcGFyYW0ge0Jvb2xlYW59IHN0b3BSZWN1cnNpb24KICAgKi8KICBmdW5jdGlvbiBnZXRCQm94KGVsZW1lbnRzLCBzdG9wUmVjdXJzaW9uKSB7CgogICAgc3RvcFJlY3Vyc2lvbiA9ICEhc3RvcFJlY3Vyc2lvbjsKICAgIGlmICghaXNBcnJheShlbGVtZW50cykpIHsKICAgICAgZWxlbWVudHMgPSBbZWxlbWVudHNdOwogICAgfQoKICAgIHZhciBtaW5YLAogICAgICAgIG1pblksCiAgICAgICAgbWF4WCwKICAgICAgICBtYXhZOwoKICAgIGZvckVhY2goZWxlbWVudHMsIGZ1bmN0aW9uKGVsZW1lbnQpIHsKCiAgICAgIC8vIElmIGVsZW1lbnQgaXMgYSBjb25uZWN0aW9uIHRoZSBiYm94IG11c3QgYmUgY29tcHV0ZWQgZmlyc3QKICAgICAgdmFyIGJib3ggPSBlbGVtZW50OwogICAgICBpZiAoZWxlbWVudC53YXlwb2ludHMgJiYgIXN0b3BSZWN1cnNpb24pIHsKICAgICAgICBiYm94ID0gZ2V0QkJveChlbGVtZW50LndheXBvaW50cywgdHJ1ZSk7CiAgICAgIH0KCiAgICAgIHZhciB4ID0gYmJveC54LAogICAgICAgICAgeSA9IGJib3gueSwKICAgICAgICAgIGhlaWdodCA9IGJib3guaGVpZ2h0IHx8IDAsCiAgICAgICAgICB3aWR0aCA9IGJib3gud2lkdGggfHwgMDsKCiAgICAgIGlmICh4IDwgbWluWCB8fCBtaW5YID09PSB1bmRlZmluZWQpIHsKICAgICAgICBtaW5YID0geDsKICAgICAgfQogICAgICBpZiAoeSA8IG1pblkgfHwgbWluWSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgbWluWSA9IHk7CiAgICAgIH0KCiAgICAgIGlmICgoeCArIHdpZHRoKSA+IG1heFggfHwgbWF4WCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgbWF4WCA9IHggKyB3aWR0aDsKICAgICAgfQogICAgICBpZiAoKHkgKyBoZWlnaHQpID4gbWF4WSB8fCBtYXhZID09PSB1bmRlZmluZWQpIHsKICAgICAgICBtYXhZID0geSArIGhlaWdodDsKICAgICAgfQogICAgfSk7CgogICAgcmV0dXJuIHsKICAgICAgeDogbWluWCwKICAgICAgeTogbWluWSwKICAgICAgaGVpZ2h0OiBtYXhZIC0gbWluWSwKICAgICAgd2lkdGg6IG1heFggLSBtaW5YCiAgICB9OwogIH0KCgogIGZ1bmN0aW9uIGdldFR5cGUoZWxlbWVudCkgewoKICAgIGlmICgnd2F5cG9pbnRzJyBpbiBlbGVtZW50KSB7CiAgICAgIHJldHVybiAnY29ubmVjdGlvbic7CiAgICB9CgogICAgaWYgKCd4JyBpbiBlbGVtZW50KSB7CiAgICAgIHJldHVybiAnc2hhcGUnOwogICAgfQoKICAgIHJldHVybiAncm9vdCc7CiAgfQoKICBmdW5jdGlvbiBpc0ZyYW1lRWxlbWVudChlbGVtZW50KSB7CgogICAgcmV0dXJuICEhKGVsZW1lbnQgJiYgZWxlbWVudC5pc0ZyYW1lKTsKICB9CgogIC8vIGFwcGx5IGRlZmF1bHQgcmVuZGVyZXIgd2l0aCBsb3dlc3QgcG9zc2libGUgcHJpb3JpdHkKICAvLyBzbyB0aGF0IGl0IG9ubHkga2lja3MgaW4gaWYgbm9vbmUgZWxzZSBjb3VsZCByZW5kZXIKICB2YXIgREVGQVVMVF9SRU5ERVJfUFJJT1JJVFkkMSA9IDE7CgogIC8qKgogICAqIFRoZSBkZWZhdWx0IHJlbmRlcmVyIHVzZWQgZm9yIHNoYXBlcyBhbmQgY29ubmVjdGlvbnMuCiAgICoKICAgKiBAcGFyYW0ge0V2ZW50QnVzfSBldmVudEJ1cwogICAqIEBwYXJhbSB7U3R5bGVzfSBzdHlsZXMKICAgKi8KICBmdW5jdGlvbiBEZWZhdWx0UmVuZGVyZXIoZXZlbnRCdXMsIHN0eWxlcykgewoKICAgIC8vCiAgICBCYXNlUmVuZGVyZXIuY2FsbCh0aGlzLCBldmVudEJ1cywgREVGQVVMVF9SRU5ERVJfUFJJT1JJVFkkMSk7CgogICAgdGhpcy5DT05ORUNUSU9OX1NUWUxFID0gc3R5bGVzLnN0eWxlKFsgJ25vLWZpbGwnIF0sIHsgc3Ryb2tlV2lkdGg6IDUsIHN0cm9rZTogJ2Z1Y2hzaWEnIH0pOwogICAgdGhpcy5TSEFQRV9TVFlMRSA9IHN0eWxlcy5zdHlsZSh7IGZpbGw6ICd3aGl0ZScsIHN0cm9rZTogJ2Z1Y2hzaWEnLCBzdHJva2VXaWR0aDogMiB9KTsKICAgIHRoaXMuRlJBTUVfU1RZTEUgPSBzdHlsZXMuc3R5bGUoWyAnbm8tZmlsbCcgXSwgeyBzdHJva2U6ICdmdWNoc2lhJywgc3Ryb2tlRGFzaGFycmF5OiA0LCBzdHJva2VXaWR0aDogMiB9KTsKICB9CgogIGluaGVyaXRzX2Jyb3dzZXIoRGVmYXVsdFJlbmRlcmVyLCBCYXNlUmVuZGVyZXIpOwoKCiAgRGVmYXVsdFJlbmRlcmVyLnByb3RvdHlwZS5jYW5SZW5kZXIgPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiB0cnVlOwogIH07CgogIERlZmF1bHRSZW5kZXJlci5wcm90b3R5cGUuZHJhd1NoYXBlID0gZnVuY3Rpb24gZHJhd1NoYXBlKHZpc3VhbHMsIGVsZW1lbnQpIHsKICAgIHZhciByZWN0ID0gY3JlYXRlKCdyZWN0Jyk7CgogICAgYXR0ciQxKHJlY3QsIHsKICAgICAgeDogMCwKICAgICAgeTogMCwKICAgICAgd2lkdGg6IGVsZW1lbnQud2lkdGggfHwgMCwKICAgICAgaGVpZ2h0OiBlbGVtZW50LmhlaWdodCB8fCAwCiAgICB9KTsKCiAgICBpZiAoaXNGcmFtZUVsZW1lbnQoZWxlbWVudCkpIHsKICAgICAgYXR0ciQxKHJlY3QsIHRoaXMuRlJBTUVfU1RZTEUpOwogICAgfSBlbHNlIHsKICAgICAgYXR0ciQxKHJlY3QsIHRoaXMuU0hBUEVfU1RZTEUpOwogICAgfQoKICAgIGFwcGVuZCh2aXN1YWxzLCByZWN0KTsKCiAgICByZXR1cm4gcmVjdDsKICB9OwoKICBEZWZhdWx0UmVuZGVyZXIucHJvdG90eXBlLmRyYXdDb25uZWN0aW9uID0gZnVuY3Rpb24gZHJhd0Nvbm5lY3Rpb24odmlzdWFscywgY29ubmVjdGlvbikgewoKICAgIHZhciBsaW5lID0gY3JlYXRlTGluZShjb25uZWN0aW9uLndheXBvaW50cywgdGhpcy5DT05ORUNUSU9OX1NUWUxFKTsKICAgIGFwcGVuZCh2aXN1YWxzLCBsaW5lKTsKCiAgICByZXR1cm4gbGluZTsKICB9OwoKICBEZWZhdWx0UmVuZGVyZXIucHJvdG90eXBlLmdldFNoYXBlUGF0aCA9IGZ1bmN0aW9uIGdldFNoYXBlUGF0aChzaGFwZSkgewoKICAgIHZhciB4ID0gc2hhcGUueCwKICAgICAgICB5ID0gc2hhcGUueSwKICAgICAgICB3aWR0aCA9IHNoYXBlLndpZHRoLAogICAgICAgIGhlaWdodCA9IHNoYXBlLmhlaWdodDsKCiAgICB2YXIgc2hhcGVQYXRoID0gWwogICAgICBbJ00nLCB4LCB5XSwKICAgICAgWydsJywgd2lkdGgsIDBdLAogICAgICBbJ2wnLCAwLCBoZWlnaHRdLAogICAgICBbJ2wnLCAtd2lkdGgsIDBdLAogICAgICBbJ3onXQogICAgXTsKCiAgICByZXR1cm4gY29tcG9uZW50c1RvUGF0aChzaGFwZVBhdGgpOwogIH07CgogIERlZmF1bHRSZW5kZXJlci5wcm90b3R5cGUuZ2V0Q29ubmVjdGlvblBhdGggPSBmdW5jdGlvbiBnZXRDb25uZWN0aW9uUGF0aChjb25uZWN0aW9uKSB7CiAgICB2YXIgd2F5cG9pbnRzID0gY29ubmVjdGlvbi53YXlwb2ludHM7CgogICAgdmFyIGlkeCwgcG9pbnQsIGNvbm5lY3Rpb25QYXRoID0gW107CgogICAgZm9yIChpZHggPSAwOyAocG9pbnQgPSB3YXlwb2ludHNbaWR4XSk7IGlkeCsrKSB7CgogICAgICAvLyB0YWtlIGludmlzaWJsZSBkb2NraW5nIGludG8gYWNjb3VudAogICAgICAvLyB3aGVuIGNyZWF0aW5nIHRoZSBwYXRoCiAgICAgIHBvaW50ID0gcG9pbnQub3JpZ2luYWwgfHwgcG9pbnQ7CgogICAgICBjb25uZWN0aW9uUGF0aC5wdXNoKFsgaWR4ID09PSAwID8gJ00nIDogJ0wnLCBwb2ludC54LCBwb2ludC55IF0pOwogICAgfQoKICAgIHJldHVybiBjb21wb25lbnRzVG9QYXRoKGNvbm5lY3Rpb25QYXRoKTsKICB9OwoKCiAgRGVmYXVsdFJlbmRlcmVyLiRpbmplY3QgPSBbICdldmVudEJ1cycsICdzdHlsZXMnIF07CgogIC8qKgogICAqIEEgY29tcG9uZW50IHRoYXQgbWFuYWdlcyBzaGFwZSBzdHlsZXMKICAgKi8KICBmdW5jdGlvbiBTdHlsZXMoKSB7CgogICAgdmFyIGRlZmF1bHRUcmFpdHMgPSB7CgogICAgICAnbm8tZmlsbCc6IHsKICAgICAgICBmaWxsOiAnbm9uZScKICAgICAgfSwKICAgICAgJ25vLWJvcmRlcic6IHsKICAgICAgICBzdHJva2VPcGFjaXR5OiAwLjAKICAgICAgfSwKICAgICAgJ25vLWV2ZW50cyc6IHsKICAgICAgICBwb2ludGVyRXZlbnRzOiAnbm9uZScKICAgICAgfQogICAgfTsKCiAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgLyoqCiAgICAgKiBCdWlsZHMgYSBzdHlsZSBkZWZpbml0aW9uIGZyb20gYSBjbGFzc05hbWUsIGEgbGlzdCBvZiB0cmFpdHMgYW5kIGFuIG9iamVjdCBvZiBhZGRpdGlvbmFsIGF0dHJpYnV0ZXMuCiAgICAgKgogICAgICogQHBhcmFtICB7U3RyaW5nfSBjbGFzc05hbWUKICAgICAqIEBwYXJhbSAge0FycmF5PFN0cmluZz59IHRyYWl0cwogICAgICogQHBhcmFtICB7T2JqZWN0fSBhZGRpdGlvbmFsQXR0cnMKICAgICAqCiAgICAgKiBAcmV0dXJuIHtPYmplY3R9IHRoZSBzdHlsZSBkZWZpbnRpb24KICAgICAqLwogICAgdGhpcy5jbHMgPSBmdW5jdGlvbihjbGFzc05hbWUsIHRyYWl0cywgYWRkaXRpb25hbEF0dHJzKSB7CiAgICAgIHZhciBhdHRycyA9IHRoaXMuc3R5bGUodHJhaXRzLCBhZGRpdGlvbmFsQXR0cnMpOwoKICAgICAgcmV0dXJuIGFzc2lnbihhdHRycywgeyAnY2xhc3MnOiBjbGFzc05hbWUgfSk7CiAgICB9OwoKICAgIC8qKgogICAgICogQnVpbGRzIGEgc3R5bGUgZGVmaW5pdGlvbiBmcm9tIGEgbGlzdCBvZiB0cmFpdHMgYW5kIGFuIG9iamVjdCBvZiBhZGRpdGlvbmFsIGF0dHJpYnV0ZXMuCiAgICAgKgogICAgICogQHBhcmFtICB7QXJyYXk8U3RyaW5nPn0gdHJhaXRzCiAgICAgKiBAcGFyYW0gIHtPYmplY3R9IGFkZGl0aW9uYWxBdHRycwogICAgICoKICAgICAqIEByZXR1cm4ge09iamVjdH0gdGhlIHN0eWxlIGRlZmludGlvbgogICAgICovCiAgICB0aGlzLnN0eWxlID0gZnVuY3Rpb24odHJhaXRzLCBhZGRpdGlvbmFsQXR0cnMpIHsKCiAgICAgIGlmICghaXNBcnJheSh0cmFpdHMpICYmICFhZGRpdGlvbmFsQXR0cnMpIHsKICAgICAgICBhZGRpdGlvbmFsQXR0cnMgPSB0cmFpdHM7CiAgICAgICAgdHJhaXRzID0gW107CiAgICAgIH0KCiAgICAgIHZhciBhdHRycyA9IHJlZHVjZSh0cmFpdHMsIGZ1bmN0aW9uKGF0dHJzLCB0KSB7CiAgICAgICAgcmV0dXJuIGFzc2lnbihhdHRycywgZGVmYXVsdFRyYWl0c1t0XSB8fCB7fSk7CiAgICAgIH0sIHt9KTsKCiAgICAgIHJldHVybiBhZGRpdGlvbmFsQXR0cnMgPyBhc3NpZ24oYXR0cnMsIGFkZGl0aW9uYWxBdHRycykgOiBhdHRyczsKICAgIH07CgogICAgdGhpcy5jb21wdXRlU3R5bGUgPSBmdW5jdGlvbihjdXN0b20sIHRyYWl0cywgZGVmYXVsdFN0eWxlcykgewogICAgICBpZiAoIWlzQXJyYXkodHJhaXRzKSkgewogICAgICAgIGRlZmF1bHRTdHlsZXMgPSB0cmFpdHM7CiAgICAgICAgdHJhaXRzID0gW107CiAgICAgIH0KCiAgICAgIHJldHVybiBzZWxmLnN0eWxlKHRyYWl0cyB8fCBbXSwgYXNzaWduKHt9LCBkZWZhdWx0U3R5bGVzLCBjdXN0b20gfHwge30pKTsKICAgIH07CiAgfQoKICB2YXIgRHJhd01vZHVsZSA9IHsKICAgIF9faW5pdF9fOiBbICdkZWZhdWx0UmVuZGVyZXInIF0sCiAgICBkZWZhdWx0UmVuZGVyZXI6IFsgJ3R5cGUnLCBEZWZhdWx0UmVuZGVyZXIgXSwKICAgIHN0eWxlczogWyAndHlwZScsIFN0eWxlcyBdCiAgfTsKCiAgLyoqCiAgICogRmFpbHNhZmUgcmVtb3ZlIGFuIGVsZW1lbnQgZnJvbSBhIGNvbGxlY3Rpb24KICAgKgogICAqIEBwYXJhbSAge0FycmF5PE9iamVjdD59IFtjb2xsZWN0aW9uXQogICAqIEBwYXJhbSAge09iamVjdH0gW2VsZW1lbnRdCiAgICoKICAgKiBAcmV0dXJuIHtOdW1iZXJ9IHRoZSBwcmV2aW91cyBpbmRleCBvZiB0aGUgZWxlbWVudAogICAqLwogIGZ1bmN0aW9uIHJlbW92ZSQyKGNvbGxlY3Rpb24sIGVsZW1lbnQpIHsKCiAgICBpZiAoIWNvbGxlY3Rpb24gfHwgIWVsZW1lbnQpIHsKICAgICAgcmV0dXJuIC0xOwogICAgfQoKICAgIHZhciBpZHggPSBjb2xsZWN0aW9uLmluZGV4T2YoZWxlbWVudCk7CgogICAgaWYgKGlkeCAhPT0gLTEpIHsKICAgICAgY29sbGVjdGlvbi5zcGxpY2UoaWR4LCAxKTsKICAgIH0KCiAgICByZXR1cm4gaWR4OwogIH0KCiAgLyoqCiAgICogRmFpbCBzYXZlIGFkZCBhbiBlbGVtZW50IHRvIHRoZSBnaXZlbiBjb25uZWN0aW9uLCBlbnN1cmluZwogICAqIGl0IGRvZXMgbm90IHlldCBleGlzdC4KICAgKgogICAqIEBwYXJhbSB7QXJyYXk8T2JqZWN0Pn0gY29sbGVjdGlvbgogICAqIEBwYXJhbSB7T2JqZWN0fSBlbGVtZW50CiAgICogQHBhcmFtIHtOdW1iZXJ9IGlkeAogICAqLwogIGZ1bmN0aW9uIGFkZChjb2xsZWN0aW9uLCBlbGVtZW50LCBpZHgpIHsKCiAgICBpZiAoIWNvbGxlY3Rpb24gfHwgIWVsZW1lbnQpIHsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIGlmICh0eXBlb2YgaWR4ICE9PSAnbnVtYmVyJykgewogICAgICBpZHggPSAtMTsKICAgIH0KCiAgICB2YXIgY3VycmVudElkeCA9IGNvbGxlY3Rpb24uaW5kZXhPZihlbGVtZW50KTsKCiAgICBpZiAoY3VycmVudElkeCAhPT0gLTEpIHsKCiAgICAgIGlmIChjdXJyZW50SWR4ID09PSBpZHgpIHsKCiAgICAgICAgLy8gbm90aGluZyB0byBkbywgcG9zaXRpb24gaGFzIG5vdCBjaGFuZ2VkCiAgICAgICAgcmV0dXJuOwogICAgICB9IGVsc2UgewoKICAgICAgICBpZiAoaWR4ICE9PSAtMSkgewoKICAgICAgICAgIC8vIHJlbW92ZSBmcm9tIGN1cnJlbnQgcG9zaXRpb24KICAgICAgICAgIGNvbGxlY3Rpb24uc3BsaWNlKGN1cnJlbnRJZHgsIDEpOwogICAgICAgIH0gZWxzZSB7CgogICAgICAgICAgLy8gYWxyZWFkeSBleGlzdHMgaW4gY29sbGVjdGlvbgogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIGlmIChpZHggIT09IC0xKSB7CgogICAgICAvLyBpbnNlcnQgYXQgc3BlY2lmaWVkIHBvc2l0aW9uCiAgICAgIGNvbGxlY3Rpb24uc3BsaWNlKGlkeCwgMCwgZWxlbWVudCk7CiAgICB9IGVsc2UgewoKICAgICAgLy8gcHVzaCB0byBlbmQKICAgICAgY29sbGVjdGlvbi5wdXNoKGVsZW1lbnQpOwogICAgfQogIH0KCiAgZnVuY3Rpb24gcm91bmQobnVtYmVyLCByZXNvbHV0aW9uKSB7CiAgICByZXR1cm4gTWF0aC5yb3VuZChudW1iZXIgKiByZXNvbHV0aW9uKSAvIHJlc29sdXRpb247CiAgfQoKICBmdW5jdGlvbiBlbnN1cmVQeChudW1iZXIpIHsKICAgIHJldHVybiBpc051bWJlcihudW1iZXIpID8gbnVtYmVyICsgJ3B4JyA6IG51bWJlcjsKICB9CgogIC8qKgogICAqIENyZWF0ZXMgYSBIVE1MIGNvbnRhaW5lciBlbGVtZW50IGZvciBhIFNWRyBlbGVtZW50IHdpdGgKICAgKiB0aGUgZ2l2ZW4gY29uZmlndXJhdGlvbgogICAqCiAgICogQHBhcmFtICB7T2JqZWN0fSBvcHRpb25zCiAgICogQHJldHVybiB7SFRNTEVsZW1lbnR9IHRoZSBjb250YWluZXIgZWxlbWVudAogICAqLwogIGZ1bmN0aW9uIGNyZWF0ZUNvbnRhaW5lcihvcHRpb25zKSB7CgogICAgb3B0aW9ucyA9IGFzc2lnbih7fSwgeyB3aWR0aDogJzEwMCUnLCBoZWlnaHQ6ICcxMDAlJyB9LCBvcHRpb25zKTsKCiAgICB2YXIgY29udGFpbmVyID0gb3B0aW9ucy5jb250YWluZXIgfHwgZG9jdW1lbnQuYm9keTsKCiAgICAvLyBjcmVhdGUgYSA8ZGl2PiBhcm91bmQgdGhlIHN2ZyBlbGVtZW50IHdpdGggdGhlIHJlc3BlY3RpdmUgc2l6ZQogICAgLy8gdGhpcyB3YXkgd2UgY2FuIGFsd2F5cyBnZXQgdGhlIGNvcnJlY3QgY29udGFpbmVyIHNpemUKICAgIC8vICh0aGlzIGlzIGltcG9zc2libGUgZm9yIDxzdmc+IGVsZW1lbnRzIGF0IHRoZSBtb21lbnQpCiAgICB2YXIgcGFyZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICBwYXJlbnQuc2V0QXR0cmlidXRlKCdjbGFzcycsICdkanMtY29udGFpbmVyJyk7CgogICAgYXNzaWduKHBhcmVudC5zdHlsZSwgewogICAgICBwb3NpdGlvbjogJ3JlbGF0aXZlJywKICAgICAgb3ZlcmZsb3c6ICdoaWRkZW4nLAogICAgICB3aWR0aDogZW5zdXJlUHgob3B0aW9ucy53aWR0aCksCiAgICAgIGhlaWdodDogZW5zdXJlUHgob3B0aW9ucy5oZWlnaHQpCiAgICB9KTsKCiAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQocGFyZW50KTsKCiAgICByZXR1cm4gcGFyZW50OwogIH0KCiAgZnVuY3Rpb24gY3JlYXRlR3JvdXAocGFyZW50LCBjbHMsIGNoaWxkSW5kZXgpIHsKICAgIHZhciBncm91cCA9IGNyZWF0ZSgnZycpOwogICAgY2xhc3NlcyQxKGdyb3VwKS5hZGQoY2xzKTsKCiAgICB2YXIgaW5kZXggPSBjaGlsZEluZGV4ICE9PSB1bmRlZmluZWQgPyBjaGlsZEluZGV4IDogcGFyZW50LmNoaWxkTm9kZXMubGVuZ3RoIC0gMTsKCiAgICAvLyBtdXN0IGVuc3VyZSBzZWNvbmQgYXJndW1lbnQgaXMgbm9kZSBvciBfbnVsbF8KICAgIC8vIGNmLiBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9BUEkvTm9kZS9pbnNlcnRCZWZvcmUKICAgIHBhcmVudC5pbnNlcnRCZWZvcmUoZ3JvdXAsIHBhcmVudC5jaGlsZE5vZGVzW2luZGV4XSB8fCBudWxsKTsKCiAgICByZXR1cm4gZ3JvdXA7CiAgfQoKICB2YXIgQkFTRV9MQVlFUiA9ICdiYXNlJzsKCgogIHZhciBSRVFVSVJFRF9NT0RFTF9BVFRSUyA9IHsKICAgIHNoYXBlOiBbICd4JywgJ3knLCAnd2lkdGgnLCAnaGVpZ2h0JyBdLAogICAgY29ubmVjdGlvbjogWyAnd2F5cG9pbnRzJyBdCiAgfTsKCiAgLyoqCiAgICogVGhlIG1haW4gZHJhd2luZyBjYW52YXMuCiAgICoKICAgKiBAY2xhc3MKICAgKiBAY29uc3RydWN0b3IKICAgKgogICAqIEBlbWl0cyBDYW52YXMjY2FudmFzLmluaXQKICAgKgogICAqIEBwYXJhbSB7T2JqZWN0fSBjb25maWcKICAgKiBAcGFyYW0ge0V2ZW50QnVzfSBldmVudEJ1cwogICAqIEBwYXJhbSB7R3JhcGhpY3NGYWN0b3J5fSBncmFwaGljc0ZhY3RvcnkKICAgKiBAcGFyYW0ge0VsZW1lbnRSZWdpc3RyeX0gZWxlbWVudFJlZ2lzdHJ5CiAgICovCiAgZnVuY3Rpb24gQ2FudmFzKGNvbmZpZywgZXZlbnRCdXMsIGdyYXBoaWNzRmFjdG9yeSwgZWxlbWVudFJlZ2lzdHJ5KSB7CgogICAgdGhpcy5fZXZlbnRCdXMgPSBldmVudEJ1czsKICAgIHRoaXMuX2VsZW1lbnRSZWdpc3RyeSA9IGVsZW1lbnRSZWdpc3RyeTsKICAgIHRoaXMuX2dyYXBoaWNzRmFjdG9yeSA9IGdyYXBoaWNzRmFjdG9yeTsKCiAgICB0aGlzLl9pbml0KGNvbmZpZyB8fCB7fSk7CiAgfQoKICBDYW52YXMuJGluamVjdCA9IFsKICAgICdjb25maWcuY2FudmFzJywKICAgICdldmVudEJ1cycsCiAgICAnZ3JhcGhpY3NGYWN0b3J5JywKICAgICdlbGVtZW50UmVnaXN0cnknCiAgXTsKCgogIENhbnZhcy5wcm90b3R5cGUuX2luaXQgPSBmdW5jdGlvbihjb25maWcpIHsKCiAgICB2YXIgZXZlbnRCdXMgPSB0aGlzLl9ldmVudEJ1czsKCiAgICAvLyBDcmVhdGVzIGEgPHN2Zz4gZWxlbWVudCB0aGF0IGlzIHdyYXBwZWQgaW50byBhIDxkaXY+LgogICAgLy8gVGhpcyB3YXkgd2UgYXJlIGFsd2F5cyBhYmxlIHRvIGNvcnJlY3RseSBmaWd1cmUgb3V0IHRoZSBzaXplIG9mIHRoZSBzdmcgZWxlbWVudAogICAgLy8gYnkgcXVlcnlpbmcgdGhlIHBhcmVudCBub2RlLgogICAgLy8KICAgIC8vIChJdCBpcyBub3QgcG9zc2libGUgdG8gZ2V0IHRoZSBzaXplIG9mIGEgc3ZnIGVsZW1lbnQgY3Jvc3MgYnJvd3NlciBAIDIwMTQtMDQtMDEpCiAgICAvLwogICAgLy8gPGRpdiBjbGFzcz0iZGpzLWNvbnRhaW5lciIgc3R5bGU9IndpZHRoOiB7ZGVzaXJlZC13aWR0aH0sIGhlaWdodDoge2Rlc2lyZWQtaGVpZ2h0fSI+CiAgICAvLyAgIDxzdmcgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSI+CiAgICAvLyAgICAuLi4KICAgIC8vICAgPC9zdmc+CiAgICAvLyA8L2Rpdj4KCiAgICAvLyBodG1sIGNvbnRhaW5lcgogICAgdmFyIGNvbnRhaW5lciA9IHRoaXMuX2NvbnRhaW5lciA9IGNyZWF0ZUNvbnRhaW5lcihjb25maWcpOwoKICAgIHZhciBzdmcgPSB0aGlzLl9zdmcgPSBjcmVhdGUoJ3N2ZycpOwogICAgYXR0ciQxKHN2ZywgeyB3aWR0aDogJzEwMCUnLCBoZWlnaHQ6ICcxMDAlJyB9KTsKCiAgICBhcHBlbmQoY29udGFpbmVyLCBzdmcpOwoKICAgIHZhciB2aWV3cG9ydCA9IHRoaXMuX3ZpZXdwb3J0ID0gY3JlYXRlR3JvdXAoc3ZnLCAndmlld3BvcnQnKTsKCiAgICB0aGlzLl9sYXllcnMgPSB7fTsKCiAgICAvLyBkZWJvdW5jZSBjYW52YXMudmlld2JveC5jaGFuZ2VkIGV2ZW50cwogICAgLy8gZm9yIHNtb290aGVyIGRpYWdyYW0gaW50ZXJhY3Rpb24KICAgIGlmIChjb25maWcuZGVmZXJVcGRhdGUgIT09IGZhbHNlKSB7CiAgICAgIHRoaXMuX3ZpZXdib3hDaGFuZ2VkID0gZGVib3VuY2UoYmluZCh0aGlzLl92aWV3Ym94Q2hhbmdlZCwgdGhpcyksIDMwMCk7CiAgICB9CgogICAgZXZlbnRCdXMub24oJ2RpYWdyYW0uaW5pdCcsIGZ1bmN0aW9uKCkgewoKICAgICAgLyoqCiAgICAgICAqIEFuIGV2ZW50IGluZGljYXRpbmcgdGhhdCB0aGUgY2FudmFzIGlzIHJlYWR5IHRvIGJlIGRyYXduIG9uLgogICAgICAgKgogICAgICAgKiBAbWVtYmVyT2YgQ2FudmFzCiAgICAgICAqCiAgICAgICAqIEBldmVudCBjYW52YXMuaW5pdAogICAgICAgKgogICAgICAgKiBAdHlwZSB7T2JqZWN0fQogICAgICAgKiBAcHJvcGVydHkge1NWR0VsZW1lbnR9IHN2ZyB0aGUgY3JlYXRlZCBzdmcgZWxlbWVudAogICAgICAgKiBAcHJvcGVydHkge1NWR0VsZW1lbnR9IHZpZXdwb3J0IHRoZSBkaXJlY3QgcGFyZW50IG9mIGRpYWdyYW0gZWxlbWVudHMgYW5kIHNoYXBlcwogICAgICAgKi8KICAgICAgZXZlbnRCdXMuZmlyZSgnY2FudmFzLmluaXQnLCB7CiAgICAgICAgc3ZnOiBzdmcsCiAgICAgICAgdmlld3BvcnQ6IHZpZXdwb3J0CiAgICAgIH0pOwoKICAgIH0sIHRoaXMpOwoKICAgIC8vIHJlc2V0IHZpZXdib3ggb24gc2hhcGUgY2hhbmdlcyB0bwogICAgLy8gcmVjb21wdXRlIHRoZSB2aWV3Ym94CiAgICBldmVudEJ1cy5vbihbCiAgICAgICdzaGFwZS5hZGRlZCcsCiAgICAgICdjb25uZWN0aW9uLmFkZGVkJywKICAgICAgJ3NoYXBlLnJlbW92ZWQnLAogICAgICAnY29ubmVjdGlvbi5yZW1vdmVkJywKICAgICAgJ2VsZW1lbnRzLmNoYW5nZWQnCiAgICBdLCBmdW5jdGlvbigpIHsKICAgICAgZGVsZXRlIHRoaXMuX2NhY2hlZFZpZXdib3g7CiAgICB9LCB0aGlzKTsKCiAgICBldmVudEJ1cy5vbignZGlhZ3JhbS5kZXN0cm95JywgNTAwLCB0aGlzLl9kZXN0cm95LCB0aGlzKTsKICAgIGV2ZW50QnVzLm9uKCdkaWFncmFtLmNsZWFyJywgNTAwLCB0aGlzLl9jbGVhciwgdGhpcyk7CiAgfTsKCiAgQ2FudmFzLnByb3RvdHlwZS5fZGVzdHJveSA9IGZ1bmN0aW9uKGVtaXQpIHsKICAgIHRoaXMuX2V2ZW50QnVzLmZpcmUoJ2NhbnZhcy5kZXN0cm95JywgewogICAgICBzdmc6IHRoaXMuX3N2ZywKICAgICAgdmlld3BvcnQ6IHRoaXMuX3ZpZXdwb3J0CiAgICB9KTsKCiAgICB2YXIgcGFyZW50ID0gdGhpcy5fY29udGFpbmVyLnBhcmVudE5vZGU7CgogICAgaWYgKHBhcmVudCkgewogICAgICBwYXJlbnQucmVtb3ZlQ2hpbGQodGhpcy5fY29udGFpbmVyKTsKICAgIH0KCiAgICBkZWxldGUgdGhpcy5fc3ZnOwogICAgZGVsZXRlIHRoaXMuX2NvbnRhaW5lcjsKICAgIGRlbGV0ZSB0aGlzLl9sYXllcnM7CiAgICBkZWxldGUgdGhpcy5fcm9vdEVsZW1lbnQ7CiAgICBkZWxldGUgdGhpcy5fdmlld3BvcnQ7CiAgfTsKCiAgQ2FudmFzLnByb3RvdHlwZS5fY2xlYXIgPSBmdW5jdGlvbigpIHsKCiAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgdmFyIGFsbEVsZW1lbnRzID0gdGhpcy5fZWxlbWVudFJlZ2lzdHJ5LmdldEFsbCgpOwoKICAgIC8vIHJlbW92ZSBhbGwgZWxlbWVudHMKICAgIGFsbEVsZW1lbnRzLmZvckVhY2goZnVuY3Rpb24oZWxlbWVudCkgewogICAgICB2YXIgdHlwZSA9IGdldFR5cGUoZWxlbWVudCk7CgogICAgICBpZiAodHlwZSA9PT0gJ3Jvb3QnKSB7CiAgICAgICAgc2VsZi5zZXRSb290RWxlbWVudChudWxsLCB0cnVlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBzZWxmLl9yZW1vdmVFbGVtZW50KGVsZW1lbnQsIHR5cGUpOwogICAgICB9CiAgICB9KTsKCiAgICAvLyBmb3JjZSByZWNvbXB1dGF0aW9uIG9mIHZpZXcgYm94CiAgICBkZWxldGUgdGhpcy5fY2FjaGVkVmlld2JveDsKICB9OwoKICAvKioKICAgKiBSZXR1cm5zIHRoZSBkZWZhdWx0IGxheWVyIG9uIHdoaWNoCiAgICogYWxsIGVsZW1lbnRzIGFyZSBkcmF3bi4KICAgKgogICAqIEByZXR1cm5zIHtTVkdFbGVtZW50fQogICAqLwogIENhbnZhcy5wcm90b3R5cGUuZ2V0RGVmYXVsdExheWVyID0gZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gdGhpcy5nZXRMYXllcihCQVNFX0xBWUVSLCAwKTsKICB9OwoKICAvKioKICAgKiBSZXR1cm5zIGEgbGF5ZXIgdGhhdCBpcyB1c2VkIHRvIGRyYXcgZWxlbWVudHMKICAgKiBvciBhbm5vdGF0aW9ucyBvbiBpdC4KICAgKgogICAqIE5vbi1leGlzdGluZyBsYXllcnMgcmV0cmlldmVkIHRocm91Z2ggdGhpcyBtZXRob2QKICAgKiB3aWxsIGJlIGNyZWF0ZWQuIER1cmluZyBjcmVhdGlvbiwgdGhlIG9wdGlvbmFsIGluZGV4CiAgICogbWF5IGJlIHVzZWQgdG8gY3JlYXRlIGxheWVycyBiZWxvdyBvciBhYm92ZSBleGlzdGluZyBsYXllcnMuCiAgICogQSBsYXllciB3aXRoIGEgY2VydGFpbiBpbmRleCBpcyBhbHdheXMgY3JlYXRlZCBhYm92ZSBhbGwKICAgKiBleGlzdGluZyBsYXllcnMgd2l0aCB0aGUgc2FtZSBpbmRleC4KICAgKgogICAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lCiAgICogQHBhcmFtIHtOdW1iZXJ9IGluZGV4CiAgICoKICAgKiBAcmV0dXJucyB7U1ZHRWxlbWVudH0KICAgKi8KICBDYW52YXMucHJvdG90eXBlLmdldExheWVyID0gZnVuY3Rpb24obmFtZSwgaW5kZXgpIHsKCiAgICBpZiAoIW5hbWUpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdtdXN0IHNwZWNpZnkgYSBuYW1lJyk7CiAgICB9CgogICAgdmFyIGxheWVyID0gdGhpcy5fbGF5ZXJzW25hbWVdOwoKICAgIGlmICghbGF5ZXIpIHsKICAgICAgbGF5ZXIgPSB0aGlzLl9sYXllcnNbbmFtZV0gPSB0aGlzLl9jcmVhdGVMYXllcihuYW1lLCBpbmRleCk7CiAgICB9CgogICAgLy8gdGhyb3cgYW4gZXJyb3IgaWYgbGF5ZXIgY3JlYXRpb24gLyByZXRyaXZhbCBpcwogICAgLy8gcmVxdWVzdGVkIG9uIGRpZmZlcmVudCBpbmRleAogICAgaWYgKHR5cGVvZiBpbmRleCAhPT0gJ3VuZGVmaW5lZCcgJiYgbGF5ZXIuaW5kZXggIT09IGluZGV4KSB7CiAgICAgIHRocm93IG5ldyBFcnJvcignbGF5ZXIgPCcgKyBuYW1lICsgJz4gYWxyZWFkeSBjcmVhdGVkIGF0IGluZGV4IDwnICsgaW5kZXggKyAnPicpOwogICAgfQoKICAgIHJldHVybiBsYXllci5ncm91cDsKICB9OwoKICAvKioKICAgKiBDcmVhdGVzIGEgZ2l2ZW4gbGF5ZXIgYW5kIHJldHVybnMgaXQuCiAgICoKICAgKiBAcGFyYW0ge1N0cmluZ30gbmFtZQogICAqIEBwYXJhbSB7TnVtYmVyfSBbaW5kZXg9MF0KICAgKgogICAqIEByZXR1cm4ge09iamVjdH0gbGF5ZXIgZGVzY3JpcHRvciB3aXRoIHsgaW5kZXgsIGdyb3VwOiBTVkdHcm91cCB9CiAgICovCiAgQ2FudmFzLnByb3RvdHlwZS5fY3JlYXRlTGF5ZXIgPSBmdW5jdGlvbihuYW1lLCBpbmRleCkgewoKICAgIGlmICghaW5kZXgpIHsKICAgICAgaW5kZXggPSAwOwogICAgfQoKICAgIHZhciBjaGlsZEluZGV4ID0gcmVkdWNlKHRoaXMuX2xheWVycywgZnVuY3Rpb24oY2hpbGRJbmRleCwgbGF5ZXIpIHsKICAgICAgaWYgKGluZGV4ID49IGxheWVyLmluZGV4KSB7CiAgICAgICAgY2hpbGRJbmRleCsrOwogICAgICB9CgogICAgICByZXR1cm4gY2hpbGRJbmRleDsKICAgIH0sIDApOwoKICAgIHJldHVybiB7CiAgICAgIGdyb3VwOiBjcmVhdGVHcm91cCh0aGlzLl92aWV3cG9ydCwgJ2xheWVyLScgKyBuYW1lLCBjaGlsZEluZGV4KSwKICAgICAgaW5kZXg6IGluZGV4CiAgICB9OwoKICB9OwoKICAvKioKICAgKiBSZXR1cm5zIHRoZSBodG1sIGVsZW1lbnQgdGhhdCBlbmNsb3NlcyB0aGUKICAgKiBkcmF3aW5nIGNhbnZhcy4KICAgKgogICAqIEByZXR1cm4ge0RPTU5vZGV9CiAgICovCiAgQ2FudmFzLnByb3RvdHlwZS5nZXRDb250YWluZXIgPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiB0aGlzLl9jb250YWluZXI7CiAgfTsKCgogIC8vIG1hcmtlcnMgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICBDYW52YXMucHJvdG90eXBlLl91cGRhdGVNYXJrZXIgPSBmdW5jdGlvbihlbGVtZW50LCBtYXJrZXIsIGFkZCkgewogICAgdmFyIGNvbnRhaW5lcjsKCiAgICBpZiAoIWVsZW1lbnQuaWQpIHsKICAgICAgZWxlbWVudCA9IHRoaXMuX2VsZW1lbnRSZWdpc3RyeS5nZXQoZWxlbWVudCk7CiAgICB9CgogICAgLy8gd2UgbmVlZCB0byBhY2Nlc3MgYWxsCiAgICBjb250YWluZXIgPSB0aGlzLl9lbGVtZW50UmVnaXN0cnkuX2VsZW1lbnRzW2VsZW1lbnQuaWRdOwoKICAgIGlmICghY29udGFpbmVyKSB7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBmb3JFYWNoKFsgY29udGFpbmVyLmdmeCwgY29udGFpbmVyLnNlY29uZGFyeUdmeCBdLCBmdW5jdGlvbihnZngpIHsKICAgICAgaWYgKGdmeCkgewoKICAgICAgICAvLyBpbnZva2UgZWl0aGVyIGFkZENsYXNzIG9yIHJlbW92ZUNsYXNzIGJhc2VkIG9uIG1vZGUKICAgICAgICBpZiAoYWRkKSB7CiAgICAgICAgICBjbGFzc2VzJDEoZ2Z4KS5hZGQobWFya2VyKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY2xhc3NlcyQxKGdmeCkucmVtb3ZlKG1hcmtlcik7CiAgICAgICAgfQogICAgICB9CiAgICB9KTsKCiAgICAvKioKICAgICAqIEFuIGV2ZW50IGluZGljYXRpbmcgdGhhdCBhIG1hcmtlciBoYXMgYmVlbiB1cGRhdGVkIGZvciBhbiBlbGVtZW50CiAgICAgKgogICAgICogQGV2ZW50IGVsZW1lbnQubWFya2VyLnVwZGF0ZQogICAgICogQHR5cGUge09iamVjdH0KICAgICAqIEBwcm9wZXJ0eSB7ZGpzLm1vZGVsLkVsZW1lbnR9IGVsZW1lbnQgdGhlIHNoYXBlCiAgICAgKiBAcHJvcGVydHkge09iamVjdH0gZ2Z4IHRoZSBncmFwaGljYWwgcmVwcmVzZW50YXRpb24gb2YgdGhlIHNoYXBlCiAgICAgKiBAcHJvcGVydHkge1N0cmluZ30gbWFya2VyCiAgICAgKiBAcHJvcGVydHkge0Jvb2xlYW59IGFkZCB0cnVlIGlmIHRoZSBtYXJrZXIgd2FzIGFkZGVkLCBmYWxzZSBpZiBpdCBnb3QgcmVtb3ZlZAogICAgICovCiAgICB0aGlzLl9ldmVudEJ1cy5maXJlKCdlbGVtZW50Lm1hcmtlci51cGRhdGUnLCB7IGVsZW1lbnQ6IGVsZW1lbnQsIGdmeDogY29udGFpbmVyLmdmeCwgbWFya2VyOiBtYXJrZXIsIGFkZDogISFhZGQgfSk7CiAgfTsKCgogIC8qKgogICAqIEFkZHMgYSBtYXJrZXIgdG8gYW4gZWxlbWVudCAoYmFzaWNhbGx5IGEgY3NzIGNsYXNzKS4KICAgKgogICAqIEZpcmVzIHRoZSBlbGVtZW50Lm1hcmtlci51cGRhdGUgZXZlbnQsIG1ha2luZyBpdCBwb3NzaWJsZSB0bwogICAqIGludGVncmF0ZSBleHRlbnNpb24gaW50byB0aGUgbWFya2VyIGxpZmUtY3ljbGUsIHRvby4KICAgKgogICAqIEBleGFtcGxlCiAgICogY2FudmFzLmFkZE1hcmtlcignZm9vJywgJ3NvbWUtbWFya2VyJyk7CiAgICoKICAgKiB2YXIgZm9vR2Z4ID0gY2FudmFzLmdldEdyYXBoaWNzKCdmb28nKTsKICAgKgogICAqIGZvb0dmeDsgLy8gPGcgY2xhc3M9Ii4uLiBzb21lLW1hcmtlciI+IC4uLiA8L2c+CiAgICoKICAgKiBAcGFyYW0ge1N0cmluZ3xkanMubW9kZWwuQmFzZX0gZWxlbWVudAogICAqIEBwYXJhbSB7U3RyaW5nfSBtYXJrZXIKICAgKi8KICBDYW52YXMucHJvdG90eXBlLmFkZE1hcmtlciA9IGZ1bmN0aW9uKGVsZW1lbnQsIG1hcmtlcikgewogICAgdGhpcy5fdXBkYXRlTWFya2VyKGVsZW1lbnQsIG1hcmtlciwgdHJ1ZSk7CiAgfTsKCgogIC8qKgogICAqIFJlbW92ZSBhIG1hcmtlciBmcm9tIGFuIGVsZW1lbnQuCiAgICoKICAgKiBGaXJlcyB0aGUgZWxlbWVudC5tYXJrZXIudXBkYXRlIGV2ZW50LCBtYWtpbmcgaXQgcG9zc2libGUgdG8KICAgKiBpbnRlZ3JhdGUgZXh0ZW5zaW9uIGludG8gdGhlIG1hcmtlciBsaWZlLWN5Y2xlLCB0b28uCiAgICoKICAgKiBAcGFyYW0gIHtTdHJpbmd8ZGpzLm1vZGVsLkJhc2V9IGVsZW1lbnQKICAgKiBAcGFyYW0gIHtTdHJpbmd9IG1hcmtlcgogICAqLwogIENhbnZhcy5wcm90b3R5cGUucmVtb3ZlTWFya2VyID0gZnVuY3Rpb24oZWxlbWVudCwgbWFya2VyKSB7CiAgICB0aGlzLl91cGRhdGVNYXJrZXIoZWxlbWVudCwgbWFya2VyLCBmYWxzZSk7CiAgfTsKCiAgLyoqCiAgICogQ2hlY2sgdGhlIGV4aXN0ZW5jZSBvZiBhIG1hcmtlciBvbiBlbGVtZW50LgogICAqCiAgICogQHBhcmFtICB7U3RyaW5nfGRqcy5tb2RlbC5CYXNlfSBlbGVtZW50CiAgICogQHBhcmFtICB7U3RyaW5nfSBtYXJrZXIKICAgKi8KICBDYW52YXMucHJvdG90eXBlLmhhc01hcmtlciA9IGZ1bmN0aW9uKGVsZW1lbnQsIG1hcmtlcikgewogICAgaWYgKCFlbGVtZW50LmlkKSB7CiAgICAgIGVsZW1lbnQgPSB0aGlzLl9lbGVtZW50UmVnaXN0cnkuZ2V0KGVsZW1lbnQpOwogICAgfQoKICAgIHZhciBnZnggPSB0aGlzLmdldEdyYXBoaWNzKGVsZW1lbnQpOwoKICAgIHJldHVybiBjbGFzc2VzJDEoZ2Z4KS5oYXMobWFya2VyKTsKICB9OwoKICAvKioKICAgKiBUb2dnbGVzIGEgbWFya2VyIG9uIGFuIGVsZW1lbnQuCiAgICoKICAgKiBGaXJlcyB0aGUgZWxlbWVudC5tYXJrZXIudXBkYXRlIGV2ZW50LCBtYWtpbmcgaXQgcG9zc2libGUgdG8KICAgKiBpbnRlZ3JhdGUgZXh0ZW5zaW9uIGludG8gdGhlIG1hcmtlciBsaWZlLWN5Y2xlLCB0b28uCiAgICoKICAgKiBAcGFyYW0gIHtTdHJpbmd8ZGpzLm1vZGVsLkJhc2V9IGVsZW1lbnQKICAgKiBAcGFyYW0gIHtTdHJpbmd9IG1hcmtlcgogICAqLwogIENhbnZhcy5wcm90b3R5cGUudG9nZ2xlTWFya2VyID0gZnVuY3Rpb24oZWxlbWVudCwgbWFya2VyKSB7CiAgICBpZiAodGhpcy5oYXNNYXJrZXIoZWxlbWVudCwgbWFya2VyKSkgewogICAgICB0aGlzLnJlbW92ZU1hcmtlcihlbGVtZW50LCBtYXJrZXIpOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5hZGRNYXJrZXIoZWxlbWVudCwgbWFya2VyKTsKICAgIH0KICB9OwoKICBDYW52YXMucHJvdG90eXBlLmdldFJvb3RFbGVtZW50ID0gZnVuY3Rpb24oKSB7CiAgICBpZiAoIXRoaXMuX3Jvb3RFbGVtZW50KSB7CiAgICAgIHRoaXMuc2V0Um9vdEVsZW1lbnQoeyBpZDogJ19faW1wbGljaXRyb290JywgY2hpbGRyZW46IFtdIH0pOwogICAgfQoKICAgIHJldHVybiB0aGlzLl9yb290RWxlbWVudDsKICB9OwoKCgogIC8vIHJvb3QgZWxlbWVudCBoYW5kbGluZyAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogIC8qKgogICAqIFNldHMgYSBnaXZlbiBlbGVtZW50IGFzIHRoZSBuZXcgcm9vdCBlbGVtZW50IGZvciB0aGUgY2FudmFzCiAgICogYW5kIHJldHVybnMgdGhlIG5ldyByb290IGVsZW1lbnQuCiAgICoKICAgKiBAcGFyYW0ge09iamVjdHxkanMubW9kZWwuUm9vdH0gZWxlbWVudAogICAqIEBwYXJhbSB7Qm9vbGVhbn0gW292ZXJyaWRlXSB3aGV0aGVyIHRvIG92ZXJyaWRlIHRoZSBjdXJyZW50IHJvb3QgZWxlbWVudCwgaWYgYW55CiAgICoKICAgKiBAcmV0dXJuIHtPYmplY3R8ZGpzLm1vZGVsLlJvb3R9IG5ldyByb290IGVsZW1lbnQKICAgKi8KICBDYW52YXMucHJvdG90eXBlLnNldFJvb3RFbGVtZW50ID0gZnVuY3Rpb24oZWxlbWVudCwgb3ZlcnJpZGUpIHsKCiAgICBpZiAoZWxlbWVudCkgewogICAgICB0aGlzLl9lbnN1cmVWYWxpZCgncm9vdCcsIGVsZW1lbnQpOwogICAgfQoKICAgIHZhciBjdXJyZW50Um9vdCA9IHRoaXMuX3Jvb3RFbGVtZW50LAogICAgICAgIGVsZW1lbnRSZWdpc3RyeSA9IHRoaXMuX2VsZW1lbnRSZWdpc3RyeSwKICAgICAgICBldmVudEJ1cyA9IHRoaXMuX2V2ZW50QnVzOwoKICAgIGlmIChjdXJyZW50Um9vdCkgewogICAgICBpZiAoIW92ZXJyaWRlKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdyb290RWxlbWVudCBhbHJlYWR5IHNldCwgbmVlZCB0byBzcGVjaWZ5IG92ZXJyaWRlJyk7CiAgICAgIH0KCiAgICAgIC8vIHNpbXVsYXRlIGVsZW1lbnQgcmVtb3ZlIGV2ZW50IHNlcXVlbmNlCiAgICAgIGV2ZW50QnVzLmZpcmUoJ3Jvb3QucmVtb3ZlJywgeyBlbGVtZW50OiBjdXJyZW50Um9vdCB9KTsKICAgICAgZXZlbnRCdXMuZmlyZSgncm9vdC5yZW1vdmVkJywgeyBlbGVtZW50OiBjdXJyZW50Um9vdCB9KTsKCiAgICAgIGVsZW1lbnRSZWdpc3RyeS5yZW1vdmUoY3VycmVudFJvb3QpOwogICAgfQoKICAgIGlmIChlbGVtZW50KSB7CiAgICAgIHZhciBnZnggPSB0aGlzLmdldERlZmF1bHRMYXllcigpOwoKICAgICAgLy8gcmVzZW1ibGUgZWxlbWVudCBhZGQgZXZlbnQgc2VxdWVuY2UKICAgICAgZXZlbnRCdXMuZmlyZSgncm9vdC5hZGQnLCB7IGVsZW1lbnQ6IGVsZW1lbnQgfSk7CgogICAgICBlbGVtZW50UmVnaXN0cnkuYWRkKGVsZW1lbnQsIGdmeCwgdGhpcy5fc3ZnKTsKCiAgICAgIGV2ZW50QnVzLmZpcmUoJ3Jvb3QuYWRkZWQnLCB7IGVsZW1lbnQ6IGVsZW1lbnQsIGdmeDogZ2Z4IH0pOwogICAgfQoKICAgIHRoaXMuX3Jvb3RFbGVtZW50ID0gZWxlbWVudDsKCiAgICByZXR1cm4gZWxlbWVudDsKICB9OwoKCgogIC8vIGFkZCBmdW5jdGlvbmFsaXR5IC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgQ2FudmFzLnByb3RvdHlwZS5fZW5zdXJlVmFsaWQgPSBmdW5jdGlvbih0eXBlLCBlbGVtZW50KSB7CiAgICBpZiAoIWVsZW1lbnQuaWQpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdlbGVtZW50IG11c3QgaGF2ZSBhbiBpZCcpOwogICAgfQoKICAgIGlmICh0aGlzLl9lbGVtZW50UmVnaXN0cnkuZ2V0KGVsZW1lbnQuaWQpKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcignZWxlbWVudCB3aXRoIGlkICcgKyBlbGVtZW50LmlkICsgJyBhbHJlYWR5IGV4aXN0cycpOwogICAgfQoKICAgIHZhciByZXF1aXJlZEF0dHJzID0gUkVRVUlSRURfTU9ERUxfQVRUUlNbdHlwZV07CgogICAgdmFyIHZhbGlkID0gZXZlcnkocmVxdWlyZWRBdHRycywgZnVuY3Rpb24oYXR0cikgewogICAgICByZXR1cm4gdHlwZW9mIGVsZW1lbnRbYXR0cl0gIT09ICd1bmRlZmluZWQnOwogICAgfSk7CgogICAgaWYgKCF2YWxpZCkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoCiAgICAgICAgJ211c3Qgc3VwcGx5IHsgJyArIHJlcXVpcmVkQXR0cnMuam9pbignLCAnKSArICcgfSB3aXRoICcgKyB0eXBlKTsKICAgIH0KICB9OwoKICBDYW52YXMucHJvdG90eXBlLl9zZXRQYXJlbnQgPSBmdW5jdGlvbihlbGVtZW50LCBwYXJlbnQsIHBhcmVudEluZGV4KSB7CiAgICBhZGQocGFyZW50LmNoaWxkcmVuLCBlbGVtZW50LCBwYXJlbnRJbmRleCk7CiAgICBlbGVtZW50LnBhcmVudCA9IHBhcmVudDsKICB9OwoKICAvKioKICAgKiBBZGRzIGFuIGVsZW1lbnQgdG8gdGhlIGNhbnZhcy4KICAgKgogICAqIFRoaXMgd2lyZXMgdGhlIHBhcmVudCA8LT4gY2hpbGQgcmVsYXRpb25zaGlwIGJldHdlZW4gdGhlIGVsZW1lbnQgYW5kCiAgICogYSBleHBsaWNpdGx5IHNwZWNpZmllZCBwYXJlbnQgb3IgYW4gaW1wbGljaXQgcm9vdCBlbGVtZW50LgogICAqCiAgICogRHVyaW5nIGFkZCBpdCBlbWl0cyB0aGUgZXZlbnRzCiAgICoKICAgKiAgKiA8e3R5cGV9LmFkZD4gKGVsZW1lbnQsIHBhcmVudCkKICAgKiAgKiA8e3R5cGV9LmFkZGVkPiAoZWxlbWVudCwgZ2Z4KQogICAqCiAgICogRXh0ZW5zaW9ucyBtYXkgaG9vayBpbnRvIHRoZXNlIGV2ZW50cyB0byBwZXJmb3JtIHRoZWlyIG1hZ2ljLgogICAqCiAgICogQHBhcmFtIHtTdHJpbmd9IHR5cGUKICAgKiBAcGFyYW0ge09iamVjdHxkanMubW9kZWwuQmFzZX0gZWxlbWVudAogICAqIEBwYXJhbSB7T2JqZWN0fGRqcy5tb2RlbC5CYXNlfSBbcGFyZW50XQogICAqIEBwYXJhbSB7TnVtYmVyfSBbcGFyZW50SW5kZXhdCiAgICoKICAgKiBAcmV0dXJuIHtPYmplY3R8ZGpzLm1vZGVsLkJhc2V9IHRoZSBhZGRlZCBlbGVtZW50CiAgICovCiAgQ2FudmFzLnByb3RvdHlwZS5fYWRkRWxlbWVudCA9IGZ1bmN0aW9uKHR5cGUsIGVsZW1lbnQsIHBhcmVudCwgcGFyZW50SW5kZXgpIHsKCiAgICBwYXJlbnQgPSBwYXJlbnQgfHwgdGhpcy5nZXRSb290RWxlbWVudCgpOwoKICAgIHZhciBldmVudEJ1cyA9IHRoaXMuX2V2ZW50QnVzLAogICAgICAgIGdyYXBoaWNzRmFjdG9yeSA9IHRoaXMuX2dyYXBoaWNzRmFjdG9yeTsKCiAgICB0aGlzLl9lbnN1cmVWYWxpZCh0eXBlLCBlbGVtZW50KTsKCiAgICBldmVudEJ1cy5maXJlKHR5cGUgKyAnLmFkZCcsIHsgZWxlbWVudDogZWxlbWVudCwgcGFyZW50OiBwYXJlbnQgfSk7CgogICAgdGhpcy5fc2V0UGFyZW50KGVsZW1lbnQsIHBhcmVudCwgcGFyZW50SW5kZXgpOwoKICAgIC8vIGNyZWF0ZSBncmFwaGljcwogICAgdmFyIGdmeCA9IGdyYXBoaWNzRmFjdG9yeS5jcmVhdGUodHlwZSwgZWxlbWVudCwgcGFyZW50SW5kZXgpOwoKICAgIHRoaXMuX2VsZW1lbnRSZWdpc3RyeS5hZGQoZWxlbWVudCwgZ2Z4KTsKCiAgICAvLyB1cGRhdGUgaXRzIHZpc3VhbAogICAgZ3JhcGhpY3NGYWN0b3J5LnVwZGF0ZSh0eXBlLCBlbGVtZW50LCBnZngpOwoKICAgIGV2ZW50QnVzLmZpcmUodHlwZSArICcuYWRkZWQnLCB7IGVsZW1lbnQ6IGVsZW1lbnQsIGdmeDogZ2Z4IH0pOwoKICAgIHJldHVybiBlbGVtZW50OwogIH07CgogIC8qKgogICAqIEFkZHMgYSBzaGFwZSB0byB0aGUgY2FudmFzCiAgICoKICAgKiBAcGFyYW0ge09iamVjdHxkanMubW9kZWwuU2hhcGV9IHNoYXBlIHRvIGFkZCB0byB0aGUgZGlhZ3JhbQogICAqIEBwYXJhbSB7ZGpzLm1vZGVsLkJhc2V9IFtwYXJlbnRdCiAgICogQHBhcmFtIHtOdW1iZXJ9IFtwYXJlbnRJbmRleF0KICAgKgogICAqIEByZXR1cm4ge2Rqcy5tb2RlbC5TaGFwZX0gdGhlIGFkZGVkIHNoYXBlCiAgICovCiAgQ2FudmFzLnByb3RvdHlwZS5hZGRTaGFwZSA9IGZ1bmN0aW9uKHNoYXBlLCBwYXJlbnQsIHBhcmVudEluZGV4KSB7CiAgICByZXR1cm4gdGhpcy5fYWRkRWxlbWVudCgnc2hhcGUnLCBzaGFwZSwgcGFyZW50LCBwYXJlbnRJbmRleCk7CiAgfTsKCiAgLyoqCiAgICogQWRkcyBhIGNvbm5lY3Rpb24gdG8gdGhlIGNhbnZhcwogICAqCiAgICogQHBhcmFtIHtPYmplY3R8ZGpzLm1vZGVsLkNvbm5lY3Rpb259IGNvbm5lY3Rpb24gdG8gYWRkIHRvIHRoZSBkaWFncmFtCiAgICogQHBhcmFtIHtkanMubW9kZWwuQmFzZX0gW3BhcmVudF0KICAgKiBAcGFyYW0ge051bWJlcn0gW3BhcmVudEluZGV4XQogICAqCiAgICogQHJldHVybiB7ZGpzLm1vZGVsLkNvbm5lY3Rpb259IHRoZSBhZGRlZCBjb25uZWN0aW9uCiAgICovCiAgQ2FudmFzLnByb3RvdHlwZS5hZGRDb25uZWN0aW9uID0gZnVuY3Rpb24oY29ubmVjdGlvbiwgcGFyZW50LCBwYXJlbnRJbmRleCkgewogICAgcmV0dXJuIHRoaXMuX2FkZEVsZW1lbnQoJ2Nvbm5lY3Rpb24nLCBjb25uZWN0aW9uLCBwYXJlbnQsIHBhcmVudEluZGV4KTsKICB9OwoKCiAgLyoqCiAgICogSW50ZXJuYWwgcmVtb3ZlIGVsZW1lbnQKICAgKi8KICBDYW52YXMucHJvdG90eXBlLl9yZW1vdmVFbGVtZW50ID0gZnVuY3Rpb24oZWxlbWVudCwgdHlwZSkgewoKICAgIHZhciBlbGVtZW50UmVnaXN0cnkgPSB0aGlzLl9lbGVtZW50UmVnaXN0cnksCiAgICAgICAgZ3JhcGhpY3NGYWN0b3J5ID0gdGhpcy5fZ3JhcGhpY3NGYWN0b3J5LAogICAgICAgIGV2ZW50QnVzID0gdGhpcy5fZXZlbnRCdXM7CgogICAgZWxlbWVudCA9IGVsZW1lbnRSZWdpc3RyeS5nZXQoZWxlbWVudC5pZCB8fCBlbGVtZW50KTsKCiAgICBpZiAoIWVsZW1lbnQpIHsKCiAgICAgIC8vIGVsZW1lbnQgd2FzIHJlbW92ZWQgYWxyZWFkeQogICAgICByZXR1cm47CiAgICB9CgogICAgZXZlbnRCdXMuZmlyZSh0eXBlICsgJy5yZW1vdmUnLCB7IGVsZW1lbnQ6IGVsZW1lbnQgfSk7CgogICAgZ3JhcGhpY3NGYWN0b3J5LnJlbW92ZShlbGVtZW50KTsKCiAgICAvLyB1bnNldCBwYXJlbnQgPC0+IGNoaWxkIHJlbGF0aW9uc2hpcAogICAgcmVtb3ZlJDIoZWxlbWVudC5wYXJlbnQgJiYgZWxlbWVudC5wYXJlbnQuY2hpbGRyZW4sIGVsZW1lbnQpOwogICAgZWxlbWVudC5wYXJlbnQgPSBudWxsOwoKICAgIGV2ZW50QnVzLmZpcmUodHlwZSArICcucmVtb3ZlZCcsIHsgZWxlbWVudDogZWxlbWVudCB9KTsKCiAgICBlbGVtZW50UmVnaXN0cnkucmVtb3ZlKGVsZW1lbnQpOwoKICAgIHJldHVybiBlbGVtZW50OwogIH07CgoKICAvKioKICAgKiBSZW1vdmVzIGEgc2hhcGUgZnJvbSB0aGUgY2FudmFzCiAgICoKICAgKiBAcGFyYW0ge1N0cmluZ3xkanMubW9kZWwuU2hhcGV9IHNoYXBlIG9yIHNoYXBlIGlkIHRvIGJlIHJlbW92ZWQKICAgKgogICAqIEByZXR1cm4ge2Rqcy5tb2RlbC5TaGFwZX0gdGhlIHJlbW92ZWQgc2hhcGUKICAgKi8KICBDYW52YXMucHJvdG90eXBlLnJlbW92ZVNoYXBlID0gZnVuY3Rpb24oc2hhcGUpIHsKCiAgICAvKioKICAgICAqIEFuIGV2ZW50IGluZGljYXRpbmcgdGhhdCBhIHNoYXBlIGlzIGFib3V0IHRvIGJlIHJlbW92ZWQgZnJvbSB0aGUgY2FudmFzLgogICAgICoKICAgICAqIEBtZW1iZXJPZiBDYW52YXMKICAgICAqCiAgICAgKiBAZXZlbnQgc2hhcGUucmVtb3ZlCiAgICAgKiBAdHlwZSB7T2JqZWN0fQogICAgICogQHByb3BlcnR5IHtkanMubW9kZWwuU2hhcGV9IGVsZW1lbnQgdGhlIHNoYXBlIGRlc2NyaXB0b3IKICAgICAqIEBwcm9wZXJ0eSB7T2JqZWN0fSBnZnggdGhlIGdyYXBoaWNhbCByZXByZXNlbnRhdGlvbiBvZiB0aGUgc2hhcGUKICAgICAqLwoKICAgIC8qKgogICAgICogQW4gZXZlbnQgaW5kaWNhdGluZyB0aGF0IGEgc2hhcGUgaGFzIGJlZW4gcmVtb3ZlZCBmcm9tIHRoZSBjYW52YXMuCiAgICAgKgogICAgICogQG1lbWJlck9mIENhbnZhcwogICAgICoKICAgICAqIEBldmVudCBzaGFwZS5yZW1vdmVkCiAgICAgKiBAdHlwZSB7T2JqZWN0fQogICAgICogQHByb3BlcnR5IHtkanMubW9kZWwuU2hhcGV9IGVsZW1lbnQgdGhlIHNoYXBlIGRlc2NyaXB0b3IKICAgICAqIEBwcm9wZXJ0eSB7T2JqZWN0fSBnZnggdGhlIGdyYXBoaWNhbCByZXByZXNlbnRhdGlvbiBvZiB0aGUgc2hhcGUKICAgICAqLwogICAgcmV0dXJuIHRoaXMuX3JlbW92ZUVsZW1lbnQoc2hhcGUsICdzaGFwZScpOwogIH07CgoKICAvKioKICAgKiBSZW1vdmVzIGEgY29ubmVjdGlvbiBmcm9tIHRoZSBjYW52YXMKICAgKgogICAqIEBwYXJhbSB7U3RyaW5nfGRqcy5tb2RlbC5Db25uZWN0aW9ufSBjb25uZWN0aW9uIG9yIGNvbm5lY3Rpb24gaWQgdG8gYmUgcmVtb3ZlZAogICAqCiAgICogQHJldHVybiB7ZGpzLm1vZGVsLkNvbm5lY3Rpb259IHRoZSByZW1vdmVkIGNvbm5lY3Rpb24KICAgKi8KICBDYW52YXMucHJvdG90eXBlLnJlbW92ZUNvbm5lY3Rpb24gPSBmdW5jdGlvbihjb25uZWN0aW9uKSB7CgogICAgLyoqCiAgICAgKiBBbiBldmVudCBpbmRpY2F0aW5nIHRoYXQgYSBjb25uZWN0aW9uIGlzIGFib3V0IHRvIGJlIHJlbW92ZWQgZnJvbSB0aGUgY2FudmFzLgogICAgICoKICAgICAqIEBtZW1iZXJPZiBDYW52YXMKICAgICAqCiAgICAgKiBAZXZlbnQgY29ubmVjdGlvbi5yZW1vdmUKICAgICAqIEB0eXBlIHtPYmplY3R9CiAgICAgKiBAcHJvcGVydHkge2Rqcy5tb2RlbC5Db25uZWN0aW9ufSBlbGVtZW50IHRoZSBjb25uZWN0aW9uIGRlc2NyaXB0b3IKICAgICAqIEBwcm9wZXJ0eSB7T2JqZWN0fSBnZnggdGhlIGdyYXBoaWNhbCByZXByZXNlbnRhdGlvbiBvZiB0aGUgY29ubmVjdGlvbgogICAgICovCgogICAgLyoqCiAgICAgKiBBbiBldmVudCBpbmRpY2F0aW5nIHRoYXQgYSBjb25uZWN0aW9uIGhhcyBiZWVuIHJlbW92ZWQgZnJvbSB0aGUgY2FudmFzLgogICAgICoKICAgICAqIEBtZW1iZXJPZiBDYW52YXMKICAgICAqCiAgICAgKiBAZXZlbnQgY29ubmVjdGlvbi5yZW1vdmVkCiAgICAgKiBAdHlwZSB7T2JqZWN0fQogICAgICogQHByb3BlcnR5IHtkanMubW9kZWwuQ29ubmVjdGlvbn0gZWxlbWVudCB0aGUgY29ubmVjdGlvbiBkZXNjcmlwdG9yCiAgICAgKiBAcHJvcGVydHkge09iamVjdH0gZ2Z4IHRoZSBncmFwaGljYWwgcmVwcmVzZW50YXRpb24gb2YgdGhlIGNvbm5lY3Rpb24KICAgICAqLwogICAgcmV0dXJuIHRoaXMuX3JlbW92ZUVsZW1lbnQoY29ubmVjdGlvbiwgJ2Nvbm5lY3Rpb24nKTsKICB9OwoKCiAgLyoqCiAgICogUmV0dXJuIHRoZSBncmFwaGljYWwgb2JqZWN0IHVuZGVybGF5aW5nIGEgY2VydGFpbiBkaWFncmFtIGVsZW1lbnQKICAgKgogICAqIEBwYXJhbSB7U3RyaW5nfGRqcy5tb2RlbC5CYXNlfSBlbGVtZW50IGRlc2NyaXB0b3Igb2YgdGhlIGVsZW1lbnQKICAgKiBAcGFyYW0ge0Jvb2xlYW59IFtzZWNvbmRhcnk9ZmFsc2VdIHdoZXRoZXIgdG8gcmV0dXJuIHRoZSBzZWNvbmRhcnkgY29ubmVjdGVkIGVsZW1lbnQKICAgKgogICAqIEByZXR1cm4ge1NWR0VsZW1lbnR9CiAgICovCiAgQ2FudmFzLnByb3RvdHlwZS5nZXRHcmFwaGljcyA9IGZ1bmN0aW9uKGVsZW1lbnQsIHNlY29uZGFyeSkgewogICAgcmV0dXJuIHRoaXMuX2VsZW1lbnRSZWdpc3RyeS5nZXRHcmFwaGljcyhlbGVtZW50LCBzZWNvbmRhcnkpOwogIH07CgoKICAvKioKICAgKiBQZXJmb3JtIGEgdmlld2JveCB1cGRhdGUgdmlhIGEgZ2l2ZW4gY2hhbmdlIGZ1bmN0aW9uLgogICAqCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2hhbmdlRm4KICAgKi8KICBDYW52YXMucHJvdG90eXBlLl9jaGFuZ2VWaWV3Ym94ID0gZnVuY3Rpb24oY2hhbmdlRm4pIHsKCiAgICAvLyBub3RpZnkgb3RoZXJzIG9mIHRoZSB1cGNvbWluZyB2aWV3Ym94IGNoYW5nZQogICAgdGhpcy5fZXZlbnRCdXMuZmlyZSgnY2FudmFzLnZpZXdib3guY2hhbmdpbmcnKTsKCiAgICAvLyBwZXJmb3JtIGFjdHVhbCBjaGFuZ2UKICAgIGNoYW5nZUZuLmFwcGx5KHRoaXMpOwoKICAgIC8vIHJlc2V0IHRoZSBjYWNoZWQgdmlld2JveCBzbyB0aGF0CiAgICAvLyBhIG5ldyBnZXQgb3BlcmF0aW9uIG9uIHZpZXdib3ggb3Igem9vbQogICAgLy8gdHJpZ2dlcnMgYSB2aWV3Ym94IHJlLWNvbXB1dGF0aW9uCiAgICB0aGlzLl9jYWNoZWRWaWV3Ym94ID0gbnVsbDsKCiAgICAvLyBub3RpZnkgb3RoZXJzIG9mIHRoZSBjaGFuZ2U7IHRoaXMgc3RlcAogICAgLy8gbWF5IG9yIG1heSBub3QgYmUgZGVib3VuY2VkCiAgICB0aGlzLl92aWV3Ym94Q2hhbmdlZCgpOwogIH07CgogIENhbnZhcy5wcm90b3R5cGUuX3ZpZXdib3hDaGFuZ2VkID0gZnVuY3Rpb24oKSB7CiAgICB0aGlzLl9ldmVudEJ1cy5maXJlKCdjYW52YXMudmlld2JveC5jaGFuZ2VkJywgeyB2aWV3Ym94OiB0aGlzLnZpZXdib3goKSB9KTsKICB9OwoKCiAgLyoqCiAgICogR2V0cyBvciBzZXRzIHRoZSB2aWV3IGJveCBvZiB0aGUgY2FudmFzLCBpLmUuIHRoZQogICAqIGFyZWEgdGhhdCBpcyBjdXJyZW50bHkgZGlzcGxheWVkLgogICAqCiAgICogVGhlIGdldHRlciBtYXkgcmV0dXJuIGEgY2FjaGVkIHZpZXdib3ggKGlmIGl0IGlzIGN1cnJlbnRseQogICAqIGNoYW5naW5nKS4gVG8gZm9yY2UgYSByZWNvbXB1dGF0aW9uLCBwYXNzIGBmYWxzZWAgYXMgdGhlIGZpcnN0IGFyZ3VtZW50LgogICAqCiAgICogQGV4YW1wbGUKICAgKgogICAqIGNhbnZhcy52aWV3Ym94KHsgeDogMTAwLCB5OiAxMDAsIHdpZHRoOiA1MDAsIGhlaWdodDogNTAwIH0pCiAgICoKICAgKiAvLyBzZXRzIHRoZSB2aXNpYmxlIGFyZWEgb2YgdGhlIGRpYWdyYW0gdG8gKDEwMHwxMDApIC0+ICg2MDB8MTAwKQogICAqIC8vIGFuZCBhbmQgc2NhbGVzIGl0IGFjY29yZGluZyB0byB0aGUgZGlhZ3JhbSB3aWR0aAogICAqCiAgICogdmFyIHZpZXdib3ggPSBjYW52YXMudmlld2JveCgpOyAvLyBwYXNzIGBmYWxzZWAgdG8gZm9yY2UgcmVjb21wdXRpbmcgdGhlIGJveC4KICAgKgogICAqIGNvbnNvbGUubG9nKHZpZXdib3gpOwogICAqIC8vIHsKICAgKiAvLyAgIGlubmVyOiBEaW1lbnNpb25zLAogICAqIC8vICAgb3V0ZXI6IERpbWVuc2lvbnMsCiAgICogLy8gICBzY2FsZSwKICAgKiAvLyAgIHgsIHksCiAgICogLy8gICB3aWR0aCwgaGVpZ2h0CiAgICogLy8gfQogICAqCiAgICogLy8gaWYgdGhlIGN1cnJlbnQgZGlhZ3JhbSBpcyB6b29tZWQgYW5kIHNjcm9sbGVkLCB5b3UgbWF5IHJlc2V0IGl0IHRvIHRoZQogICAqIC8vIGRlZmF1bHQgem9vbSB2aWEgdGhpcyBtZXRob2QsIHRvbzoKICAgKgogICAqIHZhciB6b29tZWRBbmRTY3JvbGxlZFZpZXdib3ggPSBjYW52YXMudmlld2JveCgpOwogICAqCiAgICogY2FudmFzLnZpZXdib3goewogICAqICAgeDogMCwKICAgKiAgIHk6IDAsCiAgICogICB3aWR0aDogem9vbWVkQW5kU2Nyb2xsZWRWaWV3Ym94Lm91dGVyLndpZHRoLAogICAqICAgaGVpZ2h0OiB6b29tZWRBbmRTY3JvbGxlZFZpZXdib3gub3V0ZXIuaGVpZ2h0CiAgICogfSk7CiAgICoKICAgKiBAcGFyYW0gIHtPYmplY3R9IFtib3hdIHRoZSBuZXcgdmlldyBib3ggdG8gc2V0CiAgICogQHBhcmFtICB7TnVtYmVyfSBib3gueCB0aGUgdG9wIGxlZnQgWCBjb29yZGluYXRlIG9mIHRoZSBjYW52YXMgdmlzaWJsZSBpbiB2aWV3IGJveAogICAqIEBwYXJhbSAge051bWJlcn0gYm94LnkgdGhlIHRvcCBsZWZ0IFkgY29vcmRpbmF0ZSBvZiB0aGUgY2FudmFzIHZpc2libGUgaW4gdmlldyBib3gKICAgKiBAcGFyYW0gIHtOdW1iZXJ9IGJveC53aWR0aCB0aGUgdmlzaWJsZSB3aWR0aAogICAqIEBwYXJhbSAge051bWJlcn0gYm94LmhlaWdodAogICAqCiAgICogQHJldHVybiB7T2JqZWN0fSB0aGUgY3VycmVudCB2aWV3IGJveAogICAqLwogIENhbnZhcy5wcm90b3R5cGUudmlld2JveCA9IGZ1bmN0aW9uKGJveCkgewoKICAgIGlmIChib3ggPT09IHVuZGVmaW5lZCAmJiB0aGlzLl9jYWNoZWRWaWV3Ym94KSB7CiAgICAgIHJldHVybiB0aGlzLl9jYWNoZWRWaWV3Ym94OwogICAgfQoKICAgIHZhciB2aWV3cG9ydCA9IHRoaXMuX3ZpZXdwb3J0LAogICAgICAgIGlubmVyQm94LAogICAgICAgIG91dGVyQm94ID0gdGhpcy5nZXRTaXplKCksCiAgICAgICAgbWF0cml4LAogICAgICAgIHRyYW5zZm9ybSQxLAogICAgICAgIHNjYWxlLAogICAgICAgIHgsIHk7CgogICAgaWYgKCFib3gpIHsKCiAgICAgIC8vIGNvbXB1dGUgdGhlIGlubmVyIGJveCBiYXNlZCBvbiB0aGUKICAgICAgLy8gZGlhZ3JhbXMgZGVmYXVsdCBsYXllci4gVGhpcyBhbGxvd3MgdXMgdG8gZXhjbHVkZQogICAgICAvLyBleHRlcm5hbCBjb21wb25lbnRzLCBzdWNoIGFzIG92ZXJsYXlzCiAgICAgIGlubmVyQm94ID0gdGhpcy5nZXREZWZhdWx0TGF5ZXIoKS5nZXRCQm94KCk7CgogICAgICB0cmFuc2Zvcm0kMSA9IHRyYW5zZm9ybSh2aWV3cG9ydCk7CiAgICAgIG1hdHJpeCA9IHRyYW5zZm9ybSQxID8gdHJhbnNmb3JtJDEubWF0cml4IDogY3JlYXRlTWF0cml4KCk7CiAgICAgIHNjYWxlID0gcm91bmQobWF0cml4LmEsIDEwMDApOwoKICAgICAgeCA9IHJvdW5kKC1tYXRyaXguZSB8fCAwLCAxMDAwKTsKICAgICAgeSA9IHJvdW5kKC1tYXRyaXguZiB8fCAwLCAxMDAwKTsKCiAgICAgIGJveCA9IHRoaXMuX2NhY2hlZFZpZXdib3ggPSB7CiAgICAgICAgeDogeCA/IHggLyBzY2FsZSA6IDAsCiAgICAgICAgeTogeSA/IHkgLyBzY2FsZSA6IDAsCiAgICAgICAgd2lkdGg6IG91dGVyQm94LndpZHRoIC8gc2NhbGUsCiAgICAgICAgaGVpZ2h0OiBvdXRlckJveC5oZWlnaHQgLyBzY2FsZSwKICAgICAgICBzY2FsZTogc2NhbGUsCiAgICAgICAgaW5uZXI6IHsKICAgICAgICAgIHdpZHRoOiBpbm5lckJveC53aWR0aCwKICAgICAgICAgIGhlaWdodDogaW5uZXJCb3guaGVpZ2h0LAogICAgICAgICAgeDogaW5uZXJCb3gueCwKICAgICAgICAgIHk6IGlubmVyQm94LnkKICAgICAgICB9LAogICAgICAgIG91dGVyOiBvdXRlckJveAogICAgICB9OwoKICAgICAgcmV0dXJuIGJveDsKICAgIH0gZWxzZSB7CgogICAgICB0aGlzLl9jaGFuZ2VWaWV3Ym94KGZ1bmN0aW9uKCkgewogICAgICAgIHNjYWxlID0gTWF0aC5taW4ob3V0ZXJCb3gud2lkdGggLyBib3gud2lkdGgsIG91dGVyQm94LmhlaWdodCAvIGJveC5oZWlnaHQpOwoKICAgICAgICB2YXIgbWF0cml4ID0gdGhpcy5fc3ZnLmNyZWF0ZVNWR01hdHJpeCgpCiAgICAgICAgICAuc2NhbGUoc2NhbGUpCiAgICAgICAgICAudHJhbnNsYXRlKC1ib3gueCwgLWJveC55KTsKCiAgICAgICAgdHJhbnNmb3JtKHZpZXdwb3J0LCBtYXRyaXgpOwogICAgICB9KTsKICAgIH0KCiAgICByZXR1cm4gYm94OwogIH07CgoKICAvKioKICAgKiBHZXRzIG9yIHNldHMgdGhlIHNjcm9sbCBvZiB0aGUgY2FudmFzLgogICAqCiAgICogQHBhcmFtIHtPYmplY3R9IFtkZWx0YV0gdGhlIG5ldyBzY3JvbGwgdG8gYXBwbHkuCiAgICoKICAgKiBAcGFyYW0ge051bWJlcn0gW2RlbHRhLmR4XQogICAqIEBwYXJhbSB7TnVtYmVyfSBbZGVsdGEuZHldCiAgICovCiAgQ2FudmFzLnByb3RvdHlwZS5zY3JvbGwgPSBmdW5jdGlvbihkZWx0YSkgewoKICAgIHZhciBub2RlID0gdGhpcy5fdmlld3BvcnQ7CiAgICB2YXIgbWF0cml4ID0gbm9kZS5nZXRDVE0oKTsKCiAgICBpZiAoZGVsdGEpIHsKICAgICAgdGhpcy5fY2hhbmdlVmlld2JveChmdW5jdGlvbigpIHsKICAgICAgICBkZWx0YSA9IGFzc2lnbih7IGR4OiAwLCBkeTogMCB9LCBkZWx0YSB8fCB7fSk7CgogICAgICAgIG1hdHJpeCA9IHRoaXMuX3N2Zy5jcmVhdGVTVkdNYXRyaXgoKS50cmFuc2xhdGUoZGVsdGEuZHgsIGRlbHRhLmR5KS5tdWx0aXBseShtYXRyaXgpOwoKICAgICAgICBzZXRDVE0obm9kZSwgbWF0cml4KTsKICAgICAgfSk7CiAgICB9CgogICAgcmV0dXJuIHsgeDogbWF0cml4LmUsIHk6IG1hdHJpeC5mIH07CiAgfTsKCgogIC8qKgogICAqIEdldHMgb3Igc2V0cyB0aGUgY3VycmVudCB6b29tIG9mIHRoZSBjYW52YXMsIG9wdGlvbmFsbHkgem9vbWluZwogICAqIHRvIHRoZSBzcGVjaWZpZWQgcG9zaXRpb24uCiAgICoKICAgKiBUaGUgZ2V0dGVyIG1heSByZXR1cm4gYSBjYWNoZWQgem9vbSBsZXZlbC4gQ2FsbCBpdCB3aXRoIGBmYWxzZWAgYXMKICAgKiB0aGUgZmlyc3QgYXJndW1lbnQgdG8gZm9yY2UgcmVjb21wdXRhdGlvbiBvZiB0aGUgY3VycmVudCBsZXZlbC4KICAgKgogICAqIEBwYXJhbSB7U3RyaW5nfE51bWJlcn0gW25ld1NjYWxlXSB0aGUgbmV3IHpvb20gbGV2ZWwsIGVpdGhlciBhIG51bWJlciwgaS5lLiAwLjksCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9yIGBmaXQtdmlld3BvcnRgIHRvIGFkanVzdCB0aGUgc2l6ZSB0byBmaXQgdGhlIGN1cnJlbnQgdmlld3BvcnQKICAgKiBAcGFyYW0ge1N0cmluZ3xQb2ludH0gW2NlbnRlcl0gdGhlIHJlZmVyZW5jZSBwb2ludCB7IHg6IC4uLCB5OiAuLn0gdG8gem9vbSB0bywgJ2F1dG8nIHRvIHpvb20gaW50byBtaWQgb3IgbnVsbAogICAqCiAgICogQHJldHVybiB7TnVtYmVyfSB0aGUgY3VycmVudCBzY2FsZQogICAqLwogIENhbnZhcy5wcm90b3R5cGUuem9vbSA9IGZ1bmN0aW9uKG5ld1NjYWxlLCBjZW50ZXIpIHsKCiAgICBpZiAoIW5ld1NjYWxlKSB7CiAgICAgIHJldHVybiB0aGlzLnZpZXdib3gobmV3U2NhbGUpLnNjYWxlOwogICAgfQoKICAgIGlmIChuZXdTY2FsZSA9PT0gJ2ZpdC12aWV3cG9ydCcpIHsKICAgICAgcmV0dXJuIHRoaXMuX2ZpdFZpZXdwb3J0KGNlbnRlcik7CiAgICB9CgogICAgdmFyIG91dGVyLAogICAgICAgIG1hdHJpeDsKCiAgICB0aGlzLl9jaGFuZ2VWaWV3Ym94KGZ1bmN0aW9uKCkgewoKICAgICAgaWYgKHR5cGVvZiBjZW50ZXIgIT09ICdvYmplY3QnKSB7CiAgICAgICAgb3V0ZXIgPSB0aGlzLnZpZXdib3goKS5vdXRlcjsKCiAgICAgICAgY2VudGVyID0gewogICAgICAgICAgeDogb3V0ZXIud2lkdGggLyAyLAogICAgICAgICAgeTogb3V0ZXIuaGVpZ2h0IC8gMgogICAgICAgIH07CiAgICAgIH0KCiAgICAgIG1hdHJpeCA9IHRoaXMuX3NldFpvb20obmV3U2NhbGUsIGNlbnRlcik7CiAgICB9KTsKCiAgICByZXR1cm4gcm91bmQobWF0cml4LmEsIDEwMDApOwogIH07CgogIGZ1bmN0aW9uIHNldENUTShub2RlLCBtKSB7CiAgICB2YXIgbXN0ciA9ICdtYXRyaXgoJyArIG0uYSArICcsJyArIG0uYiArICcsJyArIG0uYyArICcsJyArIG0uZCArICcsJyArIG0uZSArICcsJyArIG0uZiArICcpJzsKICAgIG5vZGUuc2V0QXR0cmlidXRlKCd0cmFuc2Zvcm0nLCBtc3RyKTsKICB9CgogIENhbnZhcy5wcm90b3R5cGUuX2ZpdFZpZXdwb3J0ID0gZnVuY3Rpb24oY2VudGVyKSB7CgogICAgdmFyIHZib3ggPSB0aGlzLnZpZXdib3goKSwKICAgICAgICBvdXRlciA9IHZib3gub3V0ZXIsCiAgICAgICAgaW5uZXIgPSB2Ym94LmlubmVyLAogICAgICAgIG5ld1NjYWxlLAogICAgICAgIG5ld1ZpZXdib3g7CgogICAgLy8gZGlzcGxheSB0aGUgY29tcGxldGUgZGlhZ3JhbSB3aXRob3V0IHpvb21pbmcgaW4uCiAgICAvLyBpbnN0ZWFkIG9mIHJlbHlpbmcgb24gaW50ZXJuYWwgem9vbSwgd2UgcGVyZm9ybSBhCiAgICAvLyBoYXJkIHJlc2V0IG9uIHRoZSBjYW52YXMgdmlld2JveCB0byByZWFsaXplIHRoaXMKICAgIC8vCiAgICAvLyBpZiBkaWFncmFtIGRvZXMgbm90IG5lZWQgdG8gYmUgem9vbWVkIGluLCB3ZSBmb2N1cyBpdCBhcm91bmQKICAgIC8vIHRoZSBkaWFncmFtIG9yaWdpbiBpbnN0ZWFkCgogICAgaWYgKGlubmVyLnggPj0gMCAmJgogICAgICAgIGlubmVyLnkgPj0gMCAmJgogICAgICAgIGlubmVyLnggKyBpbm5lci53aWR0aCA8PSBvdXRlci53aWR0aCAmJgogICAgICAgIGlubmVyLnkgKyBpbm5lci5oZWlnaHQgPD0gb3V0ZXIuaGVpZ2h0ICYmCiAgICAgICAgIWNlbnRlcikgewoKICAgICAgbmV3Vmlld2JveCA9IHsKICAgICAgICB4OiAwLAogICAgICAgIHk6IDAsCiAgICAgICAgd2lkdGg6IE1hdGgubWF4KGlubmVyLndpZHRoICsgaW5uZXIueCwgb3V0ZXIud2lkdGgpLAogICAgICAgIGhlaWdodDogTWF0aC5tYXgoaW5uZXIuaGVpZ2h0ICsgaW5uZXIueSwgb3V0ZXIuaGVpZ2h0KQogICAgICB9OwogICAgfSBlbHNlIHsKCiAgICAgIG5ld1NjYWxlID0gTWF0aC5taW4oMSwgb3V0ZXIud2lkdGggLyBpbm5lci53aWR0aCwgb3V0ZXIuaGVpZ2h0IC8gaW5uZXIuaGVpZ2h0KTsKICAgICAgbmV3Vmlld2JveCA9IHsKICAgICAgICB4OiBpbm5lci54ICsgKGNlbnRlciA/IGlubmVyLndpZHRoIC8gMiAtIG91dGVyLndpZHRoIC8gbmV3U2NhbGUgLyAyIDogMCksCiAgICAgICAgeTogaW5uZXIueSArIChjZW50ZXIgPyBpbm5lci5oZWlnaHQgLyAyIC0gb3V0ZXIuaGVpZ2h0IC8gbmV3U2NhbGUgLyAyIDogMCksCiAgICAgICAgd2lkdGg6IG91dGVyLndpZHRoIC8gbmV3U2NhbGUsCiAgICAgICAgaGVpZ2h0OiBvdXRlci5oZWlnaHQgLyBuZXdTY2FsZQogICAgICB9OwogICAgfQoKICAgIHRoaXMudmlld2JveChuZXdWaWV3Ym94KTsKCiAgICByZXR1cm4gdGhpcy52aWV3Ym94KGZhbHNlKS5zY2FsZTsKICB9OwoKCiAgQ2FudmFzLnByb3RvdHlwZS5fc2V0Wm9vbSA9IGZ1bmN0aW9uKHNjYWxlLCBjZW50ZXIpIHsKCiAgICB2YXIgc3ZnID0gdGhpcy5fc3ZnLAogICAgICAgIHZpZXdwb3J0ID0gdGhpcy5fdmlld3BvcnQ7CgogICAgdmFyIG1hdHJpeCA9IHN2Zy5jcmVhdGVTVkdNYXRyaXgoKTsKICAgIHZhciBwb2ludCA9IHN2Zy5jcmVhdGVTVkdQb2ludCgpOwoKICAgIHZhciBjZW50ZXJQb2ludCwKICAgICAgICBvcmlnaW5hbFBvaW50LAogICAgICAgIGN1cnJlbnRNYXRyaXgsCiAgICAgICAgc2NhbGVNYXRyaXgsCiAgICAgICAgbmV3TWF0cml4OwoKICAgIGN1cnJlbnRNYXRyaXggPSB2aWV3cG9ydC5nZXRDVE0oKTsKCiAgICB2YXIgY3VycmVudFNjYWxlID0gY3VycmVudE1hdHJpeC5hOwoKICAgIGlmIChjZW50ZXIpIHsKICAgICAgY2VudGVyUG9pbnQgPSBhc3NpZ24ocG9pbnQsIGNlbnRlcik7CgogICAgICAvLyByZXZlcnQgYXBwbGllZCB2aWV3cG9ydCB0cmFuc2Zvcm1hdGlvbnMKICAgICAgb3JpZ2luYWxQb2ludCA9IGNlbnRlclBvaW50Lm1hdHJpeFRyYW5zZm9ybShjdXJyZW50TWF0cml4LmludmVyc2UoKSk7CgogICAgICAvLyBjcmVhdGUgc2NhbGUgbWF0cml4CiAgICAgIHNjYWxlTWF0cml4ID0gbWF0cml4CiAgICAgICAgLnRyYW5zbGF0ZShvcmlnaW5hbFBvaW50LngsIG9yaWdpbmFsUG9pbnQueSkKICAgICAgICAuc2NhbGUoMSAvIGN1cnJlbnRTY2FsZSAqIHNjYWxlKQogICAgICAgIC50cmFuc2xhdGUoLW9yaWdpbmFsUG9pbnQueCwgLW9yaWdpbmFsUG9pbnQueSk7CgogICAgICBuZXdNYXRyaXggPSBjdXJyZW50TWF0cml4Lm11bHRpcGx5KHNjYWxlTWF0cml4KTsKICAgIH0gZWxzZSB7CiAgICAgIG5ld01hdHJpeCA9IG1hdHJpeC5zY2FsZShzY2FsZSk7CiAgICB9CgogICAgc2V0Q1RNKHRoaXMuX3ZpZXdwb3J0LCBuZXdNYXRyaXgpOwoKICAgIHJldHVybiBuZXdNYXRyaXg7CiAgfTsKCgogIC8qKgogICAqIFJldHVybnMgdGhlIHNpemUgb2YgdGhlIGNhbnZhcwogICAqCiAgICogQHJldHVybiB7RGltZW5zaW9uc30KICAgKi8KICBDYW52YXMucHJvdG90eXBlLmdldFNpemUgPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiB7CiAgICAgIHdpZHRoOiB0aGlzLl9jb250YWluZXIuY2xpZW50V2lkdGgsCiAgICAgIGhlaWdodDogdGhpcy5fY29udGFpbmVyLmNsaWVudEhlaWdodAogICAgfTsKICB9OwoKCiAgLyoqCiAgICogUmV0dXJuIHRoZSBhYnNvbHV0ZSBib3VuZGluZyBib3ggZm9yIHRoZSBnaXZlbiBlbGVtZW50CiAgICoKICAgKiBUaGUgYWJzb2x1dGUgYm91bmRpbmcgYm94IG1heSBiZSB1c2VkIHRvIGRpc3BsYXkgb3ZlcmxheXMgaW4gdGhlCiAgICogY2FsbGVycyAoYnJvd3NlcikgY29vcmRpbmF0ZSBzeXN0ZW0gcmF0aGVyIHRoYW4gdGhlIHpvb21lZCBpbi9vdXQKICAgKiBjYW52YXMgY29vcmRpbmF0ZXMuCiAgICoKICAgKiBAcGFyYW0gIHtFbGVtZW50RGVzY3JpcHRvcn0gZWxlbWVudAogICAqIEByZXR1cm4ge0JvdW5kc30gdGhlIGFic29sdXRlIGJvdW5kaW5nIGJveAogICAqLwogIENhbnZhcy5wcm90b3R5cGUuZ2V0QWJzb2x1dGVCQm94ID0gZnVuY3Rpb24oZWxlbWVudCkgewogICAgdmFyIHZib3ggPSB0aGlzLnZpZXdib3goKTsKICAgIHZhciBiYm94OwoKICAgIC8vIGNvbm5lY3Rpb24KICAgIC8vIHVzZSBzdmcgYmJveAogICAgaWYgKGVsZW1lbnQud2F5cG9pbnRzKSB7CiAgICAgIHZhciBnZnggPSB0aGlzLmdldEdyYXBoaWNzKGVsZW1lbnQpOwoKICAgICAgYmJveCA9IGdmeC5nZXRCQm94KCk7CiAgICB9CgogICAgLy8gc2hhcGVzCiAgICAvLyB1c2UgZGF0YQogICAgZWxzZSB7CiAgICAgIGJib3ggPSBlbGVtZW50OwogICAgfQoKICAgIHZhciB4ID0gYmJveC54ICogdmJveC5zY2FsZSAtIHZib3gueCAqIHZib3guc2NhbGU7CiAgICB2YXIgeSA9IGJib3gueSAqIHZib3guc2NhbGUgLSB2Ym94LnkgKiB2Ym94LnNjYWxlOwoKICAgIHZhciB3aWR0aCA9IGJib3gud2lkdGggKiB2Ym94LnNjYWxlOwogICAgdmFyIGhlaWdodCA9IGJib3guaGVpZ2h0ICogdmJveC5zY2FsZTsKCiAgICByZXR1cm4gewogICAgICB4OiB4LAogICAgICB5OiB5LAogICAgICB3aWR0aDogd2lkdGgsCiAgICAgIGhlaWdodDogaGVpZ2h0CiAgICB9OwogIH07CgogIC8qKgogICAqIEZpcmVzIGFuIGV2ZW50IGluIG9yZGVyIG90aGVyIG1vZHVsZXMgY2FuIHJlYWN0IHRvIHRoZQogICAqIGNhbnZhcyByZXNpemluZwogICAqLwogIENhbnZhcy5wcm90b3R5cGUucmVzaXplZCA9IGZ1bmN0aW9uKCkgewoKICAgIC8vIGZvcmNlIHJlY29tcHV0YXRpb24gb2YgdmlldyBib3gKICAgIGRlbGV0ZSB0aGlzLl9jYWNoZWRWaWV3Ym94OwoKICAgIHRoaXMuX2V2ZW50QnVzLmZpcmUoJ2NhbnZhcy5yZXNpemVkJyk7CiAgfTsKCiAgdmFyIEVMRU1FTlRfSUQgPSAnZGF0YS1lbGVtZW50LWlkJzsKCgogIC8qKgogICAqIEBjbGFzcwogICAqCiAgICogQSByZWdpc3RyeSB0aGF0IGtlZXBzIHRyYWNrIG9mIGFsbCBzaGFwZXMgaW4gdGhlIGRpYWdyYW0uCiAgICovCiAgZnVuY3Rpb24gRWxlbWVudFJlZ2lzdHJ5KGV2ZW50QnVzKSB7CiAgICB0aGlzLl9lbGVtZW50cyA9IHt9OwoKICAgIHRoaXMuX2V2ZW50QnVzID0gZXZlbnRCdXM7CiAgfQoKICBFbGVtZW50UmVnaXN0cnkuJGluamVjdCA9IFsgJ2V2ZW50QnVzJyBdOwoKICAvKioKICAgKiBSZWdpc3RlciBhIHBhaXIgb2YgKGVsZW1lbnQsIGdmeCwgKHNlY29uZGFyeUdmeCkpLgogICAqCiAgICogQHBhcmFtIHtkanMubW9kZWwuQmFzZX0gZWxlbWVudAogICAqIEBwYXJhbSB7U1ZHRWxlbWVudH0gZ2Z4CiAgICogQHBhcmFtIHtTVkdFbGVtZW50fSBbc2Vjb25kYXJ5R2Z4XSBvcHRpb25hbCBvdGhlciBlbGVtZW50IHRvIHJlZ2lzdGVyLCB0b28KICAgKi8KICBFbGVtZW50UmVnaXN0cnkucHJvdG90eXBlLmFkZCA9IGZ1bmN0aW9uKGVsZW1lbnQsIGdmeCwgc2Vjb25kYXJ5R2Z4KSB7CgogICAgdmFyIGlkID0gZWxlbWVudC5pZDsKCiAgICB0aGlzLl92YWxpZGF0ZUlkKGlkKTsKCiAgICAvLyBhc3NvY2lhdGUgZG9tIG5vZGUgd2l0aCBlbGVtZW50CiAgICBhdHRyJDEoZ2Z4LCBFTEVNRU5UX0lELCBpZCk7CgogICAgaWYgKHNlY29uZGFyeUdmeCkgewogICAgICBhdHRyJDEoc2Vjb25kYXJ5R2Z4LCBFTEVNRU5UX0lELCBpZCk7CiAgICB9CgogICAgdGhpcy5fZWxlbWVudHNbaWRdID0geyBlbGVtZW50OiBlbGVtZW50LCBnZng6IGdmeCwgc2Vjb25kYXJ5R2Z4OiBzZWNvbmRhcnlHZnggfTsKICB9OwoKICAvKioKICAgKiBSZW1vdmVzIGFuIGVsZW1lbnQgZnJvbSB0aGUgcmVnaXN0cnkuCiAgICoKICAgKiBAcGFyYW0ge2Rqcy5tb2RlbC5CYXNlfSBlbGVtZW50CiAgICovCiAgRWxlbWVudFJlZ2lzdHJ5LnByb3RvdHlwZS5yZW1vdmUgPSBmdW5jdGlvbihlbGVtZW50KSB7CiAgICB2YXIgZWxlbWVudHMgPSB0aGlzLl9lbGVtZW50cywKICAgICAgICBpZCA9IGVsZW1lbnQuaWQgfHwgZWxlbWVudCwKICAgICAgICBjb250YWluZXIgPSBpZCAmJiBlbGVtZW50c1tpZF07CgogICAgaWYgKGNvbnRhaW5lcikgewoKICAgICAgLy8gdW5zZXQgZWxlbWVudCBpZCBvbiBnZngKICAgICAgYXR0ciQxKGNvbnRhaW5lci5nZngsIEVMRU1FTlRfSUQsICcnKTsKCiAgICAgIGlmIChjb250YWluZXIuc2Vjb25kYXJ5R2Z4KSB7CiAgICAgICAgYXR0ciQxKGNvbnRhaW5lci5zZWNvbmRhcnlHZngsIEVMRU1FTlRfSUQsICcnKTsKICAgICAgfQoKICAgICAgZGVsZXRlIGVsZW1lbnRzW2lkXTsKICAgIH0KICB9OwoKICAvKioKICAgKiBVcGRhdGUgdGhlIGlkIG9mIGFuIGVsZW1lbnQKICAgKgogICAqIEBwYXJhbSB7ZGpzLm1vZGVsLkJhc2V9IGVsZW1lbnQKICAgKiBAcGFyYW0ge1N0cmluZ30gbmV3SWQKICAgKi8KICBFbGVtZW50UmVnaXN0cnkucHJvdG90eXBlLnVwZGF0ZUlkID0gZnVuY3Rpb24oZWxlbWVudCwgbmV3SWQpIHsKCiAgICB0aGlzLl92YWxpZGF0ZUlkKG5ld0lkKTsKCiAgICBpZiAodHlwZW9mIGVsZW1lbnQgPT09ICdzdHJpbmcnKSB7CiAgICAgIGVsZW1lbnQgPSB0aGlzLmdldChlbGVtZW50KTsKICAgIH0KCiAgICB0aGlzLl9ldmVudEJ1cy5maXJlKCdlbGVtZW50LnVwZGF0ZUlkJywgewogICAgICBlbGVtZW50OiBlbGVtZW50LAogICAgICBuZXdJZDogbmV3SWQKICAgIH0pOwoKICAgIHZhciBnZnggPSB0aGlzLmdldEdyYXBoaWNzKGVsZW1lbnQpLAogICAgICAgIHNlY29uZGFyeUdmeCA9IHRoaXMuZ2V0R3JhcGhpY3MoZWxlbWVudCwgdHJ1ZSk7CgogICAgdGhpcy5yZW1vdmUoZWxlbWVudCk7CgogICAgZWxlbWVudC5pZCA9IG5ld0lkOwoKICAgIHRoaXMuYWRkKGVsZW1lbnQsIGdmeCwgc2Vjb25kYXJ5R2Z4KTsKICB9OwoKICAvKioKICAgKiBSZXR1cm4gdGhlIG1vZGVsIGVsZW1lbnQgZm9yIGEgZ2l2ZW4gaWQgb3IgZ3JhcGhpY3MuCiAgICoKICAgKiBAZXhhbXBsZQogICAqCiAgICogZWxlbWVudFJlZ2lzdHJ5LmdldCgnU29tZUVsZW1lbnRJZF8xJyk7CiAgICogZWxlbWVudFJlZ2lzdHJ5LmdldChnZngpOwogICAqCiAgICoKICAgKiBAcGFyYW0ge1N0cmluZ3xTVkdFbGVtZW50fSBmaWx0ZXIgZm9yIHNlbGVjdGluZyB0aGUgZWxlbWVudAogICAqCiAgICogQHJldHVybiB7ZGpzLm1vZGVsLkJhc2V9CiAgICovCiAgRWxlbWVudFJlZ2lzdHJ5LnByb3RvdHlwZS5nZXQgPSBmdW5jdGlvbihmaWx0ZXIpIHsKICAgIHZhciBpZDsKCiAgICBpZiAodHlwZW9mIGZpbHRlciA9PT0gJ3N0cmluZycpIHsKICAgICAgaWQgPSBmaWx0ZXI7CiAgICB9IGVsc2UgewogICAgICBpZCA9IGZpbHRlciAmJiBhdHRyJDEoZmlsdGVyLCBFTEVNRU5UX0lEKTsKICAgIH0KCiAgICB2YXIgY29udGFpbmVyID0gdGhpcy5fZWxlbWVudHNbaWRdOwogICAgcmV0dXJuIGNvbnRhaW5lciAmJiBjb250YWluZXIuZWxlbWVudDsKICB9OwoKICAvKioKICAgKiBSZXR1cm4gYWxsIGVsZW1lbnRzIHRoYXQgbWF0Y2ggYSBnaXZlbiBmaWx0ZXIgZnVuY3Rpb24uCiAgICoKICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmbgogICAqCiAgICogQHJldHVybiB7QXJyYXk8ZGpzLm1vZGVsLkJhc2U+fQogICAqLwogIEVsZW1lbnRSZWdpc3RyeS5wcm90b3R5cGUuZmlsdGVyID0gZnVuY3Rpb24oZm4pIHsKCiAgICB2YXIgZmlsdGVyZWQgPSBbXTsKCiAgICB0aGlzLmZvckVhY2goZnVuY3Rpb24oZWxlbWVudCwgZ2Z4KSB7CiAgICAgIGlmIChmbihlbGVtZW50LCBnZngpKSB7CiAgICAgICAgZmlsdGVyZWQucHVzaChlbGVtZW50KTsKICAgICAgfQogICAgfSk7CgogICAgcmV0dXJuIGZpbHRlcmVkOwogIH07CgogIC8qKgogICAqIFJldHVybiBhbGwgcmVuZGVyZWQgbW9kZWwgZWxlbWVudHMuCiAgICoKICAgKiBAcmV0dXJuIHtBcnJheTxkanMubW9kZWwuQmFzZT59CiAgICovCiAgRWxlbWVudFJlZ2lzdHJ5LnByb3RvdHlwZS5nZXRBbGwgPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiB0aGlzLmZpbHRlcihmdW5jdGlvbihlKSB7IHJldHVybiBlOyB9KTsKICB9OwoKICAvKioKICAgKiBJdGVyYXRlIG92ZXIgYWxsIGRpYWdyYW0gZWxlbWVudHMuCiAgICoKICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmbgogICAqLwogIEVsZW1lbnRSZWdpc3RyeS5wcm90b3R5cGUuZm9yRWFjaCA9IGZ1bmN0aW9uKGZuKSB7CgogICAgdmFyIG1hcCA9IHRoaXMuX2VsZW1lbnRzOwoKICAgIE9iamVjdC5rZXlzKG1hcCkuZm9yRWFjaChmdW5jdGlvbihpZCkgewogICAgICB2YXIgY29udGFpbmVyID0gbWFwW2lkXSwKICAgICAgICAgIGVsZW1lbnQgPSBjb250YWluZXIuZWxlbWVudCwKICAgICAgICAgIGdmeCA9IGNvbnRhaW5lci5nZng7CgogICAgICByZXR1cm4gZm4oZWxlbWVudCwgZ2Z4KTsKICAgIH0pOwogIH07CgogIC8qKgogICAqIFJldHVybiB0aGUgZ3JhcGhpY2FsIHJlcHJlc2VudGF0aW9uIG9mIGFuIGVsZW1lbnQgb3IgaXRzIGlkLgogICAqCiAgICogQGV4YW1wbGUKICAgKiBlbGVtZW50UmVnaXN0cnkuZ2V0R3JhcGhpY3MoJ1NvbWVFbGVtZW50SWRfMScpOwogICAqIGVsZW1lbnRSZWdpc3RyeS5nZXRHcmFwaGljcyhyb290RWxlbWVudCk7IC8vIDxnIC4uLj4KICAgKgogICAqIGVsZW1lbnRSZWdpc3RyeS5nZXRHcmFwaGljcyhyb290RWxlbWVudCwgdHJ1ZSk7IC8vIDxzdmcgLi4uPgogICAqCiAgICoKICAgKiBAcGFyYW0ge1N0cmluZ3xkanMubW9kZWwuQmFzZX0gZmlsdGVyCiAgICogQHBhcmFtIHtCb29sZWFufSBbc2Vjb25kYXJ5PWZhbHNlXSB3aGV0aGVyIHRvIHJldHVybiB0aGUgc2Vjb25kYXJ5IGNvbm5lY3RlZCBlbGVtZW50CiAgICoKICAgKiBAcmV0dXJuIHtTVkdFbGVtZW50fQogICAqLwogIEVsZW1lbnRSZWdpc3RyeS5wcm90b3R5cGUuZ2V0R3JhcGhpY3MgPSBmdW5jdGlvbihmaWx0ZXIsIHNlY29uZGFyeSkgewogICAgdmFyIGlkID0gZmlsdGVyLmlkIHx8IGZpbHRlcjsKCiAgICB2YXIgY29udGFpbmVyID0gdGhpcy5fZWxlbWVudHNbaWRdOwogICAgcmV0dXJuIGNvbnRhaW5lciAmJiAoc2Vjb25kYXJ5ID8gY29udGFpbmVyLnNlY29uZGFyeUdmeCA6IGNvbnRhaW5lci5nZngpOwogIH07CgogIC8qKgogICAqIFZhbGlkYXRlIHRoZSBzdWl0YWJpbGl0eSBvZiB0aGUgZ2l2ZW4gaWQgYW5kIHNpZ25hbHMgYSBwcm9ibGVtCiAgICogd2l0aCBhbiBleGNlcHRpb24uCiAgICoKICAgKiBAcGFyYW0ge1N0cmluZ30gaWQKICAgKgogICAqIEB0aHJvd3Mge0Vycm9yfSBpZiBpZCBpcyBlbXB0eSBvciBhbHJlYWR5IGFzc2lnbmVkCiAgICovCiAgRWxlbWVudFJlZ2lzdHJ5LnByb3RvdHlwZS5fdmFsaWRhdGVJZCA9IGZ1bmN0aW9uKGlkKSB7CiAgICBpZiAoIWlkKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcignZWxlbWVudCBtdXN0IGhhdmUgYW4gaWQnKTsKICAgIH0KCiAgICBpZiAodGhpcy5fZWxlbWVudHNbaWRdKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcignZWxlbWVudCB3aXRoIGlkICcgKyBpZCArICcgYWxyZWFkeSBhZGRlZCcpOwogICAgfQogIH07CgogIC8qKgogICAqIEFuIGVtcHR5IGNvbGxlY3Rpb24gc3R1Yi4gVXNlIHtAbGluayBSZWZzQ29sbGVjdGlvbi5leHRlbmR9IHRvIGV4dGVuZCBhCiAgICogY29sbGVjdGlvbiB3aXRoIHJlZiBzZW1hbnRpY3MuCiAgICoKICAgKiBAY2xhc3MgUmVmc0NvbGxlY3Rpb24KICAgKi8KCiAgLyoqCiAgICogRXh0ZW5kcyBhIGNvbGxlY3Rpb24gd2l0aCB7QGxpbmsgUmVmc30gYXdhcmUgbWV0aG9kcwogICAqCiAgICogQG1lbWJlcm9mIFJlZnNDb2xsZWN0aW9uCiAgICogQHN0YXRpYwogICAqCiAgICogQHBhcmFtICB7QXJyYXk8T2JqZWN0Pn0gY29sbGVjdGlvbgogICAqIEBwYXJhbSAge1JlZnN9IHJlZnMgaW5zdGFuY2UKICAgKiBAcGFyYW0gIHtPYmplY3R9IHByb3BlcnR5IHJlcHJlc2VudGVkIGJ5IHRoZSBjb2xsZWN0aW9uCiAgICogQHBhcmFtICB7T2JqZWN0fSB0YXJnZXQgb2JqZWN0IHRoZSBjb2xsZWN0aW9uIGlzIGF0dGFjaGVkIHRvCiAgICoKICAgKiBAcmV0dXJuIHtSZWZzQ29sbGVjdGlvbjxPYmplY3Q+fSB0aGUgZXh0ZW5kZWQgYXJyYXkKICAgKi8KICBmdW5jdGlvbiBleHRlbmQkMShjb2xsZWN0aW9uLCByZWZzLCBwcm9wZXJ0eSwgdGFyZ2V0KSB7CgogICAgdmFyIGludmVyc2VQcm9wZXJ0eSA9IHByb3BlcnR5LmludmVyc2U7CgogICAgLyoqCiAgICAgKiBSZW1vdmVzIHRoZSBnaXZlbiBlbGVtZW50IGZyb20gdGhlIGFycmF5IGFuZCByZXR1cm5zIGl0LgogICAgICoKICAgICAqIEBtZXRob2QgUmVmc0NvbGxlY3Rpb24jcmVtb3ZlCiAgICAgKgogICAgICogQHBhcmFtIHtPYmplY3R9IGVsZW1lbnQgdGhlIGVsZW1lbnQgdG8gcmVtb3ZlCiAgICAgKi8KICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShjb2xsZWN0aW9uLCAncmVtb3ZlJywgewogICAgICB2YWx1ZTogZnVuY3Rpb24oZWxlbWVudCkgewogICAgICAgIHZhciBpZHggPSB0aGlzLmluZGV4T2YoZWxlbWVudCk7CiAgICAgICAgaWYgKGlkeCAhPT0gLTEpIHsKICAgICAgICAgIHRoaXMuc3BsaWNlKGlkeCwgMSk7CgogICAgICAgICAgLy8gdW5zZXQgaW52ZXJzZQogICAgICAgICAgcmVmcy51bnNldChlbGVtZW50LCBpbnZlcnNlUHJvcGVydHksIHRhcmdldCk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZWxlbWVudDsKICAgICAgfQogICAgfSk7CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRydWUgaWYgdGhlIGNvbGxlY3Rpb24gY29udGFpbnMgdGhlIGdpdmVuIGVsZW1lbnQKICAgICAqCiAgICAgKiBAbWV0aG9kIFJlZnNDb2xsZWN0aW9uI2NvbnRhaW5zCiAgICAgKgogICAgICogQHBhcmFtIHtPYmplY3R9IGVsZW1lbnQgdGhlIGVsZW1lbnQgdG8gY2hlY2sgZm9yCiAgICAgKi8KICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShjb2xsZWN0aW9uLCAnY29udGFpbnMnLCB7CiAgICAgIHZhbHVlOiBmdW5jdGlvbihlbGVtZW50KSB7CiAgICAgICAgcmV0dXJuIHRoaXMuaW5kZXhPZihlbGVtZW50KSAhPT0gLTE7CiAgICAgIH0KICAgIH0pOwoKICAgIC8qKgogICAgICogQWRkcyBhbiBlbGVtZW50IHRvIHRoZSBhcnJheSwgdW5sZXNzIGl0IGV4aXN0cyBhbHJlYWR5IChzZXQgc2VtYW50aWNzKS4KICAgICAqCiAgICAgKiBAbWV0aG9kIFJlZnNDb2xsZWN0aW9uI2FkZAogICAgICoKICAgICAqIEBwYXJhbSB7T2JqZWN0fSBlbGVtZW50IHRoZSBlbGVtZW50IHRvIGFkZAogICAgICogQHBhcmFtIHtOdW1iZXJ9IG9wdGlvbmFsIGluZGV4IHRvIGFkZCBlbGVtZW50IHRvCiAgICAgKiAgICAgICAgICAgICAgICAgKHBvc3NpYmx5IG1vdmluZyBvdGhlciBlbGVtZW50cyBhcm91bmQpCiAgICAgKi8KICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShjb2xsZWN0aW9uLCAnYWRkJywgewogICAgICB2YWx1ZTogZnVuY3Rpb24oZWxlbWVudCwgaWR4KSB7CgogICAgICAgIHZhciBjdXJyZW50SWR4ID0gdGhpcy5pbmRleE9mKGVsZW1lbnQpOwoKICAgICAgICBpZiAodHlwZW9mIGlkeCA9PT0gJ3VuZGVmaW5lZCcpIHsKCiAgICAgICAgICBpZiAoY3VycmVudElkeCAhPT0gLTEpIHsKICAgICAgICAgICAgLy8gZWxlbWVudCBhbHJlYWR5IGluIGNvbGxlY3Rpb24gKCEpCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICAvLyBhZGQgdG8gZW5kIG9mIGFycmF5LCBhcyBubyBpZHggaXMgc3BlY2lmaWVkCiAgICAgICAgICBpZHggPSB0aGlzLmxlbmd0aDsKICAgICAgICB9CgogICAgICAgIC8vIGhhbmRsZSBhbHJlYWR5IGluIGNvbGxlY3Rpb24KICAgICAgICBpZiAoY3VycmVudElkeCAhPT0gLTEpIHsKCiAgICAgICAgICAvLyByZW1vdmUgZWxlbWVudCBmcm9tIGN1cnJlbnRJZHgKICAgICAgICAgIHRoaXMuc3BsaWNlKGN1cnJlbnRJZHgsIDEpOwogICAgICAgIH0KCiAgICAgICAgLy8gYWRkIGVsZW1lbnQgYXQgaWR4CiAgICAgICAgdGhpcy5zcGxpY2UoaWR4LCAwLCBlbGVtZW50KTsKCiAgICAgICAgaWYgKGN1cnJlbnRJZHggPT09IC0xKSB7CiAgICAgICAgICAvLyBzZXQgaW52ZXJzZSwgdW5sZXNzIGVsZW1lbnQgd2FzCiAgICAgICAgICAvLyBpbiBjb2xsZWN0aW9uIGFscmVhZHkKICAgICAgICAgIHJlZnMuc2V0KGVsZW1lbnQsIGludmVyc2VQcm9wZXJ0eSwgdGFyZ2V0KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0pOwoKICAgIC8vIGEgc2ltcGxlIG1hcmtlciwgaWRlbnRpZnlpbmcgdGhpcyBlbGVtZW50CiAgICAvLyBhcyBiZWluZyBhIHJlZnMgY29sbGVjdGlvbgogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGNvbGxlY3Rpb24sICdfX3JlZnNfY29sbGVjdGlvbicsIHsKICAgICAgdmFsdWU6IHRydWUKICAgIH0pOwoKICAgIHJldHVybiBjb2xsZWN0aW9uOwogIH0KCgogIGZ1bmN0aW9uIGlzRXh0ZW5kZWQoY29sbGVjdGlvbikgewogICAgcmV0dXJuIGNvbGxlY3Rpb24uX19yZWZzX2NvbGxlY3Rpb24gPT09IHRydWU7CiAgfQoKICB2YXIgZXh0ZW5kXzEgPSBleHRlbmQkMTsKCiAgdmFyIGlzRXh0ZW5kZWRfMSA9IGlzRXh0ZW5kZWQ7CgogIHZhciBjb2xsZWN0aW9uID0gewogIAlleHRlbmQ6IGV4dGVuZF8xLAogIAlpc0V4dGVuZGVkOiBpc0V4dGVuZGVkXzEKICB9OwoKICBmdW5jdGlvbiBoYXNPd25Qcm9wZXJ0eShlLCBwcm9wZXJ0eSkgewogICAgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCBwcm9wZXJ0eS5uYW1lIHx8IHByb3BlcnR5KTsKICB9CgogIGZ1bmN0aW9uIGRlZmluZUNvbGxlY3Rpb25Qcm9wZXJ0eShyZWYsIHByb3BlcnR5LCB0YXJnZXQpIHsKCiAgICB2YXIgY29sbGVjdGlvbiQxID0gY29sbGVjdGlvbi5leHRlbmQodGFyZ2V0W3Byb3BlcnR5Lm5hbWVdIHx8IFtdLCByZWYsIHByb3BlcnR5LCB0YXJnZXQpOwoKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIHByb3BlcnR5Lm5hbWUsIHsKICAgICAgZW51bWVyYWJsZTogcHJvcGVydHkuZW51bWVyYWJsZSwKICAgICAgdmFsdWU6IGNvbGxlY3Rpb24kMQogICAgfSk7CgogICAgaWYgKGNvbGxlY3Rpb24kMS5sZW5ndGgpIHsKCiAgICAgIGNvbGxlY3Rpb24kMS5mb3JFYWNoKGZ1bmN0aW9uKG8pIHsKICAgICAgICByZWYuc2V0KG8sIHByb3BlcnR5LmludmVyc2UsIHRhcmdldCk7CiAgICAgIH0pOwogICAgfQogIH0KCgogIGZ1bmN0aW9uIGRlZmluZVByb3BlcnR5KHJlZiwgcHJvcGVydHksIHRhcmdldCkgewoKICAgIHZhciBpbnZlcnNlUHJvcGVydHkgPSBwcm9wZXJ0eS5pbnZlcnNlOwoKICAgIHZhciBfdmFsdWUgPSB0YXJnZXRbcHJvcGVydHkubmFtZV07CgogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgcHJvcGVydHkubmFtZSwgewogICAgICBjb25maWd1cmFibGU6IHByb3BlcnR5LmNvbmZpZ3VyYWJsZSwKICAgICAgZW51bWVyYWJsZTogcHJvcGVydHkuZW51bWVyYWJsZSwKCiAgICAgIGdldDogZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIF92YWx1ZTsKICAgICAgfSwKCiAgICAgIHNldDogZnVuY3Rpb24odmFsdWUpIHsKCiAgICAgICAgLy8gcmV0dXJuIGlmIHdlIGFscmVhZHkgcGVyZm9ybWVkIGFsbCBjaGFuZ2VzCiAgICAgICAgaWYgKHZhbHVlID09PSBfdmFsdWUpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHZhciBvbGQgPSBfdmFsdWU7CgogICAgICAgIC8vIHRlbXBvcmFyeSBzZXQgbnVsbAogICAgICAgIF92YWx1ZSA9IG51bGw7CgogICAgICAgIGlmIChvbGQpIHsKICAgICAgICAgIHJlZi51bnNldChvbGQsIGludmVyc2VQcm9wZXJ0eSwgdGFyZ2V0KTsKICAgICAgICB9CgogICAgICAgIC8vIHNldCBuZXcgdmFsdWUKICAgICAgICBfdmFsdWUgPSB2YWx1ZTsKCiAgICAgICAgLy8gc2V0IGludmVyc2UgdmFsdWUKICAgICAgICByZWYuc2V0KF92YWx1ZSwgaW52ZXJzZVByb3BlcnR5LCB0YXJnZXQpOwogICAgICB9CiAgICB9KTsKCiAgfQoKICAvKioKICAgKiBDcmVhdGVzIGEgbmV3IHJlZmVyZW5jZXMgb2JqZWN0IGRlZmluaW5nIHR3byBpbnZlcnNseSByZWxhdGVkCiAgICogYXR0cmlidXRlIGRlc2NyaXB0b3JzIGEgYW5kIGIuCiAgICoKICAgKiA8cD4KICAgKiAgIFdoZW4gYm91bmQgdG8gYW4gb2JqZWN0IHVzaW5nIHtAbGluayBSZWZzI2JpbmR9IHRoZSByZWZlcmVuY2VzCiAgICogICBnZXQgYWN0aXZhdGVkIGFuZCBlbnN1cmUgdGhhdCBhZGQgYW5kIHJlbW92ZSBvcGVyYXRpb25zIGFyZSBhcHBsaWVkCiAgICogICByZXZlcnNlbHksIHRvby4KICAgKiA8L3A+CiAgICoKICAgKiA8cD4KICAgKiAgIEZvciBhdHRyaWJ1dGVzIHJlcHJlc2VudGVkIGFzIGNvbGxlY3Rpb25zIHtAbGluayBSZWZzfSBwcm92aWRlcyB0aGUKICAgKiAgIHtAbGluayBSZWZzQ29sbGVjdGlvbiNhZGR9LCB7QGxpbmsgUmVmc0NvbGxlY3Rpb24jcmVtb3ZlfSBhbmQge0BsaW5rIFJlZnNDb2xsZWN0aW9uI2NvbnRhaW5zfSBleHRlbnNpb25zCiAgICogICB0aGF0IG11c3QgYmUgdXNlZCB0byBwcm9wZXJseSBob29rIGludG8gdGhlIGludmVyc2UgY2hhbmdlIG1lY2hhbmlzbS4KICAgKiA8L3A+CiAgICoKICAgKiBAY2xhc3MgUmVmcwogICAqCiAgICogQGNsYXNzZGVzYyBBIGJpLWRpcmVjdGlvbmFsIHJlZmVyZW5jZSBiZXR3ZWVuIHR3byBhdHRyaWJ1dGVzLgogICAqCiAgICogQHBhcmFtIHtSZWZzLkF0dHJpYnV0ZURlc2NyaXB0b3J9IGEgcHJvcGVydHkgZGVzY3JpcHRvcgogICAqIEBwYXJhbSB7UmVmcy5BdHRyaWJ1dGVEZXNjcmlwdG9yfSBiIHByb3BlcnR5IGRlc2NyaXB0b3IKICAgKgogICAqIEBleGFtcGxlCiAgICoKICAgKiB2YXIgcmVmcyA9IFJlZnMoeyBuYW1lOiAnd2hlZWxzJywgY29sbGVjdGlvbjogdHJ1ZSwgZW51bWVyYWJsZTogdHJ1ZSB9LCB7IG5hbWU6ICdjYXInIH0pOwogICAqCiAgICogdmFyIGNhciA9IHsgbmFtZTogJ3RveW90YScgfTsKICAgKiB2YXIgd2hlZWxzID0gW3sgcG9zOiAnZnJvbnQtbGVmdCcgfSwgeyBwb3M6ICdmcm9udC1yaWdodCcgfV07CiAgICoKICAgKiByZWZzLmJpbmQoY2FyLCAnd2hlZWxzJyk7CiAgICoKICAgKiBjYXIud2hlZWxzIC8vIFtdCiAgICogY2FyLndoZWVscy5hZGQod2hlZWxzWzBdKTsKICAgKiBjYXIud2hlZWxzLmFkZCh3aGVlbHNbMV0pOwogICAqCiAgICogY2FyLndoZWVscyAvLyBbeyBwb3M6ICdmcm9udC1sZWZ0JyB9LCB7IHBvczogJ2Zyb250LXJpZ2h0JyB9XQogICAqCiAgICogd2hlZWxzWzBdLmNhciAvLyB7IG5hbWU6ICd0b3lvdGEnIH07CiAgICogY2FyLndoZWVscy5yZW1vdmUod2hlZWxzWzBdKTsKICAgKgogICAqIHdoZWVsc1swXS5jYXIgLy8gdW5kZWZpbmVkCiAgICovCiAgZnVuY3Rpb24gUmVmcyhhLCBiKSB7CgogICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIFJlZnMpKSB7CiAgICAgIHJldHVybiBuZXcgUmVmcyhhLCBiKTsKICAgIH0KCiAgICAvLyBsaW5rCiAgICBhLmludmVyc2UgPSBiOwogICAgYi5pbnZlcnNlID0gYTsKCiAgICB0aGlzLnByb3BzID0ge307CiAgICB0aGlzLnByb3BzW2EubmFtZV0gPSBhOwogICAgdGhpcy5wcm9wc1tiLm5hbWVdID0gYjsKICB9CgogIC8qKgogICAqIEJpbmRzIG9uZSBzaWRlIG9mIGEgYmktZGlyZWN0aW9uYWwgcmVmZXJlbmNlIHRvIGEKICAgKiB0YXJnZXQgb2JqZWN0LgogICAqCiAgICogQG1lbWJlck9mIFJlZnMKICAgKgogICAqIEBwYXJhbSAge09iamVjdH0gdGFyZ2V0CiAgICogQHBhcmFtICB7U3RyaW5nfSBwcm9wZXJ0eQogICAqLwogIFJlZnMucHJvdG90eXBlLmJpbmQgPSBmdW5jdGlvbih0YXJnZXQsIHByb3BlcnR5KSB7CiAgICBpZiAodHlwZW9mIHByb3BlcnR5ID09PSAnc3RyaW5nJykgewogICAgICBpZiAoIXRoaXMucHJvcHNbcHJvcGVydHldKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdubyBwcm9wZXJ0eSA8JyArIHByb3BlcnR5ICsgJz4gaW4gcmVmJyk7CiAgICAgIH0KICAgICAgcHJvcGVydHkgPSB0aGlzLnByb3BzW3Byb3BlcnR5XTsKICAgIH0KCiAgICBpZiAocHJvcGVydHkuY29sbGVjdGlvbikgewogICAgICBkZWZpbmVDb2xsZWN0aW9uUHJvcGVydHkodGhpcywgcHJvcGVydHksIHRhcmdldCk7CiAgICB9IGVsc2UgewogICAgICBkZWZpbmVQcm9wZXJ0eSh0aGlzLCBwcm9wZXJ0eSwgdGFyZ2V0KTsKICAgIH0KICB9OwoKICBSZWZzLnByb3RvdHlwZS5lbnN1cmVSZWZzQ29sbGVjdGlvbiA9IGZ1bmN0aW9uKHRhcmdldCwgcHJvcGVydHkpIHsKCiAgICB2YXIgY29sbGVjdGlvbiQxID0gdGFyZ2V0W3Byb3BlcnR5Lm5hbWVdOwoKICAgIGlmICghY29sbGVjdGlvbi5pc0V4dGVuZGVkKGNvbGxlY3Rpb24kMSkpIHsKICAgICAgZGVmaW5lQ29sbGVjdGlvblByb3BlcnR5KHRoaXMsIHByb3BlcnR5LCB0YXJnZXQpOwogICAgfQoKICAgIHJldHVybiBjb2xsZWN0aW9uJDE7CiAgfTsKCiAgUmVmcy5wcm90b3R5cGUuZW5zdXJlQm91bmQgPSBmdW5jdGlvbih0YXJnZXQsIHByb3BlcnR5KSB7CiAgICBpZiAoIWhhc093blByb3BlcnR5KHRhcmdldCwgcHJvcGVydHkpKSB7CiAgICAgIHRoaXMuYmluZCh0YXJnZXQsIHByb3BlcnR5KTsKICAgIH0KICB9OwoKICBSZWZzLnByb3RvdHlwZS51bnNldCA9IGZ1bmN0aW9uKHRhcmdldCwgcHJvcGVydHksIHZhbHVlKSB7CgogICAgaWYgKHRhcmdldCkgewogICAgICB0aGlzLmVuc3VyZUJvdW5kKHRhcmdldCwgcHJvcGVydHkpOwoKICAgICAgaWYgKHByb3BlcnR5LmNvbGxlY3Rpb24pIHsKICAgICAgICB0aGlzLmVuc3VyZVJlZnNDb2xsZWN0aW9uKHRhcmdldCwgcHJvcGVydHkpLnJlbW92ZSh2YWx1ZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGFyZ2V0W3Byb3BlcnR5Lm5hbWVdID0gdW5kZWZpbmVkOwogICAgICB9CiAgICB9CiAgfTsKCiAgUmVmcy5wcm90b3R5cGUuc2V0ID0gZnVuY3Rpb24odGFyZ2V0LCBwcm9wZXJ0eSwgdmFsdWUpIHsKCiAgICBpZiAodGFyZ2V0KSB7CiAgICAgIHRoaXMuZW5zdXJlQm91bmQodGFyZ2V0LCBwcm9wZXJ0eSk7CgogICAgICBpZiAocHJvcGVydHkuY29sbGVjdGlvbikgewogICAgICAgIHRoaXMuZW5zdXJlUmVmc0NvbGxlY3Rpb24odGFyZ2V0LCBwcm9wZXJ0eSkuYWRkKHZhbHVlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0YXJnZXRbcHJvcGVydHkubmFtZV0gPSB2YWx1ZTsKICAgICAgfQogICAgfQogIH07CgogIHZhciByZWZzID0gUmVmczsKCiAgdmFyIG9iamVjdFJlZnMgPSByZWZzOwoKICB2YXIgQ29sbGVjdGlvbiA9IGNvbGxlY3Rpb247CiAgb2JqZWN0UmVmcy5Db2xsZWN0aW9uID0gQ29sbGVjdGlvbjsKCiAgdmFyIHBhcmVudFJlZnMgPSBuZXcgb2JqZWN0UmVmcyh7IG5hbWU6ICdjaGlsZHJlbicsIGVudW1lcmFibGU6IHRydWUsIGNvbGxlY3Rpb246IHRydWUgfSwgeyBuYW1lOiAncGFyZW50JyB9KSwKICAgICAgbGFiZWxSZWZzID0gbmV3IG9iamVjdFJlZnMoeyBuYW1lOiAnbGFiZWxzJywgZW51bWVyYWJsZTogdHJ1ZSwgY29sbGVjdGlvbjogdHJ1ZSB9LCB7IG5hbWU6ICdsYWJlbFRhcmdldCcgfSksCiAgICAgIGF0dGFjaGVyUmVmcyA9IG5ldyBvYmplY3RSZWZzKHsgbmFtZTogJ2F0dGFjaGVycycsIGNvbGxlY3Rpb246IHRydWUgfSwgeyBuYW1lOiAnaG9zdCcgfSksCiAgICAgIG91dGdvaW5nUmVmcyA9IG5ldyBvYmplY3RSZWZzKHsgbmFtZTogJ291dGdvaW5nJywgY29sbGVjdGlvbjogdHJ1ZSB9LCB7IG5hbWU6ICdzb3VyY2UnIH0pLAogICAgICBpbmNvbWluZ1JlZnMgPSBuZXcgb2JqZWN0UmVmcyh7IG5hbWU6ICdpbmNvbWluZycsIGNvbGxlY3Rpb246IHRydWUgfSwgeyBuYW1lOiAndGFyZ2V0JyB9KTsKCiAgLyoqCiAgICogQG5hbWVzcGFjZSBkanMubW9kZWwKICAgKi8KCiAgLyoqCiAgICogQG1lbWJlck9mIGRqcy5tb2RlbAogICAqLwoKICAvKioKICAgKiBUaGUgYmFzaWMgZ3JhcGhpY2FsIHJlcHJlc2VudGF0aW9uCiAgICoKICAgKiBAY2xhc3MKICAgKgogICAqIEBhYnN0cmFjdAogICAqLwogIGZ1bmN0aW9uIEJhc2UoKSB7CgogICAgLyoqCiAgICAgKiBUaGUgb2JqZWN0IHRoYXQgYmFja3MgdXAgdGhlIHNoYXBlCiAgICAgKgogICAgICogQG5hbWUgQmFzZSNidXNpbmVzc09iamVjdAogICAgICogQHR5cGUgT2JqZWN0CiAgICAgKi8KICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCAnYnVzaW5lc3NPYmplY3QnLCB7CiAgICAgIHdyaXRhYmxlOiB0cnVlCiAgICB9KTsKCgogICAgLyoqCiAgICAgKiBTaW5nbGUgbGFiZWwgc3VwcG9ydCwgd2lsbCBtYXBwZWQgdG8gbXVsdGkgbGFiZWwgYXJyYXkKICAgICAqCiAgICAgKiBAbmFtZSBCYXNlI2xhYmVsCiAgICAgKiBAdHlwZSBPYmplY3QKICAgICAqLwogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsICdsYWJlbCcsIHsKICAgICAgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gdGhpcy5sYWJlbHNbMF07CiAgICAgIH0sCiAgICAgIHNldDogZnVuY3Rpb24obmV3TGFiZWwpIHsKCiAgICAgICAgdmFyIGxhYmVsID0gdGhpcy5sYWJlbCwKICAgICAgICAgICAgbGFiZWxzID0gdGhpcy5sYWJlbHM7CgogICAgICAgIGlmICghbmV3TGFiZWwgJiYgbGFiZWwpIHsKICAgICAgICAgIGxhYmVscy5yZW1vdmUobGFiZWwpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBsYWJlbHMuYWRkKG5ld0xhYmVsLCAwKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0pOwoKICAgIC8qKgogICAgICogVGhlIHBhcmVudCBzaGFwZQogICAgICoKICAgICAqIEBuYW1lIEJhc2UjcGFyZW50CiAgICAgKiBAdHlwZSBTaGFwZQogICAgICovCiAgICBwYXJlbnRSZWZzLmJpbmQodGhpcywgJ3BhcmVudCcpOwoKICAgIC8qKgogICAgICogVGhlIGxpc3Qgb2YgbGFiZWxzCiAgICAgKgogICAgICogQG5hbWUgQmFzZSNsYWJlbHMKICAgICAqIEB0eXBlIExhYmVsCiAgICAgKi8KICAgIGxhYmVsUmVmcy5iaW5kKHRoaXMsICdsYWJlbHMnKTsKCiAgICAvKioKICAgICAqIFRoZSBsaXN0IG9mIG91dGdvaW5nIGNvbm5lY3Rpb25zCiAgICAgKgogICAgICogQG5hbWUgQmFzZSNvdXRnb2luZwogICAgICogQHR5cGUgQXJyYXk8Q29ubmVjdGlvbj4KICAgICAqLwogICAgb3V0Z29pbmdSZWZzLmJpbmQodGhpcywgJ291dGdvaW5nJyk7CgogICAgLyoqCiAgICAgKiBUaGUgbGlzdCBvZiBpbmNvbWluZyBjb25uZWN0aW9ucwogICAgICoKICAgICAqIEBuYW1lIEJhc2UjaW5jb21pbmcKICAgICAqIEB0eXBlIEFycmF5PENvbm5lY3Rpb24+CiAgICAgKi8KICAgIGluY29taW5nUmVmcy5iaW5kKHRoaXMsICdpbmNvbWluZycpOwogIH0KCgogIC8qKgogICAqIEEgZ3JhcGhpY2FsIG9iamVjdAogICAqCiAgICogQGNsYXNzCiAgICogQGNvbnN0cnVjdG9yCiAgICoKICAgKiBAZXh0ZW5kcyBCYXNlCiAgICovCiAgZnVuY3Rpb24gU2hhcGUoKSB7CiAgICBCYXNlLmNhbGwodGhpcyk7CgogICAgLyoqCiAgICAgKiBJbmRpY2F0ZXMgZnJhbWUgc2hhcGVzCiAgICAgKgogICAgICogQG5hbWUgU2hhcGUjaXNGcmFtZQogICAgICogQHR5cGUgQm9vbGVhbgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgbGlzdCBvZiBjaGlsZHJlbgogICAgICoKICAgICAqIEBuYW1lIFNoYXBlI2NoaWxkcmVuCiAgICAgKiBAdHlwZSBBcnJheTxCYXNlPgogICAgICovCiAgICBwYXJlbnRSZWZzLmJpbmQodGhpcywgJ2NoaWxkcmVuJyk7CgogICAgLyoqCiAgICAgKiBAbmFtZSBTaGFwZSNob3N0CiAgICAgKiBAdHlwZSBTaGFwZQogICAgICovCiAgICBhdHRhY2hlclJlZnMuYmluZCh0aGlzLCAnaG9zdCcpOwoKICAgIC8qKgogICAgICogQG5hbWUgU2hhcGUjYXR0YWNoZXJzCiAgICAgKiBAdHlwZSBTaGFwZQogICAgICovCiAgICBhdHRhY2hlclJlZnMuYmluZCh0aGlzLCAnYXR0YWNoZXJzJyk7CiAgfQoKICBpbmhlcml0c19icm93c2VyKFNoYXBlLCBCYXNlKTsKCgogIC8qKgogICAqIEEgcm9vdCBncmFwaGljYWwgb2JqZWN0CiAgICoKICAgKiBAY2xhc3MKICAgKiBAY29uc3RydWN0b3IKICAgKgogICAqIEBleHRlbmRzIFNoYXBlCiAgICovCiAgZnVuY3Rpb24gUm9vdCgpIHsKICAgIFNoYXBlLmNhbGwodGhpcyk7CiAgfQoKICBpbmhlcml0c19icm93c2VyKFJvb3QsIFNoYXBlKTsKCgogIC8qKgogICAqIEEgbGFiZWwgZm9yIGFuIGVsZW1lbnQKICAgKgogICAqIEBjbGFzcwogICAqIEBjb25zdHJ1Y3RvcgogICAqCiAgICogQGV4dGVuZHMgU2hhcGUKICAgKi8KICBmdW5jdGlvbiBMYWJlbCgpIHsKICAgIFNoYXBlLmNhbGwodGhpcyk7CgogICAgLyoqCiAgICAgKiBUaGUgbGFiZWxlZCBlbGVtZW50CiAgICAgKgogICAgICogQG5hbWUgTGFiZWwjbGFiZWxUYXJnZXQKICAgICAqIEB0eXBlIEJhc2UKICAgICAqLwogICAgbGFiZWxSZWZzLmJpbmQodGhpcywgJ2xhYmVsVGFyZ2V0Jyk7CiAgfQoKICBpbmhlcml0c19icm93c2VyKExhYmVsLCBTaGFwZSk7CgoKICAvKioKICAgKiBBIGNvbm5lY3Rpb24gYmV0d2VlbiB0d28gZWxlbWVudHMKICAgKgogICAqIEBjbGFzcwogICAqIEBjb25zdHJ1Y3RvcgogICAqCiAgICogQGV4dGVuZHMgQmFzZQogICAqLwogIGZ1bmN0aW9uIENvbm5lY3Rpb24oKSB7CiAgICBCYXNlLmNhbGwodGhpcyk7CgogICAgLyoqCiAgICAgKiBUaGUgZWxlbWVudCB0aGlzIGNvbm5lY3Rpb24gb3JpZ2luYXRlcyBmcm9tCiAgICAgKgogICAgICogQG5hbWUgQ29ubmVjdGlvbiNzb3VyY2UKICAgICAqIEB0eXBlIEJhc2UKICAgICAqLwogICAgb3V0Z29pbmdSZWZzLmJpbmQodGhpcywgJ3NvdXJjZScpOwoKICAgIC8qKgogICAgICogVGhlIGVsZW1lbnQgdGhpcyBjb25uZWN0aW9uIHBvaW50cyB0bwogICAgICoKICAgICAqIEBuYW1lIENvbm5lY3Rpb24jdGFyZ2V0CiAgICAgKiBAdHlwZSBCYXNlCiAgICAgKi8KICAgIGluY29taW5nUmVmcy5iaW5kKHRoaXMsICd0YXJnZXQnKTsKICB9CgogIGluaGVyaXRzX2Jyb3dzZXIoQ29ubmVjdGlvbiwgQmFzZSk7CgoKICB2YXIgdHlwZXMgPSB7CiAgICBjb25uZWN0aW9uOiBDb25uZWN0aW9uLAogICAgc2hhcGU6IFNoYXBlLAogICAgbGFiZWw6IExhYmVsLAogICAgcm9vdDogUm9vdAogIH07CgogIC8qKgogICAqIENyZWF0ZXMgYSBuZXcgbW9kZWwgZWxlbWVudCBvZiB0aGUgc3BlY2lmaWVkIHR5cGUKICAgKgogICAqIEBtZXRob2QgY3JlYXRlCiAgICoKICAgKiBAZXhhbXBsZQogICAqCiAgICogdmFyIHNoYXBlMSA9IE1vZGVsLmNyZWF0ZSgnc2hhcGUnLCB7IHg6IDEwLCB5OiAxMCwgd2lkdGg6IDEwMCwgaGVpZ2h0OiAxMDAgfSk7CiAgICogdmFyIHNoYXBlMiA9IE1vZGVsLmNyZWF0ZSgnc2hhcGUnLCB7IHg6IDIxMCwgeTogMjEwLCB3aWR0aDogMTAwLCBoZWlnaHQ6IDEwMCB9KTsKICAgKgogICAqIHZhciBjb25uZWN0aW9uID0gTW9kZWwuY3JlYXRlKCdjb25uZWN0aW9uJywgeyB3YXlwb2ludHM6IFsgeyB4OiAxMTAsIHk6IDU1IH0sIHt4OiAyMTAsIHk6IDU1IH0gXSB9KTsKICAgKgogICAqIEBwYXJhbSAge1N0cmluZ30gdHlwZSBsb3dlci1jYXNlZCBtb2RlbCBuYW1lCiAgICogQHBhcmFtICB7T2JqZWN0fSBhdHRycyBhdHRyaWJ1dGVzIHRvIGluaXRpYWxpemUgdGhlIG5ldyBtb2RlbCBpbnN0YW5jZSB3aXRoCiAgICoKICAgKiBAcmV0dXJuIHtCYXNlfSB0aGUgbmV3IG1vZGVsIGluc3RhbmNlCiAgICovCiAgZnVuY3Rpb24gY3JlYXRlJDEodHlwZSwgYXR0cnMpIHsKICAgIHZhciBUeXBlID0gdHlwZXNbdHlwZV07CiAgICBpZiAoIVR5cGUpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCd1bmtub3duIHR5cGU6IDwnICsgdHlwZSArICc+Jyk7CiAgICB9CiAgICByZXR1cm4gYXNzaWduKG5ldyBUeXBlKCksIGF0dHJzKTsKICB9CgogIC8qKgogICAqIEEgZmFjdG9yeSBmb3IgZGlhZ3JhbS1qcyBzaGFwZXMKICAgKi8KICBmdW5jdGlvbiBFbGVtZW50RmFjdG9yeSgpIHsKICAgIHRoaXMuX3VpZCA9IDEyOwogIH0KCgogIEVsZW1lbnRGYWN0b3J5LnByb3RvdHlwZS5jcmVhdGVSb290ID0gZnVuY3Rpb24oYXR0cnMpIHsKICAgIHJldHVybiB0aGlzLmNyZWF0ZSgncm9vdCcsIGF0dHJzKTsKICB9OwoKICBFbGVtZW50RmFjdG9yeS5wcm90b3R5cGUuY3JlYXRlTGFiZWwgPSBmdW5jdGlvbihhdHRycykgewogICAgcmV0dXJuIHRoaXMuY3JlYXRlKCdsYWJlbCcsIGF0dHJzKTsKICB9OwoKICBFbGVtZW50RmFjdG9yeS5wcm90b3R5cGUuY3JlYXRlU2hhcGUgPSBmdW5jdGlvbihhdHRycykgewogICAgcmV0dXJuIHRoaXMuY3JlYXRlKCdzaGFwZScsIGF0dHJzKTsKICB9OwoKICBFbGVtZW50RmFjdG9yeS5wcm90b3R5cGUuY3JlYXRlQ29ubmVjdGlvbiA9IGZ1bmN0aW9uKGF0dHJzKSB7CiAgICByZXR1cm4gdGhpcy5jcmVhdGUoJ2Nvbm5lY3Rpb24nLCBhdHRycyk7CiAgfTsKCiAgLyoqCiAgICogQ3JlYXRlIGEgbW9kZWwgZWxlbWVudCB3aXRoIHRoZSBnaXZlbiB0eXBlIGFuZAogICAqIGEgbnVtYmVyIG9mIHByZS1zZXQgYXR0cmlidXRlcy4KICAgKgogICAqIEBwYXJhbSAge1N0cmluZ30gdHlwZQogICAqIEBwYXJhbSAge09iamVjdH0gYXR0cnMKICAgKiBAcmV0dXJuIHtkanMubW9kZWwuQmFzZX0gdGhlIG5ld2x5IGNyZWF0ZWQgbW9kZWwgaW5zdGFuY2UKICAgKi8KICBFbGVtZW50RmFjdG9yeS5wcm90b3R5cGUuY3JlYXRlID0gZnVuY3Rpb24odHlwZSwgYXR0cnMpIHsKCiAgICBhdHRycyA9IGFzc2lnbih7fSwgYXR0cnMgfHwge30pOwoKICAgIGlmICghYXR0cnMuaWQpIHsKICAgICAgYXR0cnMuaWQgPSB0eXBlICsgJ18nICsgKHRoaXMuX3VpZCsrKTsKICAgIH0KCiAgICByZXR1cm4gY3JlYXRlJDEodHlwZSwgYXR0cnMpOwogIH07CgogIHZhciBGTl9SRUYgPSAnX19mbic7CgogIHZhciBERUZBVUxUX1BSSU9SSVRZID0gMTAwMDsKCiAgdmFyIHNsaWNlJDEgPSBBcnJheS5wcm90b3R5cGUuc2xpY2U7CgogIC8qKgogICAqIEEgZ2VuZXJhbCBwdXJwb3NlIGV2ZW50IGJ1cy4KICAgKgogICAqIFRoaXMgY29tcG9uZW50IGlzIHVzZWQgdG8gY29tbXVuaWNhdGUgYWNyb3NzIGEgZGlhZ3JhbSBpbnN0YW5jZS4KICAgKiBPdGhlciBwYXJ0cyBvZiBhIGRpYWdyYW0gY2FuIHVzZSBpdCB0byBsaXN0ZW4gdG8gYW5kIGJyb2FkY2FzdCBldmVudHMuCiAgICoKICAgKgogICAqICMjIFJlZ2lzdGVyaW5nIGZvciBFdmVudHMKICAgKgogICAqIFRoZSBldmVudCBidXMgcHJvdmlkZXMgdGhlIHtAbGluayBFdmVudEJ1cyNvbn0gYW5kIHtAbGluayBFdmVudEJ1cyNvbmNlfQogICAqIG1ldGhvZHMgdG8gcmVnaXN0ZXIgZm9yIGV2ZW50cy4ge0BsaW5rIEV2ZW50QnVzI29mZn0gY2FuIGJlIHVzZWQgdG8KICAgKiByZW1vdmUgZXZlbnQgcmVnaXN0cmF0aW9ucy4gTGlzdGVuZXJzIHJlY2VpdmUgYW4gaW5zdGFuY2Ugb2Yge0BsaW5rIEV2ZW50fQogICAqIGFzIHRoZSBmaXJzdCBhcmd1bWVudC4gSXQgYWxsb3dzIHRoZW0gdG8gaG9vayBpbnRvIHRoZSBldmVudCBleGVjdXRpb24uCiAgICoKICAgKiBgYGBqYXZhc2NyaXB0CiAgICoKICAgKiAvLyBsaXN0ZW4gZm9yIGV2ZW50CiAgICogZXZlbnRCdXMub24oJ2ZvbycsIGZ1bmN0aW9uKGV2ZW50KSB7CiAgICoKICAgKiAgIC8vIGFjY2VzcyBldmVudCB0eXBlCiAgICogICBldmVudC50eXBlOyAvLyAnZm9vJwogICAqCiAgICogICAvLyBzdG9wIHByb3BhZ2F0aW9uIHRvIG90aGVyIGxpc3RlbmVycwogICAqICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICoKICAgKiAgIC8vIHByZXZlbnQgZXZlbnQgZGVmYXVsdAogICAqICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgKiB9KTsKICAgKgogICAqIC8vIGxpc3RlbiBmb3IgZXZlbnQgd2l0aCBjdXN0b20gcGF5bG9hZAogICAqIGV2ZW50QnVzLm9uKCdiYXInLCBmdW5jdGlvbihldmVudCwgcGF5bG9hZCkgewogICAqICAgY29uc29sZS5sb2cocGF5bG9hZCk7CiAgICogfSk7CiAgICoKICAgKiAvLyBsaXN0ZW4gZm9yIGV2ZW50IHJldHVybmluZyB2YWx1ZQogICAqIGV2ZW50QnVzLm9uKCdmb29iYXInLCBmdW5jdGlvbihldmVudCkgewogICAqCiAgICogICAvLyBzdG9wIGV2ZW50IHByb3BhZ2F0aW9uICsgcHJldmVudCBkZWZhdWx0CiAgICogICByZXR1cm4gZmFsc2U7CiAgICoKICAgKiAgIC8vIHN0b3AgZXZlbnQgcHJvcGFnYXRpb24gKyByZXR1cm4gY3VzdG9tIHJlc3VsdAogICAqICAgcmV0dXJuIHsKICAgKiAgICAgY29tcGxleDogJ2xpc3RlbmluZyByZXN1bHQnCiAgICogICB9OwogICAqIH0pOwogICAqCiAgICoKICAgKiAvLyBsaXN0ZW4gd2l0aCBjdXN0b20gcHJpb3JpdHkgKGRlZmF1bHQ9MTAwMCwgaGlnaGVyIGlzIGJldHRlcikKICAgKiBldmVudEJ1cy5vbigncHJpb3JpdHlmb28nLCAxNTAwLCBmdW5jdGlvbihldmVudCkgewogICAqICAgY29uc29sZS5sb2coJ2ludm9rZWQgZmlyc3QhJyk7CiAgICogfSk7CiAgICoKICAgKgogICAqIC8vIGxpc3RlbiBmb3IgZXZlbnQgYW5kIHBhc3MgdGhlIGNvbnRleHQgKGB0aGlzYCkKICAgKiBldmVudEJ1cy5vbignZm9vYmFyJywgZnVuY3Rpb24oZXZlbnQpIHsKICAgKiAgIHRoaXMuZm9vKCk7CiAgICogfSwgdGhpcyk7CiAgICogYGBgCiAgICoKICAgKgogICAqICMjIEVtaXR0aW5nIEV2ZW50cwogICAqCiAgICogRXZlbnRzIGNhbiBiZSBlbWl0dGVkIHZpYSB0aGUgZXZlbnQgYnVzIHVzaW5nIHtAbGluayBFdmVudEJ1cyNmaXJlfS4KICAgKgogICAqIGBgYGphdmFzY3JpcHQKICAgKgogICAqIC8vIGZhbHNlIGluZGljYXRlcyB0aGF0IHRoZSBkZWZhdWx0IGFjdGlvbgogICAqIC8vIHdhcyBwcmV2ZW50ZWQgYnkgbGlzdGVuZXJzCiAgICogaWYgKGV2ZW50QnVzLmZpcmUoJ2ZvbycpID09PSBmYWxzZSkgewogICAqICAgY29uc29sZS5sb2coJ2RlZmF1bHQgaGFzIGJlZW4gcHJldmVudGVkIScpOwogICAqIH07CiAgICoKICAgKgogICAqIC8vIGN1c3RvbSBhcmdzICsgcmV0dXJuIHZhbHVlIGxpc3RlbmVyCiAgICogZXZlbnRCdXMub24oJ3N1bScsIGZ1bmN0aW9uKGV2ZW50LCBhLCBiKSB7CiAgICogICByZXR1cm4gYSArIGI7CiAgICogfSk7CiAgICoKICAgKiAvLyB5b3UgY2FuIHBhc3MgY3VzdG9tIGFyZ3VtZW50cyArIHJldHJpZXZlIHJlc3VsdCB2YWx1ZXMuCiAgICogdmFyIHN1bSA9IGV2ZW50QnVzLmZpcmUoJ3N1bScsIDEsIDIpOwogICAqIGNvbnNvbGUubG9nKHN1bSk7IC8vIDMKICAgKiBgYGAKICAgKi8KICBmdW5jdGlvbiBFdmVudEJ1cygpIHsKICAgIHRoaXMuX2xpc3RlbmVycyA9IHt9OwoKICAgIC8vIGNsZWFudXAgb24gZGVzdHJveSBvbiBsb3dlc3QgcHJpb3JpdHkgdG8gYWxsb3cKICAgIC8vIG1lc3NhZ2UgcGFzc2luZyB1bnRpbCB0aGUgYml0dGVyIGVuZAogICAgdGhpcy5vbignZGlhZ3JhbS5kZXN0cm95JywgMSwgdGhpcy5fZGVzdHJveSwgdGhpcyk7CiAgfQoKCiAgLyoqCiAgICogUmVnaXN0ZXIgYW4gZXZlbnQgbGlzdGVuZXIgZm9yIGV2ZW50cyB3aXRoIHRoZSBnaXZlbiBuYW1lLgogICAqCiAgICogVGhlIGNhbGxiYWNrIHdpbGwgYmUgaW52b2tlZCB3aXRoIGBldmVudCwgLi4uYWRkaXRpb25hbEFyZ3VtZW50c2AKICAgKiB0aGF0IGhhdmUgYmVlbiBwYXNzZWQgdG8ge0BsaW5rIEV2ZW50QnVzI2ZpcmV9LgogICAqCiAgICogUmV0dXJuaW5nIGZhbHNlIGZyb20gYSBsaXN0ZW5lciB3aWxsIHByZXZlbnQgdGhlIGV2ZW50cyBkZWZhdWx0IGFjdGlvbgogICAqIChpZiBhbnkgaXMgc3BlY2lmaWVkKS4gVG8gc3RvcCBhbiBldmVudCBmcm9tIGJlaW5nIHByb2Nlc3NlZCBmdXJ0aGVyIGluCiAgICogb3RoZXIgbGlzdGVuZXJzIGV4ZWN1dGUge0BsaW5rIEV2ZW50I3N0b3BQcm9wYWdhdGlvbn0uCiAgICoKICAgKiBSZXR1cm5pbmcgYW55dGhpbmcgYnV0IGB1bmRlZmluZWRgIGZyb20gYSBsaXN0ZW5lciB3aWxsIHN0b3AgdGhlIGxpc3RlbmVyIHByb3BhZ2F0aW9uLgogICAqCiAgICogQHBhcmFtIHtTdHJpbmd8QXJyYXk8U3RyaW5nPn0gZXZlbnRzCiAgICogQHBhcmFtIHtOdW1iZXJ9IFtwcmlvcml0eT0xMDAwXSB0aGUgcHJpb3JpdHkgaW4gd2hpY2ggdGhpcyBsaXN0ZW5lciBpcyBjYWxsZWQsIGxhcmdlciBpcyBoaWdoZXIKICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjawogICAqIEBwYXJhbSB7T2JqZWN0fSBbdGhhdF0gUGFzcyBjb250ZXh0IChgdGhpc2ApIHRvIHRoZSBjYWxsYmFjawogICAqLwogIEV2ZW50QnVzLnByb3RvdHlwZS5vbiA9IGZ1bmN0aW9uKGV2ZW50cywgcHJpb3JpdHksIGNhbGxiYWNrLCB0aGF0KSB7CgogICAgZXZlbnRzID0gaXNBcnJheShldmVudHMpID8gZXZlbnRzIDogWyBldmVudHMgXTsKCiAgICBpZiAoaXNGdW5jdGlvbihwcmlvcml0eSkpIHsKICAgICAgdGhhdCA9IGNhbGxiYWNrOwogICAgICBjYWxsYmFjayA9IHByaW9yaXR5OwogICAgICBwcmlvcml0eSA9IERFRkFVTFRfUFJJT1JJVFk7CiAgICB9CgogICAgaWYgKCFpc051bWJlcihwcmlvcml0eSkpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdwcmlvcml0eSBtdXN0IGJlIGEgbnVtYmVyJyk7CiAgICB9CgogICAgdmFyIGFjdHVhbENhbGxiYWNrID0gY2FsbGJhY2s7CgogICAgaWYgKHRoYXQpIHsKICAgICAgYWN0dWFsQ2FsbGJhY2sgPSBiaW5kKGNhbGxiYWNrLCB0aGF0KTsKCiAgICAgIC8vIG1ha2Ugc3VyZSB3ZSByZW1lbWJlciBhbmQgYXJlIGFibGUgdG8gcmVtb3ZlCiAgICAgIC8vIGJvdW5kIGNhbGxiYWNrcyB2aWEge0BsaW5rICNvZmZ9IHVzaW5nIHRoZSBvcmlnaW5hbAogICAgICAvLyBjYWxsYmFjawogICAgICBhY3R1YWxDYWxsYmFja1tGTl9SRUZdID0gY2FsbGJhY2tbRk5fUkVGXSB8fCBjYWxsYmFjazsKICAgIH0KCiAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgZXZlbnRzLmZvckVhY2goZnVuY3Rpb24oZSkgewogICAgICBzZWxmLl9hZGRMaXN0ZW5lcihlLCB7CiAgICAgICAgcHJpb3JpdHk6IHByaW9yaXR5LAogICAgICAgIGNhbGxiYWNrOiBhY3R1YWxDYWxsYmFjaywKICAgICAgICBuZXh0OiBudWxsCiAgICAgIH0pOwogICAgfSk7CiAgfTsKCgogIC8qKgogICAqIFJlZ2lzdGVyIGFuIGV2ZW50IGxpc3RlbmVyIHRoYXQgaXMgZXhlY3V0ZWQgb25seSBvbmNlLgogICAqCiAgICogQHBhcmFtIHtTdHJpbmd9IGV2ZW50IHRoZSBldmVudCBuYW1lIHRvIHJlZ2lzdGVyIGZvcgogICAqIEBwYXJhbSB7TnVtYmVyfSBbcHJpb3JpdHk9MTAwMF0gdGhlIHByaW9yaXR5IGluIHdoaWNoIHRoaXMgbGlzdGVuZXIgaXMgY2FsbGVkLCBsYXJnZXIgaXMgaGlnaGVyCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgdGhlIGNhbGxiYWNrIHRvIGV4ZWN1dGUKICAgKiBAcGFyYW0ge09iamVjdH0gW3RoYXRdIFBhc3MgY29udGV4dCAoYHRoaXNgKSB0byB0aGUgY2FsbGJhY2sKICAgKi8KICBFdmVudEJ1cy5wcm90b3R5cGUub25jZSA9IGZ1bmN0aW9uKGV2ZW50LCBwcmlvcml0eSwgY2FsbGJhY2ssIHRoYXQpIHsKICAgIHZhciBzZWxmID0gdGhpczsKCiAgICBpZiAoaXNGdW5jdGlvbihwcmlvcml0eSkpIHsKICAgICAgdGhhdCA9IGNhbGxiYWNrOwogICAgICBjYWxsYmFjayA9IHByaW9yaXR5OwogICAgICBwcmlvcml0eSA9IERFRkFVTFRfUFJJT1JJVFk7CiAgICB9CgogICAgaWYgKCFpc051bWJlcihwcmlvcml0eSkpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdwcmlvcml0eSBtdXN0IGJlIGEgbnVtYmVyJyk7CiAgICB9CgogICAgZnVuY3Rpb24gd3JhcHBlZENhbGxiYWNrKCkgewogICAgICB2YXIgcmVzdWx0ID0gY2FsbGJhY2suYXBwbHkodGhhdCwgYXJndW1lbnRzKTsKCiAgICAgIHNlbGYub2ZmKGV2ZW50LCB3cmFwcGVkQ2FsbGJhY2spOwoKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KCiAgICAvLyBtYWtlIHN1cmUgd2UgcmVtZW1iZXIgYW5kIGFyZSBhYmxlIHRvIHJlbW92ZQogICAgLy8gYm91bmQgY2FsbGJhY2tzIHZpYSB7QGxpbmsgI29mZn0gdXNpbmcgdGhlIG9yaWdpbmFsCiAgICAvLyBjYWxsYmFjawogICAgd3JhcHBlZENhbGxiYWNrW0ZOX1JFRl0gPSBjYWxsYmFjazsKCiAgICB0aGlzLm9uKGV2ZW50LCBwcmlvcml0eSwgd3JhcHBlZENhbGxiYWNrKTsKICB9OwoKCiAgLyoqCiAgICogUmVtb3ZlcyBldmVudCBsaXN0ZW5lcnMgYnkgZXZlbnQgYW5kIGNhbGxiYWNrLgogICAqCiAgICogSWYgbm8gY2FsbGJhY2sgaXMgZ2l2ZW4sIGFsbCBsaXN0ZW5lcnMgZm9yIGEgZ2l2ZW4gZXZlbnQgbmFtZSBhcmUgYmVpbmcgcmVtb3ZlZC4KICAgKgogICAqIEBwYXJhbSB7U3RyaW5nfEFycmF5PFN0cmluZz59IGV2ZW50cwogICAqIEBwYXJhbSB7RnVuY3Rpb259IFtjYWxsYmFja10KICAgKi8KICBFdmVudEJ1cy5wcm90b3R5cGUub2ZmID0gZnVuY3Rpb24oZXZlbnRzLCBjYWxsYmFjaykgewoKICAgIGV2ZW50cyA9IGlzQXJyYXkoZXZlbnRzKSA/IGV2ZW50cyA6IFsgZXZlbnRzIF07CgogICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgIGV2ZW50cy5mb3JFYWNoKGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgIHNlbGYuX3JlbW92ZUxpc3RlbmVyKGV2ZW50LCBjYWxsYmFjayk7CiAgICB9KTsKCiAgfTsKCgogIC8qKgogICAqIENyZWF0ZSBhbiBFdmVudEJ1cyBldmVudC4KICAgKgogICAqIEBwYXJhbSB7T2JqZWN0fSBkYXRhCiAgICoKICAgKiBAcmV0dXJuIHtPYmplY3R9IGV2ZW50LCByZWNvZ25pemVkIGJ5IHRoZSBldmVudEJ1cwogICAqLwogIEV2ZW50QnVzLnByb3RvdHlwZS5jcmVhdGVFdmVudCA9IGZ1bmN0aW9uKGRhdGEpIHsKICAgIHZhciBldmVudCA9IG5ldyBJbnRlcm5hbEV2ZW50KCk7CgogICAgZXZlbnQuaW5pdChkYXRhKTsKCiAgICByZXR1cm4gZXZlbnQ7CiAgfTsKCgogIC8qKgogICAqIEZpcmVzIGEgbmFtZWQgZXZlbnQuCiAgICoKICAgKiBAZXhhbXBsZQogICAqCiAgICogLy8gZmlyZSBldmVudCBieSBuYW1lCiAgICogZXZlbnRzLmZpcmUoJ2ZvbycpOwogICAqCiAgICogLy8gZmlyZSBldmVudCBvYmplY3Qgd2l0aCBuZXN0ZWQgdHlwZQogICAqIHZhciBldmVudCA9IHsgdHlwZTogJ2ZvbycgfTsKICAgKiBldmVudHMuZmlyZShldmVudCk7CiAgICoKICAgKiAvLyBmaXJlIGV2ZW50IHdpdGggZXhwbGljaXQgdHlwZQogICAqIHZhciBldmVudCA9IHsgeDogMTAsIHk6IDIwIH07CiAgICogZXZlbnRzLmZpcmUoJ2VsZW1lbnQubW92ZWQnLCBldmVudCk7CiAgICoKICAgKiAvLyBwYXNzIGFkZGl0aW9uYWwgYXJndW1lbnRzIHRvIHRoZSBldmVudAogICAqIGV2ZW50cy5vbignZm9vJywgZnVuY3Rpb24oZXZlbnQsIGJhcikgewogICAqICAgYWxlcnQoYmFyKTsKICAgKiB9KTsKICAgKgogICAqIGV2ZW50cy5maXJlKHsgdHlwZTogJ2ZvbycgfSwgJ0kgYW0gYmFyIScpOwogICAqCiAgICogQHBhcmFtIHtTdHJpbmd9IFtuYW1lXSB0aGUgb3B0aW9uYWwgZXZlbnQgbmFtZQogICAqIEBwYXJhbSB7T2JqZWN0fSBbZXZlbnRdIHRoZSBldmVudCBvYmplY3QKICAgKiBAcGFyYW0gey4uLk9iamVjdH0gYWRkaXRpb25hbCBhcmd1bWVudHMgdG8gYmUgcGFzc2VkIHRvIHRoZSBjYWxsYmFjayBmdW5jdGlvbnMKICAgKgogICAqIEByZXR1cm4ge0Jvb2xlYW59IHRoZSBldmVudHMgcmV0dXJuIHZhbHVlLCBpZiBzcGVjaWZpZWQgb3IgZmFsc2UgaWYgdGhlCiAgICogICAgICAgICAgICAgICAgICAgZGVmYXVsdCBhY3Rpb24gd2FzIHByZXZlbnRlZCBieSBsaXN0ZW5lcnMKICAgKi8KICBFdmVudEJ1cy5wcm90b3R5cGUuZmlyZSA9IGZ1bmN0aW9uKHR5cGUsIGRhdGEpIHsKCiAgICB2YXIgZXZlbnQsCiAgICAgICAgZmlyc3RMaXN0ZW5lciwKICAgICAgICByZXR1cm5WYWx1ZSwKICAgICAgICBhcmdzOwoKICAgIGFyZ3MgPSBzbGljZSQxLmNhbGwoYXJndW1lbnRzKTsKCiAgICBpZiAodHlwZW9mIHR5cGUgPT09ICdvYmplY3QnKSB7CiAgICAgIGV2ZW50ID0gdHlwZTsKICAgICAgdHlwZSA9IGV2ZW50LnR5cGU7CiAgICB9CgogICAgaWYgKCF0eXBlKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcignbm8gZXZlbnQgdHlwZSBzcGVjaWZpZWQnKTsKICAgIH0KCiAgICBmaXJzdExpc3RlbmVyID0gdGhpcy5fbGlzdGVuZXJzW3R5cGVdOwoKICAgIGlmICghZmlyc3RMaXN0ZW5lcikgewogICAgICByZXR1cm47CiAgICB9CgogICAgLy8gd2UgbWFrZSBzdXJlIHdlIGZpcmUgaW5zdGFuY2VzIG9mIG91ciBob21lIG1hZGUKICAgIC8vIGV2ZW50cyBoZXJlLiBXZSB3cmFwIHRoZW0gb25seSBvbmNlLCB0aG91Z2gKICAgIGlmIChkYXRhIGluc3RhbmNlb2YgSW50ZXJuYWxFdmVudCkgewoKICAgICAgLy8gd2UgYXJlIGZpbmUsIHdlIGFscmVhZCBoYXZlIGFuIGV2ZW50CiAgICAgIGV2ZW50ID0gZGF0YTsKICAgIH0gZWxzZSB7CiAgICAgIGV2ZW50ID0gdGhpcy5jcmVhdGVFdmVudChkYXRhKTsKICAgIH0KCiAgICAvLyBlbnN1cmUgd2UgcGFzcyB0aGUgZXZlbnQgYXMgdGhlIGZpcnN0IHBhcmFtZXRlcgogICAgYXJnc1swXSA9IGV2ZW50OwoKICAgIC8vIG9yaWdpbmFsIGV2ZW50IHR5cGUgKGluIGNhc2Ugd2UgZGVsZWdhdGUpCiAgICB2YXIgb3JpZ2luYWxUeXBlID0gZXZlbnQudHlwZTsKCiAgICAvLyB1cGRhdGUgZXZlbnQgdHlwZSBiZWZvcmUgZGVsZWdhdGlvbgogICAgaWYgKHR5cGUgIT09IG9yaWdpbmFsVHlwZSkgewogICAgICBldmVudC50eXBlID0gdHlwZTsKICAgIH0KCiAgICB0cnkgewogICAgICByZXR1cm5WYWx1ZSA9IHRoaXMuX2ludm9rZUxpc3RlbmVycyhldmVudCwgYXJncywgZmlyc3RMaXN0ZW5lcik7CiAgICB9IGZpbmFsbHkgewoKICAgICAgLy8gcmVzZXQgZXZlbnQgdHlwZSBhZnRlciBkZWxlZ2F0aW9uCiAgICAgIGlmICh0eXBlICE9PSBvcmlnaW5hbFR5cGUpIHsKICAgICAgICBldmVudC50eXBlID0gb3JpZ2luYWxUeXBlOwogICAgICB9CiAgICB9CgogICAgLy8gc2V0IHRoZSByZXR1cm4gdmFsdWUgdG8gZmFsc2UgaWYgdGhlIGV2ZW50IGRlZmF1bHQKICAgIC8vIGdvdCBwcmV2ZW50ZWQgYW5kIG5vIG90aGVyIHJldHVybiB2YWx1ZSBleGlzdHMKICAgIGlmIChyZXR1cm5WYWx1ZSA9PT0gdW5kZWZpbmVkICYmIGV2ZW50LmRlZmF1bHRQcmV2ZW50ZWQpIHsKICAgICAgcmV0dXJuVmFsdWUgPSBmYWxzZTsKICAgIH0KCiAgICByZXR1cm4gcmV0dXJuVmFsdWU7CiAgfTsKCgogIEV2ZW50QnVzLnByb3RvdHlwZS5oYW5kbGVFcnJvciA9IGZ1bmN0aW9uKGVycm9yKSB7CiAgICByZXR1cm4gdGhpcy5maXJlKCdlcnJvcicsIHsgZXJyb3I6IGVycm9yIH0pID09PSBmYWxzZTsKICB9OwoKCiAgRXZlbnRCdXMucHJvdG90eXBlLl9kZXN0cm95ID0gZnVuY3Rpb24oKSB7CiAgICB0aGlzLl9saXN0ZW5lcnMgPSB7fTsKICB9OwoKICBFdmVudEJ1cy5wcm90b3R5cGUuX2ludm9rZUxpc3RlbmVycyA9IGZ1bmN0aW9uKGV2ZW50LCBhcmdzLCBsaXN0ZW5lcikgewoKICAgIHZhciByZXR1cm5WYWx1ZTsKCiAgICB3aGlsZSAobGlzdGVuZXIpIHsKCiAgICAgIC8vIGhhbmRsZSBzdG9wcGVkIHByb3BhZ2F0aW9uCiAgICAgIGlmIChldmVudC5jYW5jZWxCdWJibGUpIHsKICAgICAgICBicmVhazsKICAgICAgfQoKICAgICAgcmV0dXJuVmFsdWUgPSB0aGlzLl9pbnZva2VMaXN0ZW5lcihldmVudCwgYXJncywgbGlzdGVuZXIpOwoKICAgICAgbGlzdGVuZXIgPSBsaXN0ZW5lci5uZXh0OwogICAgfQoKICAgIHJldHVybiByZXR1cm5WYWx1ZTsKICB9OwoKICBFdmVudEJ1cy5wcm90b3R5cGUuX2ludm9rZUxpc3RlbmVyID0gZnVuY3Rpb24oZXZlbnQsIGFyZ3MsIGxpc3RlbmVyKSB7CgogICAgdmFyIHJldHVyblZhbHVlOwoKICAgIHRyeSB7CgogICAgICAvLyByZXR1cm5pbmcgZmFsc2UgcHJldmVudHMgdGhlIGRlZmF1bHQgYWN0aW9uCiAgICAgIHJldHVyblZhbHVlID0gaW52b2tlRnVuY3Rpb24obGlzdGVuZXIuY2FsbGJhY2ssIGFyZ3MpOwoKICAgICAgLy8gc3RvcCBwcm9wYWdhdGlvbiBvbiByZXR1cm4gdmFsdWUKICAgICAgaWYgKHJldHVyblZhbHVlICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBldmVudC5yZXR1cm5WYWx1ZSA9IHJldHVyblZhbHVlOwogICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpOwogICAgICB9CgogICAgICAvLyBwcmV2ZW50IGRlZmF1bHQgb24gcmV0dXJuIGZhbHNlCiAgICAgIGlmIChyZXR1cm5WYWx1ZSA9PT0gZmFsc2UpIHsKICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICB9CiAgICB9IGNhdGNoIChlKSB7CiAgICAgIGlmICghdGhpcy5oYW5kbGVFcnJvcihlKSkgewogICAgICAgIGNvbnNvbGUuZXJyb3IoJ3VuaGFuZGxlZCBlcnJvciBpbiBldmVudCBsaXN0ZW5lcicpOwogICAgICAgIGNvbnNvbGUuZXJyb3IoZS5zdGFjayk7CgogICAgICAgIHRocm93IGU7CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gcmV0dXJuVmFsdWU7CiAgfTsKCiAgLyoKICAgKiBBZGQgbmV3IGxpc3RlbmVyIHdpdGggYSBjZXJ0YWluIHByaW9yaXR5IHRvIHRoZSBsaXN0CiAgICogb2YgbGlzdGVuZXJzIChmb3IgdGhlIGdpdmVuIGV2ZW50KS4KICAgKgogICAqIFRoZSBzZW1hbnRpY3Mgb2YgbGlzdGVuZXIgcmVnaXN0cmF0aW9uIC8gbGlzdGVuZXIgZXhlY3V0aW9uIGFyZQogICAqIGZpcnN0IHJlZ2lzdGVyLCBmaXJzdCBzZXJ2ZTogTmV3IGxpc3RlbmVycyB3aWxsIGFsd2F5cyBiZSBpbnNlcnRlZAogICAqIGFmdGVyIGV4aXN0aW5nIGxpc3RlbmVycyB3aXRoIHRoZSBzYW1lIHByaW9yaXR5LgogICAqCiAgICogRXhhbXBsZTogSW5zZXJ0aW5nIHR3byBsaXN0ZW5lcnMgd2l0aCBwcmlvcml0eSAxMDAwIGFuZCAxMzAwCiAgICoKICAgKiAgICAqIGJlZm9yZTogWyAxNTAwLCAxNTAwLCAxMDAwLCAxMDAwIF0KICAgKiAgICAqIGFmdGVyOiBbIDE1MDAsIDE1MDAsIChuZXc9MTMwMCksIDEwMDAsIDEwMDAsIChuZXc9MTAwMCkgXQogICAqCiAgICogQHBhcmFtIHtTdHJpbmd9IGV2ZW50CiAgICogQHBhcmFtIHtPYmplY3R9IGxpc3RlbmVyIHsgcHJpb3JpdHksIGNhbGxiYWNrIH0KICAgKi8KICBFdmVudEJ1cy5wcm90b3R5cGUuX2FkZExpc3RlbmVyID0gZnVuY3Rpb24oZXZlbnQsIG5ld0xpc3RlbmVyKSB7CgogICAgdmFyIGxpc3RlbmVyID0gdGhpcy5fZ2V0TGlzdGVuZXJzKGV2ZW50KSwKICAgICAgICBwcmV2aW91c0xpc3RlbmVyOwoKICAgIC8vIG5vIHByaW9yIGxpc3RlbmVycwogICAgaWYgKCFsaXN0ZW5lcikgewogICAgICB0aGlzLl9zZXRMaXN0ZW5lcnMoZXZlbnQsIG5ld0xpc3RlbmVyKTsKCiAgICAgIHJldHVybjsKICAgIH0KCiAgICAvLyBlbnN1cmUgd2Ugb3JkZXIgbGlzdGVuZXJzIGJ5IHByaW9yaXR5IGZyb20KICAgIC8vIDAgKGhpZ2gpIHRvIG4gPiAwIChsb3cpCiAgICB3aGlsZSAobGlzdGVuZXIpIHsKCiAgICAgIGlmIChsaXN0ZW5lci5wcmlvcml0eSA8IG5ld0xpc3RlbmVyLnByaW9yaXR5KSB7CgogICAgICAgIG5ld0xpc3RlbmVyLm5leHQgPSBsaXN0ZW5lcjsKCiAgICAgICAgaWYgKHByZXZpb3VzTGlzdGVuZXIpIHsKICAgICAgICAgIHByZXZpb3VzTGlzdGVuZXIubmV4dCA9IG5ld0xpc3RlbmVyOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLl9zZXRMaXN0ZW5lcnMoZXZlbnQsIG5ld0xpc3RlbmVyKTsKICAgICAgICB9CgogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgcHJldmlvdXNMaXN0ZW5lciA9IGxpc3RlbmVyOwogICAgICBsaXN0ZW5lciA9IGxpc3RlbmVyLm5leHQ7CiAgICB9CgogICAgLy8gYWRkIG5ldyBsaXN0ZW5lciB0byBiYWNrCiAgICBwcmV2aW91c0xpc3RlbmVyLm5leHQgPSBuZXdMaXN0ZW5lcjsKICB9OwoKCiAgRXZlbnRCdXMucHJvdG90eXBlLl9nZXRMaXN0ZW5lcnMgPSBmdW5jdGlvbihuYW1lKSB7CiAgICByZXR1cm4gdGhpcy5fbGlzdGVuZXJzW25hbWVdOwogIH07CgogIEV2ZW50QnVzLnByb3RvdHlwZS5fc2V0TGlzdGVuZXJzID0gZnVuY3Rpb24obmFtZSwgbGlzdGVuZXIpIHsKICAgIHRoaXMuX2xpc3RlbmVyc1tuYW1lXSA9IGxpc3RlbmVyOwogIH07CgogIEV2ZW50QnVzLnByb3RvdHlwZS5fcmVtb3ZlTGlzdGVuZXIgPSBmdW5jdGlvbihldmVudCwgY2FsbGJhY2spIHsKCiAgICB2YXIgbGlzdGVuZXIgPSB0aGlzLl9nZXRMaXN0ZW5lcnMoZXZlbnQpLAogICAgICAgIG5leHRMaXN0ZW5lciwKICAgICAgICBwcmV2aW91c0xpc3RlbmVyLAogICAgICAgIGxpc3RlbmVyQ2FsbGJhY2s7CgogICAgaWYgKCFjYWxsYmFjaykgewoKICAgICAgLy8gY2xlYXIgbGlzdGVuZXJzCiAgICAgIHRoaXMuX3NldExpc3RlbmVycyhldmVudCwgbnVsbCk7CgogICAgICByZXR1cm47CiAgICB9CgogICAgd2hpbGUgKGxpc3RlbmVyKSB7CgogICAgICBuZXh0TGlzdGVuZXIgPSBsaXN0ZW5lci5uZXh0OwoKICAgICAgbGlzdGVuZXJDYWxsYmFjayA9IGxpc3RlbmVyLmNhbGxiYWNrOwoKICAgICAgaWYgKGxpc3RlbmVyQ2FsbGJhY2sgPT09IGNhbGxiYWNrIHx8IGxpc3RlbmVyQ2FsbGJhY2tbRk5fUkVGXSA9PT0gY2FsbGJhY2spIHsKICAgICAgICBpZiAocHJldmlvdXNMaXN0ZW5lcikgewogICAgICAgICAgcHJldmlvdXNMaXN0ZW5lci5uZXh0ID0gbmV4dExpc3RlbmVyOwogICAgICAgIH0gZWxzZSB7CgogICAgICAgICAgLy8gbmV3IGZpcnN0IGxpc3RlbmVyCiAgICAgICAgICB0aGlzLl9zZXRMaXN0ZW5lcnMoZXZlbnQsIG5leHRMaXN0ZW5lcik7CiAgICAgICAgfQogICAgICB9CgogICAgICBwcmV2aW91c0xpc3RlbmVyID0gbGlzdGVuZXI7CiAgICAgIGxpc3RlbmVyID0gbmV4dExpc3RlbmVyOwogICAgfQogIH07CgogIC8qKgogICAqIEEgZXZlbnQgdGhhdCBpcyBlbWl0dGVkIHZpYSB0aGUgZXZlbnQgYnVzLgogICAqLwogIGZ1bmN0aW9uIEludGVybmFsRXZlbnQoKSB7IH0KCiAgSW50ZXJuYWxFdmVudC5wcm90b3R5cGUuc3RvcFByb3BhZ2F0aW9uID0gZnVuY3Rpb24oKSB7CiAgICB0aGlzLmNhbmNlbEJ1YmJsZSA9IHRydWU7CiAgfTsKCiAgSW50ZXJuYWxFdmVudC5wcm90b3R5cGUucHJldmVudERlZmF1bHQgPSBmdW5jdGlvbigpIHsKICAgIHRoaXMuZGVmYXVsdFByZXZlbnRlZCA9IHRydWU7CiAgfTsKCiAgSW50ZXJuYWxFdmVudC5wcm90b3R5cGUuaW5pdCA9IGZ1bmN0aW9uKGRhdGEpIHsKICAgIGFzc2lnbih0aGlzLCBkYXRhIHx8IHt9KTsKICB9OwoKCiAgLyoqCiAgICogSW52b2tlIGZ1bmN0aW9uLiBCZSBmYXN0Li4uCiAgICoKICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmbgogICAqIEBwYXJhbSB7QXJyYXk8T2JqZWN0Pn0gYXJncwogICAqCiAgICogQHJldHVybiB7QW55fQogICAqLwogIGZ1bmN0aW9uIGludm9rZUZ1bmN0aW9uKGZuLCBhcmdzKSB7CiAgICByZXR1cm4gZm4uYXBwbHkobnVsbCwgYXJncyk7CiAgfQoKICAvKioKICAgKiBTVkdzIGZvciBlbGVtZW50cyBhcmUgZ2VuZXJhdGVkIGJ5IHRoZSB7QGxpbmsgR3JhcGhpY3NGYWN0b3J5fS4KICAgKgogICAqIFRoaXMgdXRpbGl0eSBnaXZlcyBxdWljayBhY2Nlc3MgdG8gdGhlIGltcG9ydGFudCBzZW1hbnRpYwogICAqIHBhcnRzIG9mIGFuIGVsZW1lbnQuCiAgICovCgogIC8qKgogICAqIFJldHVybnMgdGhlIHZpc3VhbCBwYXJ0IG9mIGEgZGlhZ3JhbSBlbGVtZW50CiAgICoKICAgKiBAcGFyYW0ge1NuYXA8U1ZHRWxlbWVudD59IGdmeAogICAqCiAgICogQHJldHVybiB7U25hcDxTVkdFbGVtZW50Pn0KICAgKi8KICBmdW5jdGlvbiBnZXRWaXN1YWwoZ2Z4KSB7CiAgICByZXR1cm4gZ2Z4LmNoaWxkTm9kZXNbMF07CiAgfQoKICAvKioKICAgKiBSZXR1cm5zIHRoZSBjaGlsZHJlbiBmb3IgYSBnaXZlbiBkaWFncmFtIGVsZW1lbnQuCiAgICoKICAgKiBAcGFyYW0ge1NuYXA8U1ZHRWxlbWVudD59IGdmeAogICAqIEByZXR1cm4ge1NuYXA8U1ZHRWxlbWVudD59CiAgICovCiAgZnVuY3Rpb24gZ2V0Q2hpbGRyZW4oZ2Z4KSB7CiAgICByZXR1cm4gZ2Z4LnBhcmVudE5vZGUuY2hpbGROb2Rlc1sxXTsKICB9CgogIC8qKg0KICAgKiBAcGFyYW0gezxTVkdFbGVtZW50Pn0gZWxlbWVudA0KICAgKiBAcGFyYW0ge051bWJlcn0geA0KICAgKiBAcGFyYW0ge051bWJlcn0geQ0KICAgKiBAcGFyYW0ge051bWJlcn0gYW5nbGUNCiAgICogQHBhcmFtIHtOdW1iZXJ9IGFtb3VudA0KICAgKi8NCiAgZnVuY3Rpb24gdHJhbnNmb3JtJDEoZ2Z4LCB4LCB5LCBhbmdsZSwgYW1vdW50KSB7DQogICAgdmFyIHRyYW5zbGF0ZSA9IGNyZWF0ZVRyYW5zZm9ybSgpOw0KICAgIHRyYW5zbGF0ZS5zZXRUcmFuc2xhdGUoeCwgeSk7DQoNCiAgICB2YXIgcm90YXRlID0gY3JlYXRlVHJhbnNmb3JtKCk7DQogICAgcm90YXRlLnNldFJvdGF0ZShhbmdsZSwgMCwgMCk7DQoNCiAgICB2YXIgc2NhbGUgPSBjcmVhdGVUcmFuc2Zvcm0oKTsNCiAgICBzY2FsZS5zZXRTY2FsZShhbW91bnQgfHwgMSwgYW1vdW50IHx8IDEpOw0KDQogICAgdHJhbnNmb3JtKGdmeCwgWyB0cmFuc2xhdGUsIHJvdGF0ZSwgc2NhbGUgXSk7DQogIH0NCg0KDQogIC8qKg0KICAgKiBAcGFyYW0ge1NWR0VsZW1lbnR9IGVsZW1lbnQNCiAgICogQHBhcmFtIHtOdW1iZXJ9IHgNCiAgICogQHBhcmFtIHtOdW1iZXJ9IHkNCiAgICovDQogIGZ1bmN0aW9uIHRyYW5zbGF0ZShnZngsIHgsIHkpIHsNCiAgICB2YXIgdHJhbnNsYXRlID0gY3JlYXRlVHJhbnNmb3JtKCk7DQogICAgdHJhbnNsYXRlLnNldFRyYW5zbGF0ZSh4LCB5KTsNCg0KICAgIHRyYW5zZm9ybShnZngsIHRyYW5zbGF0ZSk7DQogIH0NCg0KDQogIC8qKg0KICAgKiBAcGFyYW0ge1NWR0VsZW1lbnR9IGVsZW1lbnQNCiAgICogQHBhcmFtIHtOdW1iZXJ9IGFuZ2xlDQogICAqLw0KICBmdW5jdGlvbiByb3RhdGUoZ2Z4LCBhbmdsZSkgew0KICAgIHZhciByb3RhdGUgPSBjcmVhdGVUcmFuc2Zvcm0oKTsNCiAgICByb3RhdGUuc2V0Um90YXRlKGFuZ2xlLCAwLCAwKTsNCg0KICAgIHRyYW5zZm9ybShnZngsIHJvdGF0ZSk7DQogIH0KCiAgLyoqCiAgICogQSBmYWN0b3J5IHRoYXQgY3JlYXRlcyBncmFwaGljYWwgZWxlbWVudHMKICAgKgogICAqIEBwYXJhbSB7RXZlbnRCdXN9IGV2ZW50QnVzCiAgICogQHBhcmFtIHtFbGVtZW50UmVnaXN0cnl9IGVsZW1lbnRSZWdpc3RyeQogICAqLwogIGZ1bmN0aW9uIEdyYXBoaWNzRmFjdG9yeShldmVudEJ1cywgZWxlbWVudFJlZ2lzdHJ5KSB7CiAgICB0aGlzLl9ldmVudEJ1cyA9IGV2ZW50QnVzOwogICAgdGhpcy5fZWxlbWVudFJlZ2lzdHJ5ID0gZWxlbWVudFJlZ2lzdHJ5OwogIH0KCiAgR3JhcGhpY3NGYWN0b3J5LiRpbmplY3QgPSBbICdldmVudEJ1cycgLCAnZWxlbWVudFJlZ2lzdHJ5JyBdOwoKCiAgR3JhcGhpY3NGYWN0b3J5LnByb3RvdHlwZS5fZ2V0Q2hpbGRyZW4gPSBmdW5jdGlvbihlbGVtZW50KSB7CgogICAgdmFyIGdmeCA9IHRoaXMuX2VsZW1lbnRSZWdpc3RyeS5nZXRHcmFwaGljcyhlbGVtZW50KTsKCiAgICB2YXIgY2hpbGRyZW5HZng7CgogICAgLy8gcm9vdCBlbGVtZW50CiAgICBpZiAoIWVsZW1lbnQucGFyZW50KSB7CiAgICAgIGNoaWxkcmVuR2Z4ID0gZ2Z4OwogICAgfSBlbHNlIHsKICAgICAgY2hpbGRyZW5HZnggPSBnZXRDaGlsZHJlbihnZngpOwogICAgICBpZiAoIWNoaWxkcmVuR2Z4KSB7CiAgICAgICAgY2hpbGRyZW5HZnggPSBjcmVhdGUoJ2cnKTsKICAgICAgICBjbGFzc2VzJDEoY2hpbGRyZW5HZngpLmFkZCgnZGpzLWNoaWxkcmVuJyk7CgogICAgICAgIGFwcGVuZChnZngucGFyZW50Tm9kZSwgY2hpbGRyZW5HZngpOwogICAgICB9CiAgICB9CgogICAgcmV0dXJuIGNoaWxkcmVuR2Z4OwogIH07CgogIC8qKgogICAqIENsZWFycyB0aGUgZ3JhcGhpY2FsIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBlbGVtZW50IGFuZCByZXR1cm5zIHRoZQogICAqIGNsZWFyZWQgdmlzdWFsICh0aGUgPGcgY2xhc3M9ImRqcy12aXN1YWwiIC8+IGVsZW1lbnQpLgogICAqLwogIEdyYXBoaWNzRmFjdG9yeS5wcm90b3R5cGUuX2NsZWFyID0gZnVuY3Rpb24oZ2Z4KSB7CiAgICB2YXIgdmlzdWFsID0gZ2V0VmlzdWFsKGdmeCk7CgogICAgY2xlYXIodmlzdWFsKTsKCiAgICByZXR1cm4gdmlzdWFsOwogIH07CgogIC8qKgogICAqIENyZWF0ZXMgYSBnZnggY29udGFpbmVyIGZvciBzaGFwZXMgYW5kIGNvbm5lY3Rpb25zCiAgICoKICAgKiBUaGUgbGF5b3V0IGlzIGFzIGZvbGxvd3M6CiAgICoKICAgKiA8ZyBjbGFzcz0iZGpzLWdyb3VwIj4KICAgKgogICAqICAgPCEtLSB0aGUgZ2Z4IC0tPgogICAqICAgPGcgY2xhc3M9ImRqcy1lbGVtZW50IGRqcy0oc2hhcGV8Y29ubmVjdGlvbnxmcmFtZSkiPgogICAqICAgICA8ZyBjbGFzcz0iZGpzLXZpc3VhbCI+CiAgICogICAgICAgPCEtLSB0aGUgcmVuZGVyZXIgZHJhd3MgaW4gaGVyZSAtLT4KICAgKiAgICAgPC9nPgogICAqCiAgICogICAgIDwhLS0gZXh0ZW5zaW9ucyAob3ZlcmxheXMsIGNsaWNrIGJveCwgLi4uKSBnb2VzIGhlcmUKICAgKiAgIDwvZz4KICAgKgogICAqICAgPCEtLSB0aGUgZ2Z4IGNoaWxkIG5vZGVzIC0tPgogICAqICAgPGcgY2xhc3M9ImRqcy1jaGlsZHJlbiI+PC9nPgogICAqIDwvZz4KICAgKgogICAqIEBwYXJhbSB7U3RyaW5nfSB0eXBlIHRoZSB0eXBlIG9mIHRoZSBlbGVtZW50LCBpLmUuIHNoYXBlIHwgY29ubmVjdGlvbgogICAqIEBwYXJhbSB7U1ZHRWxlbWVudH0gW2NoaWxkcmVuR2Z4XQogICAqIEBwYXJhbSB7TnVtYmVyfSBbcGFyZW50SW5kZXhdIHBvc2l0aW9uIHRvIGNyZWF0ZSBjb250YWluZXIgaW4gcGFyZW50CiAgICogQHBhcmFtIHtCb29sZWFufSBbaXNGcmFtZV0gaXMgZnJhbWUgZWxlbWVudAogICAqCiAgICogQHJldHVybiB7U1ZHRWxlbWVudH0KICAgKi8KICBHcmFwaGljc0ZhY3RvcnkucHJvdG90eXBlLl9jcmVhdGVDb250YWluZXIgPSBmdW5jdGlvbigKICAgICAgdHlwZSwgY2hpbGRyZW5HZngsIHBhcmVudEluZGV4LCBpc0ZyYW1lCiAgKSB7CiAgICB2YXIgb3V0ZXJHZnggPSBjcmVhdGUoJ2cnKTsKICAgIGNsYXNzZXMkMShvdXRlckdmeCkuYWRkKCdkanMtZ3JvdXAnKTsKCiAgICAvLyBpbnNlcnQgbm9kZSBhdCBwb3NpdGlvbgogICAgaWYgKHR5cGVvZiBwYXJlbnRJbmRleCAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgcHJlcGVuZFRvKG91dGVyR2Z4LCBjaGlsZHJlbkdmeCwgY2hpbGRyZW5HZnguY2hpbGROb2Rlc1twYXJlbnRJbmRleF0pOwogICAgfSBlbHNlIHsKICAgICAgYXBwZW5kKGNoaWxkcmVuR2Z4LCBvdXRlckdmeCk7CiAgICB9CgogICAgdmFyIGdmeCA9IGNyZWF0ZSgnZycpOwogICAgY2xhc3NlcyQxKGdmeCkuYWRkKCdkanMtZWxlbWVudCcpOwogICAgY2xhc3NlcyQxKGdmeCkuYWRkKCdkanMtJyArIHR5cGUpOwoKICAgIGlmIChpc0ZyYW1lKSB7CiAgICAgIGNsYXNzZXMkMShnZngpLmFkZCgnZGpzLWZyYW1lJyk7CiAgICB9CgogICAgYXBwZW5kKG91dGVyR2Z4LCBnZngpOwoKICAgIC8vIGNyZWF0ZSB2aXN1YWwKICAgIHZhciB2aXN1YWwgPSBjcmVhdGUoJ2cnKTsKICAgIGNsYXNzZXMkMSh2aXN1YWwpLmFkZCgnZGpzLXZpc3VhbCcpOwoKICAgIGFwcGVuZChnZngsIHZpc3VhbCk7CgogICAgcmV0dXJuIGdmeDsKICB9OwoKICBHcmFwaGljc0ZhY3RvcnkucHJvdG90eXBlLmNyZWF0ZSA9IGZ1bmN0aW9uKHR5cGUsIGVsZW1lbnQsIHBhcmVudEluZGV4KSB7CiAgICB2YXIgY2hpbGRyZW5HZnggPSB0aGlzLl9nZXRDaGlsZHJlbihlbGVtZW50LnBhcmVudCk7CiAgICByZXR1cm4gdGhpcy5fY3JlYXRlQ29udGFpbmVyKHR5cGUsIGNoaWxkcmVuR2Z4LCBwYXJlbnRJbmRleCwgaXNGcmFtZUVsZW1lbnQoZWxlbWVudCkpOwogIH07CgogIEdyYXBoaWNzRmFjdG9yeS5wcm90b3R5cGUudXBkYXRlQ29udGFpbm1lbnRzID0gZnVuY3Rpb24oZWxlbWVudHMpIHsKCiAgICB2YXIgc2VsZiA9IHRoaXMsCiAgICAgICAgZWxlbWVudFJlZ2lzdHJ5ID0gdGhpcy5fZWxlbWVudFJlZ2lzdHJ5LAogICAgICAgIHBhcmVudHM7CgogICAgcGFyZW50cyA9IHJlZHVjZShlbGVtZW50cywgZnVuY3Rpb24obWFwLCBlKSB7CgogICAgICBpZiAoZS5wYXJlbnQpIHsKICAgICAgICBtYXBbZS5wYXJlbnQuaWRdID0gZS5wYXJlbnQ7CiAgICAgIH0KCiAgICAgIHJldHVybiBtYXA7CiAgICB9LCB7fSk7CgogICAgLy8gdXBkYXRlIGFsbCBwYXJlbnRzIG9mIGNoYW5nZWQgYW5kIHJlb3JnYW5pemVkIHRoZWlyIGNoaWxkcmVuCiAgICAvLyBpbiB0aGUgY29ycmVjdCBvcmRlciAoYXMgaW5kaWNhdGVkIGluIG91ciBtb2RlbCkKICAgIGZvckVhY2gocGFyZW50cywgZnVuY3Rpb24ocGFyZW50KSB7CgogICAgICB2YXIgY2hpbGRyZW4gPSBwYXJlbnQuY2hpbGRyZW47CgogICAgICBpZiAoIWNoaWxkcmVuKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB2YXIgY2hpbGRHZnggPSBzZWxmLl9nZXRDaGlsZHJlbihwYXJlbnQpOwoKICAgICAgZm9yRWFjaChjaGlsZHJlbi5zbGljZSgpLnJldmVyc2UoKSwgZnVuY3Rpb24oYykgewogICAgICAgIHZhciBnZnggPSBlbGVtZW50UmVnaXN0cnkuZ2V0R3JhcGhpY3MoYyk7CgogICAgICAgIHByZXBlbmRUbyhnZngucGFyZW50Tm9kZSwgY2hpbGRHZngpOwogICAgICB9KTsKICAgIH0pOwogIH07CgogIEdyYXBoaWNzRmFjdG9yeS5wcm90b3R5cGUuZHJhd1NoYXBlID0gZnVuY3Rpb24odmlzdWFsLCBlbGVtZW50KSB7CiAgICB2YXIgZXZlbnRCdXMgPSB0aGlzLl9ldmVudEJ1czsKCiAgICByZXR1cm4gZXZlbnRCdXMuZmlyZSgncmVuZGVyLnNoYXBlJywgeyBnZng6IHZpc3VhbCwgZWxlbWVudDogZWxlbWVudCB9KTsKICB9OwoKICBHcmFwaGljc0ZhY3RvcnkucHJvdG90eXBlLmdldFNoYXBlUGF0aCA9IGZ1bmN0aW9uKGVsZW1lbnQpIHsKICAgIHZhciBldmVudEJ1cyA9IHRoaXMuX2V2ZW50QnVzOwoKICAgIHJldHVybiBldmVudEJ1cy5maXJlKCdyZW5kZXIuZ2V0U2hhcGVQYXRoJywgZWxlbWVudCk7CiAgfTsKCiAgR3JhcGhpY3NGYWN0b3J5LnByb3RvdHlwZS5kcmF3Q29ubmVjdGlvbiA9IGZ1bmN0aW9uKHZpc3VhbCwgZWxlbWVudCkgewogICAgdmFyIGV2ZW50QnVzID0gdGhpcy5fZXZlbnRCdXM7CgogICAgcmV0dXJuIGV2ZW50QnVzLmZpcmUoJ3JlbmRlci5jb25uZWN0aW9uJywgeyBnZng6IHZpc3VhbCwgZWxlbWVudDogZWxlbWVudCB9KTsKICB9OwoKICBHcmFwaGljc0ZhY3RvcnkucHJvdG90eXBlLmdldENvbm5lY3Rpb25QYXRoID0gZnVuY3Rpb24od2F5cG9pbnRzKSB7CiAgICB2YXIgZXZlbnRCdXMgPSB0aGlzLl9ldmVudEJ1czsKCiAgICByZXR1cm4gZXZlbnRCdXMuZmlyZSgncmVuZGVyLmdldENvbm5lY3Rpb25QYXRoJywgd2F5cG9pbnRzKTsKICB9OwoKICBHcmFwaGljc0ZhY3RvcnkucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uKHR5cGUsIGVsZW1lbnQsIGdmeCkgewoKICAgIC8vIGRvIE5PVCB1cGRhdGUgcm9vdCBlbGVtZW50CiAgICBpZiAoIWVsZW1lbnQucGFyZW50KSB7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICB2YXIgdmlzdWFsID0gdGhpcy5fY2xlYXIoZ2Z4KTsKCiAgICAvLyByZWRyYXcKICAgIGlmICh0eXBlID09PSAnc2hhcGUnKSB7CiAgICAgIHRoaXMuZHJhd1NoYXBlKHZpc3VhbCwgZWxlbWVudCk7CgogICAgICAvLyB1cGRhdGUgcG9zaXRpb25pbmcKICAgICAgdHJhbnNsYXRlKGdmeCwgZWxlbWVudC54LCBlbGVtZW50LnkpOwogICAgfSBlbHNlCiAgICBpZiAodHlwZSA9PT0gJ2Nvbm5lY3Rpb24nKSB7CiAgICAgIHRoaXMuZHJhd0Nvbm5lY3Rpb24odmlzdWFsLCBlbGVtZW50KTsKICAgIH0gZWxzZSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigndW5rbm93biB0eXBlOiAnICsgdHlwZSk7CiAgICB9CgogICAgaWYgKGVsZW1lbnQuaGlkZGVuKSB7CiAgICAgIGF0dHIkMShnZngsICdkaXNwbGF5JywgJ25vbmUnKTsKICAgIH0gZWxzZSB7CiAgICAgIGF0dHIkMShnZngsICdkaXNwbGF5JywgJ2Jsb2NrJyk7CiAgICB9CiAgfTsKCiAgR3JhcGhpY3NGYWN0b3J5LnByb3RvdHlwZS5yZW1vdmUgPSBmdW5jdGlvbihlbGVtZW50KSB7CiAgICB2YXIgZ2Z4ID0gdGhpcy5fZWxlbWVudFJlZ2lzdHJ5LmdldEdyYXBoaWNzKGVsZW1lbnQpOwoKICAgIC8vIHJlbW92ZQogICAgcmVtb3ZlJDEoZ2Z4LnBhcmVudE5vZGUpOwogIH07CgoKICAvLyBoZWxwZXJzIC8vLy8vLy8vLy8KCiAgZnVuY3Rpb24gcHJlcGVuZFRvKG5ld05vZGUsIHBhcmVudE5vZGUsIHNpYmxpbmdOb2RlKSB7CiAgICB2YXIgbm9kZSA9IHNpYmxpbmdOb2RlIHx8IHBhcmVudE5vZGUuZmlyc3RDaGlsZDsKCiAgICAvLyBkbyBub3QgcHJlcGVuZCBub2RlIHRvIGl0c2VsZiB0byBwcmV2ZW50IElFIGZyb20gY3Jhc2hpbmcKICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9icG1uLWlvL2JwbW4tanMvaXNzdWVzLzc0NgogICAgaWYgKG5ld05vZGUgPT09IG5vZGUpIHsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIHBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKG5ld05vZGUsIG5vZGUpOwogIH0KCiAgdmFyIENvcmVNb2R1bGUgPSB7CiAgICBfX2RlcGVuZHNfXzogWyBEcmF3TW9kdWxlIF0sCiAgICBfX2luaXRfXzogWyAnY2FudmFzJyBdLAogICAgY2FudmFzOiBbICd0eXBlJywgQ2FudmFzIF0sCiAgICBlbGVtZW50UmVnaXN0cnk6IFsgJ3R5cGUnLCBFbGVtZW50UmVnaXN0cnkgXSwKICAgIGVsZW1lbnRGYWN0b3J5OiBbICd0eXBlJywgRWxlbWVudEZhY3RvcnkgXSwKICAgIGV2ZW50QnVzOiBbICd0eXBlJywgRXZlbnRCdXMgXSwKICAgIGdyYXBoaWNzRmFjdG9yeTogWyAndHlwZScsIEdyYXBoaWNzRmFjdG9yeSBdCiAgfTsKCiAgLyoqCiAgICogQm9vdHN0cmFwIGFuIGluamVjdG9yIGZyb20gYSBsaXN0IG9mIG1vZHVsZXMsIGluc3RhbnRpYXRpbmcgYSBudW1iZXIgb2YgZGVmYXVsdCBjb21wb25lbnRzCiAgICoKICAgKiBAaWdub3JlCiAgICogQHBhcmFtIHtBcnJheTxkaWRpLk1vZHVsZT59IGJvb3RzdHJhcE1vZHVsZXMKICAgKgogICAqIEByZXR1cm4ge2RpZGkuSW5qZWN0b3J9IGEgaW5qZWN0b3IgdG8gdXNlIHRvIGFjY2VzcyB0aGUgY29tcG9uZW50cwogICAqLwogIGZ1bmN0aW9uIGJvb3RzdHJhcChib290c3RyYXBNb2R1bGVzKSB7CgogICAgdmFyIG1vZHVsZXMgPSBbXSwKICAgICAgICBjb21wb25lbnRzID0gW107CgogICAgZnVuY3Rpb24gaGFzTW9kdWxlKG0pIHsKICAgICAgcmV0dXJuIG1vZHVsZXMuaW5kZXhPZihtKSA+PSAwOwogICAgfQoKICAgIGZ1bmN0aW9uIGFkZE1vZHVsZShtKSB7CiAgICAgIG1vZHVsZXMucHVzaChtKTsKICAgIH0KCiAgICBmdW5jdGlvbiB2aXNpdChtKSB7CiAgICAgIGlmIChoYXNNb2R1bGUobSkpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIChtLl9fZGVwZW5kc19fIHx8IFtdKS5mb3JFYWNoKHZpc2l0KTsKCiAgICAgIGlmIChoYXNNb2R1bGUobSkpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGFkZE1vZHVsZShtKTsKCiAgICAgIChtLl9faW5pdF9fIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKGMpIHsKICAgICAgICBjb21wb25lbnRzLnB1c2goYyk7CiAgICAgIH0pOwogICAgfQoKICAgIGJvb3RzdHJhcE1vZHVsZXMuZm9yRWFjaCh2aXNpdCk7CgogICAgdmFyIGluamVjdG9yID0gbmV3IEluamVjdG9yKG1vZHVsZXMpOwoKICAgIGNvbXBvbmVudHMuZm9yRWFjaChmdW5jdGlvbihjKSB7CgogICAgICB0cnkgewoKICAgICAgICAvLyBlYWdlcmx5IHJlc29sdmUgY29tcG9uZW50IChmbiBvciBzdHJpbmcpCiAgICAgICAgaW5qZWN0b3JbdHlwZW9mIGMgPT09ICdzdHJpbmcnID8gJ2dldCcgOiAnaW52b2tlJ10oYyk7CiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gaW5zdGFudGlhdGUgY29tcG9uZW50Jyk7CiAgICAgICAgY29uc29sZS5lcnJvcihlLnN0YWNrKTsKCiAgICAgICAgdGhyb3cgZTsKICAgICAgfQogICAgfSk7CgogICAgcmV0dXJuIGluamVjdG9yOwogIH0KCiAgLyoqCiAgICogQ3JlYXRlcyBhbiBpbmplY3RvciBmcm9tIHBhc3NlZCBvcHRpb25zLgogICAqCiAgICogQGlnbm9yZQogICAqIEBwYXJhbSAge09iamVjdH0gb3B0aW9ucwogICAqIEByZXR1cm4ge2RpZGkuSW5qZWN0b3J9CiAgICovCiAgZnVuY3Rpb24gY3JlYXRlSW5qZWN0b3Iob3B0aW9ucykgewoKICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9OwoKICAgIHZhciBjb25maWdNb2R1bGUgPSB7CiAgICAgICdjb25maWcnOiBbJ3ZhbHVlJywgb3B0aW9uc10KICAgIH07CgogICAgdmFyIG1vZHVsZXMgPSBbIGNvbmZpZ01vZHVsZSwgQ29yZU1vZHVsZSBdLmNvbmNhdChvcHRpb25zLm1vZHVsZXMgfHwgW10pOwoKICAgIHJldHVybiBib290c3RyYXAobW9kdWxlcyk7CiAgfQoKCiAgLyoqCiAgICogVGhlIG1haW4gZGlhZ3JhbS1qcyBlbnRyeSBwb2ludCB0aGF0IGJvb3RzdHJhcHMgdGhlIGRpYWdyYW0gd2l0aCB0aGUgZ2l2ZW4KICAgKiBjb25maWd1cmF0aW9uLgogICAqCiAgICogVG8gcmVnaXN0ZXIgZXh0ZW5zaW9ucyB3aXRoIHRoZSBkaWFncmFtLCBwYXNzIHRoZW0gYXMgQXJyYXk8ZGlkaS5Nb2R1bGU+IHRvIHRoZSBjb25zdHJ1Y3Rvci4KICAgKgogICAqIEBjbGFzcyBkanMuRGlhZ3JhbQogICAqIEBtZW1iZXJPZiBkanMKICAgKiBAY29uc3RydWN0b3IKICAgKgogICAqIEBleGFtcGxlCiAgICoKICAgKiA8Y2FwdGlvbj5DcmVhdGluZyBhIHBsdWctaW4gdGhhdCBsb2dzIHdoZW5ldmVyIGEgc2hhcGUgaXMgYWRkZWQgdG8gdGhlIGNhbnZhcy48L2NhcHRpb24+CiAgICoKICAgKiAvLyBwbHVnLWluIGltcGxlbWVuZW50YXRpb24KICAgKiBmdW5jdGlvbiBNeUxvZ2dpbmdQbHVnaW4oZXZlbnRCdXMpIHsKICAgKiAgIGV2ZW50QnVzLm9uKCdzaGFwZS5hZGRlZCcsIGZ1bmN0aW9uKGV2ZW50KSB7CiAgICogICAgIGNvbnNvbGUubG9nKCdzaGFwZSAnLCBldmVudC5zaGFwZSwgJyB3YXMgYWRkZWQgdG8gdGhlIGRpYWdyYW0nKTsKICAgKiAgIH0pOwogICAqIH0KICAgKgogICAqIC8vIGV4cG9ydCBhcyBtb2R1bGUKICAgKiBleHBvcnQgZGVmYXVsdCB7CiAgICogICBfX2luaXRfXzogWyAnbXlMb2dnaW5nUGx1Z2luJyBdLAogICAqICAgICBteUxvZ2dpbmdQbHVnaW46IFsgJ3R5cGUnLCBNeUxvZ2dpbmdQbHVnaW4gXQogICAqIH07CiAgICoKICAgKgogICAqIC8vIGluc3RhbnRpYXRlIHRoZSBkaWFncmFtIHdpdGggdGhlIG5ldyBwbHVnLWluCiAgICoKICAgKiBpbXBvcnQgTXlMb2dnaW5nTW9kdWxlIGZyb20gJ3BhdGgtdG8tbXktbG9nZ2luZy1wbHVnaW4nOwogICAqCiAgICogdmFyIGRpYWdyYW0gPSBuZXcgRGlhZ3JhbSh7CiAgICogICBtb2R1bGVzOiBbCiAgICogICAgIE15TG9nZ2luZ01vZHVsZQogICAqICAgXQogICAqIH0pOwogICAqCiAgICogZGlhZ3JhbS5pbnZva2UoWyAnY2FudmFzJywgZnVuY3Rpb24oY2FudmFzKSB7CiAgICogICAvLyBhZGQgc2hhcGUgdG8gZHJhd2luZyBjYW52YXMKICAgKiAgIGNhbnZhcy5hZGRTaGFwZSh7IHg6IDEwLCB5OiAxMCB9KTsKICAgKiB9KTsKICAgKgogICAqIC8vICdzaGFwZSAuLi4gd2FzIGFkZGVkIHRvIHRoZSBkaWFncmFtJyBsb2dnZWQgdG8gY29uc29sZQogICAqCiAgICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMKICAgKiBAcGFyYW0ge0FycmF5PGRpZGkuTW9kdWxlPn0gW29wdGlvbnMubW9kdWxlc10gZXh0ZXJuYWwgbW9kdWxlcyB0byBpbnN0YW50aWF0ZSB3aXRoIHRoZSBkaWFncmFtCiAgICogQHBhcmFtIHtkaWRpLkluamVjdG9yfSBbaW5qZWN0b3JdIGFuIChvcHRpb25hbCkgaW5qZWN0b3IgdG8gYm9vdHN0cmFwIHRoZSBkaWFncmFtIHdpdGgKICAgKi8KICBmdW5jdGlvbiBEaWFncmFtKG9wdGlvbnMsIGluamVjdG9yKSB7CgogICAgLy8gY3JlYXRlIGluamVjdG9yIHVubGVzcyBleHBsaWNpdGx5IHNwZWNpZmllZAogICAgdGhpcy5pbmplY3RvciA9IGluamVjdG9yID0gaW5qZWN0b3IgfHwgY3JlYXRlSW5qZWN0b3Iob3B0aW9ucyk7CgogICAgLy8gQVBJCgogICAgLyoqCiAgICAgKiBSZXNvbHZlcyBhIGRpYWdyYW0gc2VydmljZQogICAgICoKICAgICAqIEBtZXRob2QgRGlhZ3JhbSNnZXQKICAgICAqCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gbmFtZSB0aGUgbmFtZSBvZiB0aGUgZGlhZ3JhbSBzZXJ2aWNlIHRvIGJlIHJldHJpZXZlZAogICAgICogQHBhcmFtIHtCb29sZWFufSBbc3RyaWN0PXRydWVdIGlmIGZhbHNlLCByZXNvbHZlIG1pc3Npbmcgc2VydmljZXMgdG8gbnVsbAogICAgICovCiAgICB0aGlzLmdldCA9IGluamVjdG9yLmdldDsKCiAgICAvKioKICAgICAqIEV4ZWN1dGVzIGEgZnVuY3Rpb24gaW50byB3aGljaCBkaWFncmFtIHNlcnZpY2VzIGFyZSBpbmplY3RlZAogICAgICoKICAgICAqIEBtZXRob2QgRGlhZ3JhbSNpbnZva2UKICAgICAqCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufE9iamVjdFtdfSBmbiB0aGUgZnVuY3Rpb24gdG8gcmVzb2x2ZQogICAgICogQHBhcmFtIHtPYmplY3R9IGxvY2FscyBhIG51bWJlciBvZiBsb2NhbHMgdG8gdXNlIHRvIHJlc29sdmUgY2VydGFpbiBkZXBlbmRlbmNpZXMKICAgICAqLwogICAgdGhpcy5pbnZva2UgPSBpbmplY3Rvci5pbnZva2U7CgogICAgLy8gaW5pdAoKICAgIC8vIGluZGljYXRlIHZpYSBldmVudAoKCiAgICAvKioKICAgICAqIEFuIGV2ZW50IGluZGljYXRpbmcgdGhhdCBhbGwgcGx1Zy1pbnMgYXJlIGxvYWRlZC4KICAgICAqCiAgICAgKiBVc2UgdGhpcyBldmVudCB0byBmaXJlIG90aGVyIGV2ZW50cyB0byBpbnRlcmVzdGVkIHBsdWctaW5zCiAgICAgKgogICAgICogQG1lbWJlck9mIERpYWdyYW0KICAgICAqCiAgICAgKiBAZXZlbnQgZGlhZ3JhbS5pbml0CiAgICAgKgogICAgICogQGV4YW1wbGUKICAgICAqCiAgICAgKiBldmVudEJ1cy5vbignZGlhZ3JhbS5pbml0JywgZnVuY3Rpb24oKSB7CiAgICAgKiAgIGV2ZW50QnVzLmZpcmUoJ215LWN1c3RvbS1ldmVudCcsIHsgZm9vOiAnQkFSJyB9KTsKICAgICAqIH0pOwogICAgICoKICAgICAqIEB0eXBlIHtPYmplY3R9CiAgICAgKi8KICAgIHRoaXMuZ2V0KCdldmVudEJ1cycpLmZpcmUoJ2RpYWdyYW0uaW5pdCcpOwogIH0KCgogIC8qKgogICAqIERlc3Ryb3lzIHRoZSBkaWFncmFtCiAgICoKICAgKiBAbWV0aG9kICBEaWFncmFtI2Rlc3Ryb3kKICAgKi8KICBEaWFncmFtLnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24oKSB7CiAgICB0aGlzLmdldCgnZXZlbnRCdXMnKS5maXJlKCdkaWFncmFtLmRlc3Ryb3knKTsKICB9OwoKICAvKioKICAgKiBDbGVhciB0aGUgZGlhZ3JhbSwgcmVtb3ZpbmcgYWxsIGNvbnRlbnRzLgogICAqLwogIERpYWdyYW0ucHJvdG90eXBlLmNsZWFyID0gZnVuY3Rpb24oKSB7CiAgICB0aGlzLmdldCgnZXZlbnRCdXMnKS5maXJlKCdkaWFncmFtLmNsZWFyJyk7CiAgfTsKCiAgLyoqCiAgICogTW9kZGxlIGJhc2UgZWxlbWVudC4KICAgKi8KICBmdW5jdGlvbiBCYXNlJDEoKSB7IH0KCiAgQmFzZSQxLnByb3RvdHlwZS5nZXQgPSBmdW5jdGlvbihuYW1lKSB7CiAgICByZXR1cm4gdGhpcy4kbW9kZWwucHJvcGVydGllcy5nZXQodGhpcywgbmFtZSk7CiAgfTsKCiAgQmFzZSQxLnByb3RvdHlwZS5zZXQgPSBmdW5jdGlvbihuYW1lLCB2YWx1ZSkgewogICAgdGhpcy4kbW9kZWwucHJvcGVydGllcy5zZXQodGhpcywgbmFtZSwgdmFsdWUpOwogIH07CgogIC8qKgogICAqIEEgbW9kZWwgZWxlbWVudCBmYWN0b3J5LgogICAqCiAgICogQHBhcmFtIHtNb2RkbGV9IG1vZGVsCiAgICogQHBhcmFtIHtQcm9wZXJ0aWVzfSBwcm9wZXJ0aWVzCiAgICovCiAgZnVuY3Rpb24gRmFjdG9yeShtb2RlbCwgcHJvcGVydGllcykgewogICAgdGhpcy5tb2RlbCA9IG1vZGVsOwogICAgdGhpcy5wcm9wZXJ0aWVzID0gcHJvcGVydGllczsKICB9CgoKICBGYWN0b3J5LnByb3RvdHlwZS5jcmVhdGVUeXBlID0gZnVuY3Rpb24oZGVzY3JpcHRvcikgewoKICAgIHZhciBtb2RlbCA9IHRoaXMubW9kZWw7CgogICAgdmFyIHByb3BzID0gdGhpcy5wcm9wZXJ0aWVzLAogICAgICAgIHByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoQmFzZSQxLnByb3RvdHlwZSk7CgogICAgLy8gaW5pdGlhbGl6ZSBkZWZhdWx0IHZhbHVlcwogICAgZm9yRWFjaChkZXNjcmlwdG9yLnByb3BlcnRpZXMsIGZ1bmN0aW9uKHApIHsKICAgICAgaWYgKCFwLmlzTWFueSAmJiBwLmRlZmF1bHQgIT09IHVuZGVmaW5lZCkgewogICAgICAgIHByb3RvdHlwZVtwLm5hbWVdID0gcC5kZWZhdWx0OwogICAgICB9CiAgICB9KTsKCiAgICBwcm9wcy5kZWZpbmVNb2RlbChwcm90b3R5cGUsIG1vZGVsKTsKICAgIHByb3BzLmRlZmluZURlc2NyaXB0b3IocHJvdG90eXBlLCBkZXNjcmlwdG9yKTsKCiAgICB2YXIgbmFtZSA9IGRlc2NyaXB0b3IubnMubmFtZTsKCiAgICAvKioKICAgICAqIFRoZSBuZXcgdHlwZSBjb25zdHJ1Y3RvcgogICAgICovCiAgICBmdW5jdGlvbiBNb2RkbGVFbGVtZW50KGF0dHJzKSB7CiAgICAgIHByb3BzLmRlZmluZSh0aGlzLCAnJHR5cGUnLCB7IHZhbHVlOiBuYW1lLCBlbnVtZXJhYmxlOiB0cnVlIH0pOwogICAgICBwcm9wcy5kZWZpbmUodGhpcywgJyRhdHRycycsIHsgdmFsdWU6IHt9IH0pOwogICAgICBwcm9wcy5kZWZpbmUodGhpcywgJyRwYXJlbnQnLCB7IHdyaXRhYmxlOiB0cnVlIH0pOwoKICAgICAgZm9yRWFjaChhdHRycywgYmluZChmdW5jdGlvbih2YWwsIGtleSkgewogICAgICAgIHRoaXMuc2V0KGtleSwgdmFsKTsKICAgICAgfSwgdGhpcykpOwogICAgfQoKICAgIE1vZGRsZUVsZW1lbnQucHJvdG90eXBlID0gcHJvdG90eXBlOwoKICAgIE1vZGRsZUVsZW1lbnQuaGFzVHlwZSA9IHByb3RvdHlwZS4kaW5zdGFuY2VPZiA9IHRoaXMubW9kZWwuaGFzVHlwZTsKCiAgICAvLyBzdGF0aWMgbGlua3MKICAgIHByb3BzLmRlZmluZU1vZGVsKE1vZGRsZUVsZW1lbnQsIG1vZGVsKTsKICAgIHByb3BzLmRlZmluZURlc2NyaXB0b3IoTW9kZGxlRWxlbWVudCwgZGVzY3JpcHRvcik7CgogICAgcmV0dXJuIE1vZGRsZUVsZW1lbnQ7CiAgfTsKCiAgLyoqCiAgICogQnVpbHQtaW4gbW9kZGxlIHR5cGVzCiAgICovCiAgdmFyIEJVSUxUSU5TID0gewogICAgU3RyaW5nOiB0cnVlLAogICAgQm9vbGVhbjogdHJ1ZSwKICAgIEludGVnZXI6IHRydWUsCiAgICBSZWFsOiB0cnVlLAogICAgRWxlbWVudDogdHJ1ZQogIH07CgogIC8qKgogICAqIENvbnZlcnRlcnMgZm9yIGJ1aWx0IGluIHR5cGVzIGZyb20gc3RyaW5nIHJlcHJlc2VudGF0aW9ucwogICAqLwogIHZhciBUWVBFX0NPTlZFUlRFUlMgPSB7CiAgICBTdHJpbmc6IGZ1bmN0aW9uKHMpIHsgcmV0dXJuIHM7IH0sCiAgICBCb29sZWFuOiBmdW5jdGlvbihzKSB7IHJldHVybiBzID09PSAndHJ1ZSc7IH0sCiAgICBJbnRlZ2VyOiBmdW5jdGlvbihzKSB7IHJldHVybiBwYXJzZUludChzLCAxMCk7IH0sCiAgICBSZWFsOiBmdW5jdGlvbihzKSB7IHJldHVybiBwYXJzZUZsb2F0KHMsIDEwKTsgfQogIH07CgogIC8qKgogICAqIENvbnZlcnQgYSB0eXBlIHRvIGl0cyByZWFsIHJlcHJlc2VudGF0aW9uCiAgICovCiAgZnVuY3Rpb24gY29lcmNlVHlwZSh0eXBlLCB2YWx1ZSkgewoKICAgIHZhciBjb252ZXJ0ZXIgPSBUWVBFX0NPTlZFUlRFUlNbdHlwZV07CgogICAgaWYgKGNvbnZlcnRlcikgewogICAgICByZXR1cm4gY29udmVydGVyKHZhbHVlKTsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiB2YWx1ZTsKICAgIH0KICB9CgogIC8qKgogICAqIFJldHVybiB3aGV0aGVyIHRoZSBnaXZlbiB0eXBlIGlzIGJ1aWx0LWluCiAgICovCiAgZnVuY3Rpb24gaXNCdWlsdEluKHR5cGUpIHsKICAgIHJldHVybiAhIUJVSUxUSU5TW3R5cGVdOwogIH0KCiAgLyoqCiAgICogUmV0dXJuIHdoZXRoZXIgdGhlIGdpdmVuIHR5cGUgaXMgc2ltcGxlCiAgICovCiAgZnVuY3Rpb24gaXNTaW1wbGUodHlwZSkgewogICAgcmV0dXJuICEhVFlQRV9DT05WRVJURVJTW3R5cGVdOwogIH0KCiAgLyoqCiAgICogUGFyc2VzIGEgbmFtZXNwYWNlZCBhdHRyaWJ1dGUgbmFtZSBvZiB0aGUgZm9ybSAobnM6KWxvY2FsTmFtZSB0byBhbiBvYmplY3QsCiAgICogZ2l2ZW4gYSBkZWZhdWx0IHByZWZpeCB0byBhc3N1bWUgaW4gY2FzZSBubyBleHBsaWNpdCBuYW1lc3BhY2UgaXMgZ2l2ZW4uCiAgICoKICAgKiBAcGFyYW0ge1N0cmluZ30gbmFtZQogICAqIEBwYXJhbSB7U3RyaW5nfSBbZGVmYXVsdFByZWZpeF0gdGhlIGRlZmF1bHQgcHJlZml4IHRvIHRha2UsIGlmIG5vbmUgaXMgcHJlc2VudC4KICAgKgogICAqIEByZXR1cm4ge09iamVjdH0gdGhlIHBhcnNlZCBuYW1lCiAgICovCiAgZnVuY3Rpb24gcGFyc2VOYW1lKG5hbWUsIGRlZmF1bHRQcmVmaXgpIHsKICAgIHZhciBwYXJ0cyA9IG5hbWUuc3BsaXQoLzovKSwKICAgICAgICBsb2NhbE5hbWUsIHByZWZpeDsKCiAgICAvLyBubyBwcmVmaXggKGkuZS4gb25seSBsb2NhbCBuYW1lKQogICAgaWYgKHBhcnRzLmxlbmd0aCA9PT0gMSkgewogICAgICBsb2NhbE5hbWUgPSBuYW1lOwogICAgICBwcmVmaXggPSBkZWZhdWx0UHJlZml4OwogICAgfSBlbHNlCiAgICAvLyBwcmVmaXggKyBsb2NhbCBuYW1lCiAgICBpZiAocGFydHMubGVuZ3RoID09PSAyKSB7CiAgICAgIGxvY2FsTmFtZSA9IHBhcnRzWzFdOwogICAgICBwcmVmaXggPSBwYXJ0c1swXTsKICAgIH0gZWxzZSB7CiAgICAgIHRocm93IG5ldyBFcnJvcignZXhwZWN0ZWQgPHByZWZpeDpsb2NhbE5hbWU+IG9yIDxsb2NhbE5hbWU+LCBnb3QgJyArIG5hbWUpOwogICAgfQoKICAgIG5hbWUgPSAocHJlZml4ID8gcHJlZml4ICsgJzonIDogJycpICsgbG9jYWxOYW1lOwoKICAgIHJldHVybiB7CiAgICAgIG5hbWU6IG5hbWUsCiAgICAgIHByZWZpeDogcHJlZml4LAogICAgICBsb2NhbE5hbWU6IGxvY2FsTmFtZQogICAgfTsKICB9CgogIC8qKgogICAqIEEgdXRpbGl0eSB0byBidWlsZCBlbGVtZW50IGRlc2NyaXB0b3JzLgogICAqLwogIGZ1bmN0aW9uIERlc2NyaXB0b3JCdWlsZGVyKG5hbWVOcykgewogICAgdGhpcy5ucyA9IG5hbWVOczsKICAgIHRoaXMubmFtZSA9IG5hbWVOcy5uYW1lOwogICAgdGhpcy5hbGxUeXBlcyA9IFtdOwogICAgdGhpcy5hbGxUeXBlc0J5TmFtZSA9IHt9OwogICAgdGhpcy5wcm9wZXJ0aWVzID0gW107CiAgICB0aGlzLnByb3BlcnRpZXNCeU5hbWUgPSB7fTsKICB9CgoKICBEZXNjcmlwdG9yQnVpbGRlci5wcm90b3R5cGUuYnVpbGQgPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiBwaWNrKHRoaXMsIFsKICAgICAgJ25zJywKICAgICAgJ25hbWUnLAogICAgICAnYWxsVHlwZXMnLAogICAgICAnYWxsVHlwZXNCeU5hbWUnLAogICAgICAncHJvcGVydGllcycsCiAgICAgICdwcm9wZXJ0aWVzQnlOYW1lJywKICAgICAgJ2JvZHlQcm9wZXJ0eScsCiAgICAgICdpZFByb3BlcnR5JwogICAgXSk7CiAgfTsKCiAgLyoqCiAgICogQWRkIHByb3BlcnR5IGF0IGdpdmVuIGluZGV4LgogICAqCiAgICogQHBhcmFtIHtPYmplY3R9IHAKICAgKiBAcGFyYW0ge051bWJlcn0gW2lkeF0KICAgKiBAcGFyYW0ge0Jvb2xlYW59IFt2YWxpZGF0ZT10cnVlXQogICAqLwogIERlc2NyaXB0b3JCdWlsZGVyLnByb3RvdHlwZS5hZGRQcm9wZXJ0eSA9IGZ1bmN0aW9uKHAsIGlkeCwgdmFsaWRhdGUpIHsKCiAgICBpZiAodHlwZW9mIGlkeCA9PT0gJ2Jvb2xlYW4nKSB7CiAgICAgIHZhbGlkYXRlID0gaWR4OwogICAgICBpZHggPSB1bmRlZmluZWQ7CiAgICB9CgogICAgdGhpcy5hZGROYW1lZFByb3BlcnR5KHAsIHZhbGlkYXRlICE9PSBmYWxzZSk7CgogICAgdmFyIHByb3BlcnRpZXMgPSB0aGlzLnByb3BlcnRpZXM7CgogICAgaWYgKGlkeCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIHByb3BlcnRpZXMuc3BsaWNlKGlkeCwgMCwgcCk7CiAgICB9IGVsc2UgewogICAgICBwcm9wZXJ0aWVzLnB1c2gocCk7CiAgICB9CiAgfTsKCgogIERlc2NyaXB0b3JCdWlsZGVyLnByb3RvdHlwZS5yZXBsYWNlUHJvcGVydHkgPSBmdW5jdGlvbihvbGRQcm9wZXJ0eSwgbmV3UHJvcGVydHksIHJlcGxhY2UpIHsKICAgIHZhciBvbGROYW1lTnMgPSBvbGRQcm9wZXJ0eS5uczsKCiAgICB2YXIgcHJvcHMgPSB0aGlzLnByb3BlcnRpZXMsCiAgICAgICAgcHJvcGVydGllc0J5TmFtZSA9IHRoaXMucHJvcGVydGllc0J5TmFtZSwKICAgICAgICByZW5hbWUgPSBvbGRQcm9wZXJ0eS5uYW1lICE9PSBuZXdQcm9wZXJ0eS5uYW1lOwoKICAgIGlmIChvbGRQcm9wZXJ0eS5pc0lkKSB7CiAgICAgIGlmICghbmV3UHJvcGVydHkuaXNJZCkgewogICAgICAgIHRocm93IG5ldyBFcnJvcigKICAgICAgICAgICdwcm9wZXJ0eSA8JyArIG5ld1Byb3BlcnR5Lm5zLm5hbWUgKyAnPiBtdXN0IGJlIGlkIHByb3BlcnR5ICcgKwogICAgICAgICAgJ3RvIHJlZmluZSA8JyArIG9sZFByb3BlcnR5Lm5zLm5hbWUgKyAnPicpOwogICAgICB9CgogICAgICB0aGlzLnNldElkUHJvcGVydHkobmV3UHJvcGVydHksIGZhbHNlKTsKICAgIH0KCiAgICBpZiAob2xkUHJvcGVydHkuaXNCb2R5KSB7CgogICAgICBpZiAoIW5ld1Byb3BlcnR5LmlzQm9keSkgewogICAgICAgIHRocm93IG5ldyBFcnJvcigKICAgICAgICAgICdwcm9wZXJ0eSA8JyArIG5ld1Byb3BlcnR5Lm5zLm5hbWUgKyAnPiBtdXN0IGJlIGJvZHkgcHJvcGVydHkgJyArCiAgICAgICAgICAndG8gcmVmaW5lIDwnICsgb2xkUHJvcGVydHkubnMubmFtZSArICc+Jyk7CiAgICAgIH0KCiAgICAgIC8vIFRPRE86IENoZWNrIGNvbXBhdGliaWxpdHkKICAgICAgdGhpcy5zZXRCb2R5UHJvcGVydHkobmV3UHJvcGVydHksIGZhbHNlKTsKICAgIH0KCiAgICAvLyB2YWxpZGF0ZSBleGlzdGVuY2UgYW5kIGdldCBsb2NhdGlvbiBvZiBvbGQgcHJvcGVydHkKICAgIHZhciBpZHggPSBwcm9wcy5pbmRleE9mKG9sZFByb3BlcnR5KTsKICAgIGlmIChpZHggPT09IC0xKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigncHJvcGVydHkgPCcgKyBvbGROYW1lTnMubmFtZSArICc+IG5vdCBmb3VuZCBpbiBwcm9wZXJ0eSBsaXN0Jyk7CiAgICB9CgogICAgLy8gcmVtb3ZlIG9sZCBwcm9wZXJ0eQogICAgcHJvcHMuc3BsaWNlKGlkeCwgMSk7CgogICAgLy8gcmVwbGFjaW5nIHRoZSBuYW1lZCBwcm9wZXJ0eSBpcyBpbnRlbnRpb25hbAogICAgLy8KICAgIC8vICAqIHZhbGlkYXRlIG9ubHkgaWYgdGhpcyBpcyBhICJyZW5hbWUiIG9wZXJhdGlvbgogICAgLy8gICogYWRkIGF0IHNwZWNpZmljIGluZGV4IHVubGVzcyB3ZSAicmVwbGFjZSIKICAgIC8vCiAgICB0aGlzLmFkZFByb3BlcnR5KG5ld1Byb3BlcnR5LCByZXBsYWNlID8gdW5kZWZpbmVkIDogaWR4LCByZW5hbWUpOwoKICAgIC8vIG1ha2UgbmV3IHByb3BlcnR5IGF2YWlsYWJsZSB1bmRlciBvbGQgbmFtZQogICAgcHJvcGVydGllc0J5TmFtZVtvbGROYW1lTnMubmFtZV0gPSBwcm9wZXJ0aWVzQnlOYW1lW29sZE5hbWVOcy5sb2NhbE5hbWVdID0gbmV3UHJvcGVydHk7CiAgfTsKCgogIERlc2NyaXB0b3JCdWlsZGVyLnByb3RvdHlwZS5yZWRlZmluZVByb3BlcnR5ID0gZnVuY3Rpb24ocCwgdGFyZ2V0UHJvcGVydHlOYW1lLCByZXBsYWNlKSB7CgogICAgdmFyIG5zUHJlZml4ID0gcC5ucy5wcmVmaXg7CiAgICB2YXIgcGFydHMgPSB0YXJnZXRQcm9wZXJ0eU5hbWUuc3BsaXQoJyMnKTsKCiAgICB2YXIgbmFtZSA9IHBhcnNlTmFtZShwYXJ0c1swXSwgbnNQcmVmaXgpOwogICAgdmFyIGF0dHJOYW1lID0gcGFyc2VOYW1lKHBhcnRzWzFdLCBuYW1lLnByZWZpeCkubmFtZTsKCiAgICB2YXIgcmVkZWZpbmVkUHJvcGVydHkgPSB0aGlzLnByb3BlcnRpZXNCeU5hbWVbYXR0ck5hbWVdOwogICAgaWYgKCFyZWRlZmluZWRQcm9wZXJ0eSkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ3JlZmluZWQgcHJvcGVydHkgPCcgKyBhdHRyTmFtZSArICc+IG5vdCBmb3VuZCcpOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5yZXBsYWNlUHJvcGVydHkocmVkZWZpbmVkUHJvcGVydHksIHAsIHJlcGxhY2UpOwogICAgfQoKICAgIGRlbGV0ZSBwLnJlZGVmaW5lczsKICB9OwoKICBEZXNjcmlwdG9yQnVpbGRlci5wcm90b3R5cGUuYWRkTmFtZWRQcm9wZXJ0eSA9IGZ1bmN0aW9uKHAsIHZhbGlkYXRlKSB7CiAgICB2YXIgbnMgPSBwLm5zLAogICAgICAgIHByb3BzQnlOYW1lID0gdGhpcy5wcm9wZXJ0aWVzQnlOYW1lOwoKICAgIGlmICh2YWxpZGF0ZSkgewogICAgICB0aGlzLmFzc2VydE5vdERlZmluZWQocCwgbnMubmFtZSk7CiAgICAgIHRoaXMuYXNzZXJ0Tm90RGVmaW5lZChwLCBucy5sb2NhbE5hbWUpOwogICAgfQoKICAgIHByb3BzQnlOYW1lW25zLm5hbWVdID0gcHJvcHNCeU5hbWVbbnMubG9jYWxOYW1lXSA9IHA7CiAgfTsKCiAgRGVzY3JpcHRvckJ1aWxkZXIucHJvdG90eXBlLnJlbW92ZU5hbWVkUHJvcGVydHkgPSBmdW5jdGlvbihwKSB7CiAgICB2YXIgbnMgPSBwLm5zLAogICAgICAgIHByb3BzQnlOYW1lID0gdGhpcy5wcm9wZXJ0aWVzQnlOYW1lOwoKICAgIGRlbGV0ZSBwcm9wc0J5TmFtZVtucy5uYW1lXTsKICAgIGRlbGV0ZSBwcm9wc0J5TmFtZVtucy5sb2NhbE5hbWVdOwogIH07CgogIERlc2NyaXB0b3JCdWlsZGVyLnByb3RvdHlwZS5zZXRCb2R5UHJvcGVydHkgPSBmdW5jdGlvbihwLCB2YWxpZGF0ZSkgewoKICAgIGlmICh2YWxpZGF0ZSAmJiB0aGlzLmJvZHlQcm9wZXJ0eSkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoCiAgICAgICAgJ2JvZHkgcHJvcGVydHkgZGVmaW5lZCBtdWx0aXBsZSB0aW1lcyAnICsKICAgICAgICAnKDwnICsgdGhpcy5ib2R5UHJvcGVydHkubnMubmFtZSArICc+LCA8JyArIHAubnMubmFtZSArICc+KScpOwogICAgfQoKICAgIHRoaXMuYm9keVByb3BlcnR5ID0gcDsKICB9OwoKICBEZXNjcmlwdG9yQnVpbGRlci5wcm90b3R5cGUuc2V0SWRQcm9wZXJ0eSA9IGZ1bmN0aW9uKHAsIHZhbGlkYXRlKSB7CgogICAgaWYgKHZhbGlkYXRlICYmIHRoaXMuaWRQcm9wZXJ0eSkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoCiAgICAgICAgJ2lkIHByb3BlcnR5IGRlZmluZWQgbXVsdGlwbGUgdGltZXMgJyArCiAgICAgICAgJyg8JyArIHRoaXMuaWRQcm9wZXJ0eS5ucy5uYW1lICsgJz4sIDwnICsgcC5ucy5uYW1lICsgJz4pJyk7CiAgICB9CgogICAgdGhpcy5pZFByb3BlcnR5ID0gcDsKICB9OwoKICBEZXNjcmlwdG9yQnVpbGRlci5wcm90b3R5cGUuYXNzZXJ0Tm90RGVmaW5lZCA9IGZ1bmN0aW9uKHAsIG5hbWUpIHsKICAgIHZhciBwcm9wZXJ0eU5hbWUgPSBwLm5hbWUsCiAgICAgICAgZGVmaW5lZFByb3BlcnR5ID0gdGhpcy5wcm9wZXJ0aWVzQnlOYW1lW3Byb3BlcnR5TmFtZV07CgogICAgaWYgKGRlZmluZWRQcm9wZXJ0eSkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoCiAgICAgICAgJ3Byb3BlcnR5IDwnICsgcHJvcGVydHlOYW1lICsgJz4gYWxyZWFkeSBkZWZpbmVkOyAnICsKICAgICAgICAnb3ZlcnJpZGUgb2YgPCcgKyBkZWZpbmVkUHJvcGVydHkuZGVmaW5lZEJ5Lm5zLm5hbWUgKyAnIycgKyBkZWZpbmVkUHJvcGVydHkubnMubmFtZSArICc+IGJ5ICcgKwogICAgICAgICc8JyArIHAuZGVmaW5lZEJ5Lm5zLm5hbWUgKyAnIycgKyBwLm5zLm5hbWUgKyAnPiBub3QgYWxsb3dlZCB3aXRob3V0IHJlZGVmaW5lcycpOwogICAgfQogIH07CgogIERlc2NyaXB0b3JCdWlsZGVyLnByb3RvdHlwZS5oYXNQcm9wZXJ0eSA9IGZ1bmN0aW9uKG5hbWUpIHsKICAgIHJldHVybiB0aGlzLnByb3BlcnRpZXNCeU5hbWVbbmFtZV07CiAgfTsKCiAgRGVzY3JpcHRvckJ1aWxkZXIucHJvdG90eXBlLmFkZFRyYWl0ID0gZnVuY3Rpb24odCwgaW5oZXJpdGVkKSB7CgogICAgdmFyIHR5cGVzQnlOYW1lID0gdGhpcy5hbGxUeXBlc0J5TmFtZSwKICAgICAgICB0eXBlcyA9IHRoaXMuYWxsVHlwZXM7CgogICAgdmFyIHR5cGVOYW1lID0gdC5uYW1lOwoKICAgIGlmICh0eXBlTmFtZSBpbiB0eXBlc0J5TmFtZSkgewogICAgICByZXR1cm47CiAgICB9CgogICAgZm9yRWFjaCh0LnByb3BlcnRpZXMsIGJpbmQoZnVuY3Rpb24ocCkgewoKICAgICAgLy8gY2xvbmUgcHJvcGVydHkgdG8gYWxsb3cgZXh0ZW5zaW9ucwogICAgICBwID0gYXNzaWduKHt9LCBwLCB7CiAgICAgICAgbmFtZTogcC5ucy5sb2NhbE5hbWUsCiAgICAgICAgaW5oZXJpdGVkOiBpbmhlcml0ZWQKICAgICAgfSk7CgogICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkocCwgJ2RlZmluZWRCeScsIHsKICAgICAgICB2YWx1ZTogdAogICAgICB9KTsKCiAgICAgIHZhciByZXBsYWNlcyA9IHAucmVwbGFjZXMsCiAgICAgICAgICByZWRlZmluZXMgPSBwLnJlZGVmaW5lczsKCiAgICAgIC8vIGFkZCByZXBsYWNlL3JlZGVmaW5lIHN1cHBvcnQKICAgICAgaWYgKHJlcGxhY2VzIHx8IHJlZGVmaW5lcykgewogICAgICAgIHRoaXMucmVkZWZpbmVQcm9wZXJ0eShwLCByZXBsYWNlcyB8fCByZWRlZmluZXMsIHJlcGxhY2VzKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAocC5pc0JvZHkpIHsKICAgICAgICAgIHRoaXMuc2V0Qm9keVByb3BlcnR5KHApOwogICAgICAgIH0KICAgICAgICBpZiAocC5pc0lkKSB7CiAgICAgICAgICB0aGlzLnNldElkUHJvcGVydHkocCk7CiAgICAgICAgfQogICAgICAgIHRoaXMuYWRkUHJvcGVydHkocCk7CiAgICAgIH0KICAgIH0sIHRoaXMpKTsKCiAgICB0eXBlcy5wdXNoKHQpOwogICAgdHlwZXNCeU5hbWVbdHlwZU5hbWVdID0gdDsKICB9OwoKICAvKioKICAgKiBBIHJlZ2lzdHJ5IG9mIE1vZGRsZSBwYWNrYWdlcy4KICAgKgogICAqIEBwYXJhbSB7QXJyYXk8UGFja2FnZT59IHBhY2thZ2VzCiAgICogQHBhcmFtIHtQcm9wZXJ0aWVzfSBwcm9wZXJ0aWVzCiAgICovCiAgZnVuY3Rpb24gUmVnaXN0cnkocGFja2FnZXMsIHByb3BlcnRpZXMpIHsKICAgIHRoaXMucGFja2FnZU1hcCA9IHt9OwogICAgdGhpcy50eXBlTWFwID0ge307CgogICAgdGhpcy5wYWNrYWdlcyA9IFtdOwoKICAgIHRoaXMucHJvcGVydGllcyA9IHByb3BlcnRpZXM7CgogICAgZm9yRWFjaChwYWNrYWdlcywgYmluZCh0aGlzLnJlZ2lzdGVyUGFja2FnZSwgdGhpcykpOwogIH0KCgogIFJlZ2lzdHJ5LnByb3RvdHlwZS5nZXRQYWNrYWdlID0gZnVuY3Rpb24odXJpT3JQcmVmaXgpIHsKICAgIHJldHVybiB0aGlzLnBhY2thZ2VNYXBbdXJpT3JQcmVmaXhdOwogIH07CgogIFJlZ2lzdHJ5LnByb3RvdHlwZS5nZXRQYWNrYWdlcyA9IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIHRoaXMucGFja2FnZXM7CiAgfTsKCgogIFJlZ2lzdHJ5LnByb3RvdHlwZS5yZWdpc3RlclBhY2thZ2UgPSBmdW5jdGlvbihwa2cpIHsKCiAgICAvLyBjb3B5IHBhY2thZ2UKICAgIHBrZyA9IGFzc2lnbih7fSwgcGtnKTsKCiAgICB2YXIgcGtnTWFwID0gdGhpcy5wYWNrYWdlTWFwOwoKICAgIGVuc3VyZUF2YWlsYWJsZShwa2dNYXAsIHBrZywgJ3ByZWZpeCcpOwogICAgZW5zdXJlQXZhaWxhYmxlKHBrZ01hcCwgcGtnLCAndXJpJyk7CgogICAgLy8gcmVnaXN0ZXIgdHlwZXMKICAgIGZvckVhY2gocGtnLnR5cGVzLCBiaW5kKGZ1bmN0aW9uKGRlc2NyaXB0b3IpIHsKICAgICAgdGhpcy5yZWdpc3RlclR5cGUoZGVzY3JpcHRvciwgcGtnKTsKICAgIH0sIHRoaXMpKTsKCiAgICBwa2dNYXBbcGtnLnVyaV0gPSBwa2dNYXBbcGtnLnByZWZpeF0gPSBwa2c7CiAgICB0aGlzLnBhY2thZ2VzLnB1c2gocGtnKTsKICB9OwoKCiAgLyoqCiAgICogUmVnaXN0ZXIgYSB0eXBlIGZyb20gYSBzcGVjaWZpYyBwYWNrYWdlIHdpdGggdXMKICAgKi8KICBSZWdpc3RyeS5wcm90b3R5cGUucmVnaXN0ZXJUeXBlID0gZnVuY3Rpb24odHlwZSwgcGtnKSB7CgogICAgdHlwZSA9IGFzc2lnbih7fSwgdHlwZSwgewogICAgICBzdXBlckNsYXNzOiAodHlwZS5zdXBlckNsYXNzIHx8IFtdKS5zbGljZSgpLAogICAgICBleHRlbmRzOiAodHlwZS5leHRlbmRzIHx8IFtdKS5zbGljZSgpLAogICAgICBwcm9wZXJ0aWVzOiAodHlwZS5wcm9wZXJ0aWVzIHx8IFtdKS5zbGljZSgpLAogICAgICBtZXRhOiBhc3NpZ24oKHR5cGUubWV0YSB8fCB7fSkpCiAgICB9KTsKCiAgICB2YXIgbnMgPSBwYXJzZU5hbWUodHlwZS5uYW1lLCBwa2cucHJlZml4KSwKICAgICAgICBuYW1lID0gbnMubmFtZSwKICAgICAgICBwcm9wZXJ0aWVzQnlOYW1lID0ge307CgogICAgLy8gcGFyc2UgcHJvcGVydGllcwogICAgZm9yRWFjaCh0eXBlLnByb3BlcnRpZXMsIGJpbmQoZnVuY3Rpb24ocCkgewoKICAgICAgLy8gbmFtZXNwYWNlIHByb3BlcnR5IG5hbWVzCiAgICAgIHZhciBwcm9wZXJ0eU5zID0gcGFyc2VOYW1lKHAubmFtZSwgbnMucHJlZml4KSwKICAgICAgICAgIHByb3BlcnR5TmFtZSA9IHByb3BlcnR5TnMubmFtZTsKCiAgICAgIC8vIG5hbWVzcGFjZSBwcm9wZXJ0eSB0eXBlcwogICAgICBpZiAoIWlzQnVpbHRJbihwLnR5cGUpKSB7CiAgICAgICAgcC50eXBlID0gcGFyc2VOYW1lKHAudHlwZSwgcHJvcGVydHlOcy5wcmVmaXgpLm5hbWU7CiAgICAgIH0KCiAgICAgIGFzc2lnbihwLCB7CiAgICAgICAgbnM6IHByb3BlcnR5TnMsCiAgICAgICAgbmFtZTogcHJvcGVydHlOYW1lCiAgICAgIH0pOwoKICAgICAgcHJvcGVydGllc0J5TmFtZVtwcm9wZXJ0eU5hbWVdID0gcDsKICAgIH0sIHRoaXMpKTsKCiAgICAvLyB1cGRhdGUgbnMgKyBuYW1lCiAgICBhc3NpZ24odHlwZSwgewogICAgICBuczogbnMsCiAgICAgIG5hbWU6IG5hbWUsCiAgICAgIHByb3BlcnRpZXNCeU5hbWU6IHByb3BlcnRpZXNCeU5hbWUKICAgIH0pOwoKICAgIGZvckVhY2godHlwZS5leHRlbmRzLCBiaW5kKGZ1bmN0aW9uKGV4dGVuZHNOYW1lKSB7CiAgICAgIHZhciBleHRlbmRlZCA9IHRoaXMudHlwZU1hcFtleHRlbmRzTmFtZV07CgogICAgICBleHRlbmRlZC50cmFpdHMgPSBleHRlbmRlZC50cmFpdHMgfHwgW107CiAgICAgIGV4dGVuZGVkLnRyYWl0cy5wdXNoKG5hbWUpOwogICAgfSwgdGhpcykpOwoKICAgIC8vIGxpbmsgdG8gcGFja2FnZQogICAgdGhpcy5kZWZpbmVQYWNrYWdlKHR5cGUsIHBrZyk7CgogICAgLy8gcmVnaXN0ZXIKICAgIHRoaXMudHlwZU1hcFtuYW1lXSA9IHR5cGU7CiAgfTsKCgogIC8qKgogICAqIFRyYXZlcnNlIHRoZSB0eXBlIGhpZXJhcmNoeSBmcm9tIGJvdHRvbSB0byB0b3AsCiAgICogY2FsbGluZyBpdGVyYXRvciB3aXRoICh0eXBlLCBpbmhlcml0ZWQpIGZvciBhbGwgZWxlbWVudHMgaW4KICAgKiB0aGUgaW5oZXJpdGFuY2UgY2hhaW4uCiAgICoKICAgKiBAcGFyYW0ge09iamVjdH0gbnNOYW1lCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gaXRlcmF0b3IKICAgKiBAcGFyYW0ge0Jvb2xlYW59IFt0cmFpdD1mYWxzZV0KICAgKi8KICBSZWdpc3RyeS5wcm90b3R5cGUubWFwVHlwZXMgPSBmdW5jdGlvbihuc05hbWUsIGl0ZXJhdG9yLCB0cmFpdCkgewoKICAgIHZhciB0eXBlID0gaXNCdWlsdEluKG5zTmFtZS5uYW1lKSA/IHsgbmFtZTogbnNOYW1lLm5hbWUgfSA6IHRoaXMudHlwZU1hcFtuc05hbWUubmFtZV07CgogICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgIC8qKgogICAgICogVHJhdmVyc2UgdGhlIHNlbGVjdGVkIHRyYWl0LgogICAgICoKICAgICAqIEBwYXJhbSB7U3RyaW5nfSBjbHMKICAgICAqLwogICAgZnVuY3Rpb24gdHJhdmVyc2VUcmFpdChjbHMpIHsKICAgICAgcmV0dXJuIHRyYXZlcnNlU3VwZXIoY2xzLCB0cnVlKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRyYXZlcnNlIHRoZSBzZWxlY3RlZCBzdXBlciB0eXBlIG9yIHRyYWl0CiAgICAgKgogICAgICogQHBhcmFtIHtTdHJpbmd9IGNscwogICAgICogQHBhcmFtIHtCb29sZWFufSBbdHJhaXQ9ZmFsc2VdCiAgICAgKi8KICAgIGZ1bmN0aW9uIHRyYXZlcnNlU3VwZXIoY2xzLCB0cmFpdCkgewogICAgICB2YXIgcGFyZW50TnMgPSBwYXJzZU5hbWUoY2xzLCBpc0J1aWx0SW4oY2xzKSA/ICcnIDogbnNOYW1lLnByZWZpeCk7CiAgICAgIHNlbGYubWFwVHlwZXMocGFyZW50TnMsIGl0ZXJhdG9yLCB0cmFpdCk7CiAgICB9CgogICAgaWYgKCF0eXBlKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigndW5rbm93biB0eXBlIDwnICsgbnNOYW1lLm5hbWUgKyAnPicpOwogICAgfQoKICAgIGZvckVhY2godHlwZS5zdXBlckNsYXNzLCB0cmFpdCA/IHRyYXZlcnNlVHJhaXQgOiB0cmF2ZXJzZVN1cGVyKTsKCiAgICAvLyBjYWxsIGl0ZXJhdG9yIHdpdGggKHR5cGUsIGluaGVyaXRlZD0hdHJhaXQpCiAgICBpdGVyYXRvcih0eXBlLCAhdHJhaXQpOwoKICAgIGZvckVhY2godHlwZS50cmFpdHMsIHRyYXZlcnNlVHJhaXQpOwogIH07CgoKICAvKioKICAgKiBSZXR1cm5zIHRoZSBlZmZlY3RpdmUgZGVzY3JpcHRvciBmb3IgYSB0eXBlLgogICAqCiAgICogQHBhcmFtICB7U3RyaW5nfSB0eXBlIHRoZSBuYW1lc3BhY2VkIG5hbWUgKG5zOmxvY2FsTmFtZSkgb2YgdGhlIHR5cGUKICAgKgogICAqIEByZXR1cm4ge0Rlc2NyaXB0b3J9IHRoZSByZXN1bHRpbmcgZWZmZWN0aXZlIGRlc2NyaXB0b3IKICAgKi8KICBSZWdpc3RyeS5wcm90b3R5cGUuZ2V0RWZmZWN0aXZlRGVzY3JpcHRvciA9IGZ1bmN0aW9uKG5hbWUpIHsKCiAgICB2YXIgbnNOYW1lID0gcGFyc2VOYW1lKG5hbWUpOwoKICAgIHZhciBidWlsZGVyID0gbmV3IERlc2NyaXB0b3JCdWlsZGVyKG5zTmFtZSk7CgogICAgdGhpcy5tYXBUeXBlcyhuc05hbWUsIGZ1bmN0aW9uKHR5cGUsIGluaGVyaXRlZCkgewogICAgICBidWlsZGVyLmFkZFRyYWl0KHR5cGUsIGluaGVyaXRlZCk7CiAgICB9KTsKCiAgICB2YXIgZGVzY3JpcHRvciA9IGJ1aWxkZXIuYnVpbGQoKTsKCiAgICAvLyBkZWZpbmUgcGFja2FnZSBsaW5rCiAgICB0aGlzLmRlZmluZVBhY2thZ2UoZGVzY3JpcHRvciwgZGVzY3JpcHRvci5hbGxUeXBlc1tkZXNjcmlwdG9yLmFsbFR5cGVzLmxlbmd0aCAtIDFdLiRwa2cpOwoKICAgIHJldHVybiBkZXNjcmlwdG9yOwogIH07CgoKICBSZWdpc3RyeS5wcm90b3R5cGUuZGVmaW5lUGFja2FnZSA9IGZ1bmN0aW9uKHRhcmdldCwgcGtnKSB7CiAgICB0aGlzLnByb3BlcnRpZXMuZGVmaW5lKHRhcmdldCwgJyRwa2cnLCB7IHZhbHVlOiBwa2cgfSk7CiAgfTsKCgoKICAvLy8vLy8vLy8gaGVscGVycyAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogIGZ1bmN0aW9uIGVuc3VyZUF2YWlsYWJsZShwYWNrYWdlTWFwLCBwa2csIGlkZW50aWZpZXJLZXkpIHsKCiAgICB2YXIgdmFsdWUgPSBwa2dbaWRlbnRpZmllcktleV07CgogICAgaWYgKHZhbHVlIGluIHBhY2thZ2VNYXApIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdwYWNrYWdlIHdpdGggJyArIGlkZW50aWZpZXJLZXkgKyAnIDwnICsgdmFsdWUgKyAnPiBhbHJlYWR5IGRlZmluZWQnKTsKICAgIH0KICB9CgogIC8qKgogICAqIEEgdXRpbGl0eSB0aGF0IGdldHMgYW5kIHNldHMgcHJvcGVydGllcyBvZiBtb2RlbCBlbGVtZW50cy4KICAgKgogICAqIEBwYXJhbSB7TW9kZWx9IG1vZGVsCiAgICovCiAgZnVuY3Rpb24gUHJvcGVydGllcyhtb2RlbCkgewogICAgdGhpcy5tb2RlbCA9IG1vZGVsOwogIH0KCgogIC8qKgogICAqIFNldHMgYSBuYW1lZCBwcm9wZXJ0eSBvbiB0aGUgdGFyZ2V0IGVsZW1lbnQuCiAgICogSWYgdGhlIHZhbHVlIGlzIHVuZGVmaW5lZCwgdGhlIHByb3BlcnR5IGdldHMgZGVsZXRlZC4KICAgKgogICAqIEBwYXJhbSB7T2JqZWN0fSB0YXJnZXQKICAgKiBAcGFyYW0ge1N0cmluZ30gbmFtZQogICAqIEBwYXJhbSB7T2JqZWN0fSB2YWx1ZQogICAqLwogIFByb3BlcnRpZXMucHJvdG90eXBlLnNldCA9IGZ1bmN0aW9uKHRhcmdldCwgbmFtZSwgdmFsdWUpIHsKCiAgICB2YXIgcHJvcGVydHkgPSB0aGlzLm1vZGVsLmdldFByb3BlcnR5RGVzY3JpcHRvcih0YXJnZXQsIG5hbWUpOwoKICAgIHZhciBwcm9wZXJ0eU5hbWUgPSBwcm9wZXJ0eSAmJiBwcm9wZXJ0eS5uYW1lOwoKICAgIGlmIChpc1VuZGVmaW5lZCQxKHZhbHVlKSkgewogICAgICAvLyB1bnNldCB0aGUgcHJvcGVydHksIGlmIHRoZSBzcGVjaWZpZWQgdmFsdWUgaXMgdW5kZWZpbmVkOwogICAgICAvLyBkZWxldGUgZnJvbSAkYXR0cnMgKGZvciBleHRlbnNpb25zKSBvciB0aGUgdGFyZ2V0IGl0c2VsZgogICAgICBpZiAocHJvcGVydHkpIHsKICAgICAgICBkZWxldGUgdGFyZ2V0W3Byb3BlcnR5TmFtZV07CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZGVsZXRlIHRhcmdldC4kYXR0cnNbbmFtZV07CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIC8vIHNldCB0aGUgcHJvcGVydHksIGRlZmluaW5nIHdlbGwgZGVmaW5lZCBwcm9wZXJ0aWVzIG9uIHRoZSBmbHkKICAgICAgLy8gb3Igc2ltcGx5IHVwZGF0aW5nIHRoZW0gaW4gdGFyZ2V0LiRhdHRycyAoZm9yIGV4dGVuc2lvbnMpCiAgICAgIGlmIChwcm9wZXJ0eSkgewogICAgICAgIGlmIChwcm9wZXJ0eU5hbWUgaW4gdGFyZ2V0KSB7CiAgICAgICAgICB0YXJnZXRbcHJvcGVydHlOYW1lXSA9IHZhbHVlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBkZWZpbmVQcm9wZXJ0eSQxKHRhcmdldCwgcHJvcGVydHksIHZhbHVlKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGFyZ2V0LiRhdHRyc1tuYW1lXSA9IHZhbHVlOwogICAgICB9CiAgICB9CiAgfTsKCiAgLyoqCiAgICogUmV0dXJucyB0aGUgbmFtZWQgcHJvcGVydHkgb2YgdGhlIGdpdmVuIGVsZW1lbnQKICAgKgogICAqIEBwYXJhbSAge09iamVjdH0gdGFyZ2V0CiAgICogQHBhcmFtICB7U3RyaW5nfSBuYW1lCiAgICoKICAgKiBAcmV0dXJuIHtPYmplY3R9CiAgICovCiAgUHJvcGVydGllcy5wcm90b3R5cGUuZ2V0ID0gZnVuY3Rpb24odGFyZ2V0LCBuYW1lKSB7CgogICAgdmFyIHByb3BlcnR5ID0gdGhpcy5tb2RlbC5nZXRQcm9wZXJ0eURlc2NyaXB0b3IodGFyZ2V0LCBuYW1lKTsKCiAgICBpZiAoIXByb3BlcnR5KSB7CiAgICAgIHJldHVybiB0YXJnZXQuJGF0dHJzW25hbWVdOwogICAgfQoKICAgIHZhciBwcm9wZXJ0eU5hbWUgPSBwcm9wZXJ0eS5uYW1lOwoKICAgIC8vIGNoZWNrIGlmIGFjY2VzcyB0byBjb2xsZWN0aW9uIHByb3BlcnR5IGFuZCBsYXppbHkgaW5pdGlhbGl6ZSBpdAogICAgaWYgKCF0YXJnZXRbcHJvcGVydHlOYW1lXSAmJiBwcm9wZXJ0eS5pc01hbnkpIHsKICAgICAgZGVmaW5lUHJvcGVydHkkMSh0YXJnZXQsIHByb3BlcnR5LCBbXSk7CiAgICB9CgogICAgcmV0dXJuIHRhcmdldFtwcm9wZXJ0eU5hbWVdOwogIH07CgoKICAvKioKICAgKiBEZWZpbmUgYSBwcm9wZXJ0eSBvbiB0aGUgdGFyZ2V0IGVsZW1lbnQKICAgKgogICAqIEBwYXJhbSAge09iamVjdH0gdGFyZ2V0CiAgICogQHBhcmFtICB7U3RyaW5nfSBuYW1lCiAgICogQHBhcmFtICB7T2JqZWN0fSBvcHRpb25zCiAgICovCiAgUHJvcGVydGllcy5wcm90b3R5cGUuZGVmaW5lID0gZnVuY3Rpb24odGFyZ2V0LCBuYW1lLCBvcHRpb25zKSB7CiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBuYW1lLCBvcHRpb25zKTsKICB9OwoKCiAgLyoqCiAgICogRGVmaW5lIHRoZSBkZXNjcmlwdG9yIGZvciBhbiBlbGVtZW50CiAgICovCiAgUHJvcGVydGllcy5wcm90b3R5cGUuZGVmaW5lRGVzY3JpcHRvciA9IGZ1bmN0aW9uKHRhcmdldCwgZGVzY3JpcHRvcikgewogICAgdGhpcy5kZWZpbmUodGFyZ2V0LCAnJGRlc2NyaXB0b3InLCB7IHZhbHVlOiBkZXNjcmlwdG9yIH0pOwogIH07CgogIC8qKgogICAqIERlZmluZSB0aGUgbW9kZWwgZm9yIGFuIGVsZW1lbnQKICAgKi8KICBQcm9wZXJ0aWVzLnByb3RvdHlwZS5kZWZpbmVNb2RlbCA9IGZ1bmN0aW9uKHRhcmdldCwgbW9kZWwpIHsKICAgIHRoaXMuZGVmaW5lKHRhcmdldCwgJyRtb2RlbCcsIHsgdmFsdWU6IG1vZGVsIH0pOwogIH07CgoKICBmdW5jdGlvbiBpc1VuZGVmaW5lZCQxKHZhbCkgewogICAgcmV0dXJuIHR5cGVvZiB2YWwgPT09ICd1bmRlZmluZWQnOwogIH0KCiAgZnVuY3Rpb24gZGVmaW5lUHJvcGVydHkkMSh0YXJnZXQsIHByb3BlcnR5LCB2YWx1ZSkgewogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgcHJvcGVydHkubmFtZSwgewogICAgICBlbnVtZXJhYmxlOiAhcHJvcGVydHkuaXNSZWZlcmVuY2UsCiAgICAgIHdyaXRhYmxlOiB0cnVlLAogICAgICB2YWx1ZTogdmFsdWUsCiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogICAgfSk7CiAgfQoKICAvLy8vIE1vZGRsZSBpbXBsZW1lbnRhdGlvbiAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogIC8qKgogICAqIEBjbGFzcyBNb2RkbGUKICAgKgogICAqIEEgbW9kZWwgdGhhdCBjYW4gYmUgdXNlZCB0byBjcmVhdGUgZWxlbWVudHMgb2YgYSBzcGVjaWZpYyB0eXBlLgogICAqCiAgICogQGV4YW1wbGUKICAgKgogICAqIHZhciBNb2RkbGUgPSByZXF1aXJlKCdtb2RkbGUnKTsKICAgKgogICAqIHZhciBwa2cgPSB7CiAgICogICBuYW1lOiAnbXlwYWNrYWdlJywKICAgKiAgIHByZWZpeDogJ215JywKICAgKiAgIHR5cGVzOiBbCiAgICogICAgIHsgbmFtZTogJ1Jvb3QnIH0KICAgKiAgIF0KICAgKiB9OwogICAqCiAgICogdmFyIG1vZGRsZSA9IG5ldyBNb2RkbGUoW3BrZ10pOwogICAqCiAgICogQHBhcmFtIHtBcnJheTxQYWNrYWdlPn0gcGFja2FnZXMgdGhlIHBhY2thZ2VzIHRvIGNvbnRhaW4KICAgKi8KICBmdW5jdGlvbiBNb2RkbGUocGFja2FnZXMpIHsKCiAgICB0aGlzLnByb3BlcnRpZXMgPSBuZXcgUHJvcGVydGllcyh0aGlzKTsKCiAgICB0aGlzLmZhY3RvcnkgPSBuZXcgRmFjdG9yeSh0aGlzLCB0aGlzLnByb3BlcnRpZXMpOwogICAgdGhpcy5yZWdpc3RyeSA9IG5ldyBSZWdpc3RyeShwYWNrYWdlcywgdGhpcy5wcm9wZXJ0aWVzKTsKCiAgICB0aGlzLnR5cGVDYWNoZSA9IHt9OwogIH0KCgogIC8qKgogICAqIENyZWF0ZSBhbiBpbnN0YW5jZSBvZiB0aGUgc3BlY2lmaWVkIHR5cGUuCiAgICoKICAgKiBAbWV0aG9kIE1vZGRsZSNjcmVhdGUKICAgKgogICAqIEBleGFtcGxlCiAgICoKICAgKiB2YXIgZm9vID0gbW9kZGxlLmNyZWF0ZSgnbXk6Rm9vJyk7CiAgICogdmFyIGJhciA9IG1vZGRsZS5jcmVhdGUoJ215OkJhcicsIHsgaWQ6ICdCQVJfMScgfSk7CiAgICoKICAgKiBAcGFyYW0gIHtTdHJpbmd8T2JqZWN0fSBkZXNjcmlwdG9yIHRoZSB0eXBlIGRlc2NyaXB0b3Igb3IgbmFtZSBrbm93IHRvIHRoZSBtb2RlbAogICAqIEBwYXJhbSAge09iamVjdH0gYXR0cnMgICBhIG51bWJlciBvZiBhdHRyaWJ1dGVzIHRvIGluaXRpYWxpemUgdGhlIG1vZGVsIGluc3RhbmNlIHdpdGgKICAgKiBAcmV0dXJuIHtPYmplY3R9ICAgICAgICAgbW9kZWwgaW5zdGFuY2UKICAgKi8KICBNb2RkbGUucHJvdG90eXBlLmNyZWF0ZSA9IGZ1bmN0aW9uKGRlc2NyaXB0b3IsIGF0dHJzKSB7CiAgICB2YXIgVHlwZSA9IHRoaXMuZ2V0VHlwZShkZXNjcmlwdG9yKTsKCiAgICBpZiAoIVR5cGUpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCd1bmtub3duIHR5cGUgPCcgKyBkZXNjcmlwdG9yICsgJz4nKTsKICAgIH0KCiAgICByZXR1cm4gbmV3IFR5cGUoYXR0cnMpOwogIH07CgoKICAvKioKICAgKiBSZXR1cm5zIHRoZSB0eXBlIHJlcHJlc2VudGluZyBhIGdpdmVuIGRlc2NyaXB0b3IKICAgKgogICAqIEBtZXRob2QgTW9kZGxlI2dldFR5cGUKICAgKgogICAqIEBleGFtcGxlCiAgICoKICAgKiB2YXIgRm9vID0gbW9kZGxlLmdldFR5cGUoJ215OkZvbycpOwogICAqIHZhciBmb28gPSBuZXcgRm9vKHsgJ2lkJyA6ICdGT09fMScgfSk7CiAgICoKICAgKiBAcGFyYW0gIHtTdHJpbmd8T2JqZWN0fSBkZXNjcmlwdG9yIHRoZSB0eXBlIGRlc2NyaXB0b3Igb3IgbmFtZSBrbm93IHRvIHRoZSBtb2RlbAogICAqIEByZXR1cm4ge09iamVjdH0gICAgICAgICB0aGUgdHlwZSByZXByZXNlbnRpbmcgdGhlIGRlc2NyaXB0b3IKICAgKi8KICBNb2RkbGUucHJvdG90eXBlLmdldFR5cGUgPSBmdW5jdGlvbihkZXNjcmlwdG9yKSB7CgogICAgdmFyIGNhY2hlID0gdGhpcy50eXBlQ2FjaGU7CgogICAgdmFyIG5hbWUgPSBpc1N0cmluZyhkZXNjcmlwdG9yKSA/IGRlc2NyaXB0b3IgOiBkZXNjcmlwdG9yLm5zLm5hbWU7CgogICAgdmFyIHR5cGUgPSBjYWNoZVtuYW1lXTsKCiAgICBpZiAoIXR5cGUpIHsKICAgICAgZGVzY3JpcHRvciA9IHRoaXMucmVnaXN0cnkuZ2V0RWZmZWN0aXZlRGVzY3JpcHRvcihuYW1lKTsKICAgICAgdHlwZSA9IGNhY2hlW25hbWVdID0gdGhpcy5mYWN0b3J5LmNyZWF0ZVR5cGUoZGVzY3JpcHRvcik7CiAgICB9CgogICAgcmV0dXJuIHR5cGU7CiAgfTsKCgogIC8qKgogICAqIENyZWF0ZXMgYW4gYW55LWVsZW1lbnQgdHlwZSB0byBiZSB1c2VkIHdpdGhpbiBtb2RlbCBpbnN0YW5jZXMuCiAgICoKICAgKiBUaGlzIGNhbiBiZSB1c2VkIHRvIGNyZWF0ZSBjdXN0b20gZWxlbWVudHMgdGhhdCBsaWUgb3V0c2lkZSB0aGUgbWV0YS1tb2RlbC4KICAgKiBUaGUgY3JlYXRlZCBlbGVtZW50IGNvbnRhaW5zIGFsbCB0aGUgbWV0YS1kYXRhIHJlcXVpcmVkIHRvIHNlcmlhbGl6ZSBpdAogICAqIGFzIHBhcnQgb2YgbWV0YS1tb2RlbCBlbGVtZW50cy4KICAgKgogICAqIEBtZXRob2QgTW9kZGxlI2NyZWF0ZUFueQogICAqCiAgICogQGV4YW1wbGUKICAgKgogICAqIHZhciBmb28gPSBtb2RkbGUuY3JlYXRlQW55KCd2ZW5kb3I6Rm9vJywgJ2h0dHA6Ly92ZW5kb3InLCB7CiAgICogICB2YWx1ZTogJ2JhcicKICAgKiB9KTsKICAgKgogICAqIHZhciBjb250YWluZXIgPSBtb2RkbGUuY3JlYXRlKCdteTpDb250YWluZXInLCAnaHR0cDovL215JywgewogICAqICAgYW55OiBbIGZvbyBdCiAgICogfSk7CiAgICoKICAgKiAvLyBnbyBhaGVhZCBhbmQgc2VyaWFsaXplIHRoZSBzdHVmZgogICAqCiAgICoKICAgKiBAcGFyYW0gIHtTdHJpbmd9IG5hbWUgIHRoZSBuYW1lIG9mIHRoZSBlbGVtZW50CiAgICogQHBhcmFtICB7U3RyaW5nfSBuc1VyaSB0aGUgbmFtZXNwYWNlIHVyaSBvZiB0aGUgZWxlbWVudAogICAqIEBwYXJhbSAge09iamVjdH0gW3Byb3BlcnRpZXNdIGEgbWFwIG9mIHByb3BlcnRpZXMgdG8gaW5pdGlhbGl6ZSB0aGUgaW5zdGFuY2Ugd2l0aAogICAqIEByZXR1cm4ge09iamVjdH0gdGhlIGFueSB0eXBlIGluc3RhbmNlCiAgICovCiAgTW9kZGxlLnByb3RvdHlwZS5jcmVhdGVBbnkgPSBmdW5jdGlvbihuYW1lLCBuc1VyaSwgcHJvcGVydGllcykgewoKICAgIHZhciBuYW1lTnMgPSBwYXJzZU5hbWUobmFtZSk7CgogICAgdmFyIGVsZW1lbnQgPSB7CiAgICAgICR0eXBlOiBuYW1lLAogICAgICAkaW5zdGFuY2VPZjogZnVuY3Rpb24odHlwZSkgewogICAgICAgIHJldHVybiB0eXBlID09PSB0aGlzLiR0eXBlOwogICAgICB9CiAgICB9OwoKICAgIHZhciBkZXNjcmlwdG9yID0gewogICAgICBuYW1lOiBuYW1lLAogICAgICBpc0dlbmVyaWM6IHRydWUsCiAgICAgIG5zOiB7CiAgICAgICAgcHJlZml4OiBuYW1lTnMucHJlZml4LAogICAgICAgIGxvY2FsTmFtZTogbmFtZU5zLmxvY2FsTmFtZSwKICAgICAgICB1cmk6IG5zVXJpCiAgICAgIH0KICAgIH07CgogICAgdGhpcy5wcm9wZXJ0aWVzLmRlZmluZURlc2NyaXB0b3IoZWxlbWVudCwgZGVzY3JpcHRvcik7CiAgICB0aGlzLnByb3BlcnRpZXMuZGVmaW5lTW9kZWwoZWxlbWVudCwgdGhpcyk7CiAgICB0aGlzLnByb3BlcnRpZXMuZGVmaW5lKGVsZW1lbnQsICckcGFyZW50JywgeyBlbnVtZXJhYmxlOiBmYWxzZSwgd3JpdGFibGU6IHRydWUgfSk7CgogICAgZm9yRWFjaChwcm9wZXJ0aWVzLCBmdW5jdGlvbihhLCBrZXkpIHsKICAgICAgaWYgKGlzT2JqZWN0KGEpICYmIGEudmFsdWUgIT09IHVuZGVmaW5lZCkgewogICAgICAgIGVsZW1lbnRbYS5uYW1lXSA9IGEudmFsdWU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZWxlbWVudFtrZXldID0gYTsKICAgICAgfQogICAgfSk7CgogICAgcmV0dXJuIGVsZW1lbnQ7CiAgfTsKCiAgLyoqCiAgICogUmV0dXJucyBhIHJlZ2lzdGVyZWQgcGFja2FnZSBieSB1cmkgb3IgcHJlZml4CiAgICoKICAgKiBAcmV0dXJuIHtPYmplY3R9IHRoZSBwYWNrYWdlCiAgICovCiAgTW9kZGxlLnByb3RvdHlwZS5nZXRQYWNrYWdlID0gZnVuY3Rpb24odXJpT3JQcmVmaXgpIHsKICAgIHJldHVybiB0aGlzLnJlZ2lzdHJ5LmdldFBhY2thZ2UodXJpT3JQcmVmaXgpOwogIH07CgogIC8qKgogICAqIFJldHVybnMgYSBzbmFwc2hvdCBvZiBhbGwga25vd24gcGFja2FnZXMKICAgKgogICAqIEByZXR1cm4ge09iamVjdH0gdGhlIHBhY2thZ2UKICAgKi8KICBNb2RkbGUucHJvdG90eXBlLmdldFBhY2thZ2VzID0gZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gdGhpcy5yZWdpc3RyeS5nZXRQYWNrYWdlcygpOwogIH07CgogIC8qKgogICAqIFJldHVybnMgdGhlIGRlc2NyaXB0b3IgZm9yIGFuIGVsZW1lbnQKICAgKi8KICBNb2RkbGUucHJvdG90eXBlLmdldEVsZW1lbnREZXNjcmlwdG9yID0gZnVuY3Rpb24oZWxlbWVudCkgewogICAgcmV0dXJuIGVsZW1lbnQuJGRlc2NyaXB0b3I7CiAgfTsKCiAgLyoqCiAgICogUmV0dXJucyB0cnVlIGlmIHRoZSBnaXZlbiBkZXNjcmlwdG9yIG9yIGluc3RhbmNlCiAgICogcmVwcmVzZW50cyB0aGUgZ2l2ZW4gdHlwZS4KICAgKgogICAqIE1heSBiZSBhcHBsaWVkIHRvIHRoaXMsIGlmIGVsZW1lbnQgaXMgb21pdHRlZC4KICAgKi8KICBNb2RkbGUucHJvdG90eXBlLmhhc1R5cGUgPSBmdW5jdGlvbihlbGVtZW50LCB0eXBlKSB7CiAgICBpZiAodHlwZSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgIHR5cGUgPSBlbGVtZW50OwogICAgICBlbGVtZW50ID0gdGhpczsKICAgIH0KCiAgICB2YXIgZGVzY3JpcHRvciA9IGVsZW1lbnQuJG1vZGVsLmdldEVsZW1lbnREZXNjcmlwdG9yKGVsZW1lbnQpOwoKICAgIHJldHVybiAodHlwZSBpbiBkZXNjcmlwdG9yLmFsbFR5cGVzQnlOYW1lKTsKICB9OwoKICAvKioKICAgKiBSZXR1cm5zIHRoZSBkZXNjcmlwdG9yIG9mIGFuIGVsZW1lbnRzIG5hbWVkIHByb3BlcnR5CiAgICovCiAgTW9kZGxlLnByb3RvdHlwZS5nZXRQcm9wZXJ0eURlc2NyaXB0b3IgPSBmdW5jdGlvbihlbGVtZW50LCBwcm9wZXJ0eSkgewogICAgcmV0dXJuIHRoaXMuZ2V0RWxlbWVudERlc2NyaXB0b3IoZWxlbWVudCkucHJvcGVydGllc0J5TmFtZVtwcm9wZXJ0eV07CiAgfTsKCiAgLyoqCiAgICogUmV0dXJucyBhIG1hcHBlZCB0eXBlJ3MgZGVzY3JpcHRvcgogICAqLwogIE1vZGRsZS5wcm90b3R5cGUuZ2V0VHlwZURlc2NyaXB0b3IgPSBmdW5jdGlvbih0eXBlKSB7CiAgICByZXR1cm4gdGhpcy5yZWdpc3RyeS50eXBlTWFwW3R5cGVdOwogIH07CgogIHZhciBmcm9tQ2hhckNvZGUgPSBTdHJpbmcuZnJvbUNoYXJDb2RlOwoKICB2YXIgaGFzT3duUHJvcGVydHkkMSA9IE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHk7CgogIHZhciBFTlRJVFlfUEFUVEVSTiA9IC8mIyhcZCspO3wmI3goWzAtOWEtZl0rKTt8JihcdyspOy9pZzsKCiAgdmFyIEVOVElUWV9NQVBQSU5HID0gewogICAgJ2FtcCc6ICcmJywKICAgICdhcG9zJzogJ1wnJywKICAgICdndCc6ICc+JywKICAgICdsdCc6ICc8JywKICAgICdxdW90JzogJyInCiAgfTsKCiAgLy8gbWFwIFVQUEVSQ0FTRSB2YXJpYW50cyBvZiBzdXBwb3J0ZWQgc3BlY2lhbCBjaGFycwogIE9iamVjdC5rZXlzKEVOVElUWV9NQVBQSU5HKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHsKICAgIEVOVElUWV9NQVBQSU5HW2sudG9VcHBlckNhc2UoKV0gPSBFTlRJVFlfTUFQUElOR1trXTsKICB9KTsKCgogIGZ1bmN0aW9uIHJlcGxhY2VFbnRpdGllcyhfLCBkLCB4LCB6KSB7CgogICAgLy8gcmVzZXJ2ZWQgbmFtZXMsIGkuZS4gJm5ic3A7CiAgICBpZiAoeikgewogICAgICBpZiAoaGFzT3duUHJvcGVydHkkMS5jYWxsKEVOVElUWV9NQVBQSU5HLCB6KSkgewogICAgICAgIHJldHVybiBFTlRJVFlfTUFQUElOR1t6XTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBmYWxsIGJhY2sgdG8gb3JpZ2luYWwgdmFsdWUKICAgICAgICByZXR1cm4gJyYnICsgeiArICc7JzsKICAgICAgfQogICAgfQoKICAgIC8vIGRlY2ltYWwgZW5jb2RlZCBjaGFyCiAgICBpZiAoZCkgewogICAgICByZXR1cm4gZnJvbUNoYXJDb2RlKGQpOwogICAgfQoKICAgIC8vIGhleCBlbmNvZGVkIGNoYXIKICAgIHJldHVybiBmcm9tQ2hhckNvZGUocGFyc2VJbnQoeCwgMTYpKTsKICB9CgoKICAvKioKICAgKiBBIGJhc2ljIGVudGl0eSBkZWNvZGVyIHRoYXQgY2FuIGRlY29kZSBhIG1pbmltYWwKICAgKiBzdWItc2V0IG9mIHJlc2VydmVkIG5hbWVzICgmYW1wOykgYXMgd2VsbCBhcwogICAqIGhleCAoJiN4YWFmOykgYW5kIGRlY2ltYWwgKCYjMTIzMTspIGVuY29kZWQgY2hhcmFjdGVycy4KICAgKgogICAqIEBwYXJhbSB7c3RyaW5nfSBzdHIKICAgKgogICAqIEByZXR1cm4ge3N0cmluZ30gZGVjb2RlZCBzdHJpbmcKICAgKi8KICBmdW5jdGlvbiBkZWNvZGVFbnRpdGllcyhzKSB7CiAgICBpZiAocy5sZW5ndGggPiAzICYmIHMuaW5kZXhPZignJicpICE9PSAtMSkgewogICAgICByZXR1cm4gcy5yZXBsYWNlKEVOVElUWV9QQVRURVJOLCByZXBsYWNlRW50aXRpZXMpOwogICAgfQoKICAgIHJldHVybiBzOwogIH0KCiAgdmFyIFhTSV9VUkkgPSAnaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2UnOwogIHZhciBYU0lfUFJFRklYID0gJ3hzaSc7CiAgdmFyIFhTSV9UWVBFID0gJ3hzaTp0eXBlJzsKCiAgdmFyIE5PTl9XSElURVNQQUNFX09VVFNJREVfUk9PVF9OT0RFID0gJ25vbi13aGl0ZXNwYWNlIG91dHNpZGUgb2Ygcm9vdCBub2RlJzsKCiAgZnVuY3Rpb24gZXJyb3IobXNnKSB7CiAgICByZXR1cm4gbmV3IEVycm9yKG1zZyk7CiAgfQoKICBmdW5jdGlvbiBtaXNzaW5nTmFtZXNwYWNlRm9yUHJlZml4KHByZWZpeCkgewogICAgcmV0dXJuICdtaXNzaW5nIG5hbWVzcGFjZSBmb3IgcHJlZml4IDwnICsgcHJlZml4ICsgJz4nOwogIH0KCiAgZnVuY3Rpb24gZ2V0dGVyKGdldEZuKSB7CiAgICByZXR1cm4gewogICAgICAnZ2V0JzogZ2V0Rm4sCiAgICAgICdlbnVtZXJhYmxlJzogdHJ1ZQogICAgfTsKICB9CgogIGZ1bmN0aW9uIGNsb25lTnNNYXRyaXgobnNNYXRyaXgpIHsKICAgIHZhciBjbG9uZSA9IHt9LCBrZXk7CiAgICBmb3IgKGtleSBpbiBuc01hdHJpeCkgewogICAgICBjbG9uZVtrZXldID0gbnNNYXRyaXhba2V5XTsKICAgIH0KICAgIHJldHVybiBjbG9uZTsKICB9CgogIGZ1bmN0aW9uIHVyaVByZWZpeChwcmVmaXgpIHsKICAgIHJldHVybiBwcmVmaXggKyAnJHVyaSc7CiAgfQoKICBmdW5jdGlvbiBidWlsZE5zTWF0cml4KG5zVXJpVG9QcmVmaXgpIHsKICAgIHZhciBuc01hdHJpeCA9IHt9LAogICAgICAgIHVyaSwKICAgICAgICBwcmVmaXg7CgogICAgZm9yICh1cmkgaW4gbnNVcmlUb1ByZWZpeCkgewogICAgICBwcmVmaXggPSBuc1VyaVRvUHJlZml4W3VyaV07CiAgICAgIG5zTWF0cml4W3ByZWZpeF0gPSBwcmVmaXg7CiAgICAgIG5zTWF0cml4W3VyaVByZWZpeChwcmVmaXgpXSA9IHVyaTsKICAgIH0KCiAgICByZXR1cm4gbnNNYXRyaXg7CiAgfQoKICBmdW5jdGlvbiBub29wR2V0Q29udGV4dCgpIHsKICAgIHJldHVybiB7ICdsaW5lJzogMCwgJ2NvbHVtbic6IDAgfTsKICB9CgogIGZ1bmN0aW9uIHRocm93RnVuYyhlcnIpIHsKICAgIHRocm93IGVycjsKICB9CgogIC8qKgogICAqIENyZWF0ZXMgYSBuZXcgcGFyc2VyIHdpdGggdGhlIGdpdmVuIG9wdGlvbnMuCiAgICoKICAgKiBAY29uc3RydWN0b3IKICAgKgogICAqIEBwYXJhbSAgeyFPYmplY3Q8c3RyaW5nLCA/Pj19IG9wdGlvbnMKICAgKi8KICBmdW5jdGlvbiBQYXJzZXIob3B0aW9ucykgewoKICAgIGlmICghdGhpcykgewogICAgICByZXR1cm4gbmV3IFBhcnNlcihvcHRpb25zKTsKICAgIH0KCiAgICB2YXIgcHJveHkgPSBvcHRpb25zICYmIG9wdGlvbnNbJ3Byb3h5J107CgogICAgdmFyIG9uVGV4dCwKICAgICAgICBvbk9wZW5UYWcsCiAgICAgICAgb25DbG9zZVRhZywKICAgICAgICBvbkNEQVRBLAogICAgICAgIG9uRXJyb3IgPSB0aHJvd0Z1bmMsCiAgICAgICAgb25XYXJuaW5nLAogICAgICAgIG9uQ29tbWVudCwKICAgICAgICBvblF1ZXN0aW9uLAogICAgICAgIG9uQXR0ZW50aW9uOwoKICAgIHZhciBnZXRDb250ZXh0ID0gbm9vcEdldENvbnRleHQ7CgogICAgLyoqCiAgICAgKiBEbyB3ZSBuZWVkIHRvIHBhcnNlIHRoZSBjdXJyZW50IGVsZW1lbnRzIGF0dHJpYnV0ZXMgZm9yIG5hbWVzcGFjZXM/CiAgICAgKgogICAgICogQHR5cGUge2Jvb2xlYW59CiAgICAgKi8KICAgIHZhciBtYXliZU5TID0gZmFsc2U7CgogICAgLyoqCiAgICAgKiBEbyB3ZSBwcm9jZXNzIG5hbWVzcGFjZXMgYXQgYWxsPwogICAgICoKICAgICAqIEB0eXBlIHtib29sZWFufQogICAgICovCiAgICB2YXIgaXNOYW1lc3BhY2UgPSBmYWxzZTsKCiAgICAvKioKICAgICAqIFRoZSBjYXVnaHQgZXJyb3IgcmV0dXJuZWQgb24gcGFyc2UgZW5kCiAgICAgKgogICAgICogQHR5cGUge0Vycm9yfQogICAgICovCiAgICB2YXIgcmV0dXJuRXJyb3IgPSBudWxsOwoKICAgIC8qKgogICAgICogU2hvdWxkIHdlIHN0b3AgcGFyc2luZz8KICAgICAqCiAgICAgKiBAdHlwZSB7Ym9vbGVhbn0KICAgICAqLwogICAgdmFyIHBhcnNlU3RvcCA9IGZhbHNlOwoKICAgIC8qKgogICAgICogQSBtYXAgb2YgeyB1cmk6IHByZWZpeCB9IHVzZWQgYnkgdGhlIHBhcnNlci4KICAgICAqCiAgICAgKiBUaGlzIG1hcCB3aWxsIGVuc3VyZSB3ZSBjYW4gbm9ybWFsaXplIHByZWZpeGVzIGR1cmluZyBwcm9jZXNzaW5nOwogICAgICogZm9yIGVhY2ggdXJpLCBvbmx5IG9uZSBwcmVmaXggd2lsbCBiZSBleHBvc2VkIHRvIHRoZSBoYW5kbGVycy4KICAgICAqCiAgICAgKiBAdHlwZSB7IU9iamVjdDxzdHJpbmcsIHN0cmluZz59fQogICAgICovCiAgICB2YXIgbnNVcmlUb1ByZWZpeDsKCiAgICAvKioKICAgICAqIEhhbmRsZSBwYXJzZSBlcnJvci4KICAgICAqCiAgICAgKiBAcGFyYW0gIHtzdHJpbmd8RXJyb3J9IGVycgogICAgICovCiAgICBmdW5jdGlvbiBoYW5kbGVFcnJvcihlcnIpIHsKICAgICAgaWYgKCEoZXJyIGluc3RhbmNlb2YgRXJyb3IpKSB7CiAgICAgICAgZXJyID0gZXJyb3IoZXJyKTsKICAgICAgfQoKICAgICAgcmV0dXJuRXJyb3IgPSBlcnI7CgogICAgICBvbkVycm9yKGVyciwgZ2V0Q29udGV4dCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBIYW5kbGUgcGFyc2UgZXJyb3IuCiAgICAgKgogICAgICogQHBhcmFtICB7c3RyaW5nfEVycm9yfSBlcnIKICAgICAqLwogICAgZnVuY3Rpb24gaGFuZGxlV2FybmluZyhlcnIpIHsKCiAgICAgIGlmICghb25XYXJuaW5nKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAoIShlcnIgaW5zdGFuY2VvZiBFcnJvcikpIHsKICAgICAgICBlcnIgPSBlcnJvcihlcnIpOwogICAgICB9CgogICAgICBvbldhcm5pbmcoZXJyLCBnZXRDb250ZXh0KTsKICAgIH0KCiAgICAvKioKICAgICAqIFJlZ2lzdGVyIHBhcnNlIGxpc3RlbmVyLgogICAgICoKICAgICAqIEBwYXJhbSAge3N0cmluZ30gICBuYW1lCiAgICAgKiBAcGFyYW0gIHtGdW5jdGlvbn0gY2IKICAgICAqCiAgICAgKiBAcmV0dXJuIHtQYXJzZXJ9CiAgICAgKi8KICAgIHRoaXNbJ29uJ10gPSBmdW5jdGlvbihuYW1lLCBjYikgewoKICAgICAgaWYgKHR5cGVvZiBjYiAhPT0gJ2Z1bmN0aW9uJykgewogICAgICAgIHRocm93IGVycm9yKCdyZXF1aXJlZCBhcmdzIDxuYW1lLCBjYj4nKTsKICAgICAgfQoKICAgICAgc3dpdGNoIChuYW1lKSB7CiAgICAgIGNhc2UgJ29wZW5UYWcnOiBvbk9wZW5UYWcgPSBjYjsgYnJlYWs7CiAgICAgIGNhc2UgJ3RleHQnOiBvblRleHQgPSBjYjsgYnJlYWs7CiAgICAgIGNhc2UgJ2Nsb3NlVGFnJzogb25DbG9zZVRhZyA9IGNiOyBicmVhazsKICAgICAgY2FzZSAnZXJyb3InOiBvbkVycm9yID0gY2I7IGJyZWFrOwogICAgICBjYXNlICd3YXJuJzogb25XYXJuaW5nID0gY2I7IGJyZWFrOwogICAgICBjYXNlICdjZGF0YSc6IG9uQ0RBVEEgPSBjYjsgYnJlYWs7CiAgICAgIGNhc2UgJ2F0dGVudGlvbic6IG9uQXR0ZW50aW9uID0gY2I7IGJyZWFrOyAvLyA8IVhYWFhYIHp6eno9ImVlZWUiPgogICAgICBjYXNlICdxdWVzdGlvbic6IG9uUXVlc3Rpb24gPSBjYjsgYnJlYWs7IC8vIDw/IC4uLi4gID8+CiAgICAgIGNhc2UgJ2NvbW1lbnQnOiBvbkNvbW1lbnQgPSBjYjsgYnJlYWs7CiAgICAgIGRlZmF1bHQ6CiAgICAgICAgdGhyb3cgZXJyb3IoJ3Vuc3VwcG9ydGVkIGV2ZW50OiAnICsgbmFtZSk7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfTsKCiAgICAvKioKICAgICAqIFNldCB0aGUgbmFtZXNwYWNlIHRvIHByZWZpeCBtYXBwaW5nLgogICAgICoKICAgICAqIEBleGFtcGxlCiAgICAgKgogICAgICogcGFyc2VyLm5zKHsKICAgICAqICAgJ2h0dHA6Ly9mb28nOiAnZm9vJywKICAgICAqICAgJ2h0dHA6Ly9iYXInOiAnYmFyJwogICAgICogfSk7CiAgICAgKgogICAgICogQHBhcmFtICB7IU9iamVjdDxzdHJpbmcsIHN0cmluZz59IG5zTWFwCiAgICAgKgogICAgICogQHJldHVybiB7UGFyc2VyfQogICAgICovCiAgICB0aGlzWyducyddID0gZnVuY3Rpb24obnNNYXApIHsKCiAgICAgIGlmICh0eXBlb2YgbnNNYXAgPT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgbnNNYXAgPSB7fTsKICAgICAgfQoKICAgICAgaWYgKHR5cGVvZiBuc01hcCAhPT0gJ29iamVjdCcpIHsKICAgICAgICB0aHJvdyBlcnJvcigncmVxdWlyZWQgYXJncyA8bnNNYXA9e30+Jyk7CiAgICAgIH0KCiAgICAgIHZhciBfbnNVcmlUb1ByZWZpeCA9IHt9LCBrOwoKICAgICAgZm9yIChrIGluIG5zTWFwKSB7CiAgICAgICAgX25zVXJpVG9QcmVmaXhba10gPSBuc01hcFtrXTsKICAgICAgfQoKICAgICAgLy8gRk9SQ0UgZGVmYXVsdCBtYXBwaW5nIGZvciBzY2hlbWEgaW5zdGFuY2UKICAgICAgX25zVXJpVG9QcmVmaXhbWFNJX1VSSV0gPSBYU0lfUFJFRklYOwoKICAgICAgaXNOYW1lc3BhY2UgPSB0cnVlOwogICAgICBuc1VyaVRvUHJlZml4ID0gX25zVXJpVG9QcmVmaXg7CgogICAgICByZXR1cm4gdGhpczsKICAgIH07CgogICAgLyoqCiAgICAgKiBQYXJzZSB4bWwgc3RyaW5nLgogICAgICoKICAgICAqIEBwYXJhbSAge3N0cmluZ30geG1sCiAgICAgKgogICAgICogQHJldHVybiB7RXJyb3J9IHJldHVybkVycm9yLCBpZiBub3QgdGhyb3duCiAgICAgKi8KICAgIHRoaXNbJ3BhcnNlJ10gPSBmdW5jdGlvbih4bWwpIHsKICAgICAgaWYgKHR5cGVvZiB4bWwgIT09ICdzdHJpbmcnKSB7CiAgICAgICAgdGhyb3cgZXJyb3IoJ3JlcXVpcmVkIGFyZ3MgPHhtbD1zdHJpbmc+Jyk7CiAgICAgIH0KCiAgICAgIHJldHVybkVycm9yID0gbnVsbDsKCiAgICAgIHBhcnNlKHhtbCk7CgogICAgICBnZXRDb250ZXh0ID0gbm9vcEdldENvbnRleHQ7CiAgICAgIHBhcnNlU3RvcCA9IGZhbHNlOwoKICAgICAgcmV0dXJuIHJldHVybkVycm9yOwogICAgfTsKCiAgICAvKioKICAgICAqIFN0b3AgcGFyc2luZy4KICAgICAqLwogICAgdGhpc1snc3RvcCddID0gZnVuY3Rpb24oKSB7CiAgICAgIHBhcnNlU3RvcCA9IHRydWU7CiAgICB9OwoKICAgIC8qKgogICAgICogUGFyc2Ugc3RyaW5nLCBpbnZva2luZyBjb25maWd1cmVkIGxpc3RlbmVycyBvbiBlbGVtZW50LgogICAgICoKICAgICAqIEBwYXJhbSAge3N0cmluZ30geG1sCiAgICAgKi8KICAgIGZ1bmN0aW9uIHBhcnNlKHhtbCkgewogICAgICB2YXIgbnNNYXRyaXhTdGFjayA9IGlzTmFtZXNwYWNlID8gW10gOiBudWxsLAogICAgICAgICAgbnNNYXRyaXggPSBpc05hbWVzcGFjZSA/IGJ1aWxkTnNNYXRyaXgobnNVcmlUb1ByZWZpeCkgOiBudWxsLAogICAgICAgICAgX25zTWF0cml4LAogICAgICAgICAgbm9kZVN0YWNrID0gW10sCiAgICAgICAgICBhbm9ueW1vdXNOc0NvdW50ID0gMCwKICAgICAgICAgIHRhZ1N0YXJ0ID0gZmFsc2UsCiAgICAgICAgICB0YWdFbmQgPSBmYWxzZSwKICAgICAgICAgIGkgPSAwLCBqID0gMCwKICAgICAgICAgIHgsIHksIHEsIHcsCiAgICAgICAgICB4bWxucywKICAgICAgICAgIGVsZW1lbnROYW1lLAogICAgICAgICAgX2VsZW1lbnROYW1lLAogICAgICAgICAgZWxlbWVudFByb3h5CiAgICAgICAgICA7CgogICAgICB2YXIgYXR0cnNTdHJpbmcgPSAnJywKICAgICAgICAgIGF0dHJzU3RhcnQgPSAwLAogICAgICAgICAgY2FjaGVkQXR0cnMgLy8gZmFsc2UgPSBwYXJzZWQgd2l0aCBlcnJvcnMsIG51bGwgPSBuZWVkcyBwYXJzaW5nCiAgICAgICAgICA7CgogICAgICAvKioKICAgICAgICogUGFyc2UgYXR0cmlidXRlcyBvbiBkZW1hbmQgYW5kIHJldHVybnMgdGhlIHBhcnNlZCBhdHRyaWJ1dGVzLgogICAgICAgKgogICAgICAgKiBSZXR1cm4gc2VtYW50aWNzOiAoMSkgYGZhbHNlYCBvbiBhdHRyaWJ1dGUgcGFyc2UgZXJyb3IsCiAgICAgICAqICgyKSBvYmplY3QgaGFzaCBvbiBleHRyYWN0ZWQgYXR0cnMuCiAgICAgICAqCiAgICAgICAqIEByZXR1cm4ge2Jvb2xlYW58T2JqZWN0fQogICAgICAgKi8KICAgICAgZnVuY3Rpb24gZ2V0QXR0cnMoKSB7CiAgICAgICAgaWYgKGNhY2hlZEF0dHJzICE9PSBudWxsKSB7CiAgICAgICAgICByZXR1cm4gY2FjaGVkQXR0cnM7CiAgICAgICAgfQoKICAgICAgICB2YXIgbnNVcmksCiAgICAgICAgICAgIG5zVXJpUHJlZml4LAogICAgICAgICAgICBuc05hbWUsCiAgICAgICAgICAgIGRlZmF1bHRBbGlhcyA9IGlzTmFtZXNwYWNlICYmIG5zTWF0cml4Wyd4bWxucyddLAogICAgICAgICAgICBhdHRyTGlzdCA9IGlzTmFtZXNwYWNlICYmIG1heWJlTlMgPyBbXSA6IG51bGwsCiAgICAgICAgICAgIGkgPSBhdHRyc1N0YXJ0LAogICAgICAgICAgICBzID0gYXR0cnNTdHJpbmcsCiAgICAgICAgICAgIGwgPSBzLmxlbmd0aCwKICAgICAgICAgICAgaGFzTmV3TWF0cml4LAogICAgICAgICAgICBuZXdhbGlhcywKICAgICAgICAgICAgdmFsdWUsCiAgICAgICAgICAgIGFsaWFzLAogICAgICAgICAgICBuYW1lLAogICAgICAgICAgICBhdHRycyA9IHt9LAogICAgICAgICAgICBzZWVuQXR0cnMgPSB7fSwKICAgICAgICAgICAgc2tpcEF0dHIsCiAgICAgICAgICAgIHcsCiAgICAgICAgICAgIGo7CgogICAgICAgIHBhcnNlQXR0cjoKICAgICAgICBmb3IgKDsgaSA8IGw7IGkrKykgewogICAgICAgICAgc2tpcEF0dHIgPSBmYWxzZTsKICAgICAgICAgIHcgPSBzLmNoYXJDb2RlQXQoaSk7CgogICAgICAgICAgaWYgKHcgPT09IDMyIHx8ICh3IDwgMTQgJiYgdyA+IDgpKSB7IC8vIFdISVRFU1BBQ0U9eyBcZlxuXHJcdFx2fQogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KCiAgICAgICAgICAvLyB3YWl0IGZvciBub24gd2hpdGVzcGFjZSBjaGFyYWN0ZXIKICAgICAgICAgIGlmICh3IDwgNjUgfHwgdyA+IDEyMiB8fCAodyA+IDkwICYmIHcgPCA5NykpIHsKICAgICAgICAgICAgaWYgKHcgIT09IDk1ICYmIHcgIT09IDU4KSB7IC8vIGNoYXIgOTUiXyIgNTgiOiIKICAgICAgICAgICAgICBoYW5kbGVXYXJuaW5nKCdpbGxlZ2FsIGZpcnN0IGNoYXIgYXR0cmlidXRlIG5hbWUnKTsKICAgICAgICAgICAgICBza2lwQXR0ciA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICAvLyBwYXJzZSBhdHRyaWJ1dGUgbmFtZQogICAgICAgICAgZm9yIChqID0gaSArIDE7IGogPCBsOyBqKyspIHsKICAgICAgICAgICAgdyA9IHMuY2hhckNvZGVBdChqKTsKCiAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICB3ID4gOTYgJiYgdyA8IDEyMyB8fAogICAgICAgICAgICAgIHcgPiA2NCAmJiB3IDwgOTEgfHwKICAgICAgICAgICAgICB3ID4gNDcgJiYgdyA8IDU5IHx8CiAgICAgICAgICAgICAgdyA9PT0gNDYgfHwgLy8gJy4nCiAgICAgICAgICAgICAgdyA9PT0gNDUgfHwgLy8gJy0nCiAgICAgICAgICAgICAgdyA9PT0gOTUgLy8gJ18nCiAgICAgICAgICAgICkgewogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyB1bmV4cGVjdGVkIHdoaXRlc3BhY2UKICAgICAgICAgICAgaWYgKHcgPT09IDMyIHx8ICh3IDwgMTQgJiYgdyA+IDgpKSB7IC8vIFdISVRFU1BBQ0UKICAgICAgICAgICAgICBoYW5kbGVXYXJuaW5nKCdtaXNzaW5nIGF0dHJpYnV0ZSB2YWx1ZScpOwogICAgICAgICAgICAgIGkgPSBqOwoKICAgICAgICAgICAgICBjb250aW51ZSBwYXJzZUF0dHI7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGV4cGVjdGVkICI9IgogICAgICAgICAgICBpZiAodyA9PT0gNjEpIHsgLy8gIj0iID09IDYxCiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGhhbmRsZVdhcm5pbmcoJ2lsbGVnYWwgYXR0cmlidXRlIG5hbWUgY2hhcicpOwogICAgICAgICAgICBza2lwQXR0ciA9IHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgbmFtZSA9IHMuc3Vic3RyaW5nKGksIGopOwoKICAgICAgICAgIGlmIChuYW1lID09PSAneG1sbnM6eG1sbnMnKSB7CiAgICAgICAgICAgIGhhbmRsZVdhcm5pbmcoJ2lsbGVnYWwgZGVjbGFyYXRpb24gb2YgeG1sbnMnKTsKICAgICAgICAgICAgc2tpcEF0dHIgPSB0cnVlOwogICAgICAgICAgfQoKICAgICAgICAgIHcgPSBzLmNoYXJDb2RlQXQoaiArIDEpOwoKICAgICAgICAgIGlmICh3ID09PSAzNCkgeyAvLyAnIicKICAgICAgICAgICAgaiA9IHMuaW5kZXhPZignIicsIGkgPSBqICsgMik7CgogICAgICAgICAgICBpZiAoaiA9PT0gLTEpIHsKICAgICAgICAgICAgICBqID0gcy5pbmRleE9mKCdcJycsIGkpOwoKICAgICAgICAgICAgICBpZiAoaiAhPT0gLTEpIHsKICAgICAgICAgICAgICAgIGhhbmRsZVdhcm5pbmcoJ2F0dHJpYnV0ZSB2YWx1ZSBxdW90ZSBtaXNzbWF0Y2gnKTsKICAgICAgICAgICAgICAgIHNraXBBdHRyID0gdHJ1ZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICB9IGVsc2UgaWYgKHcgPT09IDM5KSB7IC8vICInIgogICAgICAgICAgICBqID0gcy5pbmRleE9mKCdcJycsIGkgPSBqICsgMik7CgogICAgICAgICAgICBpZiAoaiA9PT0gLTEpIHsKICAgICAgICAgICAgICBqID0gcy5pbmRleE9mKCciJywgaSk7CgogICAgICAgICAgICAgIGlmIChqICE9PSAtMSkgewogICAgICAgICAgICAgICAgaGFuZGxlV2FybmluZygnYXR0cmlidXRlIHZhbHVlIHF1b3RlIG1pc3NtYXRjaCcpOwogICAgICAgICAgICAgICAgc2tpcEF0dHIgPSB0cnVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGhhbmRsZVdhcm5pbmcoJ21pc3NpbmcgYXR0cmlidXRlIHZhbHVlIHF1b3RlcycpOwogICAgICAgICAgICBza2lwQXR0ciA9IHRydWU7CgogICAgICAgICAgICAvLyBza2lwIHRvIG5leHQgc3BhY2UKICAgICAgICAgICAgZm9yIChqID0gaiArIDE7IGogPCBsOyBqKyspIHsKICAgICAgICAgICAgICB3ID0gcy5jaGFyQ29kZUF0KGogKyAxKTsKCiAgICAgICAgICAgICAgaWYgKHcgPT09IDMyIHx8ICh3IDwgMTQgJiYgdyA+IDgpKSB7IC8vIFdISVRFU1BBQ0UKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoaiA9PT0gLTEpIHsKICAgICAgICAgICAgaGFuZGxlV2FybmluZygnbWlzc2luZyBjbG9zaW5nIHF1b3RlcycpOwoKICAgICAgICAgICAgaiA9IGw7CiAgICAgICAgICAgIHNraXBBdHRyID0gdHJ1ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoIXNraXBBdHRyKSB7CiAgICAgICAgICAgIHZhbHVlID0gcy5zdWJzdHJpbmcoaSwgaik7CiAgICAgICAgICB9CgogICAgICAgICAgaSA9IGo7CgogICAgICAgICAgLy8gZW5zdXJlIFNQQUNFIGZvbGxvd3MgYXR0cmlidXRlCiAgICAgICAgICAvLyBza2lwIGlsbGVnYWwgY29udGVudCBvdGhlcndpc2UKICAgICAgICAgIC8vIGV4YW1wbGUgYT0iYiJjCiAgICAgICAgICBmb3IgKDsgaiArIDEgPCBsOyBqKyspIHsKICAgICAgICAgICAgdyA9IHMuY2hhckNvZGVBdChqICsgMSk7CgogICAgICAgICAgICBpZiAodyA9PT0gMzIgfHwgKHcgPCAxNCAmJiB3ID4gOCkpIHsgLy8gV0hJVEVTUEFDRQogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBGSVJTVCBJTExFR0FMIENIQVIKICAgICAgICAgICAgaWYgKGkgPT09IGopIHsKICAgICAgICAgICAgICBoYW5kbGVXYXJuaW5nKCdpbGxlZ2FsIGNoYXJhY3RlciBhZnRlciBhdHRyaWJ1dGUgZW5kJyk7CiAgICAgICAgICAgICAgc2tpcEF0dHIgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgLy8gYWR2YW5jZSBjdXJzb3IgdG8gbmV4dCBhdHRyaWJ1dGUKICAgICAgICAgIGkgPSBqICsgMTsKCiAgICAgICAgICBpZiAoc2tpcEF0dHIpIHsKICAgICAgICAgICAgY29udGludWUgcGFyc2VBdHRyOwogICAgICAgICAgfQoKICAgICAgICAgIC8vIGNoZWNrIGF0dHJpYnV0ZSByZS1kZWNsYXJhdGlvbgogICAgICAgICAgaWYgKG5hbWUgaW4gc2VlbkF0dHJzKSB7CiAgICAgICAgICAgIGhhbmRsZVdhcm5pbmcoJ2F0dHJpYnV0ZSA8JyArIG5hbWUgKyAnPiBhbHJlYWR5IGRlZmluZWQnKTsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CgogICAgICAgICAgc2VlbkF0dHJzW25hbWVdID0gdHJ1ZTsKCiAgICAgICAgICBpZiAoIWlzTmFtZXNwYWNlKSB7CiAgICAgICAgICAgIGF0dHJzW25hbWVdID0gdmFsdWU7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQoKICAgICAgICAgIC8vIHRyeSB0byBleHRyYWN0IG5hbWVzcGFjZSBpbmZvcm1hdGlvbgogICAgICAgICAgaWYgKG1heWJlTlMpIHsKICAgICAgICAgICAgbmV3YWxpYXMgPSAoCiAgICAgICAgICAgICAgbmFtZSA9PT0gJ3htbG5zJwogICAgICAgICAgICAgICAgPyAneG1sbnMnCiAgICAgICAgICAgICAgICA6IChuYW1lLmNoYXJDb2RlQXQoMCkgPT09IDEyMCAmJiBuYW1lLnN1YnN0cigwLCA2KSA9PT0gJ3htbG5zOicpCiAgICAgICAgICAgICAgICAgID8gbmFtZS5zdWJzdHIoNikKICAgICAgICAgICAgICAgICAgOiBudWxsCiAgICAgICAgICAgICk7CgogICAgICAgICAgICAvLyBoYW5kbGUgeG1sbnMoOmFsaWFzKSBhc3NpZ25tZW50CiAgICAgICAgICAgIGlmIChuZXdhbGlhcyAhPT0gbnVsbCkgewogICAgICAgICAgICAgIG5zVXJpID0gZGVjb2RlRW50aXRpZXModmFsdWUpOwogICAgICAgICAgICAgIG5zVXJpUHJlZml4ID0gdXJpUHJlZml4KG5ld2FsaWFzKTsKCiAgICAgICAgICAgICAgYWxpYXMgPSBuc1VyaVRvUHJlZml4W25zVXJpXTsKCiAgICAgICAgICAgICAgaWYgKCFhbGlhcykgewogICAgICAgICAgICAgICAgLy8gbm8gcHJlZml4IGRlZmluZWQgb3IgcHJlZml4IGNvbGxpc2lvbgogICAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgICAobmV3YWxpYXMgPT09ICd4bWxucycpIHx8CiAgICAgICAgICAgICAgICAgIChuc1VyaVByZWZpeCBpbiBuc01hdHJpeCAmJiBuc01hdHJpeFtuc1VyaVByZWZpeF0gIT09IG5zVXJpKQogICAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICAgIC8vIGFsb2NhdGUgZnJlZSBucyBwcmVmaXgKICAgICAgICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgICAgICAgIGFsaWFzID0gJ25zJyArIChhbm9ueW1vdXNOc0NvdW50KyspOwogICAgICAgICAgICAgICAgICB9IHdoaWxlICh0eXBlb2YgbnNNYXRyaXhbYWxpYXNdICE9PSAndW5kZWZpbmVkJyk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICBhbGlhcyA9IG5ld2FsaWFzOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIG5zVXJpVG9QcmVmaXhbbnNVcmldID0gYWxpYXM7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAobnNNYXRyaXhbbmV3YWxpYXNdICE9PSBhbGlhcykgewogICAgICAgICAgICAgICAgaWYgKCFoYXNOZXdNYXRyaXgpIHsKICAgICAgICAgICAgICAgICAgbnNNYXRyaXggPSBjbG9uZU5zTWF0cml4KG5zTWF0cml4KTsKICAgICAgICAgICAgICAgICAgaGFzTmV3TWF0cml4ID0gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBuc01hdHJpeFtuZXdhbGlhc10gPSBhbGlhczsKICAgICAgICAgICAgICAgIGlmIChuZXdhbGlhcyA9PT0gJ3htbG5zJykgewogICAgICAgICAgICAgICAgICBuc01hdHJpeFt1cmlQcmVmaXgoYWxpYXMpXSA9IG5zVXJpOwogICAgICAgICAgICAgICAgICBkZWZhdWx0QWxpYXMgPSBhbGlhczsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBuc01hdHJpeFtuc1VyaVByZWZpeF0gPSBuc1VyaTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIC8vIGV4cG9zZSB4bWxucyg6YXNkKT0iLi4uIiBpbiBhdHRyaWJ1dGVzCiAgICAgICAgICAgICAgYXR0cnNbbmFtZV0gPSB2YWx1ZTsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gY29sbGVjdCBhdHRyaWJ1dGVzIHVudGlsIGFsbCBuYW1lc3BhY2UKICAgICAgICAgICAgLy8gZGVjbGFyYXRpb25zIGFyZSBwcm9jZXNzZWQKICAgICAgICAgICAgYXR0ckxpc3QucHVzaChuYW1lLCB2YWx1ZSk7CiAgICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgIH0gLyoqIGVuZCBpZiAobWF5YmVOcykgKi8KCiAgICAgICAgICAvLyBoYW5kbGUgYXR0cmlidXRlcyBvbiBlbGVtZW50IHdpdGhvdXQKICAgICAgICAgIC8vIG5hbWVzcGFjZSBkZWNsYXJhdGlvbnMKICAgICAgICAgIHcgPSBuYW1lLmluZGV4T2YoJzonKTsKICAgICAgICAgIGlmICh3ID09PSAtMSkgewogICAgICAgICAgICBhdHRyc1tuYW1lXSA9IHZhbHVlOwogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KCiAgICAgICAgICAvLyBub3JtYWxpemUgbnMgYXR0cmlidXRlIG5hbWUKICAgICAgICAgIGlmICghKG5zTmFtZSA9IG5zTWF0cml4W25hbWUuc3Vic3RyaW5nKDAsIHcpXSkpIHsKICAgICAgICAgICAgaGFuZGxlV2FybmluZyhtaXNzaW5nTmFtZXNwYWNlRm9yUHJlZml4KG5hbWUuc3Vic3RyaW5nKDAsIHcpKSk7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQoKICAgICAgICAgIG5hbWUgPSBkZWZhdWx0QWxpYXMgPT09IG5zTmFtZQogICAgICAgICAgICA/IG5hbWUuc3Vic3RyKHcgKyAxKQogICAgICAgICAgICA6IG5zTmFtZSArIG5hbWUuc3Vic3RyKHcpOwogICAgICAgICAgLy8gZW5kOiBub3JtYWxpemUgbnMgYXR0cmlidXRlIG5hbWUKCiAgICAgICAgICAvLyBub3JtYWxpemUgeHNpOnR5cGUgbnMgYXR0cmlidXRlIHZhbHVlCiAgICAgICAgICBpZiAobmFtZSA9PT0gWFNJX1RZUEUpIHsKICAgICAgICAgICAgdyA9IHZhbHVlLmluZGV4T2YoJzonKTsKCiAgICAgICAgICAgIGlmICh3ICE9PSAtMSkgewogICAgICAgICAgICAgIG5zTmFtZSA9IHZhbHVlLnN1YnN0cmluZygwLCB3KTsKICAgICAgICAgICAgICAvLyBoYW5kbGUgZGVmYXVsdCBwcmVmaXhlcywgaS5lLiB4czpTdHJpbmcgZ3JhY2VmdWxseQogICAgICAgICAgICAgIG5zTmFtZSA9IG5zTWF0cml4W25zTmFtZV0gfHwgbnNOYW1lOwogICAgICAgICAgICAgIHZhbHVlID0gbnNOYW1lICsgdmFsdWUuc3Vic3RyaW5nKHcpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHZhbHVlID0gZGVmYXVsdEFsaWFzICsgJzonICsgdmFsdWU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIC8vIGVuZDogbm9ybWFsaXplIHhzaTp0eXBlIG5zIGF0dHJpYnV0ZSB2YWx1ZQoKICAgICAgICAgIGF0dHJzW25hbWVdID0gdmFsdWU7CiAgICAgICAgfQoKCiAgICAgICAgLy8gaGFuZGxlIGRlZmVycmVkLCBwb3NzaWJseSBuYW1lc3BhY2VkIGF0dHJpYnV0ZXMKICAgICAgICBpZiAobWF5YmVOUykgewoKICAgICAgICAgIC8vIG5vcm1hbGl6ZSBjYXB0dXJlZCBhdHRyaWJ1dGVzCiAgICAgICAgICBmb3IgKGkgPSAwLCBsID0gYXR0ckxpc3QubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CgogICAgICAgICAgICBuYW1lID0gYXR0ckxpc3RbaSsrXTsKICAgICAgICAgICAgdmFsdWUgPSBhdHRyTGlzdFtpXTsKCiAgICAgICAgICAgIHcgPSBuYW1lLmluZGV4T2YoJzonKTsKCiAgICAgICAgICAgIGlmICh3ICE9PSAtMSkgewogICAgICAgICAgICAgIC8vIG5vcm1hbGl6ZSBucyBhdHRyaWJ1dGUgbmFtZQogICAgICAgICAgICAgIGlmICghKG5zTmFtZSA9IG5zTWF0cml4W25hbWUuc3Vic3RyaW5nKDAsIHcpXSkpIHsKICAgICAgICAgICAgICAgIGhhbmRsZVdhcm5pbmcobWlzc2luZ05hbWVzcGFjZUZvclByZWZpeChuYW1lLnN1YnN0cmluZygwLCB3KSkpOwogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBuYW1lID0gZGVmYXVsdEFsaWFzID09PSBuc05hbWUKICAgICAgICAgICAgICAgID8gbmFtZS5zdWJzdHIodyArIDEpCiAgICAgICAgICAgICAgICA6IG5zTmFtZSArIG5hbWUuc3Vic3RyKHcpOwogICAgICAgICAgICAgIC8vIGVuZDogbm9ybWFsaXplIG5zIGF0dHJpYnV0ZSBuYW1lCgogICAgICAgICAgICAgIC8vIG5vcm1hbGl6ZSB4c2k6dHlwZSBucyBhdHRyaWJ1dGUgdmFsdWUKICAgICAgICAgICAgICBpZiAobmFtZSA9PT0gWFNJX1RZUEUpIHsKICAgICAgICAgICAgICAgIHcgPSB2YWx1ZS5pbmRleE9mKCc6Jyk7CgogICAgICAgICAgICAgICAgaWYgKHcgIT09IC0xKSB7CiAgICAgICAgICAgICAgICAgIG5zTmFtZSA9IHZhbHVlLnN1YnN0cmluZygwLCB3KTsKICAgICAgICAgICAgICAgICAgLy8gaGFuZGxlIGRlZmF1bHQgcHJlZml4ZXMsIGkuZS4geHM6U3RyaW5nIGdyYWNlZnVsbHkKICAgICAgICAgICAgICAgICAgbnNOYW1lID0gbnNNYXRyaXhbbnNOYW1lXSB8fCBuc05hbWU7CiAgICAgICAgICAgICAgICAgIHZhbHVlID0gbnNOYW1lICsgdmFsdWUuc3Vic3RyaW5nKHcpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgdmFsdWUgPSBkZWZhdWx0QWxpYXMgKyAnOicgKyB2YWx1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgLy8gZW5kOiBub3JtYWxpemUgeHNpOnR5cGUgbnMgYXR0cmlidXRlIHZhbHVlCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGF0dHJzW25hbWVdID0gdmFsdWU7CiAgICAgICAgICB9CiAgICAgICAgICAvLyBlbmQ6IG5vcm1hbGl6ZSBjYXB0dXJlZCBhdHRyaWJ1dGVzCiAgICAgICAgfQoKICAgICAgICByZXR1cm4gY2FjaGVkQXR0cnMgPSBhdHRyczsKICAgICAgfQoKICAgICAgLyoqCiAgICAgICAqIEV4dHJhY3QgdGhlIHBhcnNlIGNvbnRleHQgeyBsaW5lLCBjb2x1bW4sIHBhcnQgfQogICAgICAgKiBmcm9tIHRoZSBjdXJyZW50IHBhcnNlciBwb3NpdGlvbi4KICAgICAgICoKICAgICAgICogQHJldHVybiB7T2JqZWN0fSBwYXJzZSBjb250ZXh0CiAgICAgICAqLwogICAgICBmdW5jdGlvbiBnZXRQYXJzZUNvbnRleHQoKSB7CiAgICAgICAgdmFyIHNwbGl0c1JlID0gLyhcclxufFxyfFxuKS9nOwoKICAgICAgICB2YXIgbGluZSA9IDA7CiAgICAgICAgdmFyIGNvbHVtbiA9IDA7CiAgICAgICAgdmFyIHN0YXJ0T2ZMaW5lID0gMDsKICAgICAgICB2YXIgZW5kT2ZMaW5lID0gajsKICAgICAgICB2YXIgbWF0Y2g7CiAgICAgICAgdmFyIGRhdGE7CgogICAgICAgIHdoaWxlIChpID49IHN0YXJ0T2ZMaW5lKSB7CgogICAgICAgICAgbWF0Y2ggPSBzcGxpdHNSZS5leGVjKHhtbCk7CgogICAgICAgICAgaWYgKCFtYXRjaCkgewogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KCiAgICAgICAgICAvLyBlbmQgb2YgbGluZSA9IChicmVhayBpZHggKyBicmVhayBjaGFycykKICAgICAgICAgIGVuZE9mTGluZSA9IG1hdGNoWzBdLmxlbmd0aCArIG1hdGNoLmluZGV4OwoKICAgICAgICAgIGlmIChlbmRPZkxpbmUgPiBpKSB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQoKICAgICAgICAgIC8vIGFkdmFuY2UgdG8gbmV4dCBsaW5lCiAgICAgICAgICBsaW5lICs9IDE7CgogICAgICAgICAgc3RhcnRPZkxpbmUgPSBlbmRPZkxpbmU7CiAgICAgICAgfQoKICAgICAgICAvLyBFT0YgZXJyb3JzCiAgICAgICAgaWYgKGkgPT0gLTEpIHsKICAgICAgICAgIGNvbHVtbiA9IGVuZE9mTGluZTsKICAgICAgICAgIGRhdGEgPSB4bWwuc3Vic3RyaW5nKGopOwogICAgICAgIH0gZWxzZQogICAgICAgIC8vIHN0YXJ0IGVycm9ycwogICAgICAgIGlmIChqID09PSAwKSB7CiAgICAgICAgICBjb25zb2xlLmxvZyhpIC0gc3RhcnRPZkxpbmUpOwogICAgICAgICAgZGF0YSA9IHhtbC5zdWJzdHJpbmcoaiwgaSk7CiAgICAgICAgfQogICAgICAgIC8vIG90aGVyIGVycm9ycwogICAgICAgIGVsc2UgewogICAgICAgICAgY29sdW1uID0gaSAtIHN0YXJ0T2ZMaW5lOwogICAgICAgICAgZGF0YSA9IChqID09IC0xID8geG1sLnN1YnN0cmluZyhpKSA6IHhtbC5zdWJzdHJpbmcoaSwgaiArIDEpKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiB7CiAgICAgICAgICAnZGF0YSc6IGRhdGEsCiAgICAgICAgICAnbGluZSc6IGxpbmUsCiAgICAgICAgICAnY29sdW1uJzogY29sdW1uCiAgICAgICAgfTsKICAgICAgfQoKICAgICAgZ2V0Q29udGV4dCA9IGdldFBhcnNlQ29udGV4dDsKCgogICAgICBpZiAocHJveHkpIHsKICAgICAgICBlbGVtZW50UHJveHkgPSBPYmplY3QuY3JlYXRlKHt9LCB7CiAgICAgICAgICAnbmFtZSc6IGdldHRlcihmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnROYW1lOwogICAgICAgICAgfSksCiAgICAgICAgICAnb3JpZ2luYWxOYW1lJzogZ2V0dGVyKGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gX2VsZW1lbnROYW1lOwogICAgICAgICAgfSksCiAgICAgICAgICAnYXR0cnMnOiBnZXR0ZXIoZ2V0QXR0cnMpLAogICAgICAgICAgJ25zJzogZ2V0dGVyKGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gbnNNYXRyaXg7CiAgICAgICAgICB9KQogICAgICAgIH0pOwogICAgICB9CgogICAgICAvLyBhY3R1YWwgcGFyc2UgbG9naWMKICAgICAgd2hpbGUgKGogIT09IC0xKSB7CgogICAgICAgIGlmICh4bWwuY2hhckNvZGVBdChqKSA9PT0gNjApIHsgLy8gIjwiCiAgICAgICAgICBpID0gajsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgaSA9IHhtbC5pbmRleE9mKCc8Jywgaik7CiAgICAgICAgfQoKICAgICAgICAvLyBwYXJzZSBlbmQKICAgICAgICBpZiAoaSA9PT0gLTEpIHsKICAgICAgICAgIGlmIChub2RlU3RhY2subGVuZ3RoKSB7CiAgICAgICAgICAgIHJldHVybiBoYW5kbGVFcnJvcigndW5leHBlY3RlZCBlbmQgb2YgZmlsZScpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChqID09PSAwKSB7CiAgICAgICAgICAgIHJldHVybiBoYW5kbGVFcnJvcignbWlzc2luZyBzdGFydCB0YWcnKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoaiA8IHhtbC5sZW5ndGgpIHsKICAgICAgICAgICAgaWYgKHhtbC5zdWJzdHJpbmcoaikudHJpbSgpKSB7CiAgICAgICAgICAgICAgaGFuZGxlV2FybmluZyhOT05fV0hJVEVTUEFDRV9PVVRTSURFX1JPT1RfTk9ERSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAvLyBwYXJzZSB0ZXh0CiAgICAgICAgaWYgKGogIT09IGkpIHsKCiAgICAgICAgICBpZiAobm9kZVN0YWNrLmxlbmd0aCkgewogICAgICAgICAgICBpZiAob25UZXh0KSB7CiAgICAgICAgICAgICAgb25UZXh0KHhtbC5zdWJzdHJpbmcoaiwgaSksIGRlY29kZUVudGl0aWVzLCBnZXRDb250ZXh0KTsKCiAgICAgICAgICAgICAgaWYgKHBhcnNlU3RvcCkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKHhtbC5zdWJzdHJpbmcoaiwgaSkudHJpbSgpKSB7CiAgICAgICAgICAgICAgaGFuZGxlV2FybmluZyhOT05fV0hJVEVTUEFDRV9PVVRTSURFX1JPT1RfTk9ERSk7CgogICAgICAgICAgICAgIGlmIChwYXJzZVN0b3ApIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHcgPSB4bWwuY2hhckNvZGVBdChpKzEpOwoKICAgICAgICAvLyBwYXJzZSBjb21tZW50cyArIENEQVRBCiAgICAgICAgaWYgKHcgPT09IDMzKSB7IC8vICIhIgogICAgICAgICAgdyA9IHhtbC5jaGFyQ29kZUF0KGkrMik7CiAgICAgICAgICBpZiAodyA9PT0gOTEgJiYgeG1sLnN1YnN0cihpICsgMywgNikgPT09ICdDREFUQVsnKSB7IC8vIDkxID09ICJbIgogICAgICAgICAgICBqID0geG1sLmluZGV4T2YoJ11dPicsIGkpOwogICAgICAgICAgICBpZiAoaiA9PT0gLTEpIHsKICAgICAgICAgICAgICByZXR1cm4gaGFuZGxlRXJyb3IoJ3VuY2xvc2VkIGNkYXRhJyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChvbkNEQVRBKSB7CiAgICAgICAgICAgICAgb25DREFUQSh4bWwuc3Vic3RyaW5nKGkgKyA5LCBqKSwgZ2V0Q29udGV4dCk7CiAgICAgICAgICAgICAgaWYgKHBhcnNlU3RvcCkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgaiArPSAzOwogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KCgogICAgICAgICAgaWYgKHcgPT09IDQ1ICYmIHhtbC5jaGFyQ29kZUF0KGkgKyAzKSA9PT0gNDUpIHsgLy8gNDUgPT0gIi0iCiAgICAgICAgICAgIGogPSB4bWwuaW5kZXhPZignLS0+JywgaSk7CiAgICAgICAgICAgIGlmIChqID09PSAtMSkgewogICAgICAgICAgICAgIHJldHVybiBoYW5kbGVFcnJvcigndW5jbG9zZWQgY29tbWVudCcpOwogICAgICAgICAgICB9CgoKICAgICAgICAgICAgaWYgKG9uQ29tbWVudCkgewogICAgICAgICAgICAgIG9uQ29tbWVudCh4bWwuc3Vic3RyaW5nKGkgKyA0LCBqKSwgZGVjb2RlRW50aXRpZXMsIGdldENvbnRleHQpOwogICAgICAgICAgICAgIGlmIChwYXJzZVN0b3ApIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGogKz0gMzsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CgogICAgICAgICAgaiA9IHhtbC5pbmRleE9mKCc+JywgaSArIDEpOwogICAgICAgICAgaWYgKGogPT09IC0xKSB7CiAgICAgICAgICAgIHJldHVybiBoYW5kbGVFcnJvcigndW5jbG9zZWQgdGFnJyk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKG9uQXR0ZW50aW9uKSB7CiAgICAgICAgICAgIG9uQXR0ZW50aW9uKHhtbC5zdWJzdHJpbmcoaSwgaiArIDEpLCBkZWNvZGVFbnRpdGllcywgZ2V0Q29udGV4dCk7CiAgICAgICAgICAgIGlmIChwYXJzZVN0b3ApIHsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBqICs9IDE7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CgogICAgICAgIGlmICh3ID09PSA2MykgeyAvLyAiPyIKICAgICAgICAgIGogPSB4bWwuaW5kZXhPZignPz4nLCBpKTsKICAgICAgICAgIGlmIChqID09PSAtMSkgewogICAgICAgICAgICByZXR1cm4gaGFuZGxlRXJyb3IoJ3VuY2xvc2VkIHF1ZXN0aW9uJyk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKG9uUXVlc3Rpb24pIHsKICAgICAgICAgICAgb25RdWVzdGlvbih4bWwuc3Vic3RyaW5nKGksIGogKyAyKSwgZ2V0Q29udGV4dCk7CiAgICAgICAgICAgIGlmIChwYXJzZVN0b3ApIHsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBqICs9IDI7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CgogICAgICAgIGogPSB4bWwuaW5kZXhPZignPicsIGkgKyAxKTsKCiAgICAgICAgaWYgKGogPT0gLTEpIHsKICAgICAgICAgIHJldHVybiBoYW5kbGVFcnJvcigndW5jbG9zZWQgdGFnJyk7CiAgICAgICAgfQoKICAgICAgICAvLyBkb24ndCBwcm9jZXNzIGF0dHJpYnV0ZXM7CiAgICAgICAgLy8gdGhlcmUgYXJlIG5vbmUKICAgICAgICBjYWNoZWRBdHRycyA9IHt9OwoKICAgICAgICAvLyBpZiAoeG1sLmNoYXJDb2RlQXQoaSsxKSA9PT0gNDcpIHsgLy8gPC8uLi4KICAgICAgICBpZiAodyA9PT0gNDcpIHsgLy8gPC8uLi4KICAgICAgICAgIHRhZ1N0YXJ0ID0gZmFsc2U7CiAgICAgICAgICB0YWdFbmQgPSB0cnVlOwoKICAgICAgICAgIGlmICghbm9kZVN0YWNrLmxlbmd0aCkgewogICAgICAgICAgICByZXR1cm4gaGFuZGxlRXJyb3IoJ21pc3Npbmcgb3BlbiB0YWcnKTsKICAgICAgICAgIH0KCiAgICAgICAgICAvLyB2ZXJpZnkgb3BlbiA8LT4gY2xvc2UgdGFnIG1hdGNoCiAgICAgICAgICB4ID0gZWxlbWVudE5hbWUgPSBub2RlU3RhY2sucG9wKCk7CiAgICAgICAgICBxID0gaSArIDIgKyB4Lmxlbmd0aDsKCiAgICAgICAgICBpZiAoeG1sLnN1YnN0cmluZyhpICsgMiwgcSkgIT09IHgpIHsKICAgICAgICAgICAgcmV0dXJuIGhhbmRsZUVycm9yKCdjbG9zaW5nIHRhZyBtaXNtYXRjaCcpOwogICAgICAgICAgfQoKICAgICAgICAgIC8vIHZlcmlmeSBjaGFycyBpbiBjbG9zZSB0YWcKICAgICAgICAgIGZvciAoOyBxIDwgajsgcSsrKSB7CiAgICAgICAgICAgIHcgPSB4bWwuY2hhckNvZGVBdChxKTsKCiAgICAgICAgICAgIGlmICh3ID09PSAzMiB8fCAodyA+IDggJiYgdyA8IDE0KSkgeyAvLyBcZlxuXHJcdFx2IHNwYWNlCiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBoYW5kbGVFcnJvcignY2xvc2UgdGFnJyk7CiAgICAgICAgICB9CgogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAoeG1sLmNoYXJDb2RlQXQoaiAtIDEpID09PSA0NykgeyAvLyAuLi4vPgogICAgICAgICAgICB4ID0gZWxlbWVudE5hbWUgPSB4bWwuc3Vic3RyaW5nKGkgKyAxLCBqIC0gMSk7CgogICAgICAgICAgICB0YWdTdGFydCA9IHRydWU7CiAgICAgICAgICAgIHRhZ0VuZCA9IHRydWU7CgogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgeCA9IGVsZW1lbnROYW1lID0geG1sLnN1YnN0cmluZyhpICsgMSwgaik7CgogICAgICAgICAgICB0YWdTdGFydCA9IHRydWU7CiAgICAgICAgICAgIHRhZ0VuZCA9IGZhbHNlOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICghKHcgPiA5NiAmJiB3IDwgMTIzIHx8IHcgPiA2NCAmJiB3IDwgOTEgfHwgdyA9PT0gOTUgfHwgdyA9PT0gNTgpKSB7IC8vIGNoYXIgOTUiXyIgNTgiOiIKICAgICAgICAgICAgcmV0dXJuIGhhbmRsZUVycm9yKCdpbGxlZ2FsIGZpcnN0IGNoYXIgbm9kZU5hbWUnKTsKICAgICAgICAgIH0KCiAgICAgICAgICBmb3IgKHEgPSAxLCB5ID0geC5sZW5ndGg7IHEgPCB5OyBxKyspIHsKICAgICAgICAgICAgdyA9IHguY2hhckNvZGVBdChxKTsKCiAgICAgICAgICAgIGlmICh3ID4gOTYgJiYgdyA8IDEyMyB8fCB3ID4gNjQgJiYgdyA8IDkxIHx8IHcgPiA0NyAmJiB3IDwgNTkgfHwgdyA9PT0gNDUgfHwgdyA9PT0gOTUgfHwgdyA9PSA0NikgewogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAodyA9PT0gMzIgfHwgKHcgPCAxNCAmJiB3ID4gOCkpIHsgLy8gXGZcblxyXHRcdiBzcGFjZQogICAgICAgICAgICAgIGVsZW1lbnROYW1lID0geC5zdWJzdHJpbmcoMCwgcSk7CiAgICAgICAgICAgICAgLy8gbWF5YmUgdGhlcmUgYXJlIGF0dHJpYnV0ZXMKICAgICAgICAgICAgICBjYWNoZWRBdHRycyA9IG51bGw7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBoYW5kbGVFcnJvcignaW52YWxpZCBub2RlTmFtZScpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICghdGFnRW5kKSB7CiAgICAgICAgICAgIG5vZGVTdGFjay5wdXNoKGVsZW1lbnROYW1lKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChpc05hbWVzcGFjZSkgewoKICAgICAgICAgIF9uc01hdHJpeCA9IG5zTWF0cml4OwoKICAgICAgICAgIGlmICh0YWdTdGFydCkgewogICAgICAgICAgICAvLyByZW1lbWJlciBvbGQgbmFtZXNwYWNlCiAgICAgICAgICAgIC8vIHVubGVzcyB3ZSdyZSBzZWxmLWNsb3NpbmcKICAgICAgICAgICAgaWYgKCF0YWdFbmQpIHsKICAgICAgICAgICAgICBuc01hdHJpeFN0YWNrLnB1c2goX25zTWF0cml4KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGNhY2hlZEF0dHJzID09PSBudWxsKSB7CiAgICAgICAgICAgICAgLy8gcXVpY2sgY2hlY2ssIHdoZXRoZXIgdGhlcmUgbWF5IGJlIG5hbWVzcGFjZQogICAgICAgICAgICAgIC8vIGRlY2xhcmF0aW9ucyBvbiB0aGUgbm9kZTsgaWYgdGhhdCBpcyB0aGUgY2FzZQogICAgICAgICAgICAgIC8vIHdlIG5lZWQgdG8gZWFnZXJseSBwYXJzZSB0aGUgbm9kZSBhdHRyaWJ1dGVzCiAgICAgICAgICAgICAgaWYgKChtYXliZU5TID0geC5pbmRleE9mKCd4bWxucycsIHEpICE9PSAtMSkpIHsKICAgICAgICAgICAgICAgIGF0dHJzU3RhcnQgPSBxOwogICAgICAgICAgICAgICAgYXR0cnNTdHJpbmcgPSB4OwoKICAgICAgICAgICAgICAgIGdldEF0dHJzKCk7CgogICAgICAgICAgICAgICAgbWF5YmVOUyA9IGZhbHNlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIF9lbGVtZW50TmFtZSA9IGVsZW1lbnROYW1lOwoKICAgICAgICAgIHcgPSBlbGVtZW50TmFtZS5pbmRleE9mKCc6Jyk7CiAgICAgICAgICBpZiAodyAhPT0gLTEpIHsKICAgICAgICAgICAgeG1sbnMgPSBuc01hdHJpeFtlbGVtZW50TmFtZS5zdWJzdHJpbmcoMCwgdyldOwoKICAgICAgICAgICAgLy8gcHJlZml4IGdpdmVuOyBuYW1lc3BhY2UgbXVzdCBleGlzdAogICAgICAgICAgICBpZiAoIXhtbG5zKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGhhbmRsZUVycm9yKCdtaXNzaW5nIG5hbWVzcGFjZSBvbiA8JyArIF9lbGVtZW50TmFtZSArICc+Jyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGVsZW1lbnROYW1lID0gZWxlbWVudE5hbWUuc3Vic3RyKHcgKyAxKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHhtbG5zID0gbnNNYXRyaXhbJ3htbG5zJ107CgogICAgICAgICAgICAvLyBpZiBubyBkZWZhdWx0IG5hbWVzcGFjZSBpcyBkZWZpbmVkLAogICAgICAgICAgICAvLyB3ZSdsbCBpbXBvcnQgdGhlIGVsZW1lbnQgYXMgYW5vbnltb3VzLgogICAgICAgICAgICAvLwogICAgICAgICAgICAvLyBpdCBpcyB1cCB0byB1c2VycyB0byBjb3JyZWN0IHRoYXQgdG8gdGhlIGRvY3VtZW50IGRlZmluZWQKICAgICAgICAgICAgLy8gdGFyZ2V0TmFtZXNwYWNlLCBvciB3aGF0ZXZlciB0aGVpciB1bmRlcnNhbmRpbmcgb2YgdGhlCiAgICAgICAgICAgIC8vIFhNTCBzcGVjIG1hbmRhdGVzLgogICAgICAgICAgfQoKICAgICAgICAgIC8vIGFkanVzdCBuYW1lc3BhY2UgcHJlZml4cyBhcyBjb25maWd1cmVkCiAgICAgICAgICBpZiAoeG1sbnMpIHsKICAgICAgICAgICAgZWxlbWVudE5hbWUgPSB4bWxucyArICc6JyArIGVsZW1lbnROYW1lOwogICAgICAgICAgfQoKICAgICAgICB9CgogICAgICAgIGlmICh0YWdTdGFydCkgewogICAgICAgICAgYXR0cnNTdGFydCA9IHE7CiAgICAgICAgICBhdHRyc1N0cmluZyA9IHg7CgogICAgICAgICAgaWYgKG9uT3BlblRhZykgewogICAgICAgICAgICBpZiAocHJveHkpIHsKICAgICAgICAgICAgICBvbk9wZW5UYWcoZWxlbWVudFByb3h5LCBkZWNvZGVFbnRpdGllcywgdGFnRW5kLCBnZXRDb250ZXh0KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBvbk9wZW5UYWcoZWxlbWVudE5hbWUsIGdldEF0dHJzLCBkZWNvZGVFbnRpdGllcywgdGFnRW5kLCBnZXRDb250ZXh0KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHBhcnNlU3RvcCkgewogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICB9CgogICAgICAgIGlmICh0YWdFbmQpIHsKCiAgICAgICAgICBpZiAob25DbG9zZVRhZykgewogICAgICAgICAgICBvbkNsb3NlVGFnKHByb3h5ID8gZWxlbWVudFByb3h5IDogZWxlbWVudE5hbWUsIGRlY29kZUVudGl0aWVzLCB0YWdTdGFydCwgZ2V0Q29udGV4dCk7CgogICAgICAgICAgICBpZiAocGFyc2VTdG9wKSB7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgLy8gcmVzdG9yZSBvbGQgbmFtZXNwYWNlCiAgICAgICAgICBpZiAoaXNOYW1lc3BhY2UpIHsKICAgICAgICAgICAgaWYgKCF0YWdTdGFydCkgewogICAgICAgICAgICAgIG5zTWF0cml4ID0gbnNNYXRyaXhTdGFjay5wb3AoKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBuc01hdHJpeCA9IF9uc01hdHJpeDsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaiArPSAxOwogICAgICB9CiAgICB9IC8qKiBlbmQgcGFyc2UgKi8KCiAgfQoKICBmdW5jdGlvbiBoYXNMb3dlckNhc2VBbGlhcyhwa2cpIHsKICAgIHJldHVybiBwa2cueG1sICYmIHBrZy54bWwudGFnQWxpYXMgPT09ICdsb3dlckNhc2UnOwogIH0KCiAgdmFyIERFRkFVTFRfTlNfTUFQID0gewogICAgJ3hzaSc6ICdodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZScKICB9OwoKICB2YXIgWFNJX1RZUEUkMSA9ICd4c2k6dHlwZSc7CgogIGZ1bmN0aW9uIHNlcmlhbGl6ZUZvcm1hdChlbGVtZW50KSB7CiAgICByZXR1cm4gZWxlbWVudC54bWwgJiYgZWxlbWVudC54bWwuc2VyaWFsaXplOwogIH0KCiAgZnVuY3Rpb24gc2VyaWFsaXplQXNUeXBlKGVsZW1lbnQpIHsKICAgIHJldHVybiBzZXJpYWxpemVGb3JtYXQoZWxlbWVudCkgPT09IFhTSV9UWVBFJDE7CiAgfQoKICBmdW5jdGlvbiBzZXJpYWxpemVBc1Byb3BlcnR5KGVsZW1lbnQpIHsKICAgIHJldHVybiBzZXJpYWxpemVGb3JtYXQoZWxlbWVudCkgPT09ICdwcm9wZXJ0eSc7CiAgfQoKICBmdW5jdGlvbiBjYXBpdGFsaXplKHN0cikgewogICAgcmV0dXJuIHN0ci5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHN0ci5zbGljZSgxKTsKICB9CgogIGZ1bmN0aW9uIGFsaWFzVG9OYW1lKGFsaWFzTnMsIHBrZykgewoKICAgIGlmICghaGFzTG93ZXJDYXNlQWxpYXMocGtnKSkgewogICAgICByZXR1cm4gYWxpYXNOcy5uYW1lOwogICAgfQoKICAgIHJldHVybiBhbGlhc05zLnByZWZpeCArICc6JyArIGNhcGl0YWxpemUoYWxpYXNOcy5sb2NhbE5hbWUpOwogIH0KCiAgZnVuY3Rpb24gcHJlZml4ZWRUb05hbWUobmFtZU5zLCBwa2cpIHsKCiAgICB2YXIgbmFtZSA9IG5hbWVOcy5uYW1lLAogICAgICAgIGxvY2FsTmFtZSA9IG5hbWVOcy5sb2NhbE5hbWU7CgogICAgdmFyIHR5cGVQcmVmaXggPSBwa2cueG1sICYmIHBrZy54bWwudHlwZVByZWZpeDsKCiAgICBpZiAodHlwZVByZWZpeCAmJiBsb2NhbE5hbWUuaW5kZXhPZih0eXBlUHJlZml4KSA9PT0gMCkgewogICAgICByZXR1cm4gbmFtZU5zLnByZWZpeCArICc6JyArIGxvY2FsTmFtZS5zbGljZSh0eXBlUHJlZml4Lmxlbmd0aCk7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gbmFtZTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIG5vcm1hbGl6ZVhzaVR5cGVOYW1lKG5hbWUsIG1vZGVsKSB7CgogICAgdmFyIG5hbWVOcyA9IHBhcnNlTmFtZShuYW1lKTsKICAgIHZhciBwa2cgPSBtb2RlbC5nZXRQYWNrYWdlKG5hbWVOcy5wcmVmaXgpOwoKICAgIHJldHVybiBwcmVmaXhlZFRvTmFtZShuYW1lTnMsIHBrZyk7CiAgfQoKICBmdW5jdGlvbiBlcnJvciQxKG1lc3NhZ2UpIHsKICAgIHJldHVybiBuZXcgRXJyb3IobWVzc2FnZSk7CiAgfQoKICAvKioKICAgKiBHZXQgdGhlIG1vZGRsZSBkZXNjcmlwdG9yIGZvciBhIGdpdmVuIGluc3RhbmNlIG9yIHR5cGUuCiAgICoKICAgKiBAcGFyYW0gIHtNb2RkbGVFbGVtZW50fEZ1bmN0aW9ufSBlbGVtZW50CiAgICoKICAgKiBAcmV0dXJuIHtPYmplY3R9IHRoZSBtb2RkbGUgZGVzY3JpcHRvcgogICAqLwogIGZ1bmN0aW9uIGdldE1vZGRsZURlc2NyaXB0b3IoZWxlbWVudCkgewogICAgcmV0dXJuIGVsZW1lbnQuJGRlc2NyaXB0b3I7CiAgfQoKICBmdW5jdGlvbiBkZWZlcihmbikgewogICAgc2V0VGltZW91dChmbiwgMCk7CiAgfQoKICAvKioKICAgKiBBIHBhcnNlIGNvbnRleHQuCiAgICoKICAgKiBAY2xhc3MKICAgKgogICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zCiAgICogQHBhcmFtIHtFbGVtZW50SGFuZGxlcn0gb3B0aW9ucy5yb290SGFuZGxlciB0aGUgcm9vdCBoYW5kbGVyIGZvciBwYXJzaW5nIGEgZG9jdW1lbnQKICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtvcHRpb25zLmxheD1mYWxzZV0gd2hldGhlciBvciBub3QgdG8gaWdub3JlIGludmFsaWQgZWxlbWVudHMKICAgKi8KICBmdW5jdGlvbiBDb250ZXh0KG9wdGlvbnMpIHsKCiAgICAvKioKICAgICAqIEBwcm9wZXJ0eSB7RWxlbWVudEhhbmRsZXJ9IHJvb3RIYW5kbGVyCiAgICAgKi8KCiAgICAvKioKICAgICAqIEBwcm9wZXJ0eSB7Qm9vbGVhbn0gbGF4CiAgICAgKi8KCiAgICBhc3NpZ24odGhpcywgb3B0aW9ucyk7CgogICAgdGhpcy5lbGVtZW50c0J5SWQgPSB7fTsKICAgIHRoaXMucmVmZXJlbmNlcyA9IFtdOwogICAgdGhpcy53YXJuaW5ncyA9IFtdOwoKICAgIC8qKgogICAgICogQWRkIGFuIHVucmVzb2x2ZWQgcmVmZXJlbmNlLgogICAgICoKICAgICAqIEBwYXJhbSB7T2JqZWN0fSByZWZlcmVuY2UKICAgICAqLwogICAgdGhpcy5hZGRSZWZlcmVuY2UgPSBmdW5jdGlvbihyZWZlcmVuY2UpIHsKICAgICAgdGhpcy5yZWZlcmVuY2VzLnB1c2gocmVmZXJlbmNlKTsKICAgIH07CgogICAgLyoqCiAgICAgKiBBZGQgYSBwcm9jZXNzZWQgZWxlbWVudC4KICAgICAqCiAgICAgKiBAcGFyYW0ge01vZGRsZUVsZW1lbnR9IGVsZW1lbnQKICAgICAqLwogICAgdGhpcy5hZGRFbGVtZW50ID0gZnVuY3Rpb24oZWxlbWVudCkgewoKICAgICAgaWYgKCFlbGVtZW50KSB7CiAgICAgICAgdGhyb3cgZXJyb3IkMSgnZXhwZWN0ZWQgZWxlbWVudCcpOwogICAgICB9CgogICAgICB2YXIgZWxlbWVudHNCeUlkID0gdGhpcy5lbGVtZW50c0J5SWQ7CgogICAgICB2YXIgZGVzY3JpcHRvciA9IGdldE1vZGRsZURlc2NyaXB0b3IoZWxlbWVudCk7CgogICAgICB2YXIgaWRQcm9wZXJ0eSA9IGRlc2NyaXB0b3IuaWRQcm9wZXJ0eSwKICAgICAgICAgIGlkOwoKICAgICAgaWYgKGlkUHJvcGVydHkpIHsKICAgICAgICBpZCA9IGVsZW1lbnQuZ2V0KGlkUHJvcGVydHkubmFtZSk7CgogICAgICAgIGlmIChpZCkgewogICAgICAgICAgLy8gZm9yIFFOYW1lIHZhbGlkYXRpb24gYXMgcGVyIGh0dHA6Ly93d3cudzMub3JnL1RSL1JFQy14bWwvI05ULU5hbWVDaGFyCiAgICAgICAgICBpZiAoIS9eKFthLXpdW1x3LS5dKjopP1thLXpfXVtcdy0uXSokL2kudGVzdChpZCkpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdpbGxlZ2FsIElEIDwnICsgaWQgKyAnPicpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChlbGVtZW50c0J5SWRbaWRdKSB7CiAgICAgICAgICAgIHRocm93IGVycm9yJDEoJ2R1cGxpY2F0ZSBJRCA8JyArIGlkICsgJz4nKTsKICAgICAgICAgIH0KCiAgICAgICAgICBlbGVtZW50c0J5SWRbaWRdID0gZWxlbWVudDsKICAgICAgICB9CiAgICAgIH0KICAgIH07CgogICAgLyoqCiAgICAgKiBBZGQgYW4gaW1wb3J0IHdhcm5pbmcuCiAgICAgKgogICAgICogQHBhcmFtIHtPYmplY3R9IHdhcm5pbmcKICAgICAqIEBwYXJhbSB7U3RyaW5nfSB3YXJuaW5nLm1lc3NhZ2UKICAgICAqIEBwYXJhbSB7RXJyb3J9IFt3YXJuaW5nLmVycm9yXQogICAgICovCiAgICB0aGlzLmFkZFdhcm5pbmcgPSBmdW5jdGlvbih3YXJuaW5nKSB7CiAgICAgIHRoaXMud2FybmluZ3MucHVzaCh3YXJuaW5nKTsKICAgIH07CiAgfQoKICBmdW5jdGlvbiBCYXNlSGFuZGxlcigpIHt9CgogIEJhc2VIYW5kbGVyLnByb3RvdHlwZS5oYW5kbGVFbmQgPSBmdW5jdGlvbigpIHt9OwogIEJhc2VIYW5kbGVyLnByb3RvdHlwZS5oYW5kbGVUZXh0ID0gZnVuY3Rpb24oKSB7fTsKICBCYXNlSGFuZGxlci5wcm90b3R5cGUuaGFuZGxlTm9kZSA9IGZ1bmN0aW9uKCkge307CgoKICAvKioKICAgKiBBIHNpbXBsZSBwYXNzIHRocm91Z2ggaGFuZGxlciB0aGF0IGRvZXMgbm90aGluZyBleGNlcHQgZm9yCiAgICogaWdub3JpbmcgYWxsIGlucHV0IGl0IHJlY2VpdmVzLgogICAqCiAgICogVGhpcyBpcyB1c2VkIHRvIGlnbm9yZSB1bmtub3duIGVsZW1lbnRzIGFuZAogICAqIGF0dHJpYnV0ZXMuCiAgICovCiAgZnVuY3Rpb24gTm9vcEhhbmRsZXIoKSB7IH0KCiAgTm9vcEhhbmRsZXIucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShCYXNlSGFuZGxlci5wcm90b3R5cGUpOwoKICBOb29wSGFuZGxlci5wcm90b3R5cGUuaGFuZGxlTm9kZSA9IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIHRoaXM7CiAgfTsKCiAgZnVuY3Rpb24gQm9keUhhbmRsZXIoKSB7fQoKICBCb2R5SGFuZGxlci5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKEJhc2VIYW5kbGVyLnByb3RvdHlwZSk7CgogIEJvZHlIYW5kbGVyLnByb3RvdHlwZS5oYW5kbGVUZXh0ID0gZnVuY3Rpb24odGV4dCkgewogICAgdGhpcy5ib2R5ID0gKHRoaXMuYm9keSB8fCAnJykgKyB0ZXh0OwogIH07CgogIGZ1bmN0aW9uIFJlZmVyZW5jZUhhbmRsZXIocHJvcGVydHksIGNvbnRleHQpIHsKICAgIHRoaXMucHJvcGVydHkgPSBwcm9wZXJ0eTsKICAgIHRoaXMuY29udGV4dCA9IGNvbnRleHQ7CiAgfQoKICBSZWZlcmVuY2VIYW5kbGVyLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoQm9keUhhbmRsZXIucHJvdG90eXBlKTsKCiAgUmVmZXJlbmNlSGFuZGxlci5wcm90b3R5cGUuaGFuZGxlTm9kZSA9IGZ1bmN0aW9uKG5vZGUpIHsKCiAgICBpZiAodGhpcy5lbGVtZW50KSB7CiAgICAgIHRocm93IGVycm9yJDEoJ2V4cGVjdGVkIG5vIHN1YiBub2RlcycpOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5lbGVtZW50ID0gdGhpcy5jcmVhdGVSZWZlcmVuY2Uobm9kZSk7CiAgICB9CgogICAgcmV0dXJuIHRoaXM7CiAgfTsKCiAgUmVmZXJlbmNlSGFuZGxlci5wcm90b3R5cGUuaGFuZGxlRW5kID0gZnVuY3Rpb24oKSB7CiAgICB0aGlzLmVsZW1lbnQuaWQgPSB0aGlzLmJvZHk7CiAgfTsKCiAgUmVmZXJlbmNlSGFuZGxlci5wcm90b3R5cGUuY3JlYXRlUmVmZXJlbmNlID0gZnVuY3Rpb24obm9kZSkgewogICAgcmV0dXJuIHsKICAgICAgcHJvcGVydHk6IHRoaXMucHJvcGVydHkubnMubmFtZSwKICAgICAgaWQ6ICcnCiAgICB9OwogIH07CgogIGZ1bmN0aW9uIFZhbHVlSGFuZGxlcihwcm9wZXJ0eURlc2MsIGVsZW1lbnQpIHsKICAgIHRoaXMuZWxlbWVudCA9IGVsZW1lbnQ7CiAgICB0aGlzLnByb3BlcnR5RGVzYyA9IHByb3BlcnR5RGVzYzsKICB9CgogIFZhbHVlSGFuZGxlci5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKEJvZHlIYW5kbGVyLnByb3RvdHlwZSk7CgogIFZhbHVlSGFuZGxlci5wcm90b3R5cGUuaGFuZGxlRW5kID0gZnVuY3Rpb24oKSB7CgogICAgdmFyIHZhbHVlID0gdGhpcy5ib2R5IHx8ICcnLAogICAgICAgIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsCiAgICAgICAgcHJvcGVydHlEZXNjID0gdGhpcy5wcm9wZXJ0eURlc2M7CgogICAgdmFsdWUgPSBjb2VyY2VUeXBlKHByb3BlcnR5RGVzYy50eXBlLCB2YWx1ZSk7CgogICAgaWYgKHByb3BlcnR5RGVzYy5pc01hbnkpIHsKICAgICAgZWxlbWVudC5nZXQocHJvcGVydHlEZXNjLm5hbWUpLnB1c2godmFsdWUpOwogICAgfSBlbHNlIHsKICAgICAgZWxlbWVudC5zZXQocHJvcGVydHlEZXNjLm5hbWUsIHZhbHVlKTsKICAgIH0KICB9OwoKCiAgZnVuY3Rpb24gQmFzZUVsZW1lbnRIYW5kbGVyKCkge30KCiAgQmFzZUVsZW1lbnRIYW5kbGVyLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoQm9keUhhbmRsZXIucHJvdG90eXBlKTsKCiAgQmFzZUVsZW1lbnRIYW5kbGVyLnByb3RvdHlwZS5oYW5kbGVOb2RlID0gZnVuY3Rpb24obm9kZSkgewogICAgdmFyIHBhcnNlciA9IHRoaXMsCiAgICAgICAgZWxlbWVudCA9IHRoaXMuZWxlbWVudDsKCiAgICBpZiAoIWVsZW1lbnQpIHsKICAgICAgZWxlbWVudCA9IHRoaXMuZWxlbWVudCA9IHRoaXMuY3JlYXRlRWxlbWVudChub2RlKTsKCiAgICAgIHRoaXMuY29udGV4dC5hZGRFbGVtZW50KGVsZW1lbnQpOwogICAgfSBlbHNlIHsKICAgICAgcGFyc2VyID0gdGhpcy5oYW5kbGVDaGlsZChub2RlKTsKICAgIH0KCiAgICByZXR1cm4gcGFyc2VyOwogIH07CgogIC8qKgogICAqIEBjbGFzcyBSZWFkZXIuRWxlbWVudEhhbmRsZXIKICAgKgogICAqLwogIGZ1bmN0aW9uIEVsZW1lbnRIYW5kbGVyKG1vZGVsLCB0eXBlTmFtZSwgY29udGV4dCkgewogICAgdGhpcy5tb2RlbCA9IG1vZGVsOwogICAgdGhpcy50eXBlID0gbW9kZWwuZ2V0VHlwZSh0eXBlTmFtZSk7CiAgICB0aGlzLmNvbnRleHQgPSBjb250ZXh0OwogIH0KCiAgRWxlbWVudEhhbmRsZXIucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShCYXNlRWxlbWVudEhhbmRsZXIucHJvdG90eXBlKTsKCiAgRWxlbWVudEhhbmRsZXIucHJvdG90eXBlLmFkZFJlZmVyZW5jZSA9IGZ1bmN0aW9uKHJlZmVyZW5jZSkgewogICAgdGhpcy5jb250ZXh0LmFkZFJlZmVyZW5jZShyZWZlcmVuY2UpOwogIH07CgogIEVsZW1lbnRIYW5kbGVyLnByb3RvdHlwZS5oYW5kbGVUZXh0ID0gZnVuY3Rpb24odGV4dCkgewoKICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50LAogICAgICAgIGRlc2NyaXB0b3IgPSBnZXRNb2RkbGVEZXNjcmlwdG9yKGVsZW1lbnQpLAogICAgICAgIGJvZHlQcm9wZXJ0eSA9IGRlc2NyaXB0b3IuYm9keVByb3BlcnR5OwoKICAgIGlmICghYm9keVByb3BlcnR5KSB7CiAgICAgIHRocm93IGVycm9yJDEoJ3VuZXhwZWN0ZWQgYm9keSB0ZXh0IDwnICsgdGV4dCArICc+Jyk7CiAgICB9CgogICAgQm9keUhhbmRsZXIucHJvdG90eXBlLmhhbmRsZVRleHQuY2FsbCh0aGlzLCB0ZXh0KTsKICB9OwoKICBFbGVtZW50SGFuZGxlci5wcm90b3R5cGUuaGFuZGxlRW5kID0gZnVuY3Rpb24oKSB7CgogICAgdmFyIHZhbHVlID0gdGhpcy5ib2R5LAogICAgICAgIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQsCiAgICAgICAgZGVzY3JpcHRvciA9IGdldE1vZGRsZURlc2NyaXB0b3IoZWxlbWVudCksCiAgICAgICAgYm9keVByb3BlcnR5ID0gZGVzY3JpcHRvci5ib2R5UHJvcGVydHk7CgogICAgaWYgKGJvZHlQcm9wZXJ0eSAmJiB2YWx1ZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIHZhbHVlID0gY29lcmNlVHlwZShib2R5UHJvcGVydHkudHlwZSwgdmFsdWUpOwogICAgICBlbGVtZW50LnNldChib2R5UHJvcGVydHkubmFtZSwgdmFsdWUpOwogICAgfQogIH07CgogIC8qKgogICAqIENyZWF0ZSBhbiBpbnN0YW5jZSBvZiB0aGUgbW9kZWwgZnJvbSB0aGUgZ2l2ZW4gbm9kZS4KICAgKgogICAqIEBwYXJhbSAge0VsZW1lbnR9IG5vZGUgdGhlIHhtbCBub2RlCiAgICovCiAgRWxlbWVudEhhbmRsZXIucHJvdG90eXBlLmNyZWF0ZUVsZW1lbnQgPSBmdW5jdGlvbihub2RlKSB7CiAgICB2YXIgYXR0cmlidXRlcyA9IG5vZGUuYXR0cmlidXRlcywKICAgICAgICBUeXBlID0gdGhpcy50eXBlLAogICAgICAgIGRlc2NyaXB0b3IgPSBnZXRNb2RkbGVEZXNjcmlwdG9yKFR5cGUpLAogICAgICAgIGNvbnRleHQgPSB0aGlzLmNvbnRleHQsCiAgICAgICAgaW5zdGFuY2UgPSBuZXcgVHlwZSh7fSksCiAgICAgICAgbW9kZWwgPSB0aGlzLm1vZGVsLAogICAgICAgIHByb3BOYW1lTnM7CgogICAgZm9yRWFjaChhdHRyaWJ1dGVzLCBmdW5jdGlvbih2YWx1ZSwgbmFtZSkgewoKICAgICAgdmFyIHByb3AgPSBkZXNjcmlwdG9yLnByb3BlcnRpZXNCeU5hbWVbbmFtZV0sCiAgICAgICAgICB2YWx1ZXM7CgogICAgICBpZiAocHJvcCAmJiBwcm9wLmlzUmVmZXJlbmNlKSB7CgogICAgICAgIGlmICghcHJvcC5pc01hbnkpIHsKICAgICAgICAgIGNvbnRleHQuYWRkUmVmZXJlbmNlKHsKICAgICAgICAgICAgZWxlbWVudDogaW5zdGFuY2UsCiAgICAgICAgICAgIHByb3BlcnR5OiBwcm9wLm5zLm5hbWUsCiAgICAgICAgICAgIGlkOiB2YWx1ZQogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIC8vIElEUkVGUzogcGFyc2UgcmVmZXJlbmNlcyBhcyB3aGl0ZXNwYWNlLXNlcGFyYXRlZCBsaXN0CiAgICAgICAgICB2YWx1ZXMgPSB2YWx1ZS5zcGxpdCgnICcpOwoKICAgICAgICAgIGZvckVhY2godmFsdWVzLCBmdW5jdGlvbih2KSB7CiAgICAgICAgICAgIGNvbnRleHQuYWRkUmVmZXJlbmNlKHsKICAgICAgICAgICAgICBlbGVtZW50OiBpbnN0YW5jZSwKICAgICAgICAgICAgICBwcm9wZXJ0eTogcHJvcC5ucy5uYW1lLAogICAgICAgICAgICAgIGlkOiB2CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAocHJvcCkgewogICAgICAgICAgdmFsdWUgPSBjb2VyY2VUeXBlKHByb3AudHlwZSwgdmFsdWUpOwogICAgICAgIH0gZWxzZQogICAgICAgIGlmIChuYW1lICE9PSAneG1sbnMnKSB7CiAgICAgICAgICBwcm9wTmFtZU5zID0gcGFyc2VOYW1lKG5hbWUsIGRlc2NyaXB0b3IubnMucHJlZml4KTsKCiAgICAgICAgICAvLyBjaGVjayB3aGV0aGVyIGF0dHJpYnV0ZSBpcyBkZWZpbmVkIGluIGEgd2VsbC1rbm93biBuYW1lc3BhY2UKICAgICAgICAgIC8vIGlmIHRoYXQgaXMgdGhlIGNhc2Ugd2UgZW1pdCBhIHdhcm5pbmcgdG8gaW5kaWNhdGUgcG90ZW50aWFsIG1pc3VzZQogICAgICAgICAgaWYgKG1vZGVsLmdldFBhY2thZ2UocHJvcE5hbWVOcy5wcmVmaXgpKSB7CgogICAgICAgICAgICBjb250ZXh0LmFkZFdhcm5pbmcoewogICAgICAgICAgICAgIG1lc3NhZ2U6ICd1bmtub3duIGF0dHJpYnV0ZSA8JyArIG5hbWUgKyAnPicsCiAgICAgICAgICAgICAgZWxlbWVudDogaW5zdGFuY2UsCiAgICAgICAgICAgICAgcHJvcGVydHk6IG5hbWUsCiAgICAgICAgICAgICAgdmFsdWU6IHZhbHVlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaW5zdGFuY2Uuc2V0KG5hbWUsIHZhbHVlKTsKICAgICAgfQogICAgfSk7CgogICAgcmV0dXJuIGluc3RhbmNlOwogIH07CgogIEVsZW1lbnRIYW5kbGVyLnByb3RvdHlwZS5nZXRQcm9wZXJ0eUZvck5vZGUgPSBmdW5jdGlvbihub2RlKSB7CgogICAgdmFyIG5hbWUgPSBub2RlLm5hbWU7CiAgICB2YXIgbmFtZU5zID0gcGFyc2VOYW1lKG5hbWUpOwoKICAgIHZhciB0eXBlID0gdGhpcy50eXBlLAogICAgICAgIG1vZGVsID0gdGhpcy5tb2RlbCwKICAgICAgICBkZXNjcmlwdG9yID0gZ2V0TW9kZGxlRGVzY3JpcHRvcih0eXBlKTsKCiAgICB2YXIgcHJvcGVydHlOYW1lID0gbmFtZU5zLm5hbWUsCiAgICAgICAgcHJvcGVydHkgPSBkZXNjcmlwdG9yLnByb3BlcnRpZXNCeU5hbWVbcHJvcGVydHlOYW1lXSwKICAgICAgICBlbGVtZW50VHlwZU5hbWUsCiAgICAgICAgZWxlbWVudFR5cGU7CgogICAgLy8gc2VhcmNoIGZvciBwcm9wZXJ0aWVzIGJ5IG5hbWUgZmlyc3QKCiAgICBpZiAocHJvcGVydHkpIHsKCiAgICAgIGlmIChzZXJpYWxpemVBc1R5cGUocHJvcGVydHkpKSB7CiAgICAgICAgZWxlbWVudFR5cGVOYW1lID0gbm9kZS5hdHRyaWJ1dGVzW1hTSV9UWVBFJDFdOwoKICAgICAgICAvLyB4c2kgdHlwZSBpcyBvcHRpb25hbCwgaWYgaXQgZG9lcyBub3QgZXhpc3RzIHRoZQogICAgICAgIC8vIGRlZmF1bHQgdHlwZSBpcyBhc3N1bWVkCiAgICAgICAgaWYgKGVsZW1lbnRUeXBlTmFtZSkgewoKICAgICAgICAgIC8vIHRha2UgcG9zc2libGUgdHlwZSBwcmVmaXhlcyBmcm9tIFhNTAogICAgICAgICAgLy8gaW50byBhY2NvdW50LCBpLmUuOiB4c2k6dHlwZT0idHtBY3R1YWxUeXBlfSIKICAgICAgICAgIGVsZW1lbnRUeXBlTmFtZSA9IG5vcm1hbGl6ZVhzaVR5cGVOYW1lKGVsZW1lbnRUeXBlTmFtZSwgbW9kZWwpOwoKICAgICAgICAgIGVsZW1lbnRUeXBlID0gbW9kZWwuZ2V0VHlwZShlbGVtZW50VHlwZU5hbWUpOwoKICAgICAgICAgIHJldHVybiBhc3NpZ24oe30sIHByb3BlcnR5LCB7CiAgICAgICAgICAgIGVmZmVjdGl2ZVR5cGU6IGdldE1vZGRsZURlc2NyaXB0b3IoZWxlbWVudFR5cGUpLm5hbWUKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfQoKICAgICAgLy8gc2VhcmNoIGZvciBwcm9wZXJ0aWVzIGJ5IG5hbWUgZmlyc3QKICAgICAgcmV0dXJuIHByb3BlcnR5OwogICAgfQoKICAgIHZhciBwa2cgPSBtb2RlbC5nZXRQYWNrYWdlKG5hbWVOcy5wcmVmaXgpOwoKICAgIGlmIChwa2cpIHsKICAgICAgZWxlbWVudFR5cGVOYW1lID0gYWxpYXNUb05hbWUobmFtZU5zLCBwa2cpOwogICAgICBlbGVtZW50VHlwZSA9IG1vZGVsLmdldFR5cGUoZWxlbWVudFR5cGVOYW1lKTsKCiAgICAgIC8vIHNlYXJjaCBmb3IgY29sbGVjdGlvbiBtZW1iZXJzIGxhdGVyCiAgICAgIHByb3BlcnR5ID0gZmluZChkZXNjcmlwdG9yLnByb3BlcnRpZXMsIGZ1bmN0aW9uKHApIHsKICAgICAgICByZXR1cm4gIXAuaXNWaXJ0dWFsICYmICFwLmlzUmVmZXJlbmNlICYmICFwLmlzQXR0cmlidXRlICYmIGVsZW1lbnRUeXBlLmhhc1R5cGUocC50eXBlKTsKICAgICAgfSk7CgogICAgICBpZiAocHJvcGVydHkpIHsKICAgICAgICByZXR1cm4gYXNzaWduKHt9LCBwcm9wZXJ0eSwgewogICAgICAgICAgZWZmZWN0aXZlVHlwZTogZ2V0TW9kZGxlRGVzY3JpcHRvcihlbGVtZW50VHlwZSkubmFtZQogICAgICAgIH0pOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICAvLyBwYXJzZSB1bmtub3duIGVsZW1lbnQgKG1heWJlIGV4dGVuc2lvbikKICAgICAgcHJvcGVydHkgPSBmaW5kKGRlc2NyaXB0b3IucHJvcGVydGllcywgZnVuY3Rpb24ocCkgewogICAgICAgIHJldHVybiAhcC5pc1JlZmVyZW5jZSAmJiAhcC5pc0F0dHJpYnV0ZSAmJiBwLnR5cGUgPT09ICdFbGVtZW50JzsKICAgICAgfSk7CgogICAgICBpZiAocHJvcGVydHkpIHsKICAgICAgICByZXR1cm4gcHJvcGVydHk7CiAgICAgIH0KICAgIH0KCiAgICB0aHJvdyBlcnJvciQxKCd1bnJlY29nbml6ZWQgZWxlbWVudCA8JyArIG5hbWVOcy5uYW1lICsgJz4nKTsKICB9OwoKICBFbGVtZW50SGFuZGxlci5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiAnRWxlbWVudERlc2NyaXB0b3JbJyArIGdldE1vZGRsZURlc2NyaXB0b3IodGhpcy50eXBlKS5uYW1lICsgJ10nOwogIH07CgogIEVsZW1lbnRIYW5kbGVyLnByb3RvdHlwZS52YWx1ZUhhbmRsZXIgPSBmdW5jdGlvbihwcm9wZXJ0eURlc2MsIGVsZW1lbnQpIHsKICAgIHJldHVybiBuZXcgVmFsdWVIYW5kbGVyKHByb3BlcnR5RGVzYywgZWxlbWVudCk7CiAgfTsKCiAgRWxlbWVudEhhbmRsZXIucHJvdG90eXBlLnJlZmVyZW5jZUhhbmRsZXIgPSBmdW5jdGlvbihwcm9wZXJ0eURlc2MpIHsKICAgIHJldHVybiBuZXcgUmVmZXJlbmNlSGFuZGxlcihwcm9wZXJ0eURlc2MsIHRoaXMuY29udGV4dCk7CiAgfTsKCiAgRWxlbWVudEhhbmRsZXIucHJvdG90eXBlLmhhbmRsZXIgPSBmdW5jdGlvbih0eXBlKSB7CiAgICBpZiAodHlwZSA9PT0gJ0VsZW1lbnQnKSB7CiAgICAgIHJldHVybiBuZXcgR2VuZXJpY0VsZW1lbnRIYW5kbGVyKHRoaXMubW9kZWwsIHR5cGUsIHRoaXMuY29udGV4dCk7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gbmV3IEVsZW1lbnRIYW5kbGVyKHRoaXMubW9kZWwsIHR5cGUsIHRoaXMuY29udGV4dCk7CiAgICB9CiAgfTsKCiAgLyoqCiAgICogSGFuZGxlIHRoZSBjaGlsZCBlbGVtZW50IHBhcnNpbmcKICAgKgogICAqIEBwYXJhbSAge0VsZW1lbnR9IG5vZGUgdGhlIHhtbCBub2RlCiAgICovCiAgRWxlbWVudEhhbmRsZXIucHJvdG90eXBlLmhhbmRsZUNoaWxkID0gZnVuY3Rpb24obm9kZSkgewogICAgdmFyIHByb3BlcnR5RGVzYywgdHlwZSwgZWxlbWVudCwgY2hpbGRIYW5kbGVyOwoKICAgIHByb3BlcnR5RGVzYyA9IHRoaXMuZ2V0UHJvcGVydHlGb3JOb2RlKG5vZGUpOwogICAgZWxlbWVudCA9IHRoaXMuZWxlbWVudDsKCiAgICB0eXBlID0gcHJvcGVydHlEZXNjLmVmZmVjdGl2ZVR5cGUgfHwgcHJvcGVydHlEZXNjLnR5cGU7CgogICAgaWYgKGlzU2ltcGxlKHR5cGUpKSB7CiAgICAgIHJldHVybiB0aGlzLnZhbHVlSGFuZGxlcihwcm9wZXJ0eURlc2MsIGVsZW1lbnQpOwogICAgfQoKICAgIGlmIChwcm9wZXJ0eURlc2MuaXNSZWZlcmVuY2UpIHsKICAgICAgY2hpbGRIYW5kbGVyID0gdGhpcy5yZWZlcmVuY2VIYW5kbGVyKHByb3BlcnR5RGVzYykuaGFuZGxlTm9kZShub2RlKTsKICAgIH0gZWxzZSB7CiAgICAgIGNoaWxkSGFuZGxlciA9IHRoaXMuaGFuZGxlcih0eXBlKS5oYW5kbGVOb2RlKG5vZGUpOwogICAgfQoKICAgIHZhciBuZXdFbGVtZW50ID0gY2hpbGRIYW5kbGVyLmVsZW1lbnQ7CgogICAgLy8gY2hpbGQgaGFuZGxlcyBtYXkgZGVjaWRlIHRvIHNraXAgZWxlbWVudHMKICAgIC8vIGJ5IG5vdCByZXR1cm5pbmcgYW55dGhpbmcKICAgIGlmIChuZXdFbGVtZW50ICE9PSB1bmRlZmluZWQpIHsKCiAgICAgIGlmIChwcm9wZXJ0eURlc2MuaXNNYW55KSB7CiAgICAgICAgZWxlbWVudC5nZXQocHJvcGVydHlEZXNjLm5hbWUpLnB1c2gobmV3RWxlbWVudCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZWxlbWVudC5zZXQocHJvcGVydHlEZXNjLm5hbWUsIG5ld0VsZW1lbnQpOwogICAgICB9CgogICAgICBpZiAocHJvcGVydHlEZXNjLmlzUmVmZXJlbmNlKSB7CiAgICAgICAgYXNzaWduKG5ld0VsZW1lbnQsIHsKICAgICAgICAgIGVsZW1lbnQ6IGVsZW1lbnQKICAgICAgICB9KTsKCiAgICAgICAgdGhpcy5jb250ZXh0LmFkZFJlZmVyZW5jZShuZXdFbGVtZW50KTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBlc3RhYmxpc2ggY2hpbGQgLT4gcGFyZW50IHJlbGF0aW9uc2hpcAogICAgICAgIG5ld0VsZW1lbnQuJHBhcmVudCA9IGVsZW1lbnQ7CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gY2hpbGRIYW5kbGVyOwogIH07CgogIC8qKgogICAqIEFuIGVsZW1lbnQgaGFuZGxlciB0aGF0IHBlcmZvcm1zIHNwZWNpYWwgdmFsaWRhdGlvbgogICAqIHRvIGVuc3VyZSB0aGUgbm9kZSBpdCBnZXRzIGluaXRpYWxpemVkIHdpdGggbWF0Y2hlcwogICAqIHRoZSBoYW5kbGVycyB0eXBlIChuYW1lc3BhY2Ugd2lzZSkuCiAgICoKICAgKiBAcGFyYW0ge01vZGRsZX0gbW9kZWwKICAgKiBAcGFyYW0ge1N0cmluZ30gdHlwZU5hbWUKICAgKiBAcGFyYW0ge0NvbnRleHR9IGNvbnRleHQKICAgKi8KICBmdW5jdGlvbiBSb290RWxlbWVudEhhbmRsZXIobW9kZWwsIHR5cGVOYW1lLCBjb250ZXh0KSB7CiAgICBFbGVtZW50SGFuZGxlci5jYWxsKHRoaXMsIG1vZGVsLCB0eXBlTmFtZSwgY29udGV4dCk7CiAgfQoKICBSb290RWxlbWVudEhhbmRsZXIucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShFbGVtZW50SGFuZGxlci5wcm90b3R5cGUpOwoKICBSb290RWxlbWVudEhhbmRsZXIucHJvdG90eXBlLmNyZWF0ZUVsZW1lbnQgPSBmdW5jdGlvbihub2RlKSB7CgogICAgdmFyIG5hbWUgPSBub2RlLm5hbWUsCiAgICAgICAgbmFtZU5zID0gcGFyc2VOYW1lKG5hbWUpLAogICAgICAgIG1vZGVsID0gdGhpcy5tb2RlbCwKICAgICAgICB0eXBlID0gdGhpcy50eXBlLAogICAgICAgIHBrZyA9IG1vZGVsLmdldFBhY2thZ2UobmFtZU5zLnByZWZpeCksCiAgICAgICAgdHlwZU5hbWUgPSBwa2cgJiYgYWxpYXNUb05hbWUobmFtZU5zLCBwa2cpIHx8IG5hbWU7CgogICAgLy8gdmVyaWZ5IHRoZSBjb3JyZWN0IG5hbWVzcGFjZSBpZiB3ZSBwYXJzZQogICAgLy8gdGhlIGZpcnN0IGVsZW1lbnQgaW4gdGhlIGhhbmRsZXIgdHJlZQogICAgLy8KICAgIC8vIHRoaXMgZW5zdXJlcyB3ZSBkb24ndCBtaXN0YWtlbmx5IGltcG9ydCB3cm9uZyBuYW1lc3BhY2UgZWxlbWVudHMKICAgIGlmICghdHlwZS5oYXNUeXBlKHR5cGVOYW1lKSkgewogICAgICB0aHJvdyBlcnJvciQxKCd1bmV4cGVjdGVkIGVsZW1lbnQgPCcgKyBub2RlLm9yaWdpbmFsTmFtZSArICc+Jyk7CiAgICB9CgogICAgcmV0dXJuIEVsZW1lbnRIYW5kbGVyLnByb3RvdHlwZS5jcmVhdGVFbGVtZW50LmNhbGwodGhpcywgbm9kZSk7CiAgfTsKCgogIGZ1bmN0aW9uIEdlbmVyaWNFbGVtZW50SGFuZGxlcihtb2RlbCwgdHlwZU5hbWUsIGNvbnRleHQpIHsKICAgIHRoaXMubW9kZWwgPSBtb2RlbDsKICAgIHRoaXMuY29udGV4dCA9IGNvbnRleHQ7CiAgfQoKICBHZW5lcmljRWxlbWVudEhhbmRsZXIucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShCYXNlRWxlbWVudEhhbmRsZXIucHJvdG90eXBlKTsKCiAgR2VuZXJpY0VsZW1lbnRIYW5kbGVyLnByb3RvdHlwZS5jcmVhdGVFbGVtZW50ID0gZnVuY3Rpb24obm9kZSkgewoKICAgIHZhciBuYW1lID0gbm9kZS5uYW1lLAogICAgICAgIG5zID0gcGFyc2VOYW1lKG5hbWUpLAogICAgICAgIHByZWZpeCA9IG5zLnByZWZpeCwKICAgICAgICB1cmkgPSBub2RlLm5zW3ByZWZpeCArICckdXJpJ10sCiAgICAgICAgYXR0cmlidXRlcyA9IG5vZGUuYXR0cmlidXRlczsKCiAgICByZXR1cm4gdGhpcy5tb2RlbC5jcmVhdGVBbnkobmFtZSwgdXJpLCBhdHRyaWJ1dGVzKTsKICB9OwoKICBHZW5lcmljRWxlbWVudEhhbmRsZXIucHJvdG90eXBlLmhhbmRsZUNoaWxkID0gZnVuY3Rpb24obm9kZSkgewoKICAgIHZhciBoYW5kbGVyID0gbmV3IEdlbmVyaWNFbGVtZW50SGFuZGxlcih0aGlzLm1vZGVsLCAnRWxlbWVudCcsIHRoaXMuY29udGV4dCkuaGFuZGxlTm9kZShub2RlKSwKICAgICAgICBlbGVtZW50ID0gdGhpcy5lbGVtZW50OwoKICAgIHZhciBuZXdFbGVtZW50ID0gaGFuZGxlci5lbGVtZW50LAogICAgICAgIGNoaWxkcmVuOwoKICAgIGlmIChuZXdFbGVtZW50ICE9PSB1bmRlZmluZWQpIHsKICAgICAgY2hpbGRyZW4gPSBlbGVtZW50LiRjaGlsZHJlbiA9IGVsZW1lbnQuJGNoaWxkcmVuIHx8IFtdOwogICAgICBjaGlsZHJlbi5wdXNoKG5ld0VsZW1lbnQpOwoKICAgICAgLy8gZXN0YWJsaXNoIGNoaWxkIC0+IHBhcmVudCByZWxhdGlvbnNoaXAKICAgICAgbmV3RWxlbWVudC4kcGFyZW50ID0gZWxlbWVudDsKICAgIH0KCiAgICByZXR1cm4gaGFuZGxlcjsKICB9OwoKICBHZW5lcmljRWxlbWVudEhhbmRsZXIucHJvdG90eXBlLmhhbmRsZUVuZCA9IGZ1bmN0aW9uKCkgewogICAgaWYgKHRoaXMuYm9keSkgewogICAgICB0aGlzLmVsZW1lbnQuJGJvZHkgPSB0aGlzLmJvZHk7CiAgICB9CiAgfTsKCiAgLyoqCiAgICogQSByZWFkZXIgZm9yIGEgbWV0YS1tb2RlbAogICAqCiAgICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMKICAgKiBAcGFyYW0ge01vZGVsfSBvcHRpb25zLm1vZGVsIHVzZWQgdG8gcmVhZCB4bWwgZmlsZXMKICAgKiBAcGFyYW0ge0Jvb2xlYW59IG9wdGlvbnMubGF4IHdoZXRoZXIgdG8gbWFrZSBwYXJzZSBlcnJvcnMgd2FybmluZ3MKICAgKi8KICBmdW5jdGlvbiBSZWFkZXIob3B0aW9ucykgewoKICAgIGlmIChvcHRpb25zIGluc3RhbmNlb2YgTW9kZGxlKSB7CiAgICAgIG9wdGlvbnMgPSB7CiAgICAgICAgbW9kZWw6IG9wdGlvbnMKICAgICAgfTsKICAgIH0KCiAgICBhc3NpZ24odGhpcywgeyBsYXg6IGZhbHNlIH0sIG9wdGlvbnMpOwogIH0KCgogIC8qKgogICAqIFBhcnNlIHRoZSBnaXZlbiBYTUwgaW50byBhIG1vZGRsZSBkb2N1bWVudCB0cmVlLgogICAqCiAgICogQHBhcmFtIHtTdHJpbmd9IHhtbAogICAqIEBwYXJhbSB7RWxlbWVudEhhbmRsZXJ8T2JqZWN0fSBvcHRpb25zIG9yIHJvb3RIYW5kbGVyCiAgICogQHBhcmFtICB7RnVuY3Rpb259IGRvbmUKICAgKi8KICBSZWFkZXIucHJvdG90eXBlLmZyb21YTUwgPSBmdW5jdGlvbih4bWwsIG9wdGlvbnMsIGRvbmUpIHsKCiAgICB2YXIgcm9vdEhhbmRsZXIgPSBvcHRpb25zLnJvb3RIYW5kbGVyOwoKICAgIGlmIChvcHRpb25zIGluc3RhbmNlb2YgRWxlbWVudEhhbmRsZXIpIHsKICAgICAgLy8gcm9vdCBoYW5kbGVyIHBhc3NlZCB2aWEgKHhtbCwgeyByb290SGFuZGxlcjogRWxlbWVudEhhbmRsZXIgfSwgLi4uKQogICAgICByb290SGFuZGxlciA9IG9wdGlvbnM7CiAgICAgIG9wdGlvbnMgPSB7fTsKICAgIH0gZWxzZSB7CiAgICAgIGlmICh0eXBlb2Ygb3B0aW9ucyA9PT0gJ3N0cmluZycpIHsKICAgICAgICAvLyByb290SGFuZGxlciBwYXNzZWQgdmlhICh4bWwsICdzb21lU3RyaW5nJywgLi4uKQogICAgICAgIHJvb3RIYW5kbGVyID0gdGhpcy5oYW5kbGVyKG9wdGlvbnMpOwogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfSBlbHNlIGlmICh0eXBlb2Ygcm9vdEhhbmRsZXIgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgLy8gcm9vdEhhbmRsZXIgcGFzc2VkIHZpYSAoeG1sLCB7IHJvb3RIYW5kbGVyOiAnc29tZVN0cmluZycgfSwgLi4uKQogICAgICAgIHJvb3RIYW5kbGVyID0gdGhpcy5oYW5kbGVyKHJvb3RIYW5kbGVyKTsKICAgICAgfQogICAgfQoKICAgIHZhciBtb2RlbCA9IHRoaXMubW9kZWwsCiAgICAgICAgbGF4ID0gdGhpcy5sYXg7CgogICAgdmFyIGNvbnRleHQgPSBuZXcgQ29udGV4dChhc3NpZ24oe30sIG9wdGlvbnMsIHsgcm9vdEhhbmRsZXI6IHJvb3RIYW5kbGVyIH0pKSwKICAgICAgICBwYXJzZXIgPSBuZXcgUGFyc2VyKHsgcHJveHk6IHRydWUgfSksCiAgICAgICAgc3RhY2sgPSBjcmVhdGVTdGFjaygpOwoKICAgIHJvb3RIYW5kbGVyLmNvbnRleHQgPSBjb250ZXh0OwoKICAgIC8vIHB1c2ggcm9vdCBoYW5kbGVyCiAgICBzdGFjay5wdXNoKHJvb3RIYW5kbGVyKTsKCgogICAgLyoqCiAgICAgKiBIYW5kbGUgZXJyb3IuCiAgICAgKgogICAgICogQHBhcmFtICB7RXJyb3J9IGVycgogICAgICogQHBhcmFtICB7RnVuY3Rpb259IGdldENvbnRleHQKICAgICAqIEBwYXJhbSAge2Jvb2xlYW59IGxheAogICAgICoKICAgICAqIEByZXR1cm4ge2Jvb2xlYW59IHRydWUgaWYgaGFuZGxlZAogICAgICovCiAgICBmdW5jdGlvbiBoYW5kbGVFcnJvcihlcnIsIGdldENvbnRleHQsIGxheCkgewoKICAgICAgdmFyIGN0eCA9IGdldENvbnRleHQoKTsKCiAgICAgIHZhciBsaW5lID0gY3R4LmxpbmUsCiAgICAgICAgICBjb2x1bW4gPSBjdHguY29sdW1uLAogICAgICAgICAgZGF0YSA9IGN0eC5kYXRhOwoKICAgICAgLy8gd2UgcmVjZWl2ZSB0aGUgZnVsbCBjb250ZXh0IGRhdGEgaGVyZSwKICAgICAgLy8gZm9yIGVsZW1lbnRzIHRyaW0gZG93biB0aGUgaW5mb3JtYXRpb24KICAgICAgLy8gdG8gdGhlIHRhZyBuYW1lLCBvbmx5CiAgICAgIGlmIChkYXRhLmNoYXJBdCgwKSA9PT0gJzwnICYmIGRhdGEuaW5kZXhPZignICcpICE9PSAtMSkgewogICAgICAgIGRhdGEgPSBkYXRhLnNsaWNlKDAsIGRhdGEuaW5kZXhPZignICcpKSArICc+JzsKICAgICAgfQoKICAgICAgdmFyIG1lc3NhZ2UgPQogICAgICAgICd1bnBhcnNhYmxlIGNvbnRlbnQgJyArIChkYXRhID8gZGF0YSArICcgJyA6ICcnKSArICdkZXRlY3RlZFxuXHQnICsKICAgICAgICAgICdsaW5lOiAnICsgbGluZSArICdcblx0JyArCiAgICAgICAgICAnY29sdW1uOiAnICsgY29sdW1uICsgJ1xuXHQnICsKICAgICAgICAgICduZXN0ZWQgZXJyb3I6ICcgKyBlcnIubWVzc2FnZTsKCiAgICAgIGlmIChsYXgpIHsKICAgICAgICBjb250ZXh0LmFkZFdhcm5pbmcoewogICAgICAgICAgbWVzc2FnZTogbWVzc2FnZSwKICAgICAgICAgIGVycm9yOiBlcnIKICAgICAgICB9KTsKCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhyb3cgZXJyb3IkMShtZXNzYWdlKTsKICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGhhbmRsZVdhcm5pbmcoZXJyLCBnZXRDb250ZXh0KSB7CiAgICAgIC8vIGp1c3QgbGlrZSBoYW5kbGluZyBlcnJvcnMgaW4gPGxheD10cnVlPiBtb2RlCiAgICAgIHJldHVybiBoYW5kbGVFcnJvcihlcnIsIGdldENvbnRleHQsIHRydWUpOwogICAgfQoKICAgIC8qKgogICAgICogUmVzb2x2ZSBjb2xsZWN0ZWQgcmVmZXJlbmNlcyBvbiBwYXJzZSBlbmQuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHJlc29sdmVSZWZlcmVuY2VzKCkgewoKICAgICAgdmFyIGVsZW1lbnRzQnlJZCA9IGNvbnRleHQuZWxlbWVudHNCeUlkOwogICAgICB2YXIgcmVmZXJlbmNlcyA9IGNvbnRleHQucmVmZXJlbmNlczsKCiAgICAgIHZhciBpLCByOwoKICAgICAgZm9yIChpID0gMDsgKHIgPSByZWZlcmVuY2VzW2ldKTsgaSsrKSB7CiAgICAgICAgdmFyIGVsZW1lbnQgPSByLmVsZW1lbnQ7CiAgICAgICAgdmFyIHJlZmVyZW5jZSA9IGVsZW1lbnRzQnlJZFtyLmlkXTsKICAgICAgICB2YXIgcHJvcGVydHkgPSBnZXRNb2RkbGVEZXNjcmlwdG9yKGVsZW1lbnQpLnByb3BlcnRpZXNCeU5hbWVbci5wcm9wZXJ0eV07CgogICAgICAgIGlmICghcmVmZXJlbmNlKSB7CiAgICAgICAgICBjb250ZXh0LmFkZFdhcm5pbmcoewogICAgICAgICAgICBtZXNzYWdlOiAndW5yZXNvbHZlZCByZWZlcmVuY2UgPCcgKyByLmlkICsgJz4nLAogICAgICAgICAgICBlbGVtZW50OiByLmVsZW1lbnQsCiAgICAgICAgICAgIHByb3BlcnR5OiByLnByb3BlcnR5LAogICAgICAgICAgICB2YWx1ZTogci5pZAogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBpZiAocHJvcGVydHkuaXNNYW55KSB7CiAgICAgICAgICB2YXIgY29sbGVjdGlvbiA9IGVsZW1lbnQuZ2V0KHByb3BlcnR5Lm5hbWUpLAogICAgICAgICAgICAgIGlkeCA9IGNvbGxlY3Rpb24uaW5kZXhPZihyKTsKCiAgICAgICAgICAvLyB3ZSByZXBsYWNlIGFuIGV4aXN0aW5nIHBsYWNlIGhvbGRlciAoaWR4ICE9IC0xKSBvcgogICAgICAgICAgLy8gYXBwZW5kIHRvIHRoZSBjb2xsZWN0aW9uIGluc3RlYWQKICAgICAgICAgIGlmIChpZHggPT09IC0xKSB7CiAgICAgICAgICAgIGlkeCA9IGNvbGxlY3Rpb24ubGVuZ3RoOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICghcmVmZXJlbmNlKSB7CiAgICAgICAgICAgIC8vIHJlbW92ZSB1bnJlc29sdmFibGUgcmVmZXJlbmNlCiAgICAgICAgICAgIGNvbGxlY3Rpb24uc3BsaWNlKGlkeCwgMSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBhZGQgb3IgdXBkYXRlIHJlZmVyZW5jZSBpbiBjb2xsZWN0aW9uCiAgICAgICAgICAgIGNvbGxlY3Rpb25baWR4XSA9IHJlZmVyZW5jZTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgZWxlbWVudC5zZXQocHJvcGVydHkubmFtZSwgcmVmZXJlbmNlKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBoYW5kbGVDbG9zZSgpIHsKICAgICAgc3RhY2sucG9wKCkuaGFuZGxlRW5kKCk7CiAgICB9CgogICAgdmFyIFBSRUFNQkxFX1NUQVJUX1BBVFRFUk4gPSAvXjxcP3htbCAvaTsKCiAgICB2YXIgRU5DT0RJTkdfUEFUVEVSTiA9IC8gZW5jb2Rpbmc9IihbXiJdKykiL2k7CgogICAgdmFyIFVURl84X1BBVFRFUk4gPSAvXnV0Zi04JC9pOwoKICAgIGZ1bmN0aW9uIGhhbmRsZVF1ZXN0aW9uKHF1ZXN0aW9uKSB7CgogICAgICBpZiAoIVBSRUFNQkxFX1NUQVJUX1BBVFRFUk4udGVzdChxdWVzdGlvbikpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHZhciBtYXRjaCA9IEVOQ09ESU5HX1BBVFRFUk4uZXhlYyhxdWVzdGlvbik7CiAgICAgIHZhciBlbmNvZGluZyA9IG1hdGNoICYmIG1hdGNoWzFdOwoKICAgICAgaWYgKCFlbmNvZGluZyB8fCBVVEZfOF9QQVRURVJOLnRlc3QoZW5jb2RpbmcpKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBjb250ZXh0LmFkZFdhcm5pbmcoewogICAgICAgIG1lc3NhZ2U6CiAgICAgICAgICAndW5zdXBwb3J0ZWQgZG9jdW1lbnQgZW5jb2RpbmcgPCcgKyBlbmNvZGluZyArICc+LCAnICsKICAgICAgICAgICdmYWxsaW5nIGJhY2sgdG8gVVRGLTgnCiAgICAgIH0pOwogICAgfQoKICAgIGZ1bmN0aW9uIGhhbmRsZU9wZW4obm9kZSwgZ2V0Q29udGV4dCkgewogICAgICB2YXIgaGFuZGxlciA9IHN0YWNrLnBlZWsoKTsKCiAgICAgIHRyeSB7CiAgICAgICAgc3RhY2sucHVzaChoYW5kbGVyLmhhbmRsZU5vZGUobm9kZSkpOwogICAgICB9IGNhdGNoIChlcnIpIHsKCiAgICAgICAgaWYgKGhhbmRsZUVycm9yKGVyciwgZ2V0Q29udGV4dCwgbGF4KSkgewogICAgICAgICAgc3RhY2sucHVzaChuZXcgTm9vcEhhbmRsZXIoKSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gaGFuZGxlQ0RhdGEodGV4dCwgZ2V0Q29udGV4dCkgewoKICAgICAgdHJ5IHsKICAgICAgICBzdGFjay5wZWVrKCkuaGFuZGxlVGV4dCh0ZXh0KTsKICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgaGFuZGxlV2FybmluZyhlcnIsIGdldENvbnRleHQpOwogICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gaGFuZGxlVGV4dCh0ZXh0LCBnZXRDb250ZXh0KSB7CiAgICAgIC8vIHN0cmlwIHdoaXRlc3BhY2Ugb25seSBub2RlcywgaS5lLiBiZWZvcmUKICAgICAgLy8gPCFDREFUQVsgLi4uIF0+IHNlY3Rpb25zIGFuZCBpbiBiZXR3ZWVuIHRhZ3MKICAgICAgdGV4dCA9IHRleHQudHJpbSgpOwoKICAgICAgaWYgKCF0ZXh0KSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBoYW5kbGVDRGF0YSh0ZXh0LCBnZXRDb250ZXh0KTsKICAgIH0KCiAgICB2YXIgdXJpTWFwID0gbW9kZWwuZ2V0UGFja2FnZXMoKS5yZWR1Y2UoZnVuY3Rpb24odXJpTWFwLCBwKSB7CiAgICAgIHVyaU1hcFtwLnVyaV0gPSBwLnByZWZpeDsKCiAgICAgIHJldHVybiB1cmlNYXA7CiAgICB9LCB7fSk7CgogICAgcGFyc2VyCiAgICAgIC5ucyh1cmlNYXApCiAgICAgIC5vbignb3BlblRhZycsIGZ1bmN0aW9uKG9iaiwgZGVjb2RlU3RyLCBzZWxmQ2xvc2luZywgZ2V0Q29udGV4dCkgewoKICAgICAgICAvLyBncmFjZWZ1bGx5IGhhbmRsZSB1bnBhcnNhYmxlIGF0dHJpYnV0ZXMgKGF0dHJzPWZhbHNlKQogICAgICAgIHZhciBhdHRycyA9IG9iai5hdHRycyB8fCB7fTsKCiAgICAgICAgdmFyIGRlY29kZWRBdHRycyA9IE9iamVjdC5rZXlzKGF0dHJzKS5yZWR1Y2UoZnVuY3Rpb24oZCwga2V5KSB7CiAgICAgICAgICB2YXIgdmFsdWUgPSBkZWNvZGVTdHIoYXR0cnNba2V5XSk7CgogICAgICAgICAgZFtrZXldID0gdmFsdWU7CgogICAgICAgICAgcmV0dXJuIGQ7CiAgICAgICAgfSwge30pOwoKICAgICAgICB2YXIgbm9kZSA9IHsKICAgICAgICAgIG5hbWU6IG9iai5uYW1lLAogICAgICAgICAgb3JpZ2luYWxOYW1lOiBvYmoub3JpZ2luYWxOYW1lLAogICAgICAgICAgYXR0cmlidXRlczogZGVjb2RlZEF0dHJzLAogICAgICAgICAgbnM6IG9iai5ucwogICAgICAgIH07CgogICAgICAgIGhhbmRsZU9wZW4obm9kZSwgZ2V0Q29udGV4dCk7CiAgICAgIH0pCiAgICAgIC5vbigncXVlc3Rpb24nLCBoYW5kbGVRdWVzdGlvbikKICAgICAgLm9uKCdjbG9zZVRhZycsIGhhbmRsZUNsb3NlKQogICAgICAub24oJ2NkYXRhJywgaGFuZGxlQ0RhdGEpCiAgICAgIC5vbigndGV4dCcsIGZ1bmN0aW9uKHRleHQsIGRlY29kZUVudGl0aWVzLCBnZXRDb250ZXh0KSB7CiAgICAgICAgaGFuZGxlVGV4dChkZWNvZGVFbnRpdGllcyh0ZXh0KSwgZ2V0Q29udGV4dCk7CiAgICAgIH0pCiAgICAgIC5vbignZXJyb3InLCBoYW5kbGVFcnJvcikKICAgICAgLm9uKCd3YXJuJywgaGFuZGxlV2FybmluZyk7CgogICAgLy8gZGVmZXJyZWQgcGFyc2UgWE1MIHRvIG1ha2UgbG9hZGluZyByZWFsbHkgYXNjbmNocm9ub3VzCiAgICAvLyB0aGlzIGVuc3VyZXMgdGhlIGV4ZWN1dGlvbiBlbnZpcm9ubWVudCAobm9kZSBvciBicm93c2VyKQogICAgLy8gaXMga2VwdCByZXNwb25zaXZlIGFuZCB0aGF0IGNlcnRhaW4gb3B0aW1pemF0aW9uIHN0cmF0ZWdpZXMKICAgIC8vIGNhbiBraWNrIGluCiAgICBkZWZlcihmdW5jdGlvbigpIHsKICAgICAgdmFyIGVycjsKCiAgICAgIHRyeSB7CiAgICAgICAgcGFyc2VyLnBhcnNlKHhtbCk7CgogICAgICAgIHJlc29sdmVSZWZlcmVuY2VzKCk7CiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICBlcnIgPSBlOwogICAgICB9CgogICAgICB2YXIgZWxlbWVudCA9IHJvb3RIYW5kbGVyLmVsZW1lbnQ7CgogICAgICAvLyBoYW5kbGUgdGhlIHNpdHVhdGlvbiB0aGF0IHdlIGNvdWxkIG5vdCBleHRyYWN0CiAgICAgIC8vIHRoZSBkZXNpcmVkIHJvb3QgZWxlbWVudCBmcm9tIHRoZSBkb2N1bWVudAogICAgICBpZiAoIWVyciAmJiAhZWxlbWVudCkgewogICAgICAgIGVyciA9IGVycm9yJDEoJ2ZhaWxlZCB0byBwYXJzZSBkb2N1bWVudCBhcyA8JyArIHJvb3RIYW5kbGVyLnR5cGUuJGRlc2NyaXB0b3IubmFtZSArICc+Jyk7CiAgICAgIH0KCiAgICAgIGRvbmUoZXJyLCBlcnIgPyB1bmRlZmluZWQgOiBlbGVtZW50LCBjb250ZXh0KTsKICAgIH0pOwogIH07CgogIFJlYWRlci5wcm90b3R5cGUuaGFuZGxlciA9IGZ1bmN0aW9uKG5hbWUpIHsKICAgIHJldHVybiBuZXcgUm9vdEVsZW1lbnRIYW5kbGVyKHRoaXMubW9kZWwsIG5hbWUpOwogIH07CgoKICAvLyBoZWxwZXJzIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogIGZ1bmN0aW9uIGNyZWF0ZVN0YWNrKCkgewogICAgdmFyIHN0YWNrID0gW107CgogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHN0YWNrLCAncGVlaycsIHsKICAgICAgdmFsdWU6IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiB0aGlzW3RoaXMubGVuZ3RoIC0gMV07CiAgICAgIH0KICAgIH0pOwoKICAgIHJldHVybiBzdGFjazsKICB9CgogIHZhciBYTUxfUFJFQU1CTEUgPSAnPD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz5cbic7CgogIHZhciBFU0NBUEVfQVRUUl9DSEFSUyA9IC88fD58J3wifCZ8XG5ccnxcbi9nOwogIHZhciBFU0NBUEVfQ0hBUlMgPSAvPHw+fCYvZzsKCgogIGZ1bmN0aW9uIE5hbWVzcGFjZXMocGFyZW50KSB7CgogICAgdmFyIHByZWZpeE1hcCA9IHt9OwogICAgdmFyIHVyaU1hcCA9IHt9OwogICAgdmFyIHVzZWQgPSB7fTsKCiAgICB2YXIgd2VsbGtub3duID0gW107CiAgICB2YXIgY3VzdG9tID0gW107CgogICAgLy8gQVBJCgogICAgdGhpcy5ieVVyaSA9IGZ1bmN0aW9uKHVyaSkgewogICAgICByZXR1cm4gdXJpTWFwW3VyaV0gfHwgKAogICAgICAgIHBhcmVudCAmJiBwYXJlbnQuYnlVcmkodXJpKQogICAgICApOwogICAgfTsKCiAgICB0aGlzLmFkZCA9IGZ1bmN0aW9uKG5zLCBpc1dlbGxrbm93bikgewoKICAgICAgdXJpTWFwW25zLnVyaV0gPSBuczsKCiAgICAgIGlmIChpc1dlbGxrbm93bikgewogICAgICAgIHdlbGxrbm93bi5wdXNoKG5zKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjdXN0b20ucHVzaChucyk7CiAgICAgIH0KCiAgICAgIHRoaXMubWFwUHJlZml4KG5zLnByZWZpeCwgbnMudXJpKTsKICAgIH07CgogICAgdGhpcy51cmlCeVByZWZpeCA9IGZ1bmN0aW9uKHByZWZpeCkgewogICAgICByZXR1cm4gcHJlZml4TWFwW3ByZWZpeCB8fCAneG1sbnMnXTsKICAgIH07CgogICAgdGhpcy5tYXBQcmVmaXggPSBmdW5jdGlvbihwcmVmaXgsIHVyaSkgewogICAgICBwcmVmaXhNYXBbcHJlZml4IHx8ICd4bWxucyddID0gdXJpOwogICAgfTsKCiAgICB0aGlzLmxvZ1VzZWQgPSBmdW5jdGlvbihucykgewogICAgICB2YXIgdXJpID0gbnMudXJpOwoKICAgICAgdXNlZFt1cmldID0gdGhpcy5ieVVyaSh1cmkpOwogICAgfTsKCiAgICB0aGlzLmdldFVzZWQgPSBmdW5jdGlvbihucykgewoKICAgICAgZnVuY3Rpb24gaXNVc2VkKG5zKSB7CiAgICAgICAgcmV0dXJuIHVzZWRbbnMudXJpXTsKICAgICAgfQoKICAgICAgdmFyIGFsbE5zID0gW10uY29uY2F0KHdlbGxrbm93biwgY3VzdG9tKTsKCiAgICAgIHJldHVybiBhbGxOcy5maWx0ZXIoaXNVc2VkKTsKICAgIH07CgogIH0KCiAgZnVuY3Rpb24gbG93ZXIoc3RyaW5nKSB7CiAgICByZXR1cm4gc3RyaW5nLmNoYXJBdCgwKS50b0xvd2VyQ2FzZSgpICsgc3RyaW5nLnNsaWNlKDEpOwogIH0KCiAgZnVuY3Rpb24gbmFtZVRvQWxpYXMobmFtZSwgcGtnKSB7CiAgICBpZiAoaGFzTG93ZXJDYXNlQWxpYXMocGtnKSkgewogICAgICByZXR1cm4gbG93ZXIobmFtZSk7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gbmFtZTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIGluaGVyaXRzKGN0b3IsIHN1cGVyQ3RvcikgewogICAgY3Rvci5zdXBlcl8gPSBzdXBlckN0b3I7CiAgICBjdG9yLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDdG9yLnByb3RvdHlwZSwgewogICAgICBjb25zdHJ1Y3RvcjogewogICAgICAgIHZhbHVlOiBjdG9yLAogICAgICAgIGVudW1lcmFibGU6IGZhbHNlLAogICAgICAgIHdyaXRhYmxlOiB0cnVlLAogICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogICAgICB9CiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIG5zTmFtZShucykgewogICAgaWYgKGlzU3RyaW5nKG5zKSkgewogICAgICByZXR1cm4gbnM7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gKG5zLnByZWZpeCA/IG5zLnByZWZpeCArICc6JyA6ICcnKSArIG5zLmxvY2FsTmFtZTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIGdldE5zQXR0cnMobmFtZXNwYWNlcykgewoKICAgIHJldHVybiBtYXAobmFtZXNwYWNlcy5nZXRVc2VkKCksIGZ1bmN0aW9uKG5zKSB7CiAgICAgIHZhciBuYW1lID0gJ3htbG5zJyArIChucy5wcmVmaXggPyAnOicgKyBucy5wcmVmaXggOiAnJyk7CiAgICAgIHJldHVybiB7IG5hbWU6IG5hbWUsIHZhbHVlOiBucy51cmkgfTsKICAgIH0pOwoKICB9CgogIGZ1bmN0aW9uIGdldEVsZW1lbnROcyhucywgZGVzY3JpcHRvcikgewogICAgaWYgKGRlc2NyaXB0b3IuaXNHZW5lcmljKSB7CiAgICAgIHJldHVybiBhc3NpZ24oeyBsb2NhbE5hbWU6IGRlc2NyaXB0b3IubnMubG9jYWxOYW1lIH0sIG5zKTsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiBhc3NpZ24oeyBsb2NhbE5hbWU6IG5hbWVUb0FsaWFzKGRlc2NyaXB0b3IubnMubG9jYWxOYW1lLCBkZXNjcmlwdG9yLiRwa2cpIH0sIG5zKTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIGdldFByb3BlcnR5TnMobnMsIGRlc2NyaXB0b3IpIHsKICAgIHJldHVybiBhc3NpZ24oeyBsb2NhbE5hbWU6IGRlc2NyaXB0b3IubnMubG9jYWxOYW1lIH0sIG5zKTsKICB9CgogIGZ1bmN0aW9uIGdldFNlcmlhbGl6YWJsZVByb3BlcnRpZXMoZWxlbWVudCkgewogICAgdmFyIGRlc2NyaXB0b3IgPSBlbGVtZW50LiRkZXNjcmlwdG9yOwoKICAgIHJldHVybiBmaWx0ZXIoZGVzY3JpcHRvci5wcm9wZXJ0aWVzLCBmdW5jdGlvbihwKSB7CiAgICAgIHZhciBuYW1lID0gcC5uYW1lOwoKICAgICAgaWYgKHAuaXNWaXJ0dWFsKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICAvLyBkbyBub3Qgc2VyaWFsaXplIGRlZmF1bHRzCiAgICAgIGlmICghZWxlbWVudC5oYXNPd25Qcm9wZXJ0eShuYW1lKSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgdmFyIHZhbHVlID0gZWxlbWVudFtuYW1lXTsKCiAgICAgIC8vIGRvIG5vdCBzZXJpYWxpemUgZGVmYXVsdCBlcXVhbHMKICAgICAgaWYgKHZhbHVlID09PSBwLmRlZmF1bHQpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIC8vIGRvIG5vdCBzZXJpYWxpemUgbnVsbCBwcm9wZXJ0aWVzCiAgICAgIGlmICh2YWx1ZSA9PT0gbnVsbCkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgcmV0dXJuIHAuaXNNYW55ID8gdmFsdWUubGVuZ3RoIDogdHJ1ZTsKICAgIH0pOwogIH0KCiAgdmFyIEVTQ0FQRV9BVFRSX01BUCA9IHsKICAgICdcbic6ICcjMTAnLAogICAgJ1xuXHInOiAnIzEwJywKICAgICciJzogJyMzNCcsCiAgICAnXCcnOiAnIzM5JywKICAgICc8JzogJyM2MCcsCiAgICAnPic6ICcjNjInLAogICAgJyYnOiAnIzM4JwogIH07CgogIHZhciBFU0NBUEVfTUFQID0gewogICAgJzwnOiAnbHQnLAogICAgJz4nOiAnZ3QnLAogICAgJyYnOiAnYW1wJwogIH07CgogIGZ1bmN0aW9uIGVzY2FwZSQxKHN0ciwgY2hhclBhdHRlcm4sIHJlcGxhY2VNYXApIHsKCiAgICAvLyBlbnN1cmUgd2UgYXJlIGhhbmRsaW5nIHN0cmluZ3MgaGVyZQogICAgc3RyID0gaXNTdHJpbmcoc3RyKSA/IHN0ciA6ICcnICsgc3RyOwoKICAgIHJldHVybiBzdHIucmVwbGFjZShjaGFyUGF0dGVybiwgZnVuY3Rpb24ocykgewogICAgICByZXR1cm4gJyYnICsgcmVwbGFjZU1hcFtzXSArICc7JzsKICAgIH0pOwogIH0KCiAgLyoqCiAgICogRXNjYXBlIGEgc3RyaW5nIGF0dHJpYnV0ZSB0byBub3QgY29udGFpbiBhbnkgYmFkIHZhbHVlcyAobGluZSBicmVha3MsICciJywgLi4uKQogICAqCiAgICogQHBhcmFtIHtTdHJpbmd9IHN0ciB0aGUgc3RyaW5nIHRvIGVzY2FwZQogICAqIEByZXR1cm4ge1N0cmluZ30gdGhlIGVzY2FwZWQgc3RyaW5nCiAgICovCiAgZnVuY3Rpb24gZXNjYXBlQXR0cihzdHIpIHsKICAgIHJldHVybiBlc2NhcGUkMShzdHIsIEVTQ0FQRV9BVFRSX0NIQVJTLCBFU0NBUEVfQVRUUl9NQVApOwogIH0KCiAgZnVuY3Rpb24gZXNjYXBlQm9keShzdHIpIHsKICAgIHJldHVybiBlc2NhcGUkMShzdHIsIEVTQ0FQRV9DSEFSUywgRVNDQVBFX01BUCk7CiAgfQoKICBmdW5jdGlvbiBmaWx0ZXJBdHRyaWJ1dGVzKHByb3BzKSB7CiAgICByZXR1cm4gZmlsdGVyKHByb3BzLCBmdW5jdGlvbihwKSB7IHJldHVybiBwLmlzQXR0cjsgfSk7CiAgfQoKICBmdW5jdGlvbiBmaWx0ZXJDb250YWluZWQocHJvcHMpIHsKICAgIHJldHVybiBmaWx0ZXIocHJvcHMsIGZ1bmN0aW9uKHApIHsgcmV0dXJuICFwLmlzQXR0cjsgfSk7CiAgfQoKCiAgZnVuY3Rpb24gUmVmZXJlbmNlU2VyaWFsaXplcih0YWdOYW1lKSB7CiAgICB0aGlzLnRhZ05hbWUgPSB0YWdOYW1lOwogIH0KCiAgUmVmZXJlbmNlU2VyaWFsaXplci5wcm90b3R5cGUuYnVpbGQgPSBmdW5jdGlvbihlbGVtZW50KSB7CiAgICB0aGlzLmVsZW1lbnQgPSBlbGVtZW50OwogICAgcmV0dXJuIHRoaXM7CiAgfTsKCiAgUmVmZXJlbmNlU2VyaWFsaXplci5wcm90b3R5cGUuc2VyaWFsaXplVG8gPSBmdW5jdGlvbih3cml0ZXIpIHsKICAgIHdyaXRlcgogICAgICAuYXBwZW5kSW5kZW50KCkKICAgICAgLmFwcGVuZCgnPCcgKyB0aGlzLnRhZ05hbWUgKyAnPicgKyB0aGlzLmVsZW1lbnQuaWQgKyAnPC8nICsgdGhpcy50YWdOYW1lICsgJz4nKQogICAgICAuYXBwZW5kTmV3TGluZSgpOwogIH07CgogIGZ1bmN0aW9uIEJvZHlTZXJpYWxpemVyKCkge30KCiAgQm9keVNlcmlhbGl6ZXIucHJvdG90eXBlLnNlcmlhbGl6ZVZhbHVlID0KICBCb2R5U2VyaWFsaXplci5wcm90b3R5cGUuc2VyaWFsaXplVG8gPSBmdW5jdGlvbih3cml0ZXIpIHsKICAgIHdyaXRlci5hcHBlbmQoCiAgICAgIHRoaXMuZXNjYXBlCiAgICAgICAgPyBlc2NhcGVCb2R5KHRoaXMudmFsdWUpCiAgICAgICAgOiB0aGlzLnZhbHVlCiAgICApOwogIH07CgogIEJvZHlTZXJpYWxpemVyLnByb3RvdHlwZS5idWlsZCA9IGZ1bmN0aW9uKHByb3AsIHZhbHVlKSB7CiAgICB0aGlzLnZhbHVlID0gdmFsdWU7CgogICAgaWYgKHByb3AudHlwZSA9PT0gJ1N0cmluZycgJiYgdmFsdWUuc2VhcmNoKEVTQ0FQRV9DSEFSUykgIT09IC0xKSB7CiAgICAgIHRoaXMuZXNjYXBlID0gdHJ1ZTsKICAgIH0KCiAgICByZXR1cm4gdGhpczsKICB9OwoKICBmdW5jdGlvbiBWYWx1ZVNlcmlhbGl6ZXIodGFnTmFtZSkgewogICAgdGhpcy50YWdOYW1lID0gdGFnTmFtZTsKICB9CgogIGluaGVyaXRzKFZhbHVlU2VyaWFsaXplciwgQm9keVNlcmlhbGl6ZXIpOwoKICBWYWx1ZVNlcmlhbGl6ZXIucHJvdG90eXBlLnNlcmlhbGl6ZVRvID0gZnVuY3Rpb24od3JpdGVyKSB7CgogICAgd3JpdGVyCiAgICAgIC5hcHBlbmRJbmRlbnQoKQogICAgICAuYXBwZW5kKCc8JyArIHRoaXMudGFnTmFtZSArICc+Jyk7CgogICAgdGhpcy5zZXJpYWxpemVWYWx1ZSh3cml0ZXIpOwoKICAgIHdyaXRlcgogICAgICAuYXBwZW5kKCc8LycgKyB0aGlzLnRhZ05hbWUgKyAnPicpCiAgICAgIC5hcHBlbmROZXdMaW5lKCk7CiAgfTsKCiAgZnVuY3Rpb24gRWxlbWVudFNlcmlhbGl6ZXIocGFyZW50LCBwcm9wZXJ0eURlc2NyaXB0b3IpIHsKICAgIHRoaXMuYm9keSA9IFtdOwogICAgdGhpcy5hdHRycyA9IFtdOwoKICAgIHRoaXMucGFyZW50ID0gcGFyZW50OwogICAgdGhpcy5wcm9wZXJ0eURlc2NyaXB0b3IgPSBwcm9wZXJ0eURlc2NyaXB0b3I7CiAgfQoKICBFbGVtZW50U2VyaWFsaXplci5wcm90b3R5cGUuYnVpbGQgPSBmdW5jdGlvbihlbGVtZW50KSB7CiAgICB0aGlzLmVsZW1lbnQgPSBlbGVtZW50OwoKICAgIHZhciBlbGVtZW50RGVzY3JpcHRvciA9IGVsZW1lbnQuJGRlc2NyaXB0b3IsCiAgICAgICAgcHJvcGVydHlEZXNjcmlwdG9yID0gdGhpcy5wcm9wZXJ0eURlc2NyaXB0b3I7CgogICAgdmFyIG90aGVyQXR0cnMsCiAgICAgICAgcHJvcGVydGllczsKCiAgICB2YXIgaXNHZW5lcmljID0gZWxlbWVudERlc2NyaXB0b3IuaXNHZW5lcmljOwoKICAgIGlmIChpc0dlbmVyaWMpIHsKICAgICAgb3RoZXJBdHRycyA9IHRoaXMucGFyc2VHZW5lcmljKGVsZW1lbnQpOwogICAgfSBlbHNlIHsKICAgICAgb3RoZXJBdHRycyA9IHRoaXMucGFyc2VOc0F0dHJpYnV0ZXMoZWxlbWVudCk7CiAgICB9CgogICAgaWYgKHByb3BlcnR5RGVzY3JpcHRvcikgewogICAgICB0aGlzLm5zID0gdGhpcy5uc1Byb3BlcnR5VGFnTmFtZShwcm9wZXJ0eURlc2NyaXB0b3IpOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5ucyA9IHRoaXMubnNUYWdOYW1lKGVsZW1lbnREZXNjcmlwdG9yKTsKICAgIH0KCiAgICAvLyBjb21wdXRlIHRhZyBuYW1lCiAgICB0aGlzLnRhZ05hbWUgPSB0aGlzLmFkZFRhZ05hbWUodGhpcy5ucyk7CgogICAgaWYgKCFpc0dlbmVyaWMpIHsKICAgICAgcHJvcGVydGllcyA9IGdldFNlcmlhbGl6YWJsZVByb3BlcnRpZXMoZWxlbWVudCk7CgogICAgICB0aGlzLnBhcnNlQXR0cmlidXRlcyhmaWx0ZXJBdHRyaWJ1dGVzKHByb3BlcnRpZXMpKTsKICAgICAgdGhpcy5wYXJzZUNvbnRhaW5tZW50cyhmaWx0ZXJDb250YWluZWQocHJvcGVydGllcykpOwogICAgfQoKICAgIHRoaXMucGFyc2VHZW5lcmljQXR0cmlidXRlcyhlbGVtZW50LCBvdGhlckF0dHJzKTsKCiAgICByZXR1cm4gdGhpczsKICB9OwoKICBFbGVtZW50U2VyaWFsaXplci5wcm90b3R5cGUubnNUYWdOYW1lID0gZnVuY3Rpb24oZGVzY3JpcHRvcikgewogICAgdmFyIGVmZmVjdGl2ZU5zID0gdGhpcy5sb2dOYW1lc3BhY2VVc2VkKGRlc2NyaXB0b3IubnMpOwogICAgcmV0dXJuIGdldEVsZW1lbnROcyhlZmZlY3RpdmVOcywgZGVzY3JpcHRvcik7CiAgfTsKCiAgRWxlbWVudFNlcmlhbGl6ZXIucHJvdG90eXBlLm5zUHJvcGVydHlUYWdOYW1lID0gZnVuY3Rpb24oZGVzY3JpcHRvcikgewogICAgdmFyIGVmZmVjdGl2ZU5zID0gdGhpcy5sb2dOYW1lc3BhY2VVc2VkKGRlc2NyaXB0b3IubnMpOwogICAgcmV0dXJuIGdldFByb3BlcnR5TnMoZWZmZWN0aXZlTnMsIGRlc2NyaXB0b3IpOwogIH07CgogIEVsZW1lbnRTZXJpYWxpemVyLnByb3RvdHlwZS5pc0xvY2FsTnMgPSBmdW5jdGlvbihucykgewogICAgcmV0dXJuIG5zLnVyaSA9PT0gdGhpcy5ucy51cmk7CiAgfTsKCiAgLyoqCiAgICogR2V0IHRoZSBhY3R1YWwgbnMgYXR0cmlidXRlIG5hbWUgZm9yIHRoZSBnaXZlbiBlbGVtZW50LgogICAqCiAgICogQHBhcmFtIHtPYmplY3R9IGVsZW1lbnQKICAgKiBAcGFyYW0ge0Jvb2xlYW59IFtlbGVtZW50LmluaGVyaXRlZD1mYWxzZV0KICAgKgogICAqIEByZXR1cm4ge09iamVjdH0gbnNOYW1lCiAgICovCiAgRWxlbWVudFNlcmlhbGl6ZXIucHJvdG90eXBlLm5zQXR0cmlidXRlTmFtZSA9IGZ1bmN0aW9uKGVsZW1lbnQpIHsKCiAgICB2YXIgbnM7CgogICAgaWYgKGlzU3RyaW5nKGVsZW1lbnQpKSB7CiAgICAgIG5zID0gcGFyc2VOYW1lKGVsZW1lbnQpOwogICAgfSBlbHNlIHsKICAgICAgbnMgPSBlbGVtZW50Lm5zOwogICAgfQoKICAgIC8vIHJldHVybiBqdXN0IGxvY2FsIG5hbWUgZm9yIGluaGVyaXRlZCBhdHRyaWJ1dGVzCiAgICBpZiAoZWxlbWVudC5pbmhlcml0ZWQpIHsKICAgICAgcmV0dXJuIHsgbG9jYWxOYW1lOiBucy5sb2NhbE5hbWUgfTsKICAgIH0KCiAgICAvLyBwYXJzZSArIGxvZyBlZmZlY3RpdmUgbnMKICAgIHZhciBlZmZlY3RpdmVOcyA9IHRoaXMubG9nTmFtZXNwYWNlVXNlZChucyk7CgogICAgLy8gTE9HIEFDVFVBTCBuYW1lc3BhY2UgdXNlCiAgICB0aGlzLmdldE5hbWVzcGFjZXMoKS5sb2dVc2VkKGVmZmVjdGl2ZU5zKTsKCiAgICAvLyBzdHJpcCBwcmVmaXggaWYgc2FtZSBuYW1lc3BhY2UgbGlrZSBwYXJlbnQKICAgIGlmICh0aGlzLmlzTG9jYWxOcyhlZmZlY3RpdmVOcykpIHsKICAgICAgcmV0dXJuIHsgbG9jYWxOYW1lOiBucy5sb2NhbE5hbWUgfTsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiBhc3NpZ24oeyBsb2NhbE5hbWU6IG5zLmxvY2FsTmFtZSB9LCBlZmZlY3RpdmVOcyk7CiAgICB9CiAgfTsKCiAgRWxlbWVudFNlcmlhbGl6ZXIucHJvdG90eXBlLnBhcnNlR2VuZXJpYyA9IGZ1bmN0aW9uKGVsZW1lbnQpIHsKCiAgICB2YXIgc2VsZiA9IHRoaXMsCiAgICAgICAgYm9keSA9IHRoaXMuYm9keTsKCiAgICB2YXIgYXR0cmlidXRlcyA9IFtdOwoKICAgIGZvckVhY2goZWxlbWVudCwgZnVuY3Rpb24odmFsLCBrZXkpIHsKCiAgICAgIHZhciBub25Oc0F0dHI7CgogICAgICBpZiAoa2V5ID09PSAnJGJvZHknKSB7CiAgICAgICAgYm9keS5wdXNoKG5ldyBCb2R5U2VyaWFsaXplcigpLmJ1aWxkKHsgdHlwZTogJ1N0cmluZycgfSwgdmFsKSk7CiAgICAgIH0gZWxzZQogICAgICBpZiAoa2V5ID09PSAnJGNoaWxkcmVuJykgewogICAgICAgIGZvckVhY2godmFsLCBmdW5jdGlvbihjaGlsZCkgewogICAgICAgICAgYm9keS5wdXNoKG5ldyBFbGVtZW50U2VyaWFsaXplcihzZWxmKS5idWlsZChjaGlsZCkpOwogICAgICAgIH0pOwogICAgICB9IGVsc2UKICAgICAgaWYgKGtleS5pbmRleE9mKCckJykgIT09IDApIHsKICAgICAgICBub25Oc0F0dHIgPSBzZWxmLnBhcnNlTnNBdHRyaWJ1dGUoZWxlbWVudCwga2V5LCB2YWwpOwoKICAgICAgICBpZiAobm9uTnNBdHRyKSB7CiAgICAgICAgICBhdHRyaWJ1dGVzLnB1c2goeyBuYW1lOiBrZXksIHZhbHVlOiB2YWwgfSk7CiAgICAgICAgfQogICAgICB9CiAgICB9KTsKCiAgICByZXR1cm4gYXR0cmlidXRlczsKICB9OwoKICBFbGVtZW50U2VyaWFsaXplci5wcm90b3R5cGUucGFyc2VOc0F0dHJpYnV0ZSA9IGZ1bmN0aW9uKGVsZW1lbnQsIG5hbWUsIHZhbHVlKSB7CiAgICB2YXIgbW9kZWwgPSBlbGVtZW50LiRtb2RlbDsKCiAgICB2YXIgbmFtZU5zID0gcGFyc2VOYW1lKG5hbWUpOwoKICAgIHZhciBuczsKCiAgICAvLyBwYXJzZSB4bWxuczpmb289Imh0dHA6Ly9mb28uYmFyIgogICAgaWYgKG5hbWVOcy5wcmVmaXggPT09ICd4bWxucycpIHsKICAgICAgbnMgPSB7IHByZWZpeDogbmFtZU5zLmxvY2FsTmFtZSwgdXJpOiB2YWx1ZSB9OwogICAgfQoKICAgIC8vIHBhcnNlIHhtbG5zPSJodHRwOi8vZm9vLmJhciIKICAgIGlmICghbmFtZU5zLnByZWZpeCAmJiBuYW1lTnMubG9jYWxOYW1lID09PSAneG1sbnMnKSB7CiAgICAgIG5zID0geyB1cmk6IHZhbHVlIH07CiAgICB9CgogICAgaWYgKCFucykgewogICAgICByZXR1cm4gewogICAgICAgIG5hbWU6IG5hbWUsCiAgICAgICAgdmFsdWU6IHZhbHVlCiAgICAgIH07CiAgICB9CgogICAgaWYgKG1vZGVsICYmIG1vZGVsLmdldFBhY2thZ2UodmFsdWUpKSB7CiAgICAgIC8vIHJlZ2lzdGVyIHdlbGwga25vd24gbmFtZXNwYWNlCiAgICAgIHRoaXMubG9nTmFtZXNwYWNlKG5zLCB0cnVlLCB0cnVlKTsKICAgIH0gZWxzZSB7CiAgICAgIC8vIGxvZyBjdXN0b20gbmFtZXNwYWNlIGRpcmVjdGx5IGFzIHVzZWQKICAgICAgdmFyIGFjdHVhbE5zID0gdGhpcy5sb2dOYW1lc3BhY2VVc2VkKG5zLCB0cnVlKTsKCiAgICAgIHRoaXMuZ2V0TmFtZXNwYWNlcygpLmxvZ1VzZWQoYWN0dWFsTnMpOwogICAgfQogIH07CgoKICAvKioKICAgKiBQYXJzZSBuYW1lc3BhY2VzIGFuZCByZXR1cm4gYSBsaXN0IG9mIGxlZnQgb3ZlciBnZW5lcmljIGF0dHJpYnV0ZXMKICAgKgogICAqIEBwYXJhbSAge09iamVjdH0gZWxlbWVudAogICAqIEByZXR1cm4ge0FycmF5PE9iamVjdD59CiAgICovCiAgRWxlbWVudFNlcmlhbGl6ZXIucHJvdG90eXBlLnBhcnNlTnNBdHRyaWJ1dGVzID0gZnVuY3Rpb24oZWxlbWVudCwgYXR0cnMpIHsKICAgIHZhciBzZWxmID0gdGhpczsKCiAgICB2YXIgZ2VuZXJpY0F0dHJzID0gZWxlbWVudC4kYXR0cnM7CgogICAgdmFyIGF0dHJpYnV0ZXMgPSBbXTsKCiAgICAvLyBwYXJzZSBuYW1lc3BhY2UgYXR0cmlidXRlcyBmaXJzdAogICAgLy8gYW5kIGxvZyB0aGVtLiBwdXNoIG5vbiBuYW1lc3BhY2UgYXR0cmlidXRlcyB0byBhIGxpc3QKICAgIC8vIGFuZCBwcm9jZXNzIHRoZW0gbGF0ZXIKICAgIGZvckVhY2goZ2VuZXJpY0F0dHJzLCBmdW5jdGlvbih2YWx1ZSwgbmFtZSkgewoKICAgICAgdmFyIG5vbk5zQXR0ciA9IHNlbGYucGFyc2VOc0F0dHJpYnV0ZShlbGVtZW50LCBuYW1lLCB2YWx1ZSk7CgogICAgICBpZiAobm9uTnNBdHRyKSB7CiAgICAgICAgYXR0cmlidXRlcy5wdXNoKG5vbk5zQXR0cik7CiAgICAgIH0KICAgIH0pOwoKICAgIHJldHVybiBhdHRyaWJ1dGVzOwogIH07CgogIEVsZW1lbnRTZXJpYWxpemVyLnByb3RvdHlwZS5wYXJzZUdlbmVyaWNBdHRyaWJ1dGVzID0gZnVuY3Rpb24oZWxlbWVudCwgYXR0cmlidXRlcykgewoKICAgIHZhciBzZWxmID0gdGhpczsKCiAgICBmb3JFYWNoKGF0dHJpYnV0ZXMsIGZ1bmN0aW9uKGF0dHIpIHsKCiAgICAgIC8vIGRvIG5vdCBzZXJpYWxpemUgeHNpOnR5cGUgYXR0cmlidXRlCiAgICAgIC8vIGl0IGlzIHNldCBtYW51YWxseSBiYXNlZCBvbiB0aGUgYWN0dWFsIGltcGxlbWVudGF0aW9uIHR5cGUKICAgICAgaWYgKGF0dHIubmFtZSA9PT0gWFNJX1RZUEUkMSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdHJ5IHsKICAgICAgICBzZWxmLmFkZEF0dHJpYnV0ZShzZWxmLm5zQXR0cmlidXRlTmFtZShhdHRyLm5hbWUpLCBhdHRyLnZhbHVlKTsKICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIGNvbnNvbGUud2FybigKICAgICAgICAgICdtaXNzaW5nIG5hbWVzcGFjZSBpbmZvcm1hdGlvbiBmb3IgJywKICAgICAgICAgIGF0dHIubmFtZSwgJz0nLCBhdHRyLnZhbHVlLCAnb24nLCBlbGVtZW50LAogICAgICAgICAgZSk7CiAgICAgIH0KICAgIH0pOwogIH07CgogIEVsZW1lbnRTZXJpYWxpemVyLnByb3RvdHlwZS5wYXJzZUNvbnRhaW5tZW50cyA9IGZ1bmN0aW9uKHByb3BlcnRpZXMpIHsKCiAgICB2YXIgc2VsZiA9IHRoaXMsCiAgICAgICAgYm9keSA9IHRoaXMuYm9keSwKICAgICAgICBlbGVtZW50ID0gdGhpcy5lbGVtZW50OwoKICAgIGZvckVhY2gocHJvcGVydGllcywgZnVuY3Rpb24ocCkgewogICAgICB2YXIgdmFsdWUgPSBlbGVtZW50LmdldChwLm5hbWUpLAogICAgICAgICAgaXNSZWZlcmVuY2UgPSBwLmlzUmVmZXJlbmNlLAogICAgICAgICAgaXNNYW55ID0gcC5pc01hbnk7CgogICAgICBpZiAoIWlzTWFueSkgewogICAgICAgIHZhbHVlID0gWyB2YWx1ZSBdOwogICAgICB9CgogICAgICBpZiAocC5pc0JvZHkpIHsKICAgICAgICBib2R5LnB1c2gobmV3IEJvZHlTZXJpYWxpemVyKCkuYnVpbGQocCwgdmFsdWVbMF0pKTsKICAgICAgfSBlbHNlCiAgICAgIGlmIChpc1NpbXBsZShwLnR5cGUpKSB7CiAgICAgICAgZm9yRWFjaCh2YWx1ZSwgZnVuY3Rpb24odikgewogICAgICAgICAgYm9keS5wdXNoKG5ldyBWYWx1ZVNlcmlhbGl6ZXIoc2VsZi5hZGRUYWdOYW1lKHNlbGYubnNQcm9wZXJ0eVRhZ05hbWUocCkpKS5idWlsZChwLCB2KSk7CiAgICAgICAgfSk7CiAgICAgIH0gZWxzZQogICAgICBpZiAoaXNSZWZlcmVuY2UpIHsKICAgICAgICBmb3JFYWNoKHZhbHVlLCBmdW5jdGlvbih2KSB7CiAgICAgICAgICBib2R5LnB1c2gobmV3IFJlZmVyZW5jZVNlcmlhbGl6ZXIoc2VsZi5hZGRUYWdOYW1lKHNlbGYubnNQcm9wZXJ0eVRhZ05hbWUocCkpKS5idWlsZCh2KSk7CiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gYWxsb3cgc2VyaWFsaXphdGlvbiB2aWEgdHlwZQogICAgICAgIC8vIHJhdGhlciB0aGFuIGVsZW1lbnQgbmFtZQogICAgICAgIHZhciBhc1R5cGUgPSBzZXJpYWxpemVBc1R5cGUocCksCiAgICAgICAgICAgIGFzUHJvcGVydHkgPSBzZXJpYWxpemVBc1Byb3BlcnR5KHApOwoKICAgICAgICBmb3JFYWNoKHZhbHVlLCBmdW5jdGlvbih2KSB7CiAgICAgICAgICB2YXIgc2VyaWFsaXplcjsKCiAgICAgICAgICBpZiAoYXNUeXBlKSB7CiAgICAgICAgICAgIHNlcmlhbGl6ZXIgPSBuZXcgVHlwZVNlcmlhbGl6ZXIoc2VsZiwgcCk7CiAgICAgICAgICB9IGVsc2UKICAgICAgICAgIGlmIChhc1Byb3BlcnR5KSB7CiAgICAgICAgICAgIHNlcmlhbGl6ZXIgPSBuZXcgRWxlbWVudFNlcmlhbGl6ZXIoc2VsZiwgcCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBzZXJpYWxpemVyID0gbmV3IEVsZW1lbnRTZXJpYWxpemVyKHNlbGYpOwogICAgICAgICAgfQoKICAgICAgICAgIGJvZHkucHVzaChzZXJpYWxpemVyLmJ1aWxkKHYpKTsKICAgICAgICB9KTsKICAgICAgfQogICAgfSk7CiAgfTsKCiAgRWxlbWVudFNlcmlhbGl6ZXIucHJvdG90eXBlLmdldE5hbWVzcGFjZXMgPSBmdW5jdGlvbihsb2NhbCkgewoKICAgIHZhciBuYW1lc3BhY2VzID0gdGhpcy5uYW1lc3BhY2VzLAogICAgICAgIHBhcmVudCA9IHRoaXMucGFyZW50LAogICAgICAgIHBhcmVudE5hbWVzcGFjZXM7CgogICAgaWYgKCFuYW1lc3BhY2VzKSB7CiAgICAgIHBhcmVudE5hbWVzcGFjZXMgPSBwYXJlbnQgJiYgcGFyZW50LmdldE5hbWVzcGFjZXMoKTsKCiAgICAgIGlmIChsb2NhbCB8fCAhcGFyZW50TmFtZXNwYWNlcykgewogICAgICAgIHRoaXMubmFtZXNwYWNlcyA9IG5hbWVzcGFjZXMgPSBuZXcgTmFtZXNwYWNlcyhwYXJlbnROYW1lc3BhY2VzKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBuYW1lc3BhY2VzID0gcGFyZW50TmFtZXNwYWNlczsKICAgICAgfQogICAgfQoKICAgIHJldHVybiBuYW1lc3BhY2VzOwogIH07CgogIEVsZW1lbnRTZXJpYWxpemVyLnByb3RvdHlwZS5sb2dOYW1lc3BhY2UgPSBmdW5jdGlvbihucywgd2VsbGtub3duLCBsb2NhbCkgewogICAgdmFyIG5hbWVzcGFjZXMgPSB0aGlzLmdldE5hbWVzcGFjZXMobG9jYWwpOwoKICAgIHZhciBuc1VyaSA9IG5zLnVyaSwKICAgICAgICBuc1ByZWZpeCA9IG5zLnByZWZpeDsKCiAgICB2YXIgZXhpc3RpbmcgPSBuYW1lc3BhY2VzLmJ5VXJpKG5zVXJpKTsKCiAgICBpZiAoIWV4aXN0aW5nKSB7CiAgICAgIG5hbWVzcGFjZXMuYWRkKG5zLCB3ZWxsa25vd24pOwogICAgfQoKICAgIG5hbWVzcGFjZXMubWFwUHJlZml4KG5zUHJlZml4LCBuc1VyaSk7CgogICAgcmV0dXJuIG5zOwogIH07CgogIEVsZW1lbnRTZXJpYWxpemVyLnByb3RvdHlwZS5sb2dOYW1lc3BhY2VVc2VkID0gZnVuY3Rpb24obnMsIGxvY2FsKSB7CiAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudCwKICAgICAgICBtb2RlbCA9IGVsZW1lbnQuJG1vZGVsLAogICAgICAgIG5hbWVzcGFjZXMgPSB0aGlzLmdldE5hbWVzcGFjZXMobG9jYWwpOwoKICAgIC8vIG5zIG1heSBiZQogICAgLy8KICAgIC8vICAgKiBwcmVmaXggb25seQogICAgLy8gICAqIHByZWZpeDp1cmkKICAgIC8vICAgKiBsb2NhbE5hbWUgb25seQoKICAgIHZhciBwcmVmaXggPSBucy5wcmVmaXgsCiAgICAgICAgdXJpID0gbnMudXJpLAogICAgICAgIG5ld1ByZWZpeCwgaWR4LAogICAgICAgIHdlbGxrbm93blVyaTsKCiAgICAvLyBoYW5kbGUgYW5vbnltb3VzIG5hbWVzcGFjZXMgKGVsZW1lbnRGb3JtPXVucXVhbGlmaWVkKSwgY2YuICMyMwogICAgaWYgKCFwcmVmaXggJiYgIXVyaSkgewogICAgICByZXR1cm4geyBsb2NhbE5hbWU6IG5zLmxvY2FsTmFtZSB9OwogICAgfQoKICAgIHdlbGxrbm93blVyaSA9IERFRkFVTFRfTlNfTUFQW3ByZWZpeF0gfHwgbW9kZWwgJiYgKG1vZGVsLmdldFBhY2thZ2UocHJlZml4KSB8fCB7fSkudXJpOwoKICAgIHVyaSA9IHVyaSB8fCB3ZWxsa25vd25VcmkgfHwgbmFtZXNwYWNlcy51cmlCeVByZWZpeChwcmVmaXgpOwoKICAgIGlmICghdXJpKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcignbm8gbmFtZXNwYWNlIHVyaSBnaXZlbiBmb3IgcHJlZml4IDwnICsgcHJlZml4ICsgJz4nKTsKICAgIH0KCiAgICBucyA9IG5hbWVzcGFjZXMuYnlVcmkodXJpKTsKCiAgICBpZiAoIW5zKSB7CiAgICAgIG5ld1ByZWZpeCA9IHByZWZpeDsKICAgICAgaWR4ID0gMTsKCiAgICAgIC8vIGZpbmQgYSBwcmVmaXggdGhhdCBpcyBub3QgbWFwcGVkIHlldAogICAgICB3aGlsZSAobmFtZXNwYWNlcy51cmlCeVByZWZpeChuZXdQcmVmaXgpKSB7CiAgICAgICAgbmV3UHJlZml4ID0gcHJlZml4ICsgJ18nICsgaWR4Kys7CiAgICAgIH0KCiAgICAgIG5zID0gdGhpcy5sb2dOYW1lc3BhY2UoeyBwcmVmaXg6IG5ld1ByZWZpeCwgdXJpOiB1cmkgfSwgd2VsbGtub3duVXJpID09PSB1cmkpOwogICAgfQoKICAgIGlmIChwcmVmaXgpIHsKICAgICAgbmFtZXNwYWNlcy5tYXBQcmVmaXgocHJlZml4LCB1cmkpOwogICAgfQoKICAgIHJldHVybiBuczsKICB9OwoKICBFbGVtZW50U2VyaWFsaXplci5wcm90b3R5cGUucGFyc2VBdHRyaWJ1dGVzID0gZnVuY3Rpb24ocHJvcGVydGllcykgewogICAgdmFyIHNlbGYgPSB0aGlzLAogICAgICAgIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7CgogICAgZm9yRWFjaChwcm9wZXJ0aWVzLCBmdW5jdGlvbihwKSB7CgogICAgICB2YXIgdmFsdWUgPSBlbGVtZW50LmdldChwLm5hbWUpOwoKICAgICAgaWYgKHAuaXNSZWZlcmVuY2UpIHsKCiAgICAgICAgaWYgKCFwLmlzTWFueSkgewogICAgICAgICAgdmFsdWUgPSB2YWx1ZS5pZDsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICB2YXIgdmFsdWVzID0gW107CiAgICAgICAgICBmb3JFYWNoKHZhbHVlLCBmdW5jdGlvbih2KSB7CiAgICAgICAgICAgIHZhbHVlcy5wdXNoKHYuaWQpOwogICAgICAgICAgfSk7CiAgICAgICAgICAvLyBJRFJFRlMgaXMgYSB3aGl0ZXNwYWNlLXNlcGFyYXRlZCBsaXN0IG9mIHJlZmVyZW5jZXMuCiAgICAgICAgICB2YWx1ZSA9IHZhbHVlcy5qb2luKCcgJyk7CiAgICAgICAgfQoKICAgICAgfQoKICAgICAgc2VsZi5hZGRBdHRyaWJ1dGUoc2VsZi5uc0F0dHJpYnV0ZU5hbWUocCksIHZhbHVlKTsKICAgIH0pOwogIH07CgogIEVsZW1lbnRTZXJpYWxpemVyLnByb3RvdHlwZS5hZGRUYWdOYW1lID0gZnVuY3Rpb24obnNUYWdOYW1lKSB7CiAgICB2YXIgYWN0dWFsTnMgPSB0aGlzLmxvZ05hbWVzcGFjZVVzZWQobnNUYWdOYW1lKTsKCiAgICB0aGlzLmdldE5hbWVzcGFjZXMoKS5sb2dVc2VkKGFjdHVhbE5zKTsKCiAgICByZXR1cm4gbnNOYW1lKG5zVGFnTmFtZSk7CiAgfTsKCiAgRWxlbWVudFNlcmlhbGl6ZXIucHJvdG90eXBlLmFkZEF0dHJpYnV0ZSA9IGZ1bmN0aW9uKG5hbWUsIHZhbHVlKSB7CiAgICB2YXIgYXR0cnMgPSB0aGlzLmF0dHJzOwoKICAgIGlmIChpc1N0cmluZyh2YWx1ZSkpIHsKICAgICAgdmFsdWUgPSBlc2NhcGVBdHRyKHZhbHVlKTsKICAgIH0KCiAgICBhdHRycy5wdXNoKHsgbmFtZTogbmFtZSwgdmFsdWU6IHZhbHVlIH0pOwogIH07CgogIEVsZW1lbnRTZXJpYWxpemVyLnByb3RvdHlwZS5zZXJpYWxpemVBdHRyaWJ1dGVzID0gZnVuY3Rpb24od3JpdGVyKSB7CiAgICB2YXIgYXR0cnMgPSB0aGlzLmF0dHJzLAogICAgICAgIG5hbWVzcGFjZXMgPSB0aGlzLm5hbWVzcGFjZXM7CgogICAgaWYgKG5hbWVzcGFjZXMpIHsKICAgICAgYXR0cnMgPSBnZXROc0F0dHJzKG5hbWVzcGFjZXMpLmNvbmNhdChhdHRycyk7CiAgICB9CgogICAgZm9yRWFjaChhdHRycywgZnVuY3Rpb24oYSkgewogICAgICB3cml0ZXIKICAgICAgICAuYXBwZW5kKCcgJykKICAgICAgICAuYXBwZW5kKG5zTmFtZShhLm5hbWUpKS5hcHBlbmQoJz0iJykuYXBwZW5kKGEudmFsdWUpLmFwcGVuZCgnIicpOwogICAgfSk7CiAgfTsKCiAgRWxlbWVudFNlcmlhbGl6ZXIucHJvdG90eXBlLnNlcmlhbGl6ZVRvID0gZnVuY3Rpb24od3JpdGVyKSB7CiAgICB2YXIgZmlyc3RCb2R5ID0gdGhpcy5ib2R5WzBdLAogICAgICAgIGluZGVudCA9IGZpcnN0Qm9keSAmJiBmaXJzdEJvZHkuY29uc3RydWN0b3IgIT09IEJvZHlTZXJpYWxpemVyOwoKICAgIHdyaXRlcgogICAgICAuYXBwZW5kSW5kZW50KCkKICAgICAgLmFwcGVuZCgnPCcgKyB0aGlzLnRhZ05hbWUpOwoKICAgIHRoaXMuc2VyaWFsaXplQXR0cmlidXRlcyh3cml0ZXIpOwoKICAgIHdyaXRlci5hcHBlbmQoZmlyc3RCb2R5ID8gJz4nIDogJyAvPicpOwoKICAgIGlmIChmaXJzdEJvZHkpIHsKCiAgICAgIGlmIChpbmRlbnQpIHsKICAgICAgICB3cml0ZXIKICAgICAgICAgIC5hcHBlbmROZXdMaW5lKCkKICAgICAgICAgIC5pbmRlbnQoKTsKICAgICAgfQoKICAgICAgZm9yRWFjaCh0aGlzLmJvZHksIGZ1bmN0aW9uKGIpIHsKICAgICAgICBiLnNlcmlhbGl6ZVRvKHdyaXRlcik7CiAgICAgIH0pOwoKICAgICAgaWYgKGluZGVudCkgewogICAgICAgIHdyaXRlcgogICAgICAgICAgLnVuaW5kZW50KCkKICAgICAgICAgIC5hcHBlbmRJbmRlbnQoKTsKICAgICAgfQoKICAgICAgd3JpdGVyLmFwcGVuZCgnPC8nICsgdGhpcy50YWdOYW1lICsgJz4nKTsKICAgIH0KCiAgICB3cml0ZXIuYXBwZW5kTmV3TGluZSgpOwogIH07CgogIC8qKgogICAqIEEgc2VyaWFsaXplciBmb3IgdHlwZXMgdGhhdCBoYW5kbGVzIHNlcmlhbGl6YXRpb24gb2YgZGF0YSB0eXBlcwogICAqLwogIGZ1bmN0aW9uIFR5cGVTZXJpYWxpemVyKHBhcmVudCwgcHJvcGVydHlEZXNjcmlwdG9yKSB7CiAgICBFbGVtZW50U2VyaWFsaXplci5jYWxsKHRoaXMsIHBhcmVudCwgcHJvcGVydHlEZXNjcmlwdG9yKTsKICB9CgogIGluaGVyaXRzKFR5cGVTZXJpYWxpemVyLCBFbGVtZW50U2VyaWFsaXplcik7CgogIFR5cGVTZXJpYWxpemVyLnByb3RvdHlwZS5wYXJzZU5zQXR0cmlidXRlcyA9IGZ1bmN0aW9uKGVsZW1lbnQpIHsKCiAgICAvLyBleHRyYWN0ZWQgYXR0cmlidXRlcwogICAgdmFyIGF0dHJpYnV0ZXMgPSBFbGVtZW50U2VyaWFsaXplci5wcm90b3R5cGUucGFyc2VOc0F0dHJpYnV0ZXMuY2FsbCh0aGlzLCBlbGVtZW50KTsKCiAgICB2YXIgZGVzY3JpcHRvciA9IGVsZW1lbnQuJGRlc2NyaXB0b3I7CgogICAgLy8gb25seSBzZXJpYWxpemUgeHNpOnR5cGUgaWYgbmVjZXNzYXJ5CiAgICBpZiAoZGVzY3JpcHRvci5uYW1lID09PSB0aGlzLnByb3BlcnR5RGVzY3JpcHRvci50eXBlKSB7CiAgICAgIHJldHVybiBhdHRyaWJ1dGVzOwogICAgfQoKICAgIHZhciB0eXBlTnMgPSB0aGlzLnR5cGVOcyA9IHRoaXMubnNUYWdOYW1lKGRlc2NyaXB0b3IpOwogICAgdGhpcy5nZXROYW1lc3BhY2VzKCkubG9nVXNlZCh0aGlzLnR5cGVOcyk7CgogICAgLy8gYWRkIHhzaTp0eXBlIGF0dHJpYnV0ZSB0byByZXByZXNlbnQgdGhlIGVsZW1lbnRzCiAgICAvLyBhY3R1YWwgdHlwZQoKICAgIHZhciBwa2cgPSBlbGVtZW50LiRtb2RlbC5nZXRQYWNrYWdlKHR5cGVOcy51cmkpLAogICAgICAgIHR5cGVQcmVmaXggPSAocGtnLnhtbCAmJiBwa2cueG1sLnR5cGVQcmVmaXgpIHx8ICcnOwoKICAgIHRoaXMuYWRkQXR0cmlidXRlKAogICAgICB0aGlzLm5zQXR0cmlidXRlTmFtZShYU0lfVFlQRSQxKSwKICAgICAgKHR5cGVOcy5wcmVmaXggPyB0eXBlTnMucHJlZml4ICsgJzonIDogJycpICsgdHlwZVByZWZpeCArIGRlc2NyaXB0b3IubnMubG9jYWxOYW1lCiAgICApOwoKICAgIHJldHVybiBhdHRyaWJ1dGVzOwogIH07CgogIFR5cGVTZXJpYWxpemVyLnByb3RvdHlwZS5pc0xvY2FsTnMgPSBmdW5jdGlvbihucykgewogICAgcmV0dXJuIG5zLnVyaSA9PT0gKHRoaXMudHlwZU5zIHx8IHRoaXMubnMpLnVyaTsKICB9OwoKICBmdW5jdGlvbiBTYXZpbmdXcml0ZXIoKSB7CiAgICB0aGlzLnZhbHVlID0gJyc7CgogICAgdGhpcy53cml0ZSA9IGZ1bmN0aW9uKHN0cikgewogICAgICB0aGlzLnZhbHVlICs9IHN0cjsKICAgIH07CiAgfQoKICBmdW5jdGlvbiBGb3JtYXRpbmdXcml0ZXIob3V0LCBmb3JtYXQpIHsKCiAgICB2YXIgaW5kZW50ID0gWycnXTsKCiAgICB0aGlzLmFwcGVuZCA9IGZ1bmN0aW9uKHN0cikgewogICAgICBvdXQud3JpdGUoc3RyKTsKCiAgICAgIHJldHVybiB0aGlzOwogICAgfTsKCiAgICB0aGlzLmFwcGVuZE5ld0xpbmUgPSBmdW5jdGlvbigpIHsKICAgICAgaWYgKGZvcm1hdCkgewogICAgICAgIG91dC53cml0ZSgnXG4nKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9OwoKICAgIHRoaXMuYXBwZW5kSW5kZW50ID0gZnVuY3Rpb24oKSB7CiAgICAgIGlmIChmb3JtYXQpIHsKICAgICAgICBvdXQud3JpdGUoaW5kZW50LmpvaW4oJyAgJykpOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH07CgogICAgdGhpcy5pbmRlbnQgPSBmdW5jdGlvbigpIHsKICAgICAgaW5kZW50LnB1c2goJycpOwogICAgICByZXR1cm4gdGhpczsKICAgIH07CgogICAgdGhpcy51bmluZGVudCA9IGZ1bmN0aW9uKCkgewogICAgICBpbmRlbnQucG9wKCk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfTsKICB9CgogIC8qKgogICAqIEEgd3JpdGVyIGZvciBtZXRhLW1vZGVsIGJhY2tlZCBkb2N1bWVudCB0cmVlcwogICAqCiAgICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMgb3V0cHV0IG9wdGlvbnMgdG8gcGFzcyBpbnRvIHRoZSB3cml0ZXIKICAgKi8KICBmdW5jdGlvbiBXcml0ZXIob3B0aW9ucykgewoKICAgIG9wdGlvbnMgPSBhc3NpZ24oeyBmb3JtYXQ6IGZhbHNlLCBwcmVhbWJsZTogdHJ1ZSB9LCBvcHRpb25zIHx8IHt9KTsKCiAgICBmdW5jdGlvbiB0b1hNTCh0cmVlLCB3cml0ZXIpIHsKICAgICAgdmFyIGludGVybmFsV3JpdGVyID0gd3JpdGVyIHx8IG5ldyBTYXZpbmdXcml0ZXIoKTsKICAgICAgdmFyIGZvcm1hdGluZ1dyaXRlciA9IG5ldyBGb3JtYXRpbmdXcml0ZXIoaW50ZXJuYWxXcml0ZXIsIG9wdGlvbnMuZm9ybWF0KTsKCiAgICAgIGlmIChvcHRpb25zLnByZWFtYmxlKSB7CiAgICAgICAgZm9ybWF0aW5nV3JpdGVyLmFwcGVuZChYTUxfUFJFQU1CTEUpOwogICAgICB9CgogICAgICBuZXcgRWxlbWVudFNlcmlhbGl6ZXIoKS5idWlsZCh0cmVlKS5zZXJpYWxpemVUbyhmb3JtYXRpbmdXcml0ZXIpOwoKICAgICAgaWYgKCF3cml0ZXIpIHsKICAgICAgICByZXR1cm4gaW50ZXJuYWxXcml0ZXIudmFsdWU7CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gewogICAgICB0b1hNTDogdG9YTUwKICAgIH07CiAgfQoKICAvKioKICAgKiBBIHN1YiBjbGFzcyBvZiB7QGxpbmsgTW9kZGxlfSB3aXRoIHN1cHBvcnQgZm9yIGltcG9ydCBhbmQgZXhwb3J0IG9mIEJQTU4gMi4wIHhtbCBmaWxlcy4KICAgKgogICAqIEBjbGFzcyBCcG1uTW9kZGxlCiAgICogQGV4dGVuZHMgTW9kZGxlCiAgICoKICAgKiBAcGFyYW0ge09iamVjdHxBcnJheX0gcGFja2FnZXMgdG8gdXNlIGZvciBpbnN0YW50aWF0aW5nIHRoZSBtb2RlbAogICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc10gYWRkaXRpb25hbCBvcHRpb25zIHRvIHBhc3Mgb3ZlcgogICAqLwogIGZ1bmN0aW9uIEJwbW5Nb2RkbGUocGFja2FnZXMsIG9wdGlvbnMpIHsKICAgIE1vZGRsZS5jYWxsKHRoaXMsIHBhY2thZ2VzLCBvcHRpb25zKTsKICB9CgogIEJwbW5Nb2RkbGUucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShNb2RkbGUucHJvdG90eXBlKTsKCgogIC8qKgogICAqIEluc3RhbnRpYXRlcyBhIEJQTU4gbW9kZWwgdHJlZSBmcm9tIGEgZ2l2ZW4geG1sIHN0cmluZy4KICAgKgogICAqIEBwYXJhbSB7U3RyaW5nfSAgIHhtbFN0cgogICAqIEBwYXJhbSB7U3RyaW5nfSAgIFt0eXBlTmFtZT0nYnBtbjpEZWZpbml0aW9ucyddIG5hbWUgb2YgdGhlIHJvb3QgZWxlbWVudAogICAqIEBwYXJhbSB7T2JqZWN0fSAgIFtvcHRpb25zXSAgb3B0aW9ucyB0byBwYXNzIHRvIHRoZSB1bmRlcmx5aW5nIHJlYWRlcgogICAqIEBwYXJhbSB7RnVuY3Rpb259IGRvbmUgICAgICAgY2FsbGJhY2sgdGhhdCBpcyBpbnZva2VkIHdpdGggKGVyciwgcmVzdWx0LCBwYXJzZUNvbnRleHQpCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbmNlIHRoZSBpbXBvcnQgY29tcGxldGVzCiAgICovCiAgQnBtbk1vZGRsZS5wcm90b3R5cGUuZnJvbVhNTCA9IGZ1bmN0aW9uKHhtbFN0ciwgdHlwZU5hbWUsIG9wdGlvbnMsIGRvbmUpIHsKCiAgICBpZiAoIWlzU3RyaW5nKHR5cGVOYW1lKSkgewogICAgICBkb25lID0gb3B0aW9uczsKICAgICAgb3B0aW9ucyA9IHR5cGVOYW1lOwogICAgICB0eXBlTmFtZSA9ICdicG1uOkRlZmluaXRpb25zJzsKICAgIH0KCiAgICBpZiAoaXNGdW5jdGlvbihvcHRpb25zKSkgewogICAgICBkb25lID0gb3B0aW9uczsKICAgICAgb3B0aW9ucyA9IHt9OwogICAgfQoKICAgIHZhciByZWFkZXIgPSBuZXcgUmVhZGVyKGFzc2lnbih7IG1vZGVsOiB0aGlzLCBsYXg6IHRydWUgfSwgb3B0aW9ucykpOwogICAgdmFyIHJvb3RIYW5kbGVyID0gcmVhZGVyLmhhbmRsZXIodHlwZU5hbWUpOwoKICAgIHJlYWRlci5mcm9tWE1MKHhtbFN0ciwgcm9vdEhhbmRsZXIsIGRvbmUpOwogIH07CgoKICAvKioKICAgKiBTZXJpYWxpemVzIGEgQlBNTiAyLjAgb2JqZWN0IHRyZWUgdG8gWE1MLgogICAqCiAgICogQHBhcmFtIHtTdHJpbmd9ICAgZWxlbWVudCAgICB0aGUgcm9vdCBlbGVtZW50LCB0eXBpY2FsbHkgYW4gaW5zdGFuY2Ugb2YgYGJwbW46RGVmaW5pdGlvbnNgCiAgICogQHBhcmFtIHtPYmplY3R9ICAgW29wdGlvbnNdICB0byBwYXNzIHRvIHRoZSB1bmRlcmx5aW5nIHdyaXRlcgogICAqIEBwYXJhbSB7RnVuY3Rpb259IGRvbmUgICAgICAgY2FsbGJhY2sgaW52b2tlZCB3aXRoIChlcnIsIHhtbFN0cikgb25jZSB0aGUgaW1wb3J0IGNvbXBsZXRlcwogICAqLwogIEJwbW5Nb2RkbGUucHJvdG90eXBlLnRvWE1MID0gZnVuY3Rpb24oZWxlbWVudCwgb3B0aW9ucywgZG9uZSkgewoKICAgIGlmIChpc0Z1bmN0aW9uKG9wdGlvbnMpKSB7CiAgICAgIGRvbmUgPSBvcHRpb25zOwogICAgICBvcHRpb25zID0ge307CiAgICB9CgogICAgdmFyIHdyaXRlciA9IG5ldyBXcml0ZXIob3B0aW9ucyk7CgogICAgdmFyIHJlc3VsdDsKICAgIHZhciBlcnI7CgogICAgdHJ5IHsKICAgICAgcmVzdWx0ID0gd3JpdGVyLnRvWE1MKGVsZW1lbnQpOwogICAgfSBjYXRjaCAoZSkgewogICAgICBlcnIgPSBlOwogICAgfQoKICAgIHJldHVybiBkb25lKGVyciwgcmVzdWx0KTsKICB9OwoKICB2YXIgbmFtZSA9ICJCUE1OMjAiOwogIHZhciB1cmkgPSAiaHR0cDovL3d3dy5vbWcub3JnL3NwZWMvQlBNTi8yMDEwMDUyNC9NT0RFTCI7CiAgdmFyIGFzc29jaWF0aW9ucyA9IFsKICBdOwogIHZhciB0eXBlcyQxID0gWwogIAl7CiAgCQluYW1lOiAiSW50ZXJmYWNlIiwKICAJCXN1cGVyQ2xhc3M6IFsKICAJCQkiUm9vdEVsZW1lbnQiCiAgCQldLAogIAkJcHJvcGVydGllczogWwogIAkJCXsKICAJCQkJbmFtZTogIm5hbWUiLAogIAkJCQlpc0F0dHI6IHRydWUsCiAgCQkJCXR5cGU6ICJTdHJpbmciCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJvcGVyYXRpb25zIiwKICAJCQkJdHlwZTogIk9wZXJhdGlvbiIsCiAgCQkJCWlzTWFueTogdHJ1ZQogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAiaW1wbGVtZW50YXRpb25SZWYiLAogIAkJCQl0eXBlOiAiU3RyaW5nIiwKICAJCQkJaXNBdHRyOiB0cnVlCiAgCQkJfQogIAkJXQogIAl9LAogIAl7CiAgCQluYW1lOiAiT3BlcmF0aW9uIiwKICAJCXN1cGVyQ2xhc3M6IFsKICAJCQkiQmFzZUVsZW1lbnQiCiAgCQldLAogIAkJcHJvcGVydGllczogWwogIAkJCXsKICAJCQkJbmFtZTogIm5hbWUiLAogIAkJCQlpc0F0dHI6IHRydWUsCiAgCQkJCXR5cGU6ICJTdHJpbmciCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJpbk1lc3NhZ2VSZWYiLAogIAkJCQl0eXBlOiAiTWVzc2FnZSIsCiAgCQkJCWlzUmVmZXJlbmNlOiB0cnVlCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJvdXRNZXNzYWdlUmVmIiwKICAJCQkJdHlwZTogIk1lc3NhZ2UiLAogIAkJCQlpc1JlZmVyZW5jZTogdHJ1ZQogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAiZXJyb3JSZWYiLAogIAkJCQl0eXBlOiAiRXJyb3IiLAogIAkJCQlpc01hbnk6IHRydWUsCiAgCQkJCWlzUmVmZXJlbmNlOiB0cnVlCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJpbXBsZW1lbnRhdGlvblJlZiIsCiAgCQkJCXR5cGU6ICJTdHJpbmciLAogIAkJCQlpc0F0dHI6IHRydWUKICAJCQl9CiAgCQldCiAgCX0sCiAgCXsKICAJCW5hbWU6ICJFbmRQb2ludCIsCiAgCQlzdXBlckNsYXNzOiBbCiAgCQkJIlJvb3RFbGVtZW50IgogIAkJXQogIAl9LAogIAl7CiAgCQluYW1lOiAiQXVkaXRpbmciLAogIAkJc3VwZXJDbGFzczogWwogIAkJCSJCYXNlRWxlbWVudCIKICAJCV0KICAJfSwKICAJewogIAkJbmFtZTogIkdsb2JhbFRhc2siLAogIAkJc3VwZXJDbGFzczogWwogIAkJCSJDYWxsYWJsZUVsZW1lbnQiCiAgCQldLAogIAkJcHJvcGVydGllczogWwogIAkJCXsKICAJCQkJbmFtZTogInJlc291cmNlcyIsCiAgCQkJCXR5cGU6ICJSZXNvdXJjZVJvbGUiLAogIAkJCQlpc01hbnk6IHRydWUKICAJCQl9CiAgCQldCiAgCX0sCiAgCXsKICAJCW5hbWU6ICJNb25pdG9yaW5nIiwKICAJCXN1cGVyQ2xhc3M6IFsKICAJCQkiQmFzZUVsZW1lbnQiCiAgCQldCiAgCX0sCiAgCXsKICAJCW5hbWU6ICJQZXJmb3JtZXIiLAogIAkJc3VwZXJDbGFzczogWwogIAkJCSJSZXNvdXJjZVJvbGUiCiAgCQldCiAgCX0sCiAgCXsKICAJCW5hbWU6ICJQcm9jZXNzIiwKICAJCXN1cGVyQ2xhc3M6IFsKICAJCQkiRmxvd0VsZW1lbnRzQ29udGFpbmVyIiwKICAJCQkiQ2FsbGFibGVFbGVtZW50IgogIAkJXSwKICAJCXByb3BlcnRpZXM6IFsKICAJCQl7CiAgCQkJCW5hbWU6ICJwcm9jZXNzVHlwZSIsCiAgCQkJCXR5cGU6ICJQcm9jZXNzVHlwZSIsCiAgCQkJCWlzQXR0cjogdHJ1ZQogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAiaXNDbG9zZWQiLAogIAkJCQlpc0F0dHI6IHRydWUsCiAgCQkJCXR5cGU6ICJCb29sZWFuIgogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAiYXVkaXRpbmciLAogIAkJCQl0eXBlOiAiQXVkaXRpbmciCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJtb25pdG9yaW5nIiwKICAJCQkJdHlwZTogIk1vbml0b3JpbmciCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJwcm9wZXJ0aWVzIiwKICAJCQkJdHlwZTogIlByb3BlcnR5IiwKICAJCQkJaXNNYW55OiB0cnVlCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJsYW5lU2V0cyIsCiAgCQkJCXR5cGU6ICJMYW5lU2V0IiwKICAJCQkJaXNNYW55OiB0cnVlLAogIAkJCQlyZXBsYWNlczogIkZsb3dFbGVtZW50c0NvbnRhaW5lciNsYW5lU2V0cyIKICAJCQl9LAogIAkJCXsKICAJCQkJbmFtZTogImZsb3dFbGVtZW50cyIsCiAgCQkJCXR5cGU6ICJGbG93RWxlbWVudCIsCiAgCQkJCWlzTWFueTogdHJ1ZSwKICAJCQkJcmVwbGFjZXM6ICJGbG93RWxlbWVudHNDb250YWluZXIjZmxvd0VsZW1lbnRzIgogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAiYXJ0aWZhY3RzIiwKICAJCQkJdHlwZTogIkFydGlmYWN0IiwKICAJCQkJaXNNYW55OiB0cnVlCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJyZXNvdXJjZXMiLAogIAkJCQl0eXBlOiAiUmVzb3VyY2VSb2xlIiwKICAJCQkJaXNNYW55OiB0cnVlCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJjb3JyZWxhdGlvblN1YnNjcmlwdGlvbnMiLAogIAkJCQl0eXBlOiAiQ29ycmVsYXRpb25TdWJzY3JpcHRpb24iLAogIAkJCQlpc01hbnk6IHRydWUKICAJCQl9LAogIAkJCXsKICAJCQkJbmFtZTogInN1cHBvcnRzIiwKICAJCQkJdHlwZTogIlByb2Nlc3MiLAogIAkJCQlpc01hbnk6IHRydWUsCiAgCQkJCWlzUmVmZXJlbmNlOiB0cnVlCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJkZWZpbml0aW9uYWxDb2xsYWJvcmF0aW9uUmVmIiwKICAJCQkJdHlwZTogIkNvbGxhYm9yYXRpb24iLAogIAkJCQlpc0F0dHI6IHRydWUsCiAgCQkJCWlzUmVmZXJlbmNlOiB0cnVlCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJpc0V4ZWN1dGFibGUiLAogIAkJCQlpc0F0dHI6IHRydWUsCiAgCQkJCXR5cGU6ICJCb29sZWFuIgogIAkJCX0KICAJCV0KICAJfSwKICAJewogIAkJbmFtZTogIkxhbmVTZXQiLAogIAkJc3VwZXJDbGFzczogWwogIAkJCSJCYXNlRWxlbWVudCIKICAJCV0sCiAgCQlwcm9wZXJ0aWVzOiBbCiAgCQkJewogIAkJCQluYW1lOiAibGFuZXMiLAogIAkJCQl0eXBlOiAiTGFuZSIsCiAgCQkJCWlzTWFueTogdHJ1ZQogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAibmFtZSIsCiAgCQkJCWlzQXR0cjogdHJ1ZSwKICAJCQkJdHlwZTogIlN0cmluZyIKICAJCQl9CiAgCQldCiAgCX0sCiAgCXsKICAJCW5hbWU6ICJMYW5lIiwKICAJCXN1cGVyQ2xhc3M6IFsKICAJCQkiQmFzZUVsZW1lbnQiCiAgCQldLAogIAkJcHJvcGVydGllczogWwogIAkJCXsKICAJCQkJbmFtZTogIm5hbWUiLAogIAkJCQlpc0F0dHI6IHRydWUsCiAgCQkJCXR5cGU6ICJTdHJpbmciCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJwYXJ0aXRpb25FbGVtZW50UmVmIiwKICAJCQkJdHlwZTogIkJhc2VFbGVtZW50IiwKICAJCQkJaXNBdHRyOiB0cnVlLAogIAkJCQlpc1JlZmVyZW5jZTogdHJ1ZQogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAicGFydGl0aW9uRWxlbWVudCIsCiAgCQkJCXR5cGU6ICJCYXNlRWxlbWVudCIKICAJCQl9LAogIAkJCXsKICAJCQkJbmFtZTogImZsb3dOb2RlUmVmIiwKICAJCQkJdHlwZTogIkZsb3dOb2RlIiwKICAJCQkJaXNNYW55OiB0cnVlLAogIAkJCQlpc1JlZmVyZW5jZTogdHJ1ZQogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAiY2hpbGRMYW5lU2V0IiwKICAJCQkJdHlwZTogIkxhbmVTZXQiLAogIAkJCQl4bWw6IHsKICAJCQkJCXNlcmlhbGl6ZTogInhzaTp0eXBlIgogIAkJCQl9CiAgCQkJfQogIAkJXQogIAl9LAogIAl7CiAgCQluYW1lOiAiR2xvYmFsTWFudWFsVGFzayIsCiAgCQlzdXBlckNsYXNzOiBbCiAgCQkJIkdsb2JhbFRhc2siCiAgCQldCiAgCX0sCiAgCXsKICAJCW5hbWU6ICJNYW51YWxUYXNrIiwKICAJCXN1cGVyQ2xhc3M6IFsKICAJCQkiVGFzayIKICAJCV0KICAJfSwKICAJewogIAkJbmFtZTogIlVzZXJUYXNrIiwKICAJCXN1cGVyQ2xhc3M6IFsKICAJCQkiVGFzayIKICAJCV0sCiAgCQlwcm9wZXJ0aWVzOiBbCiAgCQkJewogIAkJCQluYW1lOiAicmVuZGVyaW5ncyIsCiAgCQkJCXR5cGU6ICJSZW5kZXJpbmciLAogIAkJCQlpc01hbnk6IHRydWUKICAJCQl9LAogIAkJCXsKICAJCQkJbmFtZTogImltcGxlbWVudGF0aW9uIiwKICAJCQkJaXNBdHRyOiB0cnVlLAogIAkJCQl0eXBlOiAiU3RyaW5nIgogIAkJCX0KICAJCV0KICAJfSwKICAJewogIAkJbmFtZTogIlJlbmRlcmluZyIsCiAgCQlzdXBlckNsYXNzOiBbCiAgCQkJIkJhc2VFbGVtZW50IgogIAkJXQogIAl9LAogIAl7CiAgCQluYW1lOiAiSHVtYW5QZXJmb3JtZXIiLAogIAkJc3VwZXJDbGFzczogWwogIAkJCSJQZXJmb3JtZXIiCiAgCQldCiAgCX0sCiAgCXsKICAJCW5hbWU6ICJQb3RlbnRpYWxPd25lciIsCiAgCQlzdXBlckNsYXNzOiBbCiAgCQkJIkh1bWFuUGVyZm9ybWVyIgogIAkJXQogIAl9LAogIAl7CiAgCQluYW1lOiAiR2xvYmFsVXNlclRhc2siLAogIAkJc3VwZXJDbGFzczogWwogIAkJCSJHbG9iYWxUYXNrIgogIAkJXSwKICAJCXByb3BlcnRpZXM6IFsKICAJCQl7CiAgCQkJCW5hbWU6ICJpbXBsZW1lbnRhdGlvbiIsCiAgCQkJCWlzQXR0cjogdHJ1ZSwKICAJCQkJdHlwZTogIlN0cmluZyIKICAJCQl9LAogIAkJCXsKICAJCQkJbmFtZTogInJlbmRlcmluZ3MiLAogIAkJCQl0eXBlOiAiUmVuZGVyaW5nIiwKICAJCQkJaXNNYW55OiB0cnVlCiAgCQkJfQogIAkJXQogIAl9LAogIAl7CiAgCQluYW1lOiAiR2F0ZXdheSIsCiAgCQlpc0Fic3RyYWN0OiB0cnVlLAogIAkJc3VwZXJDbGFzczogWwogIAkJCSJGbG93Tm9kZSIKICAJCV0sCiAgCQlwcm9wZXJ0aWVzOiBbCiAgCQkJewogIAkJCQluYW1lOiAiZ2F0ZXdheURpcmVjdGlvbiIsCiAgCQkJCXR5cGU6ICJHYXRld2F5RGlyZWN0aW9uIiwKICAJCQkJImRlZmF1bHQiOiAiVW5zcGVjaWZpZWQiLAogIAkJCQlpc0F0dHI6IHRydWUKICAJCQl9CiAgCQldCiAgCX0sCiAgCXsKICAJCW5hbWU6ICJFdmVudEJhc2VkR2F0ZXdheSIsCiAgCQlzdXBlckNsYXNzOiBbCiAgCQkJIkdhdGV3YXkiCiAgCQldLAogIAkJcHJvcGVydGllczogWwogIAkJCXsKICAJCQkJbmFtZTogImluc3RhbnRpYXRlIiwKICAJCQkJImRlZmF1bHQiOiBmYWxzZSwKICAJCQkJaXNBdHRyOiB0cnVlLAogIAkJCQl0eXBlOiAiQm9vbGVhbiIKICAJCQl9LAogIAkJCXsKICAJCQkJbmFtZTogImV2ZW50R2F0ZXdheVR5cGUiLAogIAkJCQl0eXBlOiAiRXZlbnRCYXNlZEdhdGV3YXlUeXBlIiwKICAJCQkJaXNBdHRyOiB0cnVlLAogIAkJCQkiZGVmYXVsdCI6ICJFeGNsdXNpdmUiCiAgCQkJfQogIAkJXQogIAl9LAogIAl7CiAgCQluYW1lOiAiQ29tcGxleEdhdGV3YXkiLAogIAkJc3VwZXJDbGFzczogWwogIAkJCSJHYXRld2F5IgogIAkJXSwKICAJCXByb3BlcnRpZXM6IFsKICAJCQl7CiAgCQkJCW5hbWU6ICJhY3RpdmF0aW9uQ29uZGl0aW9uIiwKICAJCQkJdHlwZTogIkV4cHJlc3Npb24iLAogIAkJCQl4bWw6IHsKICAJCQkJCXNlcmlhbGl6ZTogInhzaTp0eXBlIgogIAkJCQl9CiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJkZWZhdWx0IiwKICAJCQkJdHlwZTogIlNlcXVlbmNlRmxvdyIsCiAgCQkJCWlzQXR0cjogdHJ1ZSwKICAJCQkJaXNSZWZlcmVuY2U6IHRydWUKICAJCQl9CiAgCQldCiAgCX0sCiAgCXsKICAJCW5hbWU6ICJFeGNsdXNpdmVHYXRld2F5IiwKICAJCXN1cGVyQ2xhc3M6IFsKICAJCQkiR2F0ZXdheSIKICAJCV0sCiAgCQlwcm9wZXJ0aWVzOiBbCiAgCQkJewogIAkJCQluYW1lOiAiZGVmYXVsdCIsCiAgCQkJCXR5cGU6ICJTZXF1ZW5jZUZsb3ciLAogIAkJCQlpc0F0dHI6IHRydWUsCiAgCQkJCWlzUmVmZXJlbmNlOiB0cnVlCiAgCQkJfQogIAkJXQogIAl9LAogIAl7CiAgCQluYW1lOiAiSW5jbHVzaXZlR2F0ZXdheSIsCiAgCQlzdXBlckNsYXNzOiBbCiAgCQkJIkdhdGV3YXkiCiAgCQldLAogIAkJcHJvcGVydGllczogWwogIAkJCXsKICAJCQkJbmFtZTogImRlZmF1bHQiLAogIAkJCQl0eXBlOiAiU2VxdWVuY2VGbG93IiwKICAJCQkJaXNBdHRyOiB0cnVlLAogIAkJCQlpc1JlZmVyZW5jZTogdHJ1ZQogIAkJCX0KICAJCV0KICAJfSwKICAJewogIAkJbmFtZTogIlBhcmFsbGVsR2F0ZXdheSIsCiAgCQlzdXBlckNsYXNzOiBbCiAgCQkJIkdhdGV3YXkiCiAgCQldCiAgCX0sCiAgCXsKICAJCW5hbWU6ICJSb290RWxlbWVudCIsCiAgCQlpc0Fic3RyYWN0OiB0cnVlLAogIAkJc3VwZXJDbGFzczogWwogIAkJCSJCYXNlRWxlbWVudCIKICAJCV0KICAJfSwKICAJewogIAkJbmFtZTogIlJlbGF0aW9uc2hpcCIsCiAgCQlzdXBlckNsYXNzOiBbCiAgCQkJIkJhc2VFbGVtZW50IgogIAkJXSwKICAJCXByb3BlcnRpZXM6IFsKICAJCQl7CiAgCQkJCW5hbWU6ICJ0eXBlIiwKICAJCQkJaXNBdHRyOiB0cnVlLAogIAkJCQl0eXBlOiAiU3RyaW5nIgogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAiZGlyZWN0aW9uIiwKICAJCQkJdHlwZTogIlJlbGF0aW9uc2hpcERpcmVjdGlvbiIsCiAgCQkJCWlzQXR0cjogdHJ1ZQogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAic291cmNlIiwKICAJCQkJaXNNYW55OiB0cnVlLAogIAkJCQlpc1JlZmVyZW5jZTogdHJ1ZSwKICAJCQkJdHlwZTogIkVsZW1lbnQiCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJ0YXJnZXQiLAogIAkJCQlpc01hbnk6IHRydWUsCiAgCQkJCWlzUmVmZXJlbmNlOiB0cnVlLAogIAkJCQl0eXBlOiAiRWxlbWVudCIKICAJCQl9CiAgCQldCiAgCX0sCiAgCXsKICAJCW5hbWU6ICJCYXNlRWxlbWVudCIsCiAgCQlpc0Fic3RyYWN0OiB0cnVlLAogIAkJcHJvcGVydGllczogWwogIAkJCXsKICAJCQkJbmFtZTogImlkIiwKICAJCQkJaXNBdHRyOiB0cnVlLAogIAkJCQl0eXBlOiAiU3RyaW5nIiwKICAJCQkJaXNJZDogdHJ1ZQogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAiZG9jdW1lbnRhdGlvbiIsCiAgCQkJCXR5cGU6ICJEb2N1bWVudGF0aW9uIiwKICAJCQkJaXNNYW55OiB0cnVlCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJleHRlbnNpb25EZWZpbml0aW9ucyIsCiAgCQkJCXR5cGU6ICJFeHRlbnNpb25EZWZpbml0aW9uIiwKICAJCQkJaXNNYW55OiB0cnVlLAogIAkJCQlpc1JlZmVyZW5jZTogdHJ1ZQogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAiZXh0ZW5zaW9uRWxlbWVudHMiLAogIAkJCQl0eXBlOiAiRXh0ZW5zaW9uRWxlbWVudHMiCiAgCQkJfQogIAkJXQogIAl9LAogIAl7CiAgCQluYW1lOiAiRXh0ZW5zaW9uIiwKICAJCXByb3BlcnRpZXM6IFsKICAJCQl7CiAgCQkJCW5hbWU6ICJtdXN0VW5kZXJzdGFuZCIsCiAgCQkJCSJkZWZhdWx0IjogZmFsc2UsCiAgCQkJCWlzQXR0cjogdHJ1ZSwKICAJCQkJdHlwZTogIkJvb2xlYW4iCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJkZWZpbml0aW9uIiwKICAJCQkJdHlwZTogIkV4dGVuc2lvbkRlZmluaXRpb24iLAogIAkJCQlpc0F0dHI6IHRydWUsCiAgCQkJCWlzUmVmZXJlbmNlOiB0cnVlCiAgCQkJfQogIAkJXQogIAl9LAogIAl7CiAgCQluYW1lOiAiRXh0ZW5zaW9uRGVmaW5pdGlvbiIsCiAgCQlwcm9wZXJ0aWVzOiBbCiAgCQkJewogIAkJCQluYW1lOiAibmFtZSIsCiAgCQkJCWlzQXR0cjogdHJ1ZSwKICAJCQkJdHlwZTogIlN0cmluZyIKICAJCQl9LAogIAkJCXsKICAJCQkJbmFtZTogImV4dGVuc2lvbkF0dHJpYnV0ZURlZmluaXRpb25zIiwKICAJCQkJdHlwZTogIkV4dGVuc2lvbkF0dHJpYnV0ZURlZmluaXRpb24iLAogIAkJCQlpc01hbnk6IHRydWUKICAJCQl9CiAgCQldCiAgCX0sCiAgCXsKICAJCW5hbWU6ICJFeHRlbnNpb25BdHRyaWJ1dGVEZWZpbml0aW9uIiwKICAJCXByb3BlcnRpZXM6IFsKICAJCQl7CiAgCQkJCW5hbWU6ICJuYW1lIiwKICAJCQkJaXNBdHRyOiB0cnVlLAogIAkJCQl0eXBlOiAiU3RyaW5nIgogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAidHlwZSIsCiAgCQkJCWlzQXR0cjogdHJ1ZSwKICAJCQkJdHlwZTogIlN0cmluZyIKICAJCQl9LAogIAkJCXsKICAJCQkJbmFtZTogImlzUmVmZXJlbmNlIiwKICAJCQkJImRlZmF1bHQiOiBmYWxzZSwKICAJCQkJaXNBdHRyOiB0cnVlLAogIAkJCQl0eXBlOiAiQm9vbGVhbiIKICAJCQl9LAogIAkJCXsKICAJCQkJbmFtZTogImV4dGVuc2lvbkRlZmluaXRpb24iLAogIAkJCQl0eXBlOiAiRXh0ZW5zaW9uRGVmaW5pdGlvbiIsCiAgCQkJCWlzQXR0cjogdHJ1ZSwKICAJCQkJaXNSZWZlcmVuY2U6IHRydWUKICAJCQl9CiAgCQldCiAgCX0sCiAgCXsKICAJCW5hbWU6ICJFeHRlbnNpb25FbGVtZW50cyIsCiAgCQlwcm9wZXJ0aWVzOiBbCiAgCQkJewogIAkJCQluYW1lOiAidmFsdWVSZWYiLAogIAkJCQlpc0F0dHI6IHRydWUsCiAgCQkJCWlzUmVmZXJlbmNlOiB0cnVlLAogIAkJCQl0eXBlOiAiRWxlbWVudCIKICAJCQl9LAogIAkJCXsKICAJCQkJbmFtZTogInZhbHVlcyIsCiAgCQkJCXR5cGU6ICJFbGVtZW50IiwKICAJCQkJaXNNYW55OiB0cnVlCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJleHRlbnNpb25BdHRyaWJ1dGVEZWZpbml0aW9uIiwKICAJCQkJdHlwZTogIkV4dGVuc2lvbkF0dHJpYnV0ZURlZmluaXRpb24iLAogIAkJCQlpc0F0dHI6IHRydWUsCiAgCQkJCWlzUmVmZXJlbmNlOiB0cnVlCiAgCQkJfQogIAkJXQogIAl9LAogIAl7CiAgCQluYW1lOiAiRG9jdW1lbnRhdGlvbiIsCiAgCQlzdXBlckNsYXNzOiBbCiAgCQkJIkJhc2VFbGVtZW50IgogIAkJXSwKICAJCXByb3BlcnRpZXM6IFsKICAJCQl7CiAgCQkJCW5hbWU6ICJ0ZXh0IiwKICAJCQkJdHlwZTogIlN0cmluZyIsCiAgCQkJCWlzQm9keTogdHJ1ZQogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAidGV4dEZvcm1hdCIsCiAgCQkJCSJkZWZhdWx0IjogInRleHQvcGxhaW4iLAogIAkJCQlpc0F0dHI6IHRydWUsCiAgCQkJCXR5cGU6ICJTdHJpbmciCiAgCQkJfQogIAkJXQogIAl9LAogIAl7CiAgCQluYW1lOiAiRXZlbnQiLAogIAkJaXNBYnN0cmFjdDogdHJ1ZSwKICAJCXN1cGVyQ2xhc3M6IFsKICAJCQkiRmxvd05vZGUiLAogIAkJCSJJbnRlcmFjdGlvbk5vZGUiCiAgCQldLAogIAkJcHJvcGVydGllczogWwogIAkJCXsKICAJCQkJbmFtZTogInByb3BlcnRpZXMiLAogIAkJCQl0eXBlOiAiUHJvcGVydHkiLAogIAkJCQlpc01hbnk6IHRydWUKICAJCQl9CiAgCQldCiAgCX0sCiAgCXsKICAJCW5hbWU6ICJJbnRlcm1lZGlhdGVDYXRjaEV2ZW50IiwKICAJCXN1cGVyQ2xhc3M6IFsKICAJCQkiQ2F0Y2hFdmVudCIKICAJCV0KICAJfSwKICAJewogIAkJbmFtZTogIkludGVybWVkaWF0ZVRocm93RXZlbnQiLAogIAkJc3VwZXJDbGFzczogWwogIAkJCSJUaHJvd0V2ZW50IgogIAkJXQogIAl9LAogIAl7CiAgCQluYW1lOiAiRW5kRXZlbnQiLAogIAkJc3VwZXJDbGFzczogWwogIAkJCSJUaHJvd0V2ZW50IgogIAkJXQogIAl9LAogIAl7CiAgCQluYW1lOiAiU3RhcnRFdmVudCIsCiAgCQlzdXBlckNsYXNzOiBbCiAgCQkJIkNhdGNoRXZlbnQiCiAgCQldLAogIAkJcHJvcGVydGllczogWwogIAkJCXsKICAJCQkJbmFtZTogImlzSW50ZXJydXB0aW5nIiwKICAJCQkJImRlZmF1bHQiOiB0cnVlLAogIAkJCQlpc0F0dHI6IHRydWUsCiAgCQkJCXR5cGU6ICJCb29sZWFuIgogIAkJCX0KICAJCV0KICAJfSwKICAJewogIAkJbmFtZTogIlRocm93RXZlbnQiLAogIAkJaXNBYnN0cmFjdDogdHJ1ZSwKICAJCXN1cGVyQ2xhc3M6IFsKICAJCQkiRXZlbnQiCiAgCQldLAogIAkJcHJvcGVydGllczogWwogIAkJCXsKICAJCQkJbmFtZTogImRhdGFJbnB1dHMiLAogIAkJCQl0eXBlOiAiRGF0YUlucHV0IiwKICAJCQkJaXNNYW55OiB0cnVlCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJkYXRhSW5wdXRBc3NvY2lhdGlvbnMiLAogIAkJCQl0eXBlOiAiRGF0YUlucHV0QXNzb2NpYXRpb24iLAogIAkJCQlpc01hbnk6IHRydWUKICAJCQl9LAogIAkJCXsKICAJCQkJbmFtZTogImlucHV0U2V0IiwKICAJCQkJdHlwZTogIklucHV0U2V0IgogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAiZXZlbnREZWZpbml0aW9ucyIsCiAgCQkJCXR5cGU6ICJFdmVudERlZmluaXRpb24iLAogIAkJCQlpc01hbnk6IHRydWUKICAJCQl9LAogIAkJCXsKICAJCQkJbmFtZTogImV2ZW50RGVmaW5pdGlvblJlZiIsCiAgCQkJCXR5cGU6ICJFdmVudERlZmluaXRpb24iLAogIAkJCQlpc01hbnk6IHRydWUsCiAgCQkJCWlzUmVmZXJlbmNlOiB0cnVlCiAgCQkJfQogIAkJXQogIAl9LAogIAl7CiAgCQluYW1lOiAiQ2F0Y2hFdmVudCIsCiAgCQlpc0Fic3RyYWN0OiB0cnVlLAogIAkJc3VwZXJDbGFzczogWwogIAkJCSJFdmVudCIKICAJCV0sCiAgCQlwcm9wZXJ0aWVzOiBbCiAgCQkJewogIAkJCQluYW1lOiAicGFyYWxsZWxNdWx0aXBsZSIsCiAgCQkJCWlzQXR0cjogdHJ1ZSwKICAJCQkJdHlwZTogIkJvb2xlYW4iLAogIAkJCQkiZGVmYXVsdCI6IGZhbHNlCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJkYXRhT3V0cHV0cyIsCiAgCQkJCXR5cGU6ICJEYXRhT3V0cHV0IiwKICAJCQkJaXNNYW55OiB0cnVlCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJkYXRhT3V0cHV0QXNzb2NpYXRpb25zIiwKICAJCQkJdHlwZTogIkRhdGFPdXRwdXRBc3NvY2lhdGlvbiIsCiAgCQkJCWlzTWFueTogdHJ1ZQogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAib3V0cHV0U2V0IiwKICAJCQkJdHlwZTogIk91dHB1dFNldCIKICAJCQl9LAogIAkJCXsKICAJCQkJbmFtZTogImV2ZW50RGVmaW5pdGlvbnMiLAogIAkJCQl0eXBlOiAiRXZlbnREZWZpbml0aW9uIiwKICAJCQkJaXNNYW55OiB0cnVlCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJldmVudERlZmluaXRpb25SZWYiLAogIAkJCQl0eXBlOiAiRXZlbnREZWZpbml0aW9uIiwKICAJCQkJaXNNYW55OiB0cnVlLAogIAkJCQlpc1JlZmVyZW5jZTogdHJ1ZQogIAkJCX0KICAJCV0KICAJfSwKICAJewogIAkJbmFtZTogIkJvdW5kYXJ5RXZlbnQiLAogIAkJc3VwZXJDbGFzczogWwogIAkJCSJDYXRjaEV2ZW50IgogIAkJXSwKICAJCXByb3BlcnRpZXM6IFsKICAJCQl7CiAgCQkJCW5hbWU6ICJjYW5jZWxBY3Rpdml0eSIsCiAgCQkJCSJkZWZhdWx0IjogdHJ1ZSwKICAJCQkJaXNBdHRyOiB0cnVlLAogIAkJCQl0eXBlOiAiQm9vbGVhbiIKICAJCQl9LAogIAkJCXsKICAJCQkJbmFtZTogImF0dGFjaGVkVG9SZWYiLAogIAkJCQl0eXBlOiAiQWN0aXZpdHkiLAogIAkJCQlpc0F0dHI6IHRydWUsCiAgCQkJCWlzUmVmZXJlbmNlOiB0cnVlCiAgCQkJfQogIAkJXQogIAl9LAogIAl7CiAgCQluYW1lOiAiRXZlbnREZWZpbml0aW9uIiwKICAJCWlzQWJzdHJhY3Q6IHRydWUsCiAgCQlzdXBlckNsYXNzOiBbCiAgCQkJIlJvb3RFbGVtZW50IgogIAkJXQogIAl9LAogIAl7CiAgCQluYW1lOiAiQ2FuY2VsRXZlbnREZWZpbml0aW9uIiwKICAJCXN1cGVyQ2xhc3M6IFsKICAJCQkiRXZlbnREZWZpbml0aW9uIgogIAkJXQogIAl9LAogIAl7CiAgCQluYW1lOiAiRXJyb3JFdmVudERlZmluaXRpb24iLAogIAkJc3VwZXJDbGFzczogWwogIAkJCSJFdmVudERlZmluaXRpb24iCiAgCQldLAogIAkJcHJvcGVydGllczogWwogIAkJCXsKICAJCQkJbmFtZTogImVycm9yUmVmIiwKICAJCQkJdHlwZTogIkVycm9yIiwKICAJCQkJaXNBdHRyOiB0cnVlLAogIAkJCQlpc1JlZmVyZW5jZTogdHJ1ZQogIAkJCX0KICAJCV0KICAJfSwKICAJewogIAkJbmFtZTogIlRlcm1pbmF0ZUV2ZW50RGVmaW5pdGlvbiIsCiAgCQlzdXBlckNsYXNzOiBbCiAgCQkJIkV2ZW50RGVmaW5pdGlvbiIKICAJCV0KICAJfSwKICAJewogIAkJbmFtZTogIkVzY2FsYXRpb25FdmVudERlZmluaXRpb24iLAogIAkJc3VwZXJDbGFzczogWwogIAkJCSJFdmVudERlZmluaXRpb24iCiAgCQldLAogIAkJcHJvcGVydGllczogWwogIAkJCXsKICAJCQkJbmFtZTogImVzY2FsYXRpb25SZWYiLAogIAkJCQl0eXBlOiAiRXNjYWxhdGlvbiIsCiAgCQkJCWlzQXR0cjogdHJ1ZSwKICAJCQkJaXNSZWZlcmVuY2U6IHRydWUKICAJCQl9CiAgCQldCiAgCX0sCiAgCXsKICAJCW5hbWU6ICJFc2NhbGF0aW9uIiwKICAJCXByb3BlcnRpZXM6IFsKICAJCQl7CiAgCQkJCW5hbWU6ICJzdHJ1Y3R1cmVSZWYiLAogIAkJCQl0eXBlOiAiSXRlbURlZmluaXRpb24iLAogIAkJCQlpc0F0dHI6IHRydWUsCiAgCQkJCWlzUmVmZXJlbmNlOiB0cnVlCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJuYW1lIiwKICAJCQkJaXNBdHRyOiB0cnVlLAogIAkJCQl0eXBlOiAiU3RyaW5nIgogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAiZXNjYWxhdGlvbkNvZGUiLAogIAkJCQlpc0F0dHI6IHRydWUsCiAgCQkJCXR5cGU6ICJTdHJpbmciCiAgCQkJfQogIAkJXSwKICAJCXN1cGVyQ2xhc3M6IFsKICAJCQkiUm9vdEVsZW1lbnQiCiAgCQldCiAgCX0sCiAgCXsKICAJCW5hbWU6ICJDb21wZW5zYXRlRXZlbnREZWZpbml0aW9uIiwKICAJCXN1cGVyQ2xhc3M6IFsKICAJCQkiRXZlbnREZWZpbml0aW9uIgogIAkJXSwKICAJCXByb3BlcnRpZXM6IFsKICAJCQl7CiAgCQkJCW5hbWU6ICJ3YWl0Rm9yQ29tcGxldGlvbiIsCiAgCQkJCWlzQXR0cjogdHJ1ZSwKICAJCQkJdHlwZTogIkJvb2xlYW4iLAogIAkJCQkiZGVmYXVsdCI6IHRydWUKICAJCQl9LAogIAkJCXsKICAJCQkJbmFtZTogImFjdGl2aXR5UmVmIiwKICAJCQkJdHlwZTogIkFjdGl2aXR5IiwKICAJCQkJaXNBdHRyOiB0cnVlLAogIAkJCQlpc1JlZmVyZW5jZTogdHJ1ZQogIAkJCX0KICAJCV0KICAJfSwKICAJewogIAkJbmFtZTogIlRpbWVyRXZlbnREZWZpbml0aW9uIiwKICAJCXN1cGVyQ2xhc3M6IFsKICAJCQkiRXZlbnREZWZpbml0aW9uIgogIAkJXSwKICAJCXByb3BlcnRpZXM6IFsKICAJCQl7CiAgCQkJCW5hbWU6ICJ0aW1lRGF0ZSIsCiAgCQkJCXR5cGU6ICJFeHByZXNzaW9uIiwKICAJCQkJeG1sOiB7CiAgCQkJCQlzZXJpYWxpemU6ICJ4c2k6dHlwZSIKICAJCQkJfQogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAidGltZUN5Y2xlIiwKICAJCQkJdHlwZTogIkV4cHJlc3Npb24iLAogIAkJCQl4bWw6IHsKICAJCQkJCXNlcmlhbGl6ZTogInhzaTp0eXBlIgogIAkJCQl9CiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJ0aW1lRHVyYXRpb24iLAogIAkJCQl0eXBlOiAiRXhwcmVzc2lvbiIsCiAgCQkJCXhtbDogewogIAkJCQkJc2VyaWFsaXplOiAieHNpOnR5cGUiCiAgCQkJCX0KICAJCQl9CiAgCQldCiAgCX0sCiAgCXsKICAJCW5hbWU6ICJMaW5rRXZlbnREZWZpbml0aW9uIiwKICAJCXN1cGVyQ2xhc3M6IFsKICAJCQkiRXZlbnREZWZpbml0aW9uIgogIAkJXSwKICAJCXByb3BlcnRpZXM6IFsKICAJCQl7CiAgCQkJCW5hbWU6ICJuYW1lIiwKICAJCQkJaXNBdHRyOiB0cnVlLAogIAkJCQl0eXBlOiAiU3RyaW5nIgogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAidGFyZ2V0IiwKICAJCQkJdHlwZTogIkxpbmtFdmVudERlZmluaXRpb24iLAogIAkJCQlpc0F0dHI6IHRydWUsCiAgCQkJCWlzUmVmZXJlbmNlOiB0cnVlCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJzb3VyY2UiLAogIAkJCQl0eXBlOiAiTGlua0V2ZW50RGVmaW5pdGlvbiIsCiAgCQkJCWlzTWFueTogdHJ1ZSwKICAJCQkJaXNSZWZlcmVuY2U6IHRydWUKICAJCQl9CiAgCQldCiAgCX0sCiAgCXsKICAJCW5hbWU6ICJNZXNzYWdlRXZlbnREZWZpbml0aW9uIiwKICAJCXN1cGVyQ2xhc3M6IFsKICAJCQkiRXZlbnREZWZpbml0aW9uIgogIAkJXSwKICAJCXByb3BlcnRpZXM6IFsKICAJCQl7CiAgCQkJCW5hbWU6ICJtZXNzYWdlUmVmIiwKICAJCQkJdHlwZTogIk1lc3NhZ2UiLAogIAkJCQlpc0F0dHI6IHRydWUsCiAgCQkJCWlzUmVmZXJlbmNlOiB0cnVlCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJvcGVyYXRpb25SZWYiLAogIAkJCQl0eXBlOiAiT3BlcmF0aW9uIiwKICAJCQkJaXNBdHRyOiB0cnVlLAogIAkJCQlpc1JlZmVyZW5jZTogdHJ1ZQogIAkJCX0KICAJCV0KICAJfSwKICAJewogIAkJbmFtZTogIkNvbmRpdGlvbmFsRXZlbnREZWZpbml0aW9uIiwKICAJCXN1cGVyQ2xhc3M6IFsKICAJCQkiRXZlbnREZWZpbml0aW9uIgogIAkJXSwKICAJCXByb3BlcnRpZXM6IFsKICAJCQl7CiAgCQkJCW5hbWU6ICJjb25kaXRpb24iLAogIAkJCQl0eXBlOiAiRXhwcmVzc2lvbiIsCiAgCQkJCXhtbDogewogIAkJCQkJc2VyaWFsaXplOiAieHNpOnR5cGUiCiAgCQkJCX0KICAJCQl9CiAgCQldCiAgCX0sCiAgCXsKICAJCW5hbWU6ICJTaWduYWxFdmVudERlZmluaXRpb24iLAogIAkJc3VwZXJDbGFzczogWwogIAkJCSJFdmVudERlZmluaXRpb24iCiAgCQldLAogIAkJcHJvcGVydGllczogWwogIAkJCXsKICAJCQkJbmFtZTogInNpZ25hbFJlZiIsCiAgCQkJCXR5cGU6ICJTaWduYWwiLAogIAkJCQlpc0F0dHI6IHRydWUsCiAgCQkJCWlzUmVmZXJlbmNlOiB0cnVlCiAgCQkJfQogIAkJXQogIAl9LAogIAl7CiAgCQluYW1lOiAiU2lnbmFsIiwKICAJCXN1cGVyQ2xhc3M6IFsKICAJCQkiUm9vdEVsZW1lbnQiCiAgCQldLAogIAkJcHJvcGVydGllczogWwogIAkJCXsKICAJCQkJbmFtZTogInN0cnVjdHVyZVJlZiIsCiAgCQkJCXR5cGU6ICJJdGVtRGVmaW5pdGlvbiIsCiAgCQkJCWlzQXR0cjogdHJ1ZSwKICAJCQkJaXNSZWZlcmVuY2U6IHRydWUKICAJCQl9LAogIAkJCXsKICAJCQkJbmFtZTogIm5hbWUiLAogIAkJCQlpc0F0dHI6IHRydWUsCiAgCQkJCXR5cGU6ICJTdHJpbmciCiAgCQkJfQogIAkJXQogIAl9LAogIAl7CiAgCQluYW1lOiAiSW1wbGljaXRUaHJvd0V2ZW50IiwKICAJCXN1cGVyQ2xhc3M6IFsKICAJCQkiVGhyb3dFdmVudCIKICAJCV0KICAJfSwKICAJewogIAkJbmFtZTogIkRhdGFTdGF0ZSIsCiAgCQlzdXBlckNsYXNzOiBbCiAgCQkJIkJhc2VFbGVtZW50IgogIAkJXSwKICAJCXByb3BlcnRpZXM6IFsKICAJCQl7CiAgCQkJCW5hbWU6ICJuYW1lIiwKICAJCQkJaXNBdHRyOiB0cnVlLAogIAkJCQl0eXBlOiAiU3RyaW5nIgogIAkJCX0KICAJCV0KICAJfSwKICAJewogIAkJbmFtZTogIkl0ZW1Bd2FyZUVsZW1lbnQiLAogIAkJc3VwZXJDbGFzczogWwogIAkJCSJCYXNlRWxlbWVudCIKICAJCV0sCiAgCQlwcm9wZXJ0aWVzOiBbCiAgCQkJewogIAkJCQluYW1lOiAiaXRlbVN1YmplY3RSZWYiLAogIAkJCQl0eXBlOiAiSXRlbURlZmluaXRpb24iLAogIAkJCQlpc0F0dHI6IHRydWUsCiAgCQkJCWlzUmVmZXJlbmNlOiB0cnVlCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJkYXRhU3RhdGUiLAogIAkJCQl0eXBlOiAiRGF0YVN0YXRlIgogIAkJCX0KICAJCV0KICAJfSwKICAJewogIAkJbmFtZTogIkRhdGFBc3NvY2lhdGlvbiIsCiAgCQlzdXBlckNsYXNzOiBbCiAgCQkJIkJhc2VFbGVtZW50IgogIAkJXSwKICAJCXByb3BlcnRpZXM6IFsKICAJCQl7CiAgCQkJCW5hbWU6ICJhc3NpZ25tZW50IiwKICAJCQkJdHlwZTogIkFzc2lnbm1lbnQiLAogIAkJCQlpc01hbnk6IHRydWUKICAJCQl9LAogIAkJCXsKICAJCQkJbmFtZTogInNvdXJjZVJlZiIsCiAgCQkJCXR5cGU6ICJJdGVtQXdhcmVFbGVtZW50IiwKICAJCQkJaXNNYW55OiB0cnVlLAogIAkJCQlpc1JlZmVyZW5jZTogdHJ1ZQogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAidGFyZ2V0UmVmIiwKICAJCQkJdHlwZTogIkl0ZW1Bd2FyZUVsZW1lbnQiLAogIAkJCQlpc1JlZmVyZW5jZTogdHJ1ZQogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAidHJhbnNmb3JtYXRpb24iLAogIAkJCQl0eXBlOiAiRm9ybWFsRXhwcmVzc2lvbiIsCiAgCQkJCXhtbDogewogIAkJCQkJc2VyaWFsaXplOiAicHJvcGVydHkiCiAgCQkJCX0KICAJCQl9CiAgCQldCiAgCX0sCiAgCXsKICAJCW5hbWU6ICJEYXRhSW5wdXQiLAogIAkJc3VwZXJDbGFzczogWwogIAkJCSJJdGVtQXdhcmVFbGVtZW50IgogIAkJXSwKICAJCXByb3BlcnRpZXM6IFsKICAJCQl7CiAgCQkJCW5hbWU6ICJuYW1lIiwKICAJCQkJaXNBdHRyOiB0cnVlLAogIAkJCQl0eXBlOiAiU3RyaW5nIgogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAiaXNDb2xsZWN0aW9uIiwKICAJCQkJImRlZmF1bHQiOiBmYWxzZSwKICAJCQkJaXNBdHRyOiB0cnVlLAogIAkJCQl0eXBlOiAiQm9vbGVhbiIKICAJCQl9LAogIAkJCXsKICAJCQkJbmFtZTogImlucHV0U2V0UmVmIiwKICAJCQkJdHlwZTogIklucHV0U2V0IiwKICAJCQkJaXNWaXJ0dWFsOiB0cnVlLAogIAkJCQlpc01hbnk6IHRydWUsCiAgCQkJCWlzUmVmZXJlbmNlOiB0cnVlCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJpbnB1dFNldFdpdGhPcHRpb25hbCIsCiAgCQkJCXR5cGU6ICJJbnB1dFNldCIsCiAgCQkJCWlzVmlydHVhbDogdHJ1ZSwKICAJCQkJaXNNYW55OiB0cnVlLAogIAkJCQlpc1JlZmVyZW5jZTogdHJ1ZQogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAiaW5wdXRTZXRXaXRoV2hpbGVFeGVjdXRpbmciLAogIAkJCQl0eXBlOiAiSW5wdXRTZXQiLAogIAkJCQlpc1ZpcnR1YWw6IHRydWUsCiAgCQkJCWlzTWFueTogdHJ1ZSwKICAJCQkJaXNSZWZlcmVuY2U6IHRydWUKICAJCQl9CiAgCQldCiAgCX0sCiAgCXsKICAJCW5hbWU6ICJEYXRhT3V0cHV0IiwKICAJCXN1cGVyQ2xhc3M6IFsKICAJCQkiSXRlbUF3YXJlRWxlbWVudCIKICAJCV0sCiAgCQlwcm9wZXJ0aWVzOiBbCiAgCQkJewogIAkJCQluYW1lOiAibmFtZSIsCiAgCQkJCWlzQXR0cjogdHJ1ZSwKICAJCQkJdHlwZTogIlN0cmluZyIKICAJCQl9LAogIAkJCXsKICAJCQkJbmFtZTogImlzQ29sbGVjdGlvbiIsCiAgCQkJCSJkZWZhdWx0IjogZmFsc2UsCiAgCQkJCWlzQXR0cjogdHJ1ZSwKICAJCQkJdHlwZTogIkJvb2xlYW4iCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJvdXRwdXRTZXRSZWYiLAogIAkJCQl0eXBlOiAiT3V0cHV0U2V0IiwKICAJCQkJaXNWaXJ0dWFsOiB0cnVlLAogIAkJCQlpc01hbnk6IHRydWUsCiAgCQkJCWlzUmVmZXJlbmNlOiB0cnVlCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJvdXRwdXRTZXRXaXRoT3B0aW9uYWwiLAogIAkJCQl0eXBlOiAiT3V0cHV0U2V0IiwKICAJCQkJaXNWaXJ0dWFsOiB0cnVlLAogIAkJCQlpc01hbnk6IHRydWUsCiAgCQkJCWlzUmVmZXJlbmNlOiB0cnVlCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJvdXRwdXRTZXRXaXRoV2hpbGVFeGVjdXRpbmciLAogIAkJCQl0eXBlOiAiT3V0cHV0U2V0IiwKICAJCQkJaXNWaXJ0dWFsOiB0cnVlLAogIAkJCQlpc01hbnk6IHRydWUsCiAgCQkJCWlzUmVmZXJlbmNlOiB0cnVlCiAgCQkJfQogIAkJXQogIAl9LAogIAl7CiAgCQluYW1lOiAiSW5wdXRTZXQiLAogIAkJc3VwZXJDbGFzczogWwogIAkJCSJCYXNlRWxlbWVudCIKICAJCV0sCiAgCQlwcm9wZXJ0aWVzOiBbCiAgCQkJewogIAkJCQluYW1lOiAibmFtZSIsCiAgCQkJCWlzQXR0cjogdHJ1ZSwKICAJCQkJdHlwZTogIlN0cmluZyIKICAJCQl9LAogIAkJCXsKICAJCQkJbmFtZTogImRhdGFJbnB1dFJlZnMiLAogIAkJCQl0eXBlOiAiRGF0YUlucHV0IiwKICAJCQkJaXNNYW55OiB0cnVlLAogIAkJCQlpc1JlZmVyZW5jZTogdHJ1ZQogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAib3B0aW9uYWxJbnB1dFJlZnMiLAogIAkJCQl0eXBlOiAiRGF0YUlucHV0IiwKICAJCQkJaXNNYW55OiB0cnVlLAogIAkJCQlpc1JlZmVyZW5jZTogdHJ1ZQogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAid2hpbGVFeGVjdXRpbmdJbnB1dFJlZnMiLAogIAkJCQl0eXBlOiAiRGF0YUlucHV0IiwKICAJCQkJaXNNYW55OiB0cnVlLAogIAkJCQlpc1JlZmVyZW5jZTogdHJ1ZQogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAib3V0cHV0U2V0UmVmcyIsCiAgCQkJCXR5cGU6ICJPdXRwdXRTZXQiLAogIAkJCQlpc01hbnk6IHRydWUsCiAgCQkJCWlzUmVmZXJlbmNlOiB0cnVlCiAgCQkJfQogIAkJXQogIAl9LAogIAl7CiAgCQluYW1lOiAiT3V0cHV0U2V0IiwKICAJCXN1cGVyQ2xhc3M6IFsKICAJCQkiQmFzZUVsZW1lbnQiCiAgCQldLAogIAkJcHJvcGVydGllczogWwogIAkJCXsKICAJCQkJbmFtZTogImRhdGFPdXRwdXRSZWZzIiwKICAJCQkJdHlwZTogIkRhdGFPdXRwdXQiLAogIAkJCQlpc01hbnk6IHRydWUsCiAgCQkJCWlzUmVmZXJlbmNlOiB0cnVlCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJuYW1lIiwKICAJCQkJaXNBdHRyOiB0cnVlLAogIAkJCQl0eXBlOiAiU3RyaW5nIgogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAiaW5wdXRTZXRSZWZzIiwKICAJCQkJdHlwZTogIklucHV0U2V0IiwKICAJCQkJaXNNYW55OiB0cnVlLAogIAkJCQlpc1JlZmVyZW5jZTogdHJ1ZQogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAib3B0aW9uYWxPdXRwdXRSZWZzIiwKICAJCQkJdHlwZTogIkRhdGFPdXRwdXQiLAogIAkJCQlpc01hbnk6IHRydWUsCiAgCQkJCWlzUmVmZXJlbmNlOiB0cnVlCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJ3aGlsZUV4ZWN1dGluZ091dHB1dFJlZnMiLAogIAkJCQl0eXBlOiAiRGF0YU91dHB1dCIsCiAgCQkJCWlzTWFueTogdHJ1ZSwKICAJCQkJaXNSZWZlcmVuY2U6IHRydWUKICAJCQl9CiAgCQldCiAgCX0sCiAgCXsKICAJCW5hbWU6ICJQcm9wZXJ0eSIsCiAgCQlzdXBlckNsYXNzOiBbCiAgCQkJIkl0ZW1Bd2FyZUVsZW1lbnQiCiAgCQldLAogIAkJcHJvcGVydGllczogWwogIAkJCXsKICAJCQkJbmFtZTogIm5hbWUiLAogIAkJCQlpc0F0dHI6IHRydWUsCiAgCQkJCXR5cGU6ICJTdHJpbmciCiAgCQkJfQogIAkJXQogIAl9LAogIAl7CiAgCQluYW1lOiAiRGF0YUlucHV0QXNzb2NpYXRpb24iLAogIAkJc3VwZXJDbGFzczogWwogIAkJCSJEYXRhQXNzb2NpYXRpb24iCiAgCQldCiAgCX0sCiAgCXsKICAJCW5hbWU6ICJEYXRhT3V0cHV0QXNzb2NpYXRpb24iLAogIAkJc3VwZXJDbGFzczogWwogIAkJCSJEYXRhQXNzb2NpYXRpb24iCiAgCQldCiAgCX0sCiAgCXsKICAJCW5hbWU6ICJJbnB1dE91dHB1dFNwZWNpZmljYXRpb24iLAogIAkJc3VwZXJDbGFzczogWwogIAkJCSJCYXNlRWxlbWVudCIKICAJCV0sCiAgCQlwcm9wZXJ0aWVzOiBbCiAgCQkJewogIAkJCQluYW1lOiAiZGF0YUlucHV0cyIsCiAgCQkJCXR5cGU6ICJEYXRhSW5wdXQiLAogIAkJCQlpc01hbnk6IHRydWUKICAJCQl9LAogIAkJCXsKICAJCQkJbmFtZTogImRhdGFPdXRwdXRzIiwKICAJCQkJdHlwZTogIkRhdGFPdXRwdXQiLAogIAkJCQlpc01hbnk6IHRydWUKICAJCQl9LAogIAkJCXsKICAJCQkJbmFtZTogImlucHV0U2V0cyIsCiAgCQkJCXR5cGU6ICJJbnB1dFNldCIsCiAgCQkJCWlzTWFueTogdHJ1ZQogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAib3V0cHV0U2V0cyIsCiAgCQkJCXR5cGU6ICJPdXRwdXRTZXQiLAogIAkJCQlpc01hbnk6IHRydWUKICAJCQl9CiAgCQldCiAgCX0sCiAgCXsKICAJCW5hbWU6ICJEYXRhT2JqZWN0IiwKICAJCXN1cGVyQ2xhc3M6IFsKICAJCQkiRmxvd0VsZW1lbnQiLAogIAkJCSJJdGVtQXdhcmVFbGVtZW50IgogIAkJXSwKICAJCXByb3BlcnRpZXM6IFsKICAJCQl7CiAgCQkJCW5hbWU6ICJpc0NvbGxlY3Rpb24iLAogIAkJCQkiZGVmYXVsdCI6IGZhbHNlLAogIAkJCQlpc0F0dHI6IHRydWUsCiAgCQkJCXR5cGU6ICJCb29sZWFuIgogIAkJCX0KICAJCV0KICAJfSwKICAJewogIAkJbmFtZTogIklucHV0T3V0cHV0QmluZGluZyIsCiAgCQlwcm9wZXJ0aWVzOiBbCiAgCQkJewogIAkJCQluYW1lOiAiaW5wdXREYXRhUmVmIiwKICAJCQkJdHlwZTogIklucHV0U2V0IiwKICAJCQkJaXNBdHRyOiB0cnVlLAogIAkJCQlpc1JlZmVyZW5jZTogdHJ1ZQogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAib3V0cHV0RGF0YVJlZiIsCiAgCQkJCXR5cGU6ICJPdXRwdXRTZXQiLAogIAkJCQlpc0F0dHI6IHRydWUsCiAgCQkJCWlzUmVmZXJlbmNlOiB0cnVlCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJvcGVyYXRpb25SZWYiLAogIAkJCQl0eXBlOiAiT3BlcmF0aW9uIiwKICAJCQkJaXNBdHRyOiB0cnVlLAogIAkJCQlpc1JlZmVyZW5jZTogdHJ1ZQogIAkJCX0KICAJCV0KICAJfSwKICAJewogIAkJbmFtZTogIkFzc2lnbm1lbnQiLAogIAkJc3VwZXJDbGFzczogWwogIAkJCSJCYXNlRWxlbWVudCIKICAJCV0sCiAgCQlwcm9wZXJ0aWVzOiBbCiAgCQkJewogIAkJCQluYW1lOiAiZnJvbSIsCiAgCQkJCXR5cGU6ICJFeHByZXNzaW9uIiwKICAJCQkJeG1sOiB7CiAgCQkJCQlzZXJpYWxpemU6ICJ4c2k6dHlwZSIKICAJCQkJfQogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAidG8iLAogIAkJCQl0eXBlOiAiRXhwcmVzc2lvbiIsCiAgCQkJCXhtbDogewogIAkJCQkJc2VyaWFsaXplOiAieHNpOnR5cGUiCiAgCQkJCX0KICAJCQl9CiAgCQldCiAgCX0sCiAgCXsKICAJCW5hbWU6ICJEYXRhU3RvcmUiLAogIAkJc3VwZXJDbGFzczogWwogIAkJCSJSb290RWxlbWVudCIsCiAgCQkJIkl0ZW1Bd2FyZUVsZW1lbnQiCiAgCQldLAogIAkJcHJvcGVydGllczogWwogIAkJCXsKICAJCQkJbmFtZTogIm5hbWUiLAogIAkJCQlpc0F0dHI6IHRydWUsCiAgCQkJCXR5cGU6ICJTdHJpbmciCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJjYXBhY2l0eSIsCiAgCQkJCWlzQXR0cjogdHJ1ZSwKICAJCQkJdHlwZTogIkludGVnZXIiCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJpc1VubGltaXRlZCIsCiAgCQkJCSJkZWZhdWx0IjogdHJ1ZSwKICAJCQkJaXNBdHRyOiB0cnVlLAogIAkJCQl0eXBlOiAiQm9vbGVhbiIKICAJCQl9CiAgCQldCiAgCX0sCiAgCXsKICAJCW5hbWU6ICJEYXRhU3RvcmVSZWZlcmVuY2UiLAogIAkJc3VwZXJDbGFzczogWwogIAkJCSJJdGVtQXdhcmVFbGVtZW50IiwKICAJCQkiRmxvd0VsZW1lbnQiCiAgCQldLAogIAkJcHJvcGVydGllczogWwogIAkJCXsKICAJCQkJbmFtZTogImRhdGFTdG9yZVJlZiIsCiAgCQkJCXR5cGU6ICJEYXRhU3RvcmUiLAogIAkJCQlpc0F0dHI6IHRydWUsCiAgCQkJCWlzUmVmZXJlbmNlOiB0cnVlCiAgCQkJfQogIAkJXQogIAl9LAogIAl7CiAgCQluYW1lOiAiRGF0YU9iamVjdFJlZmVyZW5jZSIsCiAgCQlzdXBlckNsYXNzOiBbCiAgCQkJIkl0ZW1Bd2FyZUVsZW1lbnQiLAogIAkJCSJGbG93RWxlbWVudCIKICAJCV0sCiAgCQlwcm9wZXJ0aWVzOiBbCiAgCQkJewogIAkJCQluYW1lOiAiZGF0YU9iamVjdFJlZiIsCiAgCQkJCXR5cGU6ICJEYXRhT2JqZWN0IiwKICAJCQkJaXNBdHRyOiB0cnVlLAogIAkJCQlpc1JlZmVyZW5jZTogdHJ1ZQogIAkJCX0KICAJCV0KICAJfSwKICAJewogIAkJbmFtZTogIkNvbnZlcnNhdGlvbkxpbmsiLAogIAkJc3VwZXJDbGFzczogWwogIAkJCSJCYXNlRWxlbWVudCIKICAJCV0sCiAgCQlwcm9wZXJ0aWVzOiBbCiAgCQkJewogIAkJCQluYW1lOiAic291cmNlUmVmIiwKICAJCQkJdHlwZTogIkludGVyYWN0aW9uTm9kZSIsCiAgCQkJCWlzQXR0cjogdHJ1ZSwKICAJCQkJaXNSZWZlcmVuY2U6IHRydWUKICAJCQl9LAogIAkJCXsKICAJCQkJbmFtZTogInRhcmdldFJlZiIsCiAgCQkJCXR5cGU6ICJJbnRlcmFjdGlvbk5vZGUiLAogIAkJCQlpc0F0dHI6IHRydWUsCiAgCQkJCWlzUmVmZXJlbmNlOiB0cnVlCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJuYW1lIiwKICAJCQkJaXNBdHRyOiB0cnVlLAogIAkJCQl0eXBlOiAiU3RyaW5nIgogIAkJCX0KICAJCV0KICAJfSwKICAJewogIAkJbmFtZTogIkNvbnZlcnNhdGlvbkFzc29jaWF0aW9uIiwKICAJCXN1cGVyQ2xhc3M6IFsKICAJCQkiQmFzZUVsZW1lbnQiCiAgCQldLAogIAkJcHJvcGVydGllczogWwogIAkJCXsKICAJCQkJbmFtZTogImlubmVyQ29udmVyc2F0aW9uTm9kZVJlZiIsCiAgCQkJCXR5cGU6ICJDb252ZXJzYXRpb25Ob2RlIiwKICAJCQkJaXNBdHRyOiB0cnVlLAogIAkJCQlpc1JlZmVyZW5jZTogdHJ1ZQogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAib3V0ZXJDb252ZXJzYXRpb25Ob2RlUmVmIiwKICAJCQkJdHlwZTogIkNvbnZlcnNhdGlvbk5vZGUiLAogIAkJCQlpc0F0dHI6IHRydWUsCiAgCQkJCWlzUmVmZXJlbmNlOiB0cnVlCiAgCQkJfQogIAkJXQogIAl9LAogIAl7CiAgCQluYW1lOiAiQ2FsbENvbnZlcnNhdGlvbiIsCiAgCQlzdXBlckNsYXNzOiBbCiAgCQkJIkNvbnZlcnNhdGlvbk5vZGUiCiAgCQldLAogIAkJcHJvcGVydGllczogWwogIAkJCXsKICAJCQkJbmFtZTogImNhbGxlZENvbGxhYm9yYXRpb25SZWYiLAogIAkJCQl0eXBlOiAiQ29sbGFib3JhdGlvbiIsCiAgCQkJCWlzQXR0cjogdHJ1ZSwKICAJCQkJaXNSZWZlcmVuY2U6IHRydWUKICAJCQl9LAogIAkJCXsKICAJCQkJbmFtZTogInBhcnRpY2lwYW50QXNzb2NpYXRpb25zIiwKICAJCQkJdHlwZTogIlBhcnRpY2lwYW50QXNzb2NpYXRpb24iLAogIAkJCQlpc01hbnk6IHRydWUKICAJCQl9CiAgCQldCiAgCX0sCiAgCXsKICAJCW5hbWU6ICJDb252ZXJzYXRpb24iLAogIAkJc3VwZXJDbGFzczogWwogIAkJCSJDb252ZXJzYXRpb25Ob2RlIgogIAkJXQogIAl9LAogIAl7CiAgCQluYW1lOiAiU3ViQ29udmVyc2F0aW9uIiwKICAJCXN1cGVyQ2xhc3M6IFsKICAJCQkiQ29udmVyc2F0aW9uTm9kZSIKICAJCV0sCiAgCQlwcm9wZXJ0aWVzOiBbCiAgCQkJewogIAkJCQluYW1lOiAiY29udmVyc2F0aW9uTm9kZXMiLAogIAkJCQl0eXBlOiAiQ29udmVyc2F0aW9uTm9kZSIsCiAgCQkJCWlzTWFueTogdHJ1ZQogIAkJCX0KICAJCV0KICAJfSwKICAJewogIAkJbmFtZTogIkNvbnZlcnNhdGlvbk5vZGUiLAogIAkJaXNBYnN0cmFjdDogdHJ1ZSwKICAJCXN1cGVyQ2xhc3M6IFsKICAJCQkiSW50ZXJhY3Rpb25Ob2RlIiwKICAJCQkiQmFzZUVsZW1lbnQiCiAgCQldLAogIAkJcHJvcGVydGllczogWwogIAkJCXsKICAJCQkJbmFtZTogIm5hbWUiLAogIAkJCQlpc0F0dHI6IHRydWUsCiAgCQkJCXR5cGU6ICJTdHJpbmciCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJwYXJ0aWNpcGFudFJlZiIsCiAgCQkJCXR5cGU6ICJQYXJ0aWNpcGFudCIsCiAgCQkJCWlzTWFueTogdHJ1ZSwKICAJCQkJaXNSZWZlcmVuY2U6IHRydWUKICAJCQl9LAogIAkJCXsKICAJCQkJbmFtZTogIm1lc3NhZ2VGbG93UmVmcyIsCiAgCQkJCXR5cGU6ICJNZXNzYWdlRmxvdyIsCiAgCQkJCWlzTWFueTogdHJ1ZSwKICAJCQkJaXNSZWZlcmVuY2U6IHRydWUKICAJCQl9LAogIAkJCXsKICAJCQkJbmFtZTogImNvcnJlbGF0aW9uS2V5cyIsCiAgCQkJCXR5cGU6ICJDb3JyZWxhdGlvbktleSIsCiAgCQkJCWlzTWFueTogdHJ1ZQogIAkJCX0KICAJCV0KICAJfSwKICAJewogIAkJbmFtZTogIkdsb2JhbENvbnZlcnNhdGlvbiIsCiAgCQlzdXBlckNsYXNzOiBbCiAgCQkJIkNvbGxhYm9yYXRpb24iCiAgCQldCiAgCX0sCiAgCXsKICAJCW5hbWU6ICJQYXJ0bmVyRW50aXR5IiwKICAJCXN1cGVyQ2xhc3M6IFsKICAJCQkiUm9vdEVsZW1lbnQiCiAgCQldLAogIAkJcHJvcGVydGllczogWwogIAkJCXsKICAJCQkJbmFtZTogIm5hbWUiLAogIAkJCQlpc0F0dHI6IHRydWUsCiAgCQkJCXR5cGU6ICJTdHJpbmciCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJwYXJ0aWNpcGFudFJlZiIsCiAgCQkJCXR5cGU6ICJQYXJ0aWNpcGFudCIsCiAgCQkJCWlzTWFueTogdHJ1ZSwKICAJCQkJaXNSZWZlcmVuY2U6IHRydWUKICAJCQl9CiAgCQldCiAgCX0sCiAgCXsKICAJCW5hbWU6ICJQYXJ0bmVyUm9sZSIsCiAgCQlzdXBlckNsYXNzOiBbCiAgCQkJIlJvb3RFbGVtZW50IgogIAkJXSwKICAJCXByb3BlcnRpZXM6IFsKICAJCQl7CiAgCQkJCW5hbWU6ICJuYW1lIiwKICAJCQkJaXNBdHRyOiB0cnVlLAogIAkJCQl0eXBlOiAiU3RyaW5nIgogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAicGFydGljaXBhbnRSZWYiLAogIAkJCQl0eXBlOiAiUGFydGljaXBhbnQiLAogIAkJCQlpc01hbnk6IHRydWUsCiAgCQkJCWlzUmVmZXJlbmNlOiB0cnVlCiAgCQkJfQogIAkJXQogIAl9LAogIAl7CiAgCQluYW1lOiAiQ29ycmVsYXRpb25Qcm9wZXJ0eSIsCiAgCQlzdXBlckNsYXNzOiBbCiAgCQkJIlJvb3RFbGVtZW50IgogIAkJXSwKICAJCXByb3BlcnRpZXM6IFsKICAJCQl7CiAgCQkJCW5hbWU6ICJjb3JyZWxhdGlvblByb3BlcnR5UmV0cmlldmFsRXhwcmVzc2lvbiIsCiAgCQkJCXR5cGU6ICJDb3JyZWxhdGlvblByb3BlcnR5UmV0cmlldmFsRXhwcmVzc2lvbiIsCiAgCQkJCWlzTWFueTogdHJ1ZQogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAibmFtZSIsCiAgCQkJCWlzQXR0cjogdHJ1ZSwKICAJCQkJdHlwZTogIlN0cmluZyIKICAJCQl9LAogIAkJCXsKICAJCQkJbmFtZTogInR5cGUiLAogIAkJCQl0eXBlOiAiSXRlbURlZmluaXRpb24iLAogIAkJCQlpc0F0dHI6IHRydWUsCiAgCQkJCWlzUmVmZXJlbmNlOiB0cnVlCiAgCQkJfQogIAkJXQogIAl9LAogIAl7CiAgCQluYW1lOiAiRXJyb3IiLAogIAkJc3VwZXJDbGFzczogWwogIAkJCSJSb290RWxlbWVudCIKICAJCV0sCiAgCQlwcm9wZXJ0aWVzOiBbCiAgCQkJewogIAkJCQluYW1lOiAic3RydWN0dXJlUmVmIiwKICAJCQkJdHlwZTogIkl0ZW1EZWZpbml0aW9uIiwKICAJCQkJaXNBdHRyOiB0cnVlLAogIAkJCQlpc1JlZmVyZW5jZTogdHJ1ZQogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAibmFtZSIsCiAgCQkJCWlzQXR0cjogdHJ1ZSwKICAJCQkJdHlwZTogIlN0cmluZyIKICAJCQl9LAogIAkJCXsKICAJCQkJbmFtZTogImVycm9yQ29kZSIsCiAgCQkJCWlzQXR0cjogdHJ1ZSwKICAJCQkJdHlwZTogIlN0cmluZyIKICAJCQl9CiAgCQldCiAgCX0sCiAgCXsKICAJCW5hbWU6ICJDb3JyZWxhdGlvbktleSIsCiAgCQlzdXBlckNsYXNzOiBbCiAgCQkJIkJhc2VFbGVtZW50IgogIAkJXSwKICAJCXByb3BlcnRpZXM6IFsKICAJCQl7CiAgCQkJCW5hbWU6ICJjb3JyZWxhdGlvblByb3BlcnR5UmVmIiwKICAJCQkJdHlwZTogIkNvcnJlbGF0aW9uUHJvcGVydHkiLAogIAkJCQlpc01hbnk6IHRydWUsCiAgCQkJCWlzUmVmZXJlbmNlOiB0cnVlCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJuYW1lIiwKICAJCQkJaXNBdHRyOiB0cnVlLAogIAkJCQl0eXBlOiAiU3RyaW5nIgogIAkJCX0KICAJCV0KICAJfSwKICAJewogIAkJbmFtZTogIkV4cHJlc3Npb24iLAogIAkJc3VwZXJDbGFzczogWwogIAkJCSJCYXNlRWxlbWVudCIKICAJCV0sCiAgCQlpc0Fic3RyYWN0OiBmYWxzZSwKICAJCXByb3BlcnRpZXM6IFsKICAJCQl7CiAgCQkJCW5hbWU6ICJib2R5IiwKICAJCQkJdHlwZTogIlN0cmluZyIsCiAgCQkJCWlzQm9keTogdHJ1ZQogIAkJCX0KICAJCV0KICAJfSwKICAJewogIAkJbmFtZTogIkZvcm1hbEV4cHJlc3Npb24iLAogIAkJc3VwZXJDbGFzczogWwogIAkJCSJFeHByZXNzaW9uIgogIAkJXSwKICAJCXByb3BlcnRpZXM6IFsKICAJCQl7CiAgCQkJCW5hbWU6ICJsYW5ndWFnZSIsCiAgCQkJCWlzQXR0cjogdHJ1ZSwKICAJCQkJdHlwZTogIlN0cmluZyIKICAJCQl9LAogIAkJCXsKICAJCQkJbmFtZTogImV2YWx1YXRlc1RvVHlwZVJlZiIsCiAgCQkJCXR5cGU6ICJJdGVtRGVmaW5pdGlvbiIsCiAgCQkJCWlzQXR0cjogdHJ1ZSwKICAJCQkJaXNSZWZlcmVuY2U6IHRydWUKICAJCQl9CiAgCQldCiAgCX0sCiAgCXsKICAJCW5hbWU6ICJNZXNzYWdlIiwKICAJCXN1cGVyQ2xhc3M6IFsKICAJCQkiUm9vdEVsZW1lbnQiCiAgCQldLAogIAkJcHJvcGVydGllczogWwogIAkJCXsKICAJCQkJbmFtZTogIm5hbWUiLAogIAkJCQlpc0F0dHI6IHRydWUsCiAgCQkJCXR5cGU6ICJTdHJpbmciCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJpdGVtUmVmIiwKICAJCQkJdHlwZTogIkl0ZW1EZWZpbml0aW9uIiwKICAJCQkJaXNBdHRyOiB0cnVlLAogIAkJCQlpc1JlZmVyZW5jZTogdHJ1ZQogIAkJCX0KICAJCV0KICAJfSwKICAJewogIAkJbmFtZTogIkl0ZW1EZWZpbml0aW9uIiwKICAJCXN1cGVyQ2xhc3M6IFsKICAJCQkiUm9vdEVsZW1lbnQiCiAgCQldLAogIAkJcHJvcGVydGllczogWwogIAkJCXsKICAJCQkJbmFtZTogIml0ZW1LaW5kIiwKICAJCQkJdHlwZTogIkl0ZW1LaW5kIiwKICAJCQkJaXNBdHRyOiB0cnVlCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJzdHJ1Y3R1cmVSZWYiLAogIAkJCQl0eXBlOiAiU3RyaW5nIiwKICAJCQkJaXNBdHRyOiB0cnVlCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJpc0NvbGxlY3Rpb24iLAogIAkJCQkiZGVmYXVsdCI6IGZhbHNlLAogIAkJCQlpc0F0dHI6IHRydWUsCiAgCQkJCXR5cGU6ICJCb29sZWFuIgogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAiaW1wb3J0IiwKICAJCQkJdHlwZTogIkltcG9ydCIsCiAgCQkJCWlzQXR0cjogdHJ1ZSwKICAJCQkJaXNSZWZlcmVuY2U6IHRydWUKICAJCQl9CiAgCQldCiAgCX0sCiAgCXsKICAJCW5hbWU6ICJGbG93RWxlbWVudCIsCiAgCQlpc0Fic3RyYWN0OiB0cnVlLAogIAkJc3VwZXJDbGFzczogWwogIAkJCSJCYXNlRWxlbWVudCIKICAJCV0sCiAgCQlwcm9wZXJ0aWVzOiBbCiAgCQkJewogIAkJCQluYW1lOiAibmFtZSIsCiAgCQkJCWlzQXR0cjogdHJ1ZSwKICAJCQkJdHlwZTogIlN0cmluZyIKICAJCQl9LAogIAkJCXsKICAJCQkJbmFtZTogImF1ZGl0aW5nIiwKICAJCQkJdHlwZTogIkF1ZGl0aW5nIgogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAibW9uaXRvcmluZyIsCiAgCQkJCXR5cGU6ICJNb25pdG9yaW5nIgogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAiY2F0ZWdvcnlWYWx1ZVJlZiIsCiAgCQkJCXR5cGU6ICJDYXRlZ29yeVZhbHVlIiwKICAJCQkJaXNNYW55OiB0cnVlLAogIAkJCQlpc1JlZmVyZW5jZTogdHJ1ZQogIAkJCX0KICAJCV0KICAJfSwKICAJewogIAkJbmFtZTogIlNlcXVlbmNlRmxvdyIsCiAgCQlzdXBlckNsYXNzOiBbCiAgCQkJIkZsb3dFbGVtZW50IgogIAkJXSwKICAJCXByb3BlcnRpZXM6IFsKICAJCQl7CiAgCQkJCW5hbWU6ICJpc0ltbWVkaWF0ZSIsCiAgCQkJCWlzQXR0cjogdHJ1ZSwKICAJCQkJdHlwZTogIkJvb2xlYW4iCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJjb25kaXRpb25FeHByZXNzaW9uIiwKICAJCQkJdHlwZTogIkV4cHJlc3Npb24iLAogIAkJCQl4bWw6IHsKICAJCQkJCXNlcmlhbGl6ZTogInhzaTp0eXBlIgogIAkJCQl9CiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJzb3VyY2VSZWYiLAogIAkJCQl0eXBlOiAiRmxvd05vZGUiLAogIAkJCQlpc0F0dHI6IHRydWUsCiAgCQkJCWlzUmVmZXJlbmNlOiB0cnVlCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJ0YXJnZXRSZWYiLAogIAkJCQl0eXBlOiAiRmxvd05vZGUiLAogIAkJCQlpc0F0dHI6IHRydWUsCiAgCQkJCWlzUmVmZXJlbmNlOiB0cnVlCiAgCQkJfQogIAkJXQogIAl9LAogIAl7CiAgCQluYW1lOiAiRmxvd0VsZW1lbnRzQ29udGFpbmVyIiwKICAJCWlzQWJzdHJhY3Q6IHRydWUsCiAgCQlzdXBlckNsYXNzOiBbCiAgCQkJIkJhc2VFbGVtZW50IgogIAkJXSwKICAJCXByb3BlcnRpZXM6IFsKICAJCQl7CiAgCQkJCW5hbWU6ICJsYW5lU2V0cyIsCiAgCQkJCXR5cGU6ICJMYW5lU2V0IiwKICAJCQkJaXNNYW55OiB0cnVlCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJmbG93RWxlbWVudHMiLAogIAkJCQl0eXBlOiAiRmxvd0VsZW1lbnQiLAogIAkJCQlpc01hbnk6IHRydWUKICAJCQl9CiAgCQldCiAgCX0sCiAgCXsKICAJCW5hbWU6ICJDYWxsYWJsZUVsZW1lbnQiLAogIAkJaXNBYnN0cmFjdDogdHJ1ZSwKICAJCXN1cGVyQ2xhc3M6IFsKICAJCQkiUm9vdEVsZW1lbnQiCiAgCQldLAogIAkJcHJvcGVydGllczogWwogIAkJCXsKICAJCQkJbmFtZTogIm5hbWUiLAogIAkJCQlpc0F0dHI6IHRydWUsCiAgCQkJCXR5cGU6ICJTdHJpbmciCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJpb1NwZWNpZmljYXRpb24iLAogIAkJCQl0eXBlOiAiSW5wdXRPdXRwdXRTcGVjaWZpY2F0aW9uIiwKICAJCQkJeG1sOiB7CiAgCQkJCQlzZXJpYWxpemU6ICJwcm9wZXJ0eSIKICAJCQkJfQogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAic3VwcG9ydGVkSW50ZXJmYWNlUmVmIiwKICAJCQkJdHlwZTogIkludGVyZmFjZSIsCiAgCQkJCWlzTWFueTogdHJ1ZSwKICAJCQkJaXNSZWZlcmVuY2U6IHRydWUKICAJCQl9LAogIAkJCXsKICAJCQkJbmFtZTogImlvQmluZGluZyIsCiAgCQkJCXR5cGU6ICJJbnB1dE91dHB1dEJpbmRpbmciLAogIAkJCQlpc01hbnk6IHRydWUsCiAgCQkJCXhtbDogewogIAkJCQkJc2VyaWFsaXplOiAicHJvcGVydHkiCiAgCQkJCX0KICAJCQl9CiAgCQldCiAgCX0sCiAgCXsKICAJCW5hbWU6ICJGbG93Tm9kZSIsCiAgCQlpc0Fic3RyYWN0OiB0cnVlLAogIAkJc3VwZXJDbGFzczogWwogIAkJCSJGbG93RWxlbWVudCIKICAJCV0sCiAgCQlwcm9wZXJ0aWVzOiBbCiAgCQkJewogIAkJCQluYW1lOiAiaW5jb21pbmciLAogIAkJCQl0eXBlOiAiU2VxdWVuY2VGbG93IiwKICAJCQkJaXNNYW55OiB0cnVlLAogIAkJCQlpc1JlZmVyZW5jZTogdHJ1ZQogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAib3V0Z29pbmciLAogIAkJCQl0eXBlOiAiU2VxdWVuY2VGbG93IiwKICAJCQkJaXNNYW55OiB0cnVlLAogIAkJCQlpc1JlZmVyZW5jZTogdHJ1ZQogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAibGFuZXMiLAogIAkJCQl0eXBlOiAiTGFuZSIsCiAgCQkJCWlzVmlydHVhbDogdHJ1ZSwKICAJCQkJaXNNYW55OiB0cnVlLAogIAkJCQlpc1JlZmVyZW5jZTogdHJ1ZQogIAkJCX0KICAJCV0KICAJfSwKICAJewogIAkJbmFtZTogIkNvcnJlbGF0aW9uUHJvcGVydHlSZXRyaWV2YWxFeHByZXNzaW9uIiwKICAJCXN1cGVyQ2xhc3M6IFsKICAJCQkiQmFzZUVsZW1lbnQiCiAgCQldLAogIAkJcHJvcGVydGllczogWwogIAkJCXsKICAJCQkJbmFtZTogIm1lc3NhZ2VQYXRoIiwKICAJCQkJdHlwZTogIkZvcm1hbEV4cHJlc3Npb24iCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJtZXNzYWdlUmVmIiwKICAJCQkJdHlwZTogIk1lc3NhZ2UiLAogIAkJCQlpc0F0dHI6IHRydWUsCiAgCQkJCWlzUmVmZXJlbmNlOiB0cnVlCiAgCQkJfQogIAkJXQogIAl9LAogIAl7CiAgCQluYW1lOiAiQ29ycmVsYXRpb25Qcm9wZXJ0eUJpbmRpbmciLAogIAkJc3VwZXJDbGFzczogWwogIAkJCSJCYXNlRWxlbWVudCIKICAJCV0sCiAgCQlwcm9wZXJ0aWVzOiBbCiAgCQkJewogIAkJCQluYW1lOiAiZGF0YVBhdGgiLAogIAkJCQl0eXBlOiAiRm9ybWFsRXhwcmVzc2lvbiIKICAJCQl9LAogIAkJCXsKICAJCQkJbmFtZTogImNvcnJlbGF0aW9uUHJvcGVydHlSZWYiLAogIAkJCQl0eXBlOiAiQ29ycmVsYXRpb25Qcm9wZXJ0eSIsCiAgCQkJCWlzQXR0cjogdHJ1ZSwKICAJCQkJaXNSZWZlcmVuY2U6IHRydWUKICAJCQl9CiAgCQldCiAgCX0sCiAgCXsKICAJCW5hbWU6ICJSZXNvdXJjZSIsCiAgCQlzdXBlckNsYXNzOiBbCiAgCQkJIlJvb3RFbGVtZW50IgogIAkJXSwKICAJCXByb3BlcnRpZXM6IFsKICAJCQl7CiAgCQkJCW5hbWU6ICJuYW1lIiwKICAJCQkJaXNBdHRyOiB0cnVlLAogIAkJCQl0eXBlOiAiU3RyaW5nIgogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAicmVzb3VyY2VQYXJhbWV0ZXJzIiwKICAJCQkJdHlwZTogIlJlc291cmNlUGFyYW1ldGVyIiwKICAJCQkJaXNNYW55OiB0cnVlCiAgCQkJfQogIAkJXQogIAl9LAogIAl7CiAgCQluYW1lOiAiUmVzb3VyY2VQYXJhbWV0ZXIiLAogIAkJc3VwZXJDbGFzczogWwogIAkJCSJCYXNlRWxlbWVudCIKICAJCV0sCiAgCQlwcm9wZXJ0aWVzOiBbCiAgCQkJewogIAkJCQluYW1lOiAibmFtZSIsCiAgCQkJCWlzQXR0cjogdHJ1ZSwKICAJCQkJdHlwZTogIlN0cmluZyIKICAJCQl9LAogIAkJCXsKICAJCQkJbmFtZTogImlzUmVxdWlyZWQiLAogIAkJCQlpc0F0dHI6IHRydWUsCiAgCQkJCXR5cGU6ICJCb29sZWFuIgogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAidHlwZSIsCiAgCQkJCXR5cGU6ICJJdGVtRGVmaW5pdGlvbiIsCiAgCQkJCWlzQXR0cjogdHJ1ZSwKICAJCQkJaXNSZWZlcmVuY2U6IHRydWUKICAJCQl9CiAgCQldCiAgCX0sCiAgCXsKICAJCW5hbWU6ICJDb3JyZWxhdGlvblN1YnNjcmlwdGlvbiIsCiAgCQlzdXBlckNsYXNzOiBbCiAgCQkJIkJhc2VFbGVtZW50IgogIAkJXSwKICAJCXByb3BlcnRpZXM6IFsKICAJCQl7CiAgCQkJCW5hbWU6ICJjb3JyZWxhdGlvbktleVJlZiIsCiAgCQkJCXR5cGU6ICJDb3JyZWxhdGlvbktleSIsCiAgCQkJCWlzQXR0cjogdHJ1ZSwKICAJCQkJaXNSZWZlcmVuY2U6IHRydWUKICAJCQl9LAogIAkJCXsKICAJCQkJbmFtZTogImNvcnJlbGF0aW9uUHJvcGVydHlCaW5kaW5nIiwKICAJCQkJdHlwZTogIkNvcnJlbGF0aW9uUHJvcGVydHlCaW5kaW5nIiwKICAJCQkJaXNNYW55OiB0cnVlCiAgCQkJfQogIAkJXQogIAl9LAogIAl7CiAgCQluYW1lOiAiTWVzc2FnZUZsb3ciLAogIAkJc3VwZXJDbGFzczogWwogIAkJCSJCYXNlRWxlbWVudCIKICAJCV0sCiAgCQlwcm9wZXJ0aWVzOiBbCiAgCQkJewogIAkJCQluYW1lOiAibmFtZSIsCiAgCQkJCWlzQXR0cjogdHJ1ZSwKICAJCQkJdHlwZTogIlN0cmluZyIKICAJCQl9LAogIAkJCXsKICAJCQkJbmFtZTogInNvdXJjZVJlZiIsCiAgCQkJCXR5cGU6ICJJbnRlcmFjdGlvbk5vZGUiLAogIAkJCQlpc0F0dHI6IHRydWUsCiAgCQkJCWlzUmVmZXJlbmNlOiB0cnVlCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJ0YXJnZXRSZWYiLAogIAkJCQl0eXBlOiAiSW50ZXJhY3Rpb25Ob2RlIiwKICAJCQkJaXNBdHRyOiB0cnVlLAogIAkJCQlpc1JlZmVyZW5jZTogdHJ1ZQogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAibWVzc2FnZVJlZiIsCiAgCQkJCXR5cGU6ICJNZXNzYWdlIiwKICAJCQkJaXNBdHRyOiB0cnVlLAogIAkJCQlpc1JlZmVyZW5jZTogdHJ1ZQogIAkJCX0KICAJCV0KICAJfSwKICAJewogIAkJbmFtZTogIk1lc3NhZ2VGbG93QXNzb2NpYXRpb24iLAogIAkJc3VwZXJDbGFzczogWwogIAkJCSJCYXNlRWxlbWVudCIKICAJCV0sCiAgCQlwcm9wZXJ0aWVzOiBbCiAgCQkJewogIAkJCQluYW1lOiAiaW5uZXJNZXNzYWdlRmxvd1JlZiIsCiAgCQkJCXR5cGU6ICJNZXNzYWdlRmxvdyIsCiAgCQkJCWlzQXR0cjogdHJ1ZSwKICAJCQkJaXNSZWZlcmVuY2U6IHRydWUKICAJCQl9LAogIAkJCXsKICAJCQkJbmFtZTogIm91dGVyTWVzc2FnZUZsb3dSZWYiLAogIAkJCQl0eXBlOiAiTWVzc2FnZUZsb3ciLAogIAkJCQlpc0F0dHI6IHRydWUsCiAgCQkJCWlzUmVmZXJlbmNlOiB0cnVlCiAgCQkJfQogIAkJXQogIAl9LAogIAl7CiAgCQluYW1lOiAiSW50ZXJhY3Rpb25Ob2RlIiwKICAJCWlzQWJzdHJhY3Q6IHRydWUsCiAgCQlwcm9wZXJ0aWVzOiBbCiAgCQkJewogIAkJCQluYW1lOiAiaW5jb21pbmdDb252ZXJzYXRpb25MaW5rcyIsCiAgCQkJCXR5cGU6ICJDb252ZXJzYXRpb25MaW5rIiwKICAJCQkJaXNWaXJ0dWFsOiB0cnVlLAogIAkJCQlpc01hbnk6IHRydWUsCiAgCQkJCWlzUmVmZXJlbmNlOiB0cnVlCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJvdXRnb2luZ0NvbnZlcnNhdGlvbkxpbmtzIiwKICAJCQkJdHlwZTogIkNvbnZlcnNhdGlvbkxpbmsiLAogIAkJCQlpc1ZpcnR1YWw6IHRydWUsCiAgCQkJCWlzTWFueTogdHJ1ZSwKICAJCQkJaXNSZWZlcmVuY2U6IHRydWUKICAJCQl9CiAgCQldCiAgCX0sCiAgCXsKICAJCW5hbWU6ICJQYXJ0aWNpcGFudCIsCiAgCQlzdXBlckNsYXNzOiBbCiAgCQkJIkludGVyYWN0aW9uTm9kZSIsCiAgCQkJIkJhc2VFbGVtZW50IgogIAkJXSwKICAJCXByb3BlcnRpZXM6IFsKICAJCQl7CiAgCQkJCW5hbWU6ICJuYW1lIiwKICAJCQkJaXNBdHRyOiB0cnVlLAogIAkJCQl0eXBlOiAiU3RyaW5nIgogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAiaW50ZXJmYWNlUmVmIiwKICAJCQkJdHlwZTogIkludGVyZmFjZSIsCiAgCQkJCWlzTWFueTogdHJ1ZSwKICAJCQkJaXNSZWZlcmVuY2U6IHRydWUKICAJCQl9LAogIAkJCXsKICAJCQkJbmFtZTogInBhcnRpY2lwYW50TXVsdGlwbGljaXR5IiwKICAJCQkJdHlwZTogIlBhcnRpY2lwYW50TXVsdGlwbGljaXR5IgogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAiZW5kUG9pbnRSZWZzIiwKICAJCQkJdHlwZTogIkVuZFBvaW50IiwKICAJCQkJaXNNYW55OiB0cnVlLAogIAkJCQlpc1JlZmVyZW5jZTogdHJ1ZQogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAicHJvY2Vzc1JlZiIsCiAgCQkJCXR5cGU6ICJQcm9jZXNzIiwKICAJCQkJaXNBdHRyOiB0cnVlLAogIAkJCQlpc1JlZmVyZW5jZTogdHJ1ZQogIAkJCX0KICAJCV0KICAJfSwKICAJewogIAkJbmFtZTogIlBhcnRpY2lwYW50QXNzb2NpYXRpb24iLAogIAkJc3VwZXJDbGFzczogWwogIAkJCSJCYXNlRWxlbWVudCIKICAJCV0sCiAgCQlwcm9wZXJ0aWVzOiBbCiAgCQkJewogIAkJCQluYW1lOiAiaW5uZXJQYXJ0aWNpcGFudFJlZiIsCiAgCQkJCXR5cGU6ICJQYXJ0aWNpcGFudCIsCiAgCQkJCWlzQXR0cjogdHJ1ZSwKICAJCQkJaXNSZWZlcmVuY2U6IHRydWUKICAJCQl9LAogIAkJCXsKICAJCQkJbmFtZTogIm91dGVyUGFydGljaXBhbnRSZWYiLAogIAkJCQl0eXBlOiAiUGFydGljaXBhbnQiLAogIAkJCQlpc0F0dHI6IHRydWUsCiAgCQkJCWlzUmVmZXJlbmNlOiB0cnVlCiAgCQkJfQogIAkJXQogIAl9LAogIAl7CiAgCQluYW1lOiAiUGFydGljaXBhbnRNdWx0aXBsaWNpdHkiLAogIAkJcHJvcGVydGllczogWwogIAkJCXsKICAJCQkJbmFtZTogIm1pbmltdW0iLAogIAkJCQkiZGVmYXVsdCI6IDAsCiAgCQkJCWlzQXR0cjogdHJ1ZSwKICAJCQkJdHlwZTogIkludGVnZXIiCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJtYXhpbXVtIiwKICAJCQkJImRlZmF1bHQiOiAxLAogIAkJCQlpc0F0dHI6IHRydWUsCiAgCQkJCXR5cGU6ICJJbnRlZ2VyIgogIAkJCX0KICAJCV0sCiAgCQlzdXBlckNsYXNzOiBbCiAgCQkJIkJhc2VFbGVtZW50IgogIAkJXQogIAl9LAogIAl7CiAgCQluYW1lOiAiQ29sbGFib3JhdGlvbiIsCiAgCQlzdXBlckNsYXNzOiBbCiAgCQkJIlJvb3RFbGVtZW50IgogIAkJXSwKICAJCXByb3BlcnRpZXM6IFsKICAJCQl7CiAgCQkJCW5hbWU6ICJuYW1lIiwKICAJCQkJaXNBdHRyOiB0cnVlLAogIAkJCQl0eXBlOiAiU3RyaW5nIgogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAiaXNDbG9zZWQiLAogIAkJCQlpc0F0dHI6IHRydWUsCiAgCQkJCXR5cGU6ICJCb29sZWFuIgogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAicGFydGljaXBhbnRzIiwKICAJCQkJdHlwZTogIlBhcnRpY2lwYW50IiwKICAJCQkJaXNNYW55OiB0cnVlCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJtZXNzYWdlRmxvd3MiLAogIAkJCQl0eXBlOiAiTWVzc2FnZUZsb3ciLAogIAkJCQlpc01hbnk6IHRydWUKICAJCQl9LAogIAkJCXsKICAJCQkJbmFtZTogImFydGlmYWN0cyIsCiAgCQkJCXR5cGU6ICJBcnRpZmFjdCIsCiAgCQkJCWlzTWFueTogdHJ1ZQogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAiY29udmVyc2F0aW9ucyIsCiAgCQkJCXR5cGU6ICJDb252ZXJzYXRpb25Ob2RlIiwKICAJCQkJaXNNYW55OiB0cnVlCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJjb252ZXJzYXRpb25Bc3NvY2lhdGlvbnMiLAogIAkJCQl0eXBlOiAiQ29udmVyc2F0aW9uQXNzb2NpYXRpb24iCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJwYXJ0aWNpcGFudEFzc29jaWF0aW9ucyIsCiAgCQkJCXR5cGU6ICJQYXJ0aWNpcGFudEFzc29jaWF0aW9uIiwKICAJCQkJaXNNYW55OiB0cnVlCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJtZXNzYWdlRmxvd0Fzc29jaWF0aW9ucyIsCiAgCQkJCXR5cGU6ICJNZXNzYWdlRmxvd0Fzc29jaWF0aW9uIiwKICAJCQkJaXNNYW55OiB0cnVlCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJjb3JyZWxhdGlvbktleXMiLAogIAkJCQl0eXBlOiAiQ29ycmVsYXRpb25LZXkiLAogIAkJCQlpc01hbnk6IHRydWUKICAJCQl9LAogIAkJCXsKICAJCQkJbmFtZTogImNob3Jlb2dyYXBoeVJlZiIsCiAgCQkJCXR5cGU6ICJDaG9yZW9ncmFwaHkiLAogIAkJCQlpc01hbnk6IHRydWUsCiAgCQkJCWlzUmVmZXJlbmNlOiB0cnVlCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJjb252ZXJzYXRpb25MaW5rcyIsCiAgCQkJCXR5cGU6ICJDb252ZXJzYXRpb25MaW5rIiwKICAJCQkJaXNNYW55OiB0cnVlCiAgCQkJfQogIAkJXQogIAl9LAogIAl7CiAgCQluYW1lOiAiQ2hvcmVvZ3JhcGh5QWN0aXZpdHkiLAogIAkJaXNBYnN0cmFjdDogdHJ1ZSwKICAJCXN1cGVyQ2xhc3M6IFsKICAJCQkiRmxvd05vZGUiCiAgCQldLAogIAkJcHJvcGVydGllczogWwogIAkJCXsKICAJCQkJbmFtZTogInBhcnRpY2lwYW50UmVmIiwKICAJCQkJdHlwZTogIlBhcnRpY2lwYW50IiwKICAJCQkJaXNNYW55OiB0cnVlLAogIAkJCQlpc1JlZmVyZW5jZTogdHJ1ZQogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAiaW5pdGlhdGluZ1BhcnRpY2lwYW50UmVmIiwKICAJCQkJdHlwZTogIlBhcnRpY2lwYW50IiwKICAJCQkJaXNBdHRyOiB0cnVlLAogIAkJCQlpc1JlZmVyZW5jZTogdHJ1ZQogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAiY29ycmVsYXRpb25LZXlzIiwKICAJCQkJdHlwZTogIkNvcnJlbGF0aW9uS2V5IiwKICAJCQkJaXNNYW55OiB0cnVlCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJsb29wVHlwZSIsCiAgCQkJCXR5cGU6ICJDaG9yZW9ncmFwaHlMb29wVHlwZSIsCiAgCQkJCSJkZWZhdWx0IjogIk5vbmUiLAogIAkJCQlpc0F0dHI6IHRydWUKICAJCQl9CiAgCQldCiAgCX0sCiAgCXsKICAJCW5hbWU6ICJDYWxsQ2hvcmVvZ3JhcGh5IiwKICAJCXN1cGVyQ2xhc3M6IFsKICAJCQkiQ2hvcmVvZ3JhcGh5QWN0aXZpdHkiCiAgCQldLAogIAkJcHJvcGVydGllczogWwogIAkJCXsKICAJCQkJbmFtZTogImNhbGxlZENob3Jlb2dyYXBoeVJlZiIsCiAgCQkJCXR5cGU6ICJDaG9yZW9ncmFwaHkiLAogIAkJCQlpc0F0dHI6IHRydWUsCiAgCQkJCWlzUmVmZXJlbmNlOiB0cnVlCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJwYXJ0aWNpcGFudEFzc29jaWF0aW9ucyIsCiAgCQkJCXR5cGU6ICJQYXJ0aWNpcGFudEFzc29jaWF0aW9uIiwKICAJCQkJaXNNYW55OiB0cnVlCiAgCQkJfQogIAkJXQogIAl9LAogIAl7CiAgCQluYW1lOiAiU3ViQ2hvcmVvZ3JhcGh5IiwKICAJCXN1cGVyQ2xhc3M6IFsKICAJCQkiQ2hvcmVvZ3JhcGh5QWN0aXZpdHkiLAogIAkJCSJGbG93RWxlbWVudHNDb250YWluZXIiCiAgCQldLAogIAkJcHJvcGVydGllczogWwogIAkJCXsKICAJCQkJbmFtZTogImFydGlmYWN0cyIsCiAgCQkJCXR5cGU6ICJBcnRpZmFjdCIsCiAgCQkJCWlzTWFueTogdHJ1ZQogIAkJCX0KICAJCV0KICAJfSwKICAJewogIAkJbmFtZTogIkNob3Jlb2dyYXBoeVRhc2siLAogIAkJc3VwZXJDbGFzczogWwogIAkJCSJDaG9yZW9ncmFwaHlBY3Rpdml0eSIKICAJCV0sCiAgCQlwcm9wZXJ0aWVzOiBbCiAgCQkJewogIAkJCQluYW1lOiAibWVzc2FnZUZsb3dSZWYiLAogIAkJCQl0eXBlOiAiTWVzc2FnZUZsb3ciLAogIAkJCQlpc01hbnk6IHRydWUsCiAgCQkJCWlzUmVmZXJlbmNlOiB0cnVlCiAgCQkJfQogIAkJXQogIAl9LAogIAl7CiAgCQluYW1lOiAiQ2hvcmVvZ3JhcGh5IiwKICAJCXN1cGVyQ2xhc3M6IFsKICAJCQkiQ29sbGFib3JhdGlvbiIsCiAgCQkJIkZsb3dFbGVtZW50c0NvbnRhaW5lciIKICAJCV0KICAJfSwKICAJewogIAkJbmFtZTogIkdsb2JhbENob3Jlb2dyYXBoeVRhc2siLAogIAkJc3VwZXJDbGFzczogWwogIAkJCSJDaG9yZW9ncmFwaHkiCiAgCQldLAogIAkJcHJvcGVydGllczogWwogIAkJCXsKICAJCQkJbmFtZTogImluaXRpYXRpbmdQYXJ0aWNpcGFudFJlZiIsCiAgCQkJCXR5cGU6ICJQYXJ0aWNpcGFudCIsCiAgCQkJCWlzQXR0cjogdHJ1ZSwKICAJCQkJaXNSZWZlcmVuY2U6IHRydWUKICAJCQl9CiAgCQldCiAgCX0sCiAgCXsKICAJCW5hbWU6ICJUZXh0QW5ub3RhdGlvbiIsCiAgCQlzdXBlckNsYXNzOiBbCiAgCQkJIkFydGlmYWN0IgogIAkJXSwKICAJCXByb3BlcnRpZXM6IFsKICAJCQl7CiAgCQkJCW5hbWU6ICJ0ZXh0IiwKICAJCQkJdHlwZTogIlN0cmluZyIKICAJCQl9LAogIAkJCXsKICAJCQkJbmFtZTogInRleHRGb3JtYXQiLAogIAkJCQkiZGVmYXVsdCI6ICJ0ZXh0L3BsYWluIiwKICAJCQkJaXNBdHRyOiB0cnVlLAogIAkJCQl0eXBlOiAiU3RyaW5nIgogIAkJCX0KICAJCV0KICAJfSwKICAJewogIAkJbmFtZTogIkdyb3VwIiwKICAJCXN1cGVyQ2xhc3M6IFsKICAJCQkiQXJ0aWZhY3QiCiAgCQldLAogIAkJcHJvcGVydGllczogWwogIAkJCXsKICAJCQkJbmFtZTogImNhdGVnb3J5VmFsdWVSZWYiLAogIAkJCQl0eXBlOiAiQ2F0ZWdvcnlWYWx1ZSIsCiAgCQkJCWlzQXR0cjogdHJ1ZSwKICAJCQkJaXNSZWZlcmVuY2U6IHRydWUKICAJCQl9CiAgCQldCiAgCX0sCiAgCXsKICAJCW5hbWU6ICJBc3NvY2lhdGlvbiIsCiAgCQlzdXBlckNsYXNzOiBbCiAgCQkJIkFydGlmYWN0IgogIAkJXSwKICAJCXByb3BlcnRpZXM6IFsKICAJCQl7CiAgCQkJCW5hbWU6ICJhc3NvY2lhdGlvbkRpcmVjdGlvbiIsCiAgCQkJCXR5cGU6ICJBc3NvY2lhdGlvbkRpcmVjdGlvbiIsCiAgCQkJCWlzQXR0cjogdHJ1ZQogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAic291cmNlUmVmIiwKICAJCQkJdHlwZTogIkJhc2VFbGVtZW50IiwKICAJCQkJaXNBdHRyOiB0cnVlLAogIAkJCQlpc1JlZmVyZW5jZTogdHJ1ZQogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAidGFyZ2V0UmVmIiwKICAJCQkJdHlwZTogIkJhc2VFbGVtZW50IiwKICAJCQkJaXNBdHRyOiB0cnVlLAogIAkJCQlpc1JlZmVyZW5jZTogdHJ1ZQogIAkJCX0KICAJCV0KICAJfSwKICAJewogIAkJbmFtZTogIkNhdGVnb3J5IiwKICAJCXN1cGVyQ2xhc3M6IFsKICAJCQkiUm9vdEVsZW1lbnQiCiAgCQldLAogIAkJcHJvcGVydGllczogWwogIAkJCXsKICAJCQkJbmFtZTogImNhdGVnb3J5VmFsdWUiLAogIAkJCQl0eXBlOiAiQ2F0ZWdvcnlWYWx1ZSIsCiAgCQkJCWlzTWFueTogdHJ1ZQogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAibmFtZSIsCiAgCQkJCWlzQXR0cjogdHJ1ZSwKICAJCQkJdHlwZTogIlN0cmluZyIKICAJCQl9CiAgCQldCiAgCX0sCiAgCXsKICAJCW5hbWU6ICJBcnRpZmFjdCIsCiAgCQlpc0Fic3RyYWN0OiB0cnVlLAogIAkJc3VwZXJDbGFzczogWwogIAkJCSJCYXNlRWxlbWVudCIKICAJCV0KICAJfSwKICAJewogIAkJbmFtZTogIkNhdGVnb3J5VmFsdWUiLAogIAkJc3VwZXJDbGFzczogWwogIAkJCSJCYXNlRWxlbWVudCIKICAJCV0sCiAgCQlwcm9wZXJ0aWVzOiBbCiAgCQkJewogIAkJCQluYW1lOiAiY2F0ZWdvcml6ZWRGbG93RWxlbWVudHMiLAogIAkJCQl0eXBlOiAiRmxvd0VsZW1lbnQiLAogIAkJCQlpc1ZpcnR1YWw6IHRydWUsCiAgCQkJCWlzTWFueTogdHJ1ZSwKICAJCQkJaXNSZWZlcmVuY2U6IHRydWUKICAJCQl9LAogIAkJCXsKICAJCQkJbmFtZTogInZhbHVlIiwKICAJCQkJaXNBdHRyOiB0cnVlLAogIAkJCQl0eXBlOiAiU3RyaW5nIgogIAkJCX0KICAJCV0KICAJfSwKICAJewogIAkJbmFtZTogIkFjdGl2aXR5IiwKICAJCWlzQWJzdHJhY3Q6IHRydWUsCiAgCQlzdXBlckNsYXNzOiBbCiAgCQkJIkZsb3dOb2RlIgogIAkJXSwKICAJCXByb3BlcnRpZXM6IFsKICAJCQl7CiAgCQkJCW5hbWU6ICJpc0ZvckNvbXBlbnNhdGlvbiIsCiAgCQkJCSJkZWZhdWx0IjogZmFsc2UsCiAgCQkJCWlzQXR0cjogdHJ1ZSwKICAJCQkJdHlwZTogIkJvb2xlYW4iCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJkZWZhdWx0IiwKICAJCQkJdHlwZTogIlNlcXVlbmNlRmxvdyIsCiAgCQkJCWlzQXR0cjogdHJ1ZSwKICAJCQkJaXNSZWZlcmVuY2U6IHRydWUKICAJCQl9LAogIAkJCXsKICAJCQkJbmFtZTogImlvU3BlY2lmaWNhdGlvbiIsCiAgCQkJCXR5cGU6ICJJbnB1dE91dHB1dFNwZWNpZmljYXRpb24iLAogIAkJCQl4bWw6IHsKICAJCQkJCXNlcmlhbGl6ZTogInByb3BlcnR5IgogIAkJCQl9CiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJib3VuZGFyeUV2ZW50UmVmcyIsCiAgCQkJCXR5cGU6ICJCb3VuZGFyeUV2ZW50IiwKICAJCQkJaXNNYW55OiB0cnVlLAogIAkJCQlpc1JlZmVyZW5jZTogdHJ1ZQogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAicHJvcGVydGllcyIsCiAgCQkJCXR5cGU6ICJQcm9wZXJ0eSIsCiAgCQkJCWlzTWFueTogdHJ1ZQogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAiZGF0YUlucHV0QXNzb2NpYXRpb25zIiwKICAJCQkJdHlwZTogIkRhdGFJbnB1dEFzc29jaWF0aW9uIiwKICAJCQkJaXNNYW55OiB0cnVlCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJkYXRhT3V0cHV0QXNzb2NpYXRpb25zIiwKICAJCQkJdHlwZTogIkRhdGFPdXRwdXRBc3NvY2lhdGlvbiIsCiAgCQkJCWlzTWFueTogdHJ1ZQogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAic3RhcnRRdWFudGl0eSIsCiAgCQkJCSJkZWZhdWx0IjogMSwKICAJCQkJaXNBdHRyOiB0cnVlLAogIAkJCQl0eXBlOiAiSW50ZWdlciIKICAJCQl9LAogIAkJCXsKICAJCQkJbmFtZTogInJlc291cmNlcyIsCiAgCQkJCXR5cGU6ICJSZXNvdXJjZVJvbGUiLAogIAkJCQlpc01hbnk6IHRydWUKICAJCQl9LAogIAkJCXsKICAJCQkJbmFtZTogImNvbXBsZXRpb25RdWFudGl0eSIsCiAgCQkJCSJkZWZhdWx0IjogMSwKICAJCQkJaXNBdHRyOiB0cnVlLAogIAkJCQl0eXBlOiAiSW50ZWdlciIKICAJCQl9LAogIAkJCXsKICAJCQkJbmFtZTogImxvb3BDaGFyYWN0ZXJpc3RpY3MiLAogIAkJCQl0eXBlOiAiTG9vcENoYXJhY3RlcmlzdGljcyIKICAJCQl9CiAgCQldCiAgCX0sCiAgCXsKICAJCW5hbWU6ICJTZXJ2aWNlVGFzayIsCiAgCQlzdXBlckNsYXNzOiBbCiAgCQkJIlRhc2siCiAgCQldLAogIAkJcHJvcGVydGllczogWwogIAkJCXsKICAJCQkJbmFtZTogImltcGxlbWVudGF0aW9uIiwKICAJCQkJaXNBdHRyOiB0cnVlLAogIAkJCQl0eXBlOiAiU3RyaW5nIgogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAib3BlcmF0aW9uUmVmIiwKICAJCQkJdHlwZTogIk9wZXJhdGlvbiIsCiAgCQkJCWlzQXR0cjogdHJ1ZSwKICAJCQkJaXNSZWZlcmVuY2U6IHRydWUKICAJCQl9CiAgCQldCiAgCX0sCiAgCXsKICAJCW5hbWU6ICJTdWJQcm9jZXNzIiwKICAJCXN1cGVyQ2xhc3M6IFsKICAJCQkiQWN0aXZpdHkiLAogIAkJCSJGbG93RWxlbWVudHNDb250YWluZXIiLAogIAkJCSJJbnRlcmFjdGlvbk5vZGUiCiAgCQldLAogIAkJcHJvcGVydGllczogWwogIAkJCXsKICAJCQkJbmFtZTogInRyaWdnZXJlZEJ5RXZlbnQiLAogIAkJCQkiZGVmYXVsdCI6IGZhbHNlLAogIAkJCQlpc0F0dHI6IHRydWUsCiAgCQkJCXR5cGU6ICJCb29sZWFuIgogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAiYXJ0aWZhY3RzIiwKICAJCQkJdHlwZTogIkFydGlmYWN0IiwKICAJCQkJaXNNYW55OiB0cnVlCiAgCQkJfQogIAkJXQogIAl9LAogIAl7CiAgCQluYW1lOiAiTG9vcENoYXJhY3RlcmlzdGljcyIsCiAgCQlpc0Fic3RyYWN0OiB0cnVlLAogIAkJc3VwZXJDbGFzczogWwogIAkJCSJCYXNlRWxlbWVudCIKICAJCV0KICAJfSwKICAJewogIAkJbmFtZTogIk11bHRpSW5zdGFuY2VMb29wQ2hhcmFjdGVyaXN0aWNzIiwKICAJCXN1cGVyQ2xhc3M6IFsKICAJCQkiTG9vcENoYXJhY3RlcmlzdGljcyIKICAJCV0sCiAgCQlwcm9wZXJ0aWVzOiBbCiAgCQkJewogIAkJCQluYW1lOiAiaXNTZXF1ZW50aWFsIiwKICAJCQkJImRlZmF1bHQiOiBmYWxzZSwKICAJCQkJaXNBdHRyOiB0cnVlLAogIAkJCQl0eXBlOiAiQm9vbGVhbiIKICAJCQl9LAogIAkJCXsKICAJCQkJbmFtZTogImJlaGF2aW9yIiwKICAJCQkJdHlwZTogIk11bHRpSW5zdGFuY2VCZWhhdmlvciIsCiAgCQkJCSJkZWZhdWx0IjogIkFsbCIsCiAgCQkJCWlzQXR0cjogdHJ1ZQogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAibG9vcENhcmRpbmFsaXR5IiwKICAJCQkJdHlwZTogIkV4cHJlc3Npb24iLAogIAkJCQl4bWw6IHsKICAJCQkJCXNlcmlhbGl6ZTogInhzaTp0eXBlIgogIAkJCQl9CiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJsb29wRGF0YUlucHV0UmVmIiwKICAJCQkJdHlwZTogIkl0ZW1Bd2FyZUVsZW1lbnQiLAogIAkJCQlpc1JlZmVyZW5jZTogdHJ1ZQogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAibG9vcERhdGFPdXRwdXRSZWYiLAogIAkJCQl0eXBlOiAiSXRlbUF3YXJlRWxlbWVudCIsCiAgCQkJCWlzUmVmZXJlbmNlOiB0cnVlCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJpbnB1dERhdGFJdGVtIiwKICAJCQkJdHlwZTogIkRhdGFJbnB1dCIsCiAgCQkJCXhtbDogewogIAkJCQkJc2VyaWFsaXplOiAicHJvcGVydHkiCiAgCQkJCX0KICAJCQl9LAogIAkJCXsKICAJCQkJbmFtZTogIm91dHB1dERhdGFJdGVtIiwKICAJCQkJdHlwZTogIkRhdGFPdXRwdXQiLAogIAkJCQl4bWw6IHsKICAJCQkJCXNlcmlhbGl6ZTogInByb3BlcnR5IgogIAkJCQl9CiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJjb21wbGV4QmVoYXZpb3JEZWZpbml0aW9uIiwKICAJCQkJdHlwZTogIkNvbXBsZXhCZWhhdmlvckRlZmluaXRpb24iLAogIAkJCQlpc01hbnk6IHRydWUKICAJCQl9LAogIAkJCXsKICAJCQkJbmFtZTogImNvbXBsZXRpb25Db25kaXRpb24iLAogIAkJCQl0eXBlOiAiRXhwcmVzc2lvbiIsCiAgCQkJCXhtbDogewogIAkJCQkJc2VyaWFsaXplOiAieHNpOnR5cGUiCiAgCQkJCX0KICAJCQl9LAogIAkJCXsKICAJCQkJbmFtZTogIm9uZUJlaGF2aW9yRXZlbnRSZWYiLAogIAkJCQl0eXBlOiAiRXZlbnREZWZpbml0aW9uIiwKICAJCQkJaXNBdHRyOiB0cnVlLAogIAkJCQlpc1JlZmVyZW5jZTogdHJ1ZQogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAibm9uZUJlaGF2aW9yRXZlbnRSZWYiLAogIAkJCQl0eXBlOiAiRXZlbnREZWZpbml0aW9uIiwKICAJCQkJaXNBdHRyOiB0cnVlLAogIAkJCQlpc1JlZmVyZW5jZTogdHJ1ZQogIAkJCX0KICAJCV0KICAJfSwKICAJewogIAkJbmFtZTogIlN0YW5kYXJkTG9vcENoYXJhY3RlcmlzdGljcyIsCiAgCQlzdXBlckNsYXNzOiBbCiAgCQkJIkxvb3BDaGFyYWN0ZXJpc3RpY3MiCiAgCQldLAogIAkJcHJvcGVydGllczogWwogIAkJCXsKICAJCQkJbmFtZTogInRlc3RCZWZvcmUiLAogIAkJCQkiZGVmYXVsdCI6IGZhbHNlLAogIAkJCQlpc0F0dHI6IHRydWUsCiAgCQkJCXR5cGU6ICJCb29sZWFuIgogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAibG9vcENvbmRpdGlvbiIsCiAgCQkJCXR5cGU6ICJFeHByZXNzaW9uIiwKICAJCQkJeG1sOiB7CiAgCQkJCQlzZXJpYWxpemU6ICJ4c2k6dHlwZSIKICAJCQkJfQogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAibG9vcE1heGltdW0iLAogIAkJCQl0eXBlOiAiSW50ZWdlciIsCiAgCQkJCWlzQXR0cjogdHJ1ZQogIAkJCX0KICAJCV0KICAJfSwKICAJewogIAkJbmFtZTogIkNhbGxBY3Rpdml0eSIsCiAgCQlzdXBlckNsYXNzOiBbCiAgCQkJIkFjdGl2aXR5IgogIAkJXSwKICAJCXByb3BlcnRpZXM6IFsKICAJCQl7CiAgCQkJCW5hbWU6ICJjYWxsZWRFbGVtZW50IiwKICAJCQkJdHlwZTogIlN0cmluZyIsCiAgCQkJCWlzQXR0cjogdHJ1ZQogIAkJCX0KICAJCV0KICAJfSwKICAJewogIAkJbmFtZTogIlRhc2siLAogIAkJc3VwZXJDbGFzczogWwogIAkJCSJBY3Rpdml0eSIsCiAgCQkJIkludGVyYWN0aW9uTm9kZSIKICAJCV0KICAJfSwKICAJewogIAkJbmFtZTogIlNlbmRUYXNrIiwKICAJCXN1cGVyQ2xhc3M6IFsKICAJCQkiVGFzayIKICAJCV0sCiAgCQlwcm9wZXJ0aWVzOiBbCiAgCQkJewogIAkJCQluYW1lOiAiaW1wbGVtZW50YXRpb24iLAogIAkJCQlpc0F0dHI6IHRydWUsCiAgCQkJCXR5cGU6ICJTdHJpbmciCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJvcGVyYXRpb25SZWYiLAogIAkJCQl0eXBlOiAiT3BlcmF0aW9uIiwKICAJCQkJaXNBdHRyOiB0cnVlLAogIAkJCQlpc1JlZmVyZW5jZTogdHJ1ZQogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAibWVzc2FnZVJlZiIsCiAgCQkJCXR5cGU6ICJNZXNzYWdlIiwKICAJCQkJaXNBdHRyOiB0cnVlLAogIAkJCQlpc1JlZmVyZW5jZTogdHJ1ZQogIAkJCX0KICAJCV0KICAJfSwKICAJewogIAkJbmFtZTogIlJlY2VpdmVUYXNrIiwKICAJCXN1cGVyQ2xhc3M6IFsKICAJCQkiVGFzayIKICAJCV0sCiAgCQlwcm9wZXJ0aWVzOiBbCiAgCQkJewogIAkJCQluYW1lOiAiaW1wbGVtZW50YXRpb24iLAogIAkJCQlpc0F0dHI6IHRydWUsCiAgCQkJCXR5cGU6ICJTdHJpbmciCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJpbnN0YW50aWF0ZSIsCiAgCQkJCSJkZWZhdWx0IjogZmFsc2UsCiAgCQkJCWlzQXR0cjogdHJ1ZSwKICAJCQkJdHlwZTogIkJvb2xlYW4iCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJvcGVyYXRpb25SZWYiLAogIAkJCQl0eXBlOiAiT3BlcmF0aW9uIiwKICAJCQkJaXNBdHRyOiB0cnVlLAogIAkJCQlpc1JlZmVyZW5jZTogdHJ1ZQogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAibWVzc2FnZVJlZiIsCiAgCQkJCXR5cGU6ICJNZXNzYWdlIiwKICAJCQkJaXNBdHRyOiB0cnVlLAogIAkJCQlpc1JlZmVyZW5jZTogdHJ1ZQogIAkJCX0KICAJCV0KICAJfSwKICAJewogIAkJbmFtZTogIlNjcmlwdFRhc2siLAogIAkJc3VwZXJDbGFzczogWwogIAkJCSJUYXNrIgogIAkJXSwKICAJCXByb3BlcnRpZXM6IFsKICAJCQl7CiAgCQkJCW5hbWU6ICJzY3JpcHRGb3JtYXQiLAogIAkJCQlpc0F0dHI6IHRydWUsCiAgCQkJCXR5cGU6ICJTdHJpbmciCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJzY3JpcHQiLAogIAkJCQl0eXBlOiAiU3RyaW5nIgogIAkJCX0KICAJCV0KICAJfSwKICAJewogIAkJbmFtZTogIkJ1c2luZXNzUnVsZVRhc2siLAogIAkJc3VwZXJDbGFzczogWwogIAkJCSJUYXNrIgogIAkJXSwKICAJCXByb3BlcnRpZXM6IFsKICAJCQl7CiAgCQkJCW5hbWU6ICJpbXBsZW1lbnRhdGlvbiIsCiAgCQkJCWlzQXR0cjogdHJ1ZSwKICAJCQkJdHlwZTogIlN0cmluZyIKICAJCQl9CiAgCQldCiAgCX0sCiAgCXsKICAJCW5hbWU6ICJBZEhvY1N1YlByb2Nlc3MiLAogIAkJc3VwZXJDbGFzczogWwogIAkJCSJTdWJQcm9jZXNzIgogIAkJXSwKICAJCXByb3BlcnRpZXM6IFsKICAJCQl7CiAgCQkJCW5hbWU6ICJjb21wbGV0aW9uQ29uZGl0aW9uIiwKICAJCQkJdHlwZTogIkV4cHJlc3Npb24iLAogIAkJCQl4bWw6IHsKICAJCQkJCXNlcmlhbGl6ZTogInhzaTp0eXBlIgogIAkJCQl9CiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJvcmRlcmluZyIsCiAgCQkJCXR5cGU6ICJBZEhvY09yZGVyaW5nIiwKICAJCQkJaXNBdHRyOiB0cnVlCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJjYW5jZWxSZW1haW5pbmdJbnN0YW5jZXMiLAogIAkJCQkiZGVmYXVsdCI6IHRydWUsCiAgCQkJCWlzQXR0cjogdHJ1ZSwKICAJCQkJdHlwZTogIkJvb2xlYW4iCiAgCQkJfQogIAkJXQogIAl9LAogIAl7CiAgCQluYW1lOiAiVHJhbnNhY3Rpb24iLAogIAkJc3VwZXJDbGFzczogWwogIAkJCSJTdWJQcm9jZXNzIgogIAkJXSwKICAJCXByb3BlcnRpZXM6IFsKICAJCQl7CiAgCQkJCW5hbWU6ICJwcm90b2NvbCIsCiAgCQkJCWlzQXR0cjogdHJ1ZSwKICAJCQkJdHlwZTogIlN0cmluZyIKICAJCQl9LAogIAkJCXsKICAJCQkJbmFtZTogIm1ldGhvZCIsCiAgCQkJCWlzQXR0cjogdHJ1ZSwKICAJCQkJdHlwZTogIlN0cmluZyIKICAJCQl9CiAgCQldCiAgCX0sCiAgCXsKICAJCW5hbWU6ICJHbG9iYWxTY3JpcHRUYXNrIiwKICAJCXN1cGVyQ2xhc3M6IFsKICAJCQkiR2xvYmFsVGFzayIKICAJCV0sCiAgCQlwcm9wZXJ0aWVzOiBbCiAgCQkJewogIAkJCQluYW1lOiAic2NyaXB0TGFuZ3VhZ2UiLAogIAkJCQlpc0F0dHI6IHRydWUsCiAgCQkJCXR5cGU6ICJTdHJpbmciCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJzY3JpcHQiLAogIAkJCQlpc0F0dHI6IHRydWUsCiAgCQkJCXR5cGU6ICJTdHJpbmciCiAgCQkJfQogIAkJXQogIAl9LAogIAl7CiAgCQluYW1lOiAiR2xvYmFsQnVzaW5lc3NSdWxlVGFzayIsCiAgCQlzdXBlckNsYXNzOiBbCiAgCQkJIkdsb2JhbFRhc2siCiAgCQldLAogIAkJcHJvcGVydGllczogWwogIAkJCXsKICAJCQkJbmFtZTogImltcGxlbWVudGF0aW9uIiwKICAJCQkJaXNBdHRyOiB0cnVlLAogIAkJCQl0eXBlOiAiU3RyaW5nIgogIAkJCX0KICAJCV0KICAJfSwKICAJewogIAkJbmFtZTogIkNvbXBsZXhCZWhhdmlvckRlZmluaXRpb24iLAogIAkJc3VwZXJDbGFzczogWwogIAkJCSJCYXNlRWxlbWVudCIKICAJCV0sCiAgCQlwcm9wZXJ0aWVzOiBbCiAgCQkJewogIAkJCQluYW1lOiAiY29uZGl0aW9uIiwKICAJCQkJdHlwZTogIkZvcm1hbEV4cHJlc3Npb24iCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJldmVudCIsCiAgCQkJCXR5cGU6ICJJbXBsaWNpdFRocm93RXZlbnQiCiAgCQkJfQogIAkJXQogIAl9LAogIAl7CiAgCQluYW1lOiAiUmVzb3VyY2VSb2xlIiwKICAJCXN1cGVyQ2xhc3M6IFsKICAJCQkiQmFzZUVsZW1lbnQiCiAgCQldLAogIAkJcHJvcGVydGllczogWwogIAkJCXsKICAJCQkJbmFtZTogInJlc291cmNlUmVmIiwKICAJCQkJdHlwZTogIlJlc291cmNlIiwKICAJCQkJaXNSZWZlcmVuY2U6IHRydWUKICAJCQl9LAogIAkJCXsKICAJCQkJbmFtZTogInJlc291cmNlUGFyYW1ldGVyQmluZGluZ3MiLAogIAkJCQl0eXBlOiAiUmVzb3VyY2VQYXJhbWV0ZXJCaW5kaW5nIiwKICAJCQkJaXNNYW55OiB0cnVlCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJyZXNvdXJjZUFzc2lnbm1lbnRFeHByZXNzaW9uIiwKICAJCQkJdHlwZTogIlJlc291cmNlQXNzaWdubWVudEV4cHJlc3Npb24iCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJuYW1lIiwKICAJCQkJaXNBdHRyOiB0cnVlLAogIAkJCQl0eXBlOiAiU3RyaW5nIgogIAkJCX0KICAJCV0KICAJfSwKICAJewogIAkJbmFtZTogIlJlc291cmNlUGFyYW1ldGVyQmluZGluZyIsCiAgCQlwcm9wZXJ0aWVzOiBbCiAgCQkJewogIAkJCQluYW1lOiAiZXhwcmVzc2lvbiIsCiAgCQkJCXR5cGU6ICJFeHByZXNzaW9uIiwKICAJCQkJeG1sOiB7CiAgCQkJCQlzZXJpYWxpemU6ICJ4c2k6dHlwZSIKICAJCQkJfQogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAicGFyYW1ldGVyUmVmIiwKICAJCQkJdHlwZTogIlJlc291cmNlUGFyYW1ldGVyIiwKICAJCQkJaXNBdHRyOiB0cnVlLAogIAkJCQlpc1JlZmVyZW5jZTogdHJ1ZQogIAkJCX0KICAJCV0sCiAgCQlzdXBlckNsYXNzOiBbCiAgCQkJIkJhc2VFbGVtZW50IgogIAkJXQogIAl9LAogIAl7CiAgCQluYW1lOiAiUmVzb3VyY2VBc3NpZ25tZW50RXhwcmVzc2lvbiIsCiAgCQlwcm9wZXJ0aWVzOiBbCiAgCQkJewogIAkJCQluYW1lOiAiZXhwcmVzc2lvbiIsCiAgCQkJCXR5cGU6ICJFeHByZXNzaW9uIiwKICAJCQkJeG1sOiB7CiAgCQkJCQlzZXJpYWxpemU6ICJ4c2k6dHlwZSIKICAJCQkJfQogIAkJCX0KICAJCV0sCiAgCQlzdXBlckNsYXNzOiBbCiAgCQkJIkJhc2VFbGVtZW50IgogIAkJXQogIAl9LAogIAl7CiAgCQluYW1lOiAiSW1wb3J0IiwKICAJCXByb3BlcnRpZXM6IFsKICAJCQl7CiAgCQkJCW5hbWU6ICJpbXBvcnRUeXBlIiwKICAJCQkJaXNBdHRyOiB0cnVlLAogIAkJCQl0eXBlOiAiU3RyaW5nIgogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAibG9jYXRpb24iLAogIAkJCQlpc0F0dHI6IHRydWUsCiAgCQkJCXR5cGU6ICJTdHJpbmciCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJuYW1lc3BhY2UiLAogIAkJCQlpc0F0dHI6IHRydWUsCiAgCQkJCXR5cGU6ICJTdHJpbmciCiAgCQkJfQogIAkJXQogIAl9LAogIAl7CiAgCQluYW1lOiAiRGVmaW5pdGlvbnMiLAogIAkJc3VwZXJDbGFzczogWwogIAkJCSJCYXNlRWxlbWVudCIKICAJCV0sCiAgCQlwcm9wZXJ0aWVzOiBbCiAgCQkJewogIAkJCQluYW1lOiAibmFtZSIsCiAgCQkJCWlzQXR0cjogdHJ1ZSwKICAJCQkJdHlwZTogIlN0cmluZyIKICAJCQl9LAogIAkJCXsKICAJCQkJbmFtZTogInRhcmdldE5hbWVzcGFjZSIsCiAgCQkJCWlzQXR0cjogdHJ1ZSwKICAJCQkJdHlwZTogIlN0cmluZyIKICAJCQl9LAogIAkJCXsKICAJCQkJbmFtZTogImV4cHJlc3Npb25MYW5ndWFnZSIsCiAgCQkJCSJkZWZhdWx0IjogImh0dHA6Ly93d3cudzMub3JnLzE5OTkvWFBhdGgiLAogIAkJCQlpc0F0dHI6IHRydWUsCiAgCQkJCXR5cGU6ICJTdHJpbmciCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJ0eXBlTGFuZ3VhZ2UiLAogIAkJCQkiZGVmYXVsdCI6ICJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYSIsCiAgCQkJCWlzQXR0cjogdHJ1ZSwKICAJCQkJdHlwZTogIlN0cmluZyIKICAJCQl9LAogIAkJCXsKICAJCQkJbmFtZTogImltcG9ydHMiLAogIAkJCQl0eXBlOiAiSW1wb3J0IiwKICAJCQkJaXNNYW55OiB0cnVlCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJleHRlbnNpb25zIiwKICAJCQkJdHlwZTogIkV4dGVuc2lvbiIsCiAgCQkJCWlzTWFueTogdHJ1ZQogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAicm9vdEVsZW1lbnRzIiwKICAJCQkJdHlwZTogIlJvb3RFbGVtZW50IiwKICAJCQkJaXNNYW55OiB0cnVlCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJkaWFncmFtcyIsCiAgCQkJCWlzTWFueTogdHJ1ZSwKICAJCQkJdHlwZTogImJwbW5kaTpCUE1ORGlhZ3JhbSIKICAJCQl9LAogIAkJCXsKICAJCQkJbmFtZTogImV4cG9ydGVyIiwKICAJCQkJaXNBdHRyOiB0cnVlLAogIAkJCQl0eXBlOiAiU3RyaW5nIgogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAicmVsYXRpb25zaGlwcyIsCiAgCQkJCXR5cGU6ICJSZWxhdGlvbnNoaXAiLAogIAkJCQlpc01hbnk6IHRydWUKICAJCQl9LAogIAkJCXsKICAJCQkJbmFtZTogImV4cG9ydGVyVmVyc2lvbiIsCiAgCQkJCWlzQXR0cjogdHJ1ZSwKICAJCQkJdHlwZTogIlN0cmluZyIKICAJCQl9CiAgCQldCiAgCX0KICBdOwogIHZhciBlbnVtZXJhdGlvbnMgPSBbCiAgCXsKICAJCW5hbWU6ICJQcm9jZXNzVHlwZSIsCiAgCQlsaXRlcmFsVmFsdWVzOiBbCiAgCQkJewogIAkJCQluYW1lOiAiTm9uZSIKICAJCQl9LAogIAkJCXsKICAJCQkJbmFtZTogIlB1YmxpYyIKICAJCQl9LAogIAkJCXsKICAJCQkJbmFtZTogIlByaXZhdGUiCiAgCQkJfQogIAkJXQogIAl9LAogIAl7CiAgCQluYW1lOiAiR2F0ZXdheURpcmVjdGlvbiIsCiAgCQlsaXRlcmFsVmFsdWVzOiBbCiAgCQkJewogIAkJCQluYW1lOiAiVW5zcGVjaWZpZWQiCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJDb252ZXJnaW5nIgogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAiRGl2ZXJnaW5nIgogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAiTWl4ZWQiCiAgCQkJfQogIAkJXQogIAl9LAogIAl7CiAgCQluYW1lOiAiRXZlbnRCYXNlZEdhdGV3YXlUeXBlIiwKICAJCWxpdGVyYWxWYWx1ZXM6IFsKICAJCQl7CiAgCQkJCW5hbWU6ICJQYXJhbGxlbCIKICAJCQl9LAogIAkJCXsKICAJCQkJbmFtZTogIkV4Y2x1c2l2ZSIKICAJCQl9CiAgCQldCiAgCX0sCiAgCXsKICAJCW5hbWU6ICJSZWxhdGlvbnNoaXBEaXJlY3Rpb24iLAogIAkJbGl0ZXJhbFZhbHVlczogWwogIAkJCXsKICAJCQkJbmFtZTogIk5vbmUiCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJGb3J3YXJkIgogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAiQmFja3dhcmQiCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJCb3RoIgogIAkJCX0KICAJCV0KICAJfSwKICAJewogIAkJbmFtZTogIkl0ZW1LaW5kIiwKICAJCWxpdGVyYWxWYWx1ZXM6IFsKICAJCQl7CiAgCQkJCW5hbWU6ICJQaHlzaWNhbCIKICAJCQl9LAogIAkJCXsKICAJCQkJbmFtZTogIkluZm9ybWF0aW9uIgogIAkJCX0KICAJCV0KICAJfSwKICAJewogIAkJbmFtZTogIkNob3Jlb2dyYXBoeUxvb3BUeXBlIiwKICAJCWxpdGVyYWxWYWx1ZXM6IFsKICAJCQl7CiAgCQkJCW5hbWU6ICJOb25lIgogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAiU3RhbmRhcmQiCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJNdWx0aUluc3RhbmNlU2VxdWVudGlhbCIKICAJCQl9LAogIAkJCXsKICAJCQkJbmFtZTogIk11bHRpSW5zdGFuY2VQYXJhbGxlbCIKICAJCQl9CiAgCQldCiAgCX0sCiAgCXsKICAJCW5hbWU6ICJBc3NvY2lhdGlvbkRpcmVjdGlvbiIsCiAgCQlsaXRlcmFsVmFsdWVzOiBbCiAgCQkJewogIAkJCQluYW1lOiAiTm9uZSIKICAJCQl9LAogIAkJCXsKICAJCQkJbmFtZTogIk9uZSIKICAJCQl9LAogIAkJCXsKICAJCQkJbmFtZTogIkJvdGgiCiAgCQkJfQogIAkJXQogIAl9LAogIAl7CiAgCQluYW1lOiAiTXVsdGlJbnN0YW5jZUJlaGF2aW9yIiwKICAJCWxpdGVyYWxWYWx1ZXM6IFsKICAJCQl7CiAgCQkJCW5hbWU6ICJOb25lIgogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAiT25lIgogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAiQWxsIgogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAiQ29tcGxleCIKICAJCQl9CiAgCQldCiAgCX0sCiAgCXsKICAJCW5hbWU6ICJBZEhvY09yZGVyaW5nIiwKICAJCWxpdGVyYWxWYWx1ZXM6IFsKICAJCQl7CiAgCQkJCW5hbWU6ICJQYXJhbGxlbCIKICAJCQl9LAogIAkJCXsKICAJCQkJbmFtZTogIlNlcXVlbnRpYWwiCiAgCQkJfQogIAkJXQogIAl9CiAgXTsKICB2YXIgcHJlZml4JDEgPSAiYnBtbiI7CiAgdmFyIHhtbCA9IHsKICAJdGFnQWxpYXM6ICJsb3dlckNhc2UiLAogIAl0eXBlUHJlZml4OiAidCIKICB9OwogIHZhciBCcG1uUGFja2FnZSA9IHsKICAJbmFtZTogbmFtZSwKICAJdXJpOiB1cmksCiAgCWFzc29jaWF0aW9uczogYXNzb2NpYXRpb25zLAogIAl0eXBlczogdHlwZXMkMSwKICAJZW51bWVyYXRpb25zOiBlbnVtZXJhdGlvbnMsCiAgCXByZWZpeDogcHJlZml4JDEsCiAgCXhtbDogeG1sCiAgfTsKCiAgdmFyIG5hbWUkMSA9ICJCUE1OREkiOwogIHZhciB1cmkkMSA9ICJodHRwOi8vd3d3Lm9tZy5vcmcvc3BlYy9CUE1OLzIwMTAwNTI0L0RJIjsKICB2YXIgdHlwZXMkMSQxID0gWwogIAl7CiAgCQluYW1lOiAiQlBNTkRpYWdyYW0iLAogIAkJcHJvcGVydGllczogWwogIAkJCXsKICAJCQkJbmFtZTogInBsYW5lIiwKICAJCQkJdHlwZTogIkJQTU5QbGFuZSIsCiAgCQkJCXJlZGVmaW5lczogImRpOkRpYWdyYW0jcm9vdEVsZW1lbnQiCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJsYWJlbFN0eWxlIiwKICAJCQkJdHlwZTogIkJQTU5MYWJlbFN0eWxlIiwKICAJCQkJaXNNYW55OiB0cnVlCiAgCQkJfQogIAkJXSwKICAJCXN1cGVyQ2xhc3M6IFsKICAJCQkiZGk6RGlhZ3JhbSIKICAJCV0KICAJfSwKICAJewogIAkJbmFtZTogIkJQTU5QbGFuZSIsCiAgCQlwcm9wZXJ0aWVzOiBbCiAgCQkJewogIAkJCQluYW1lOiAiYnBtbkVsZW1lbnQiLAogIAkJCQlpc0F0dHI6IHRydWUsCiAgCQkJCWlzUmVmZXJlbmNlOiB0cnVlLAogIAkJCQl0eXBlOiAiYnBtbjpCYXNlRWxlbWVudCIsCiAgCQkJCXJlZGVmaW5lczogImRpOkRpYWdyYW1FbGVtZW50I21vZGVsRWxlbWVudCIKICAJCQl9CiAgCQldLAogIAkJc3VwZXJDbGFzczogWwogIAkJCSJkaTpQbGFuZSIKICAJCV0KICAJfSwKICAJewogIAkJbmFtZTogIkJQTU5TaGFwZSIsCiAgCQlwcm9wZXJ0aWVzOiBbCiAgCQkJewogIAkJCQluYW1lOiAiYnBtbkVsZW1lbnQiLAogIAkJCQlpc0F0dHI6IHRydWUsCiAgCQkJCWlzUmVmZXJlbmNlOiB0cnVlLAogIAkJCQl0eXBlOiAiYnBtbjpCYXNlRWxlbWVudCIsCiAgCQkJCXJlZGVmaW5lczogImRpOkRpYWdyYW1FbGVtZW50I21vZGVsRWxlbWVudCIKICAJCQl9LAogIAkJCXsKICAJCQkJbmFtZTogImlzSG9yaXpvbnRhbCIsCiAgCQkJCWlzQXR0cjogdHJ1ZSwKICAJCQkJdHlwZTogIkJvb2xlYW4iCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJpc0V4cGFuZGVkIiwKICAJCQkJaXNBdHRyOiB0cnVlLAogIAkJCQl0eXBlOiAiQm9vbGVhbiIKICAJCQl9LAogIAkJCXsKICAJCQkJbmFtZTogImlzTWFya2VyVmlzaWJsZSIsCiAgCQkJCWlzQXR0cjogdHJ1ZSwKICAJCQkJdHlwZTogIkJvb2xlYW4iCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJsYWJlbCIsCiAgCQkJCXR5cGU6ICJCUE1OTGFiZWwiCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJpc01lc3NhZ2VWaXNpYmxlIiwKICAJCQkJaXNBdHRyOiB0cnVlLAogIAkJCQl0eXBlOiAiQm9vbGVhbiIKICAJCQl9LAogIAkJCXsKICAJCQkJbmFtZTogInBhcnRpY2lwYW50QmFuZEtpbmQiLAogIAkJCQl0eXBlOiAiUGFydGljaXBhbnRCYW5kS2luZCIsCiAgCQkJCWlzQXR0cjogdHJ1ZQogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAiY2hvcmVvZ3JhcGh5QWN0aXZpdHlTaGFwZSIsCiAgCQkJCXR5cGU6ICJCUE1OU2hhcGUiLAogIAkJCQlpc0F0dHI6IHRydWUsCiAgCQkJCWlzUmVmZXJlbmNlOiB0cnVlCiAgCQkJfQogIAkJXSwKICAJCXN1cGVyQ2xhc3M6IFsKICAJCQkiZGk6TGFiZWxlZFNoYXBlIgogIAkJXQogIAl9LAogIAl7CiAgCQluYW1lOiAiQlBNTkVkZ2UiLAogIAkJcHJvcGVydGllczogWwogIAkJCXsKICAJCQkJbmFtZTogImxhYmVsIiwKICAJCQkJdHlwZTogIkJQTU5MYWJlbCIKICAJCQl9LAogIAkJCXsKICAJCQkJbmFtZTogImJwbW5FbGVtZW50IiwKICAJCQkJaXNBdHRyOiB0cnVlLAogIAkJCQlpc1JlZmVyZW5jZTogdHJ1ZSwKICAJCQkJdHlwZTogImJwbW46QmFzZUVsZW1lbnQiLAogIAkJCQlyZWRlZmluZXM6ICJkaTpEaWFncmFtRWxlbWVudCNtb2RlbEVsZW1lbnQiCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJzb3VyY2VFbGVtZW50IiwKICAJCQkJaXNBdHRyOiB0cnVlLAogIAkJCQlpc1JlZmVyZW5jZTogdHJ1ZSwKICAJCQkJdHlwZTogImRpOkRpYWdyYW1FbGVtZW50IiwKICAJCQkJcmVkZWZpbmVzOiAiZGk6RWRnZSNzb3VyY2UiCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJ0YXJnZXRFbGVtZW50IiwKICAJCQkJaXNBdHRyOiB0cnVlLAogIAkJCQlpc1JlZmVyZW5jZTogdHJ1ZSwKICAJCQkJdHlwZTogImRpOkRpYWdyYW1FbGVtZW50IiwKICAJCQkJcmVkZWZpbmVzOiAiZGk6RWRnZSN0YXJnZXQiCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJtZXNzYWdlVmlzaWJsZUtpbmQiLAogIAkJCQl0eXBlOiAiTWVzc2FnZVZpc2libGVLaW5kIiwKICAJCQkJaXNBdHRyOiB0cnVlLAogIAkJCQkiZGVmYXVsdCI6ICJpbml0aWF0aW5nIgogIAkJCX0KICAJCV0sCiAgCQlzdXBlckNsYXNzOiBbCiAgCQkJImRpOkxhYmVsZWRFZGdlIgogIAkJXQogIAl9LAogIAl7CiAgCQluYW1lOiAiQlBNTkxhYmVsIiwKICAJCXByb3BlcnRpZXM6IFsKICAJCQl7CiAgCQkJCW5hbWU6ICJsYWJlbFN0eWxlIiwKICAJCQkJdHlwZTogIkJQTU5MYWJlbFN0eWxlIiwKICAJCQkJaXNBdHRyOiB0cnVlLAogIAkJCQlpc1JlZmVyZW5jZTogdHJ1ZSwKICAJCQkJcmVkZWZpbmVzOiAiZGk6RGlhZ3JhbUVsZW1lbnQjc3R5bGUiCiAgCQkJfQogIAkJXSwKICAJCXN1cGVyQ2xhc3M6IFsKICAJCQkiZGk6TGFiZWwiCiAgCQldCiAgCX0sCiAgCXsKICAJCW5hbWU6ICJCUE1OTGFiZWxTdHlsZSIsCiAgCQlwcm9wZXJ0aWVzOiBbCiAgCQkJewogIAkJCQluYW1lOiAiZm9udCIsCiAgCQkJCXR5cGU6ICJkYzpGb250IgogIAkJCX0KICAJCV0sCiAgCQlzdXBlckNsYXNzOiBbCiAgCQkJImRpOlN0eWxlIgogIAkJXQogIAl9CiAgXTsKICB2YXIgZW51bWVyYXRpb25zJDEgPSBbCiAgCXsKICAJCW5hbWU6ICJQYXJ0aWNpcGFudEJhbmRLaW5kIiwKICAJCWxpdGVyYWxWYWx1ZXM6IFsKICAJCQl7CiAgCQkJCW5hbWU6ICJ0b3BfaW5pdGlhdGluZyIKICAJCQl9LAogIAkJCXsKICAJCQkJbmFtZTogIm1pZGRsZV9pbml0aWF0aW5nIgogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAiYm90dG9tX2luaXRpYXRpbmciCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJ0b3Bfbm9uX2luaXRpYXRpbmciCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJtaWRkbGVfbm9uX2luaXRpYXRpbmciCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJib3R0b21fbm9uX2luaXRpYXRpbmciCiAgCQkJfQogIAkJXQogIAl9LAogIAl7CiAgCQluYW1lOiAiTWVzc2FnZVZpc2libGVLaW5kIiwKICAJCWxpdGVyYWxWYWx1ZXM6IFsKICAJCQl7CiAgCQkJCW5hbWU6ICJpbml0aWF0aW5nIgogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAibm9uX2luaXRpYXRpbmciCiAgCQkJfQogIAkJXQogIAl9CiAgXTsKICB2YXIgYXNzb2NpYXRpb25zJDEgPSBbCiAgXTsKICB2YXIgcHJlZml4JDEkMSA9ICJicG1uZGkiOwogIHZhciBCcG1uRGlQYWNrYWdlID0gewogIAluYW1lOiBuYW1lJDEsCiAgCXVyaTogdXJpJDEsCiAgCXR5cGVzOiB0eXBlcyQxJDEsCiAgCWVudW1lcmF0aW9uczogZW51bWVyYXRpb25zJDEsCiAgCWFzc29jaWF0aW9uczogYXNzb2NpYXRpb25zJDEsCiAgCXByZWZpeDogcHJlZml4JDEkMQogIH07CgogIHZhciBuYW1lJDIgPSAiREMiOwogIHZhciB1cmkkMiA9ICJodHRwOi8vd3d3Lm9tZy5vcmcvc3BlYy9ERC8yMDEwMDUyNC9EQyI7CiAgdmFyIHR5cGVzJDIgPSBbCiAgCXsKICAJCW5hbWU6ICJCb29sZWFuIgogIAl9LAogIAl7CiAgCQluYW1lOiAiSW50ZWdlciIKICAJfSwKICAJewogIAkJbmFtZTogIlJlYWwiCiAgCX0sCiAgCXsKICAJCW5hbWU6ICJTdHJpbmciCiAgCX0sCiAgCXsKICAJCW5hbWU6ICJGb250IiwKICAJCXByb3BlcnRpZXM6IFsKICAJCQl7CiAgCQkJCW5hbWU6ICJuYW1lIiwKICAJCQkJdHlwZTogIlN0cmluZyIsCiAgCQkJCWlzQXR0cjogdHJ1ZQogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAic2l6ZSIsCiAgCQkJCXR5cGU6ICJSZWFsIiwKICAJCQkJaXNBdHRyOiB0cnVlCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJpc0JvbGQiLAogIAkJCQl0eXBlOiAiQm9vbGVhbiIsCiAgCQkJCWlzQXR0cjogdHJ1ZQogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAiaXNJdGFsaWMiLAogIAkJCQl0eXBlOiAiQm9vbGVhbiIsCiAgCQkJCWlzQXR0cjogdHJ1ZQogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAiaXNVbmRlcmxpbmUiLAogIAkJCQl0eXBlOiAiQm9vbGVhbiIsCiAgCQkJCWlzQXR0cjogdHJ1ZQogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAiaXNTdHJpa2VUaHJvdWdoIiwKICAJCQkJdHlwZTogIkJvb2xlYW4iLAogIAkJCQlpc0F0dHI6IHRydWUKICAJCQl9CiAgCQldCiAgCX0sCiAgCXsKICAJCW5hbWU6ICJQb2ludCIsCiAgCQlwcm9wZXJ0aWVzOiBbCiAgCQkJewogIAkJCQluYW1lOiAieCIsCiAgCQkJCXR5cGU6ICJSZWFsIiwKICAJCQkJImRlZmF1bHQiOiAiMCIsCiAgCQkJCWlzQXR0cjogdHJ1ZQogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAieSIsCiAgCQkJCXR5cGU6ICJSZWFsIiwKICAJCQkJImRlZmF1bHQiOiAiMCIsCiAgCQkJCWlzQXR0cjogdHJ1ZQogIAkJCX0KICAJCV0KICAJfSwKICAJewogIAkJbmFtZTogIkJvdW5kcyIsCiAgCQlwcm9wZXJ0aWVzOiBbCiAgCQkJewogIAkJCQluYW1lOiAieCIsCiAgCQkJCXR5cGU6ICJSZWFsIiwKICAJCQkJImRlZmF1bHQiOiAiMCIsCiAgCQkJCWlzQXR0cjogdHJ1ZQogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAieSIsCiAgCQkJCXR5cGU6ICJSZWFsIiwKICAJCQkJImRlZmF1bHQiOiAiMCIsCiAgCQkJCWlzQXR0cjogdHJ1ZQogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAid2lkdGgiLAogIAkJCQl0eXBlOiAiUmVhbCIsCiAgCQkJCWlzQXR0cjogdHJ1ZQogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAiaGVpZ2h0IiwKICAJCQkJdHlwZTogIlJlYWwiLAogIAkJCQlpc0F0dHI6IHRydWUKICAJCQl9CiAgCQldCiAgCX0KICBdOwogIHZhciBwcmVmaXgkMiA9ICJkYyI7CiAgdmFyIGFzc29jaWF0aW9ucyQyID0gWwogIF07CiAgdmFyIERjUGFja2FnZSA9IHsKICAJbmFtZTogbmFtZSQyLAogIAl1cmk6IHVyaSQyLAogIAl0eXBlczogdHlwZXMkMiwKICAJcHJlZml4OiBwcmVmaXgkMiwKICAJYXNzb2NpYXRpb25zOiBhc3NvY2lhdGlvbnMkMgogIH07CgogIHZhciBuYW1lJDMgPSAiREkiOwogIHZhciB1cmkkMyA9ICJodHRwOi8vd3d3Lm9tZy5vcmcvc3BlYy9ERC8yMDEwMDUyNC9ESSI7CiAgdmFyIHR5cGVzJDMgPSBbCiAgCXsKICAJCW5hbWU6ICJEaWFncmFtRWxlbWVudCIsCiAgCQlpc0Fic3RyYWN0OiB0cnVlLAogIAkJcHJvcGVydGllczogWwogIAkJCXsKICAJCQkJbmFtZTogImlkIiwKICAJCQkJdHlwZTogIlN0cmluZyIsCiAgCQkJCWlzQXR0cjogdHJ1ZSwKICAJCQkJaXNJZDogdHJ1ZQogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAiZXh0ZW5zaW9uIiwKICAJCQkJdHlwZTogIkV4dGVuc2lvbiIKICAJCQl9LAogIAkJCXsKICAJCQkJbmFtZTogIm93bmluZ0RpYWdyYW0iLAogIAkJCQl0eXBlOiAiRGlhZ3JhbSIsCiAgCQkJCWlzUmVhZE9ubHk6IHRydWUsCiAgCQkJCWlzVmlydHVhbDogdHJ1ZSwKICAJCQkJaXNSZWZlcmVuY2U6IHRydWUKICAJCQl9LAogIAkJCXsKICAJCQkJbmFtZTogIm93bmluZ0VsZW1lbnQiLAogIAkJCQl0eXBlOiAiRGlhZ3JhbUVsZW1lbnQiLAogIAkJCQlpc1JlYWRPbmx5OiB0cnVlLAogIAkJCQlpc1ZpcnR1YWw6IHRydWUsCiAgCQkJCWlzUmVmZXJlbmNlOiB0cnVlCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJtb2RlbEVsZW1lbnQiLAogIAkJCQlpc1JlYWRPbmx5OiB0cnVlLAogIAkJCQlpc1ZpcnR1YWw6IHRydWUsCiAgCQkJCWlzUmVmZXJlbmNlOiB0cnVlLAogIAkJCQl0eXBlOiAiRWxlbWVudCIKICAJCQl9LAogIAkJCXsKICAJCQkJbmFtZTogInN0eWxlIiwKICAJCQkJdHlwZTogIlN0eWxlIiwKICAJCQkJaXNSZWFkT25seTogdHJ1ZSwKICAJCQkJaXNWaXJ0dWFsOiB0cnVlLAogIAkJCQlpc1JlZmVyZW5jZTogdHJ1ZQogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAib3duZWRFbGVtZW50IiwKICAJCQkJdHlwZTogIkRpYWdyYW1FbGVtZW50IiwKICAJCQkJaXNSZWFkT25seTogdHJ1ZSwKICAJCQkJaXNWaXJ0dWFsOiB0cnVlLAogIAkJCQlpc01hbnk6IHRydWUKICAJCQl9CiAgCQldCiAgCX0sCiAgCXsKICAJCW5hbWU6ICJOb2RlIiwKICAJCWlzQWJzdHJhY3Q6IHRydWUsCiAgCQlzdXBlckNsYXNzOiBbCiAgCQkJIkRpYWdyYW1FbGVtZW50IgogIAkJXQogIAl9LAogIAl7CiAgCQluYW1lOiAiRWRnZSIsCiAgCQlpc0Fic3RyYWN0OiB0cnVlLAogIAkJc3VwZXJDbGFzczogWwogIAkJCSJEaWFncmFtRWxlbWVudCIKICAJCV0sCiAgCQlwcm9wZXJ0aWVzOiBbCiAgCQkJewogIAkJCQluYW1lOiAic291cmNlIiwKICAJCQkJdHlwZTogIkRpYWdyYW1FbGVtZW50IiwKICAJCQkJaXNSZWFkT25seTogdHJ1ZSwKICAJCQkJaXNWaXJ0dWFsOiB0cnVlLAogIAkJCQlpc1JlZmVyZW5jZTogdHJ1ZQogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAidGFyZ2V0IiwKICAJCQkJdHlwZTogIkRpYWdyYW1FbGVtZW50IiwKICAJCQkJaXNSZWFkT25seTogdHJ1ZSwKICAJCQkJaXNWaXJ0dWFsOiB0cnVlLAogIAkJCQlpc1JlZmVyZW5jZTogdHJ1ZQogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAid2F5cG9pbnQiLAogIAkJCQlpc1VuaXF1ZTogZmFsc2UsCiAgCQkJCWlzTWFueTogdHJ1ZSwKICAJCQkJdHlwZTogImRjOlBvaW50IiwKICAJCQkJeG1sOiB7CiAgCQkJCQlzZXJpYWxpemU6ICJ4c2k6dHlwZSIKICAJCQkJfQogIAkJCX0KICAJCV0KICAJfSwKICAJewogIAkJbmFtZTogIkRpYWdyYW0iLAogIAkJaXNBYnN0cmFjdDogdHJ1ZSwKICAJCXByb3BlcnRpZXM6IFsKICAJCQl7CiAgCQkJCW5hbWU6ICJpZCIsCiAgCQkJCXR5cGU6ICJTdHJpbmciLAogIAkJCQlpc0F0dHI6IHRydWUsCiAgCQkJCWlzSWQ6IHRydWUKICAJCQl9LAogIAkJCXsKICAJCQkJbmFtZTogInJvb3RFbGVtZW50IiwKICAJCQkJdHlwZTogIkRpYWdyYW1FbGVtZW50IiwKICAJCQkJaXNSZWFkT25seTogdHJ1ZSwKICAJCQkJaXNWaXJ0dWFsOiB0cnVlCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJuYW1lIiwKICAJCQkJaXNBdHRyOiB0cnVlLAogIAkJCQl0eXBlOiAiU3RyaW5nIgogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAiZG9jdW1lbnRhdGlvbiIsCiAgCQkJCWlzQXR0cjogdHJ1ZSwKICAJCQkJdHlwZTogIlN0cmluZyIKICAJCQl9LAogIAkJCXsKICAJCQkJbmFtZTogInJlc29sdXRpb24iLAogIAkJCQlpc0F0dHI6IHRydWUsCiAgCQkJCXR5cGU6ICJSZWFsIgogIAkJCX0sCiAgCQkJewogIAkJCQluYW1lOiAib3duZWRTdHlsZSIsCiAgCQkJCXR5cGU6ICJTdHlsZSIsCiAgCQkJCWlzUmVhZE9ubHk6IHRydWUsCiAgCQkJCWlzVmlydHVhbDogdHJ1ZSwKICAJCQkJaXNNYW55OiB0cnVlCiAgCQkJfQogIAkJXQogIAl9LAogIAl7CiAgCQluYW1lOiAiU2hhcGUiLAogIAkJaXNBYnN0cmFjdDogdHJ1ZSwKICAJCXN1cGVyQ2xhc3M6IFsKICAJCQkiTm9kZSIKICAJCV0sCiAgCQlwcm9wZXJ0aWVzOiBbCiAgCQkJewogIAkJCQluYW1lOiAiYm91bmRzIiwKICAJCQkJdHlwZTogImRjOkJvdW5kcyIKICAJCQl9CiAgCQldCiAgCX0sCiAgCXsKICAJCW5hbWU6ICJQbGFuZSIsCiAgCQlpc0Fic3RyYWN0OiB0cnVlLAogIAkJc3VwZXJDbGFzczogWwogIAkJCSJOb2RlIgogIAkJXSwKICAJCXByb3BlcnRpZXM6IFsKICAJCQl7CiAgCQkJCW5hbWU6ICJwbGFuZUVsZW1lbnQiLAogIAkJCQl0eXBlOiAiRGlhZ3JhbUVsZW1lbnQiLAogIAkJCQlzdWJzZXR0ZWRQcm9wZXJ0eTogIkRpYWdyYW1FbGVtZW50LW93bmVkRWxlbWVudCIsCiAgCQkJCWlzTWFueTogdHJ1ZQogIAkJCX0KICAJCV0KICAJfSwKICAJewogIAkJbmFtZTogIkxhYmVsZWRFZGdlIiwKICAJCWlzQWJzdHJhY3Q6IHRydWUsCiAgCQlzdXBlckNsYXNzOiBbCiAgCQkJIkVkZ2UiCiAgCQldLAogIAkJcHJvcGVydGllczogWwogIAkJCXsKICAJCQkJbmFtZTogIm93bmVkTGFiZWwiLAogIAkJCQl0eXBlOiAiTGFiZWwiLAogIAkJCQlpc1JlYWRPbmx5OiB0cnVlLAogIAkJCQlzdWJzZXR0ZWRQcm9wZXJ0eTogIkRpYWdyYW1FbGVtZW50LW93bmVkRWxlbWVudCIsCiAgCQkJCWlzVmlydHVhbDogdHJ1ZSwKICAJCQkJaXNNYW55OiB0cnVlCiAgCQkJfQogIAkJXQogIAl9LAogIAl7CiAgCQluYW1lOiAiTGFiZWxlZFNoYXBlIiwKICAJCWlzQWJzdHJhY3Q6IHRydWUsCiAgCQlzdXBlckNsYXNzOiBbCiAgCQkJIlNoYXBlIgogIAkJXSwKICAJCXByb3BlcnRpZXM6IFsKICAJCQl7CiAgCQkJCW5hbWU6ICJvd25lZExhYmVsIiwKICAJCQkJdHlwZTogIkxhYmVsIiwKICAJCQkJaXNSZWFkT25seTogdHJ1ZSwKICAJCQkJc3Vic2V0dGVkUHJvcGVydHk6ICJEaWFncmFtRWxlbWVudC1vd25lZEVsZW1lbnQiLAogIAkJCQlpc1ZpcnR1YWw6IHRydWUsCiAgCQkJCWlzTWFueTogdHJ1ZQogIAkJCX0KICAJCV0KICAJfSwKICAJewogIAkJbmFtZTogIkxhYmVsIiwKICAJCWlzQWJzdHJhY3Q6IHRydWUsCiAgCQlzdXBlckNsYXNzOiBbCiAgCQkJIk5vZGUiCiAgCQldLAogIAkJcHJvcGVydGllczogWwogIAkJCXsKICAJCQkJbmFtZTogImJvdW5kcyIsCiAgCQkJCXR5cGU6ICJkYzpCb3VuZHMiCiAgCQkJfQogIAkJXQogIAl9LAogIAl7CiAgCQluYW1lOiAiU3R5bGUiLAogIAkJaXNBYnN0cmFjdDogdHJ1ZSwKICAJCXByb3BlcnRpZXM6IFsKICAJCQl7CiAgCQkJCW5hbWU6ICJpZCIsCiAgCQkJCXR5cGU6ICJTdHJpbmciLAogIAkJCQlpc0F0dHI6IHRydWUsCiAgCQkJCWlzSWQ6IHRydWUKICAJCQl9CiAgCQldCiAgCX0sCiAgCXsKICAJCW5hbWU6ICJFeHRlbnNpb24iLAogIAkJcHJvcGVydGllczogWwogIAkJCXsKICAJCQkJbmFtZTogInZhbHVlcyIsCiAgCQkJCXR5cGU6ICJFbGVtZW50IiwKICAJCQkJaXNNYW55OiB0cnVlCiAgCQkJfQogIAkJXQogIAl9CiAgXTsKICB2YXIgYXNzb2NpYXRpb25zJDMgPSBbCiAgXTsKICB2YXIgcHJlZml4JDMgPSAiZGkiOwogIHZhciB4bWwkMSA9IHsKICAJdGFnQWxpYXM6ICJsb3dlckNhc2UiCiAgfTsKICB2YXIgRGlQYWNrYWdlID0gewogIAluYW1lOiBuYW1lJDMsCiAgCXVyaTogdXJpJDMsCiAgCXR5cGVzOiB0eXBlcyQzLAogIAlhc3NvY2lhdGlvbnM6IGFzc29jaWF0aW9ucyQzLAogIAlwcmVmaXg6IHByZWZpeCQzLAogIAl4bWw6IHhtbCQxCiAgfTsKCiAgdmFyIG5hbWUkNCA9ICJicG1uLmlvIGNvbG9ycyBmb3IgQlBNTiI7CiAgdmFyIHVyaSQ0ID0gImh0dHA6Ly9icG1uLmlvL3NjaGVtYS9icG1uL2Jpb2NvbG9yLzEuMCI7CiAgdmFyIHByZWZpeCQ0ID0gImJpb2MiOwogIHZhciB0eXBlcyQ0ID0gWwogIAl7CiAgCQluYW1lOiAiQ29sb3JlZFNoYXBlIiwKICAJCSJleHRlbmRzIjogWwogIAkJCSJicG1uZGk6QlBNTlNoYXBlIgogIAkJXSwKICAJCXByb3BlcnRpZXM6IFsKICAJCQl7CiAgCQkJCW5hbWU6ICJzdHJva2UiLAogIAkJCQlpc0F0dHI6IHRydWUsCiAgCQkJCXR5cGU6ICJTdHJpbmciCiAgCQkJfSwKICAJCQl7CiAgCQkJCW5hbWU6ICJmaWxsIiwKICAJCQkJaXNBdHRyOiB0cnVlLAogIAkJCQl0eXBlOiAiU3RyaW5nIgogIAkJCX0KICAJCV0KICAJfSwKICAJewogIAkJbmFtZTogIkNvbG9yZWRFZGdlIiwKICAJCSJleHRlbmRzIjogWwogIAkJCSJicG1uZGk6QlBNTkVkZ2UiCiAgCQldLAogIAkJcHJvcGVydGllczogWwogIAkJCXsKICAJCQkJbmFtZTogInN0cm9rZSIsCiAgCQkJCWlzQXR0cjogdHJ1ZSwKICAJCQkJdHlwZTogIlN0cmluZyIKICAJCQl9LAogIAkJCXsKICAJCQkJbmFtZTogImZpbGwiLAogIAkJCQlpc0F0dHI6IHRydWUsCiAgCQkJCXR5cGU6ICJTdHJpbmciCiAgCQkJfQogIAkJXQogIAl9CiAgXTsKICB2YXIgZW51bWVyYXRpb25zJDIgPSBbCiAgXTsKICB2YXIgYXNzb2NpYXRpb25zJDQgPSBbCiAgXTsKICB2YXIgQmlvY1BhY2thZ2UgPSB7CiAgCW5hbWU6IG5hbWUkNCwKICAJdXJpOiB1cmkkNCwKICAJcHJlZml4OiBwcmVmaXgkNCwKICAJdHlwZXM6IHR5cGVzJDQsCiAgCWVudW1lcmF0aW9uczogZW51bWVyYXRpb25zJDIsCiAgCWFzc29jaWF0aW9uczogYXNzb2NpYXRpb25zJDQKICB9OwoKICB2YXIgcGFja2FnZXMgPSB7CiAgICBicG1uOiBCcG1uUGFja2FnZSwKICAgIGJwbW5kaTogQnBtbkRpUGFja2FnZSwKICAgIGRjOiBEY1BhY2thZ2UsCiAgICBkaTogRGlQYWNrYWdlLAogICAgYmlvYzogQmlvY1BhY2thZ2UKICB9OwoKICBmdW5jdGlvbiBzaW1wbGUoYWRkaXRpb25hbFBhY2thZ2VzLCBvcHRpb25zKSB7CiAgICB2YXIgcGtzID0gYXNzaWduKHt9LCBwYWNrYWdlcywgYWRkaXRpb25hbFBhY2thZ2VzKTsKCiAgICByZXR1cm4gbmV3IEJwbW5Nb2RkbGUocGtzLCBvcHRpb25zKTsKICB9CgogIGZ1bmN0aW9uIGVsZW1lbnRUb1N0cmluZyhlKSB7CiAgICBpZiAoIWUpIHsKICAgICAgcmV0dXJuICc8bnVsbD4nOwogICAgfQoKICAgIHJldHVybiAnPCcgKyBlLiR0eXBlICsgKGUuaWQgPyAnIGlkPSInICsgZS5pZCA6ICcnKSArICciIC8+JzsKICB9CgogIHZhciBkaVJlZnMgPSBuZXcgb2JqZWN0UmVmcygKICAgIHsgbmFtZTogJ2JwbW5FbGVtZW50JywgZW51bWVyYWJsZTogdHJ1ZSB9LAogICAgeyBuYW1lOiAnZGknLCBjb25maWd1cmFibGU6IHRydWUgfQogICk7CgogIC8qKgogICAqIFJldHVybnMgdHJ1ZSBpZiBhbiBlbGVtZW50IGhhcyB0aGUgZ2l2ZW4gbWV0YS1tb2RlbCB0eXBlCiAgICoKICAgKiBAcGFyYW0gIHtNb2RkbGVFbGVtZW50fSAgZWxlbWVudAogICAqIEBwYXJhbSAge1N0cmluZ30gICAgICAgICB0eXBlCiAgICoKICAgKiBAcmV0dXJuIHtCb29sZWFufQogICAqLwogIGZ1bmN0aW9uIGlzKGVsZW1lbnQsIHR5cGUpIHsKICAgIHJldHVybiBlbGVtZW50LiRpbnN0YW5jZU9mKHR5cGUpOwogIH0KCgogIC8qKgogICAqIEZpbmQgYSBzdWl0YWJsZSBkaXNwbGF5IGNhbmRpZGF0ZSBmb3IgZGVmaW5pdGlvbnMgd2hlcmUgdGhlIERJIGRvZXMgbm90CiAgICogY29ycmVjdGx5IHNwZWNpZnkgb25lLgogICAqLwogIGZ1bmN0aW9uIGZpbmREaXNwbGF5Q2FuZGlkYXRlKGRlZmluaXRpb25zKSB7CiAgICByZXR1cm4gZmluZChkZWZpbml0aW9ucy5yb290RWxlbWVudHMsIGZ1bmN0aW9uKGUpIHsKICAgICAgcmV0dXJuIGlzKGUsICdicG1uOlByb2Nlc3MnKSB8fCBpcyhlLCAnYnBtbjpDb2xsYWJvcmF0aW9uJyk7CiAgICB9KTsKICB9CgoKICBmdW5jdGlvbiBCcG1uVHJlZVdhbGtlcihoYW5kbGVyLCB0cmFuc2xhdGUpIHsKCiAgICAvLyBsaXN0IG9mIGNvbnRhaW5lcnMgYWxyZWFkeSB3YWxrZWQKICAgIHZhciBoYW5kbGVkRWxlbWVudHMgPSB7fTsKCiAgICAvLyBsaXN0IG9mIGVsZW1lbnRzIHRvIGhhbmRsZSBkZWZlcnJlZCB0byBlbnN1cmUKICAgIC8vIHByZXJlcXVpc2l0ZXMgYXJlIGRyYXduCiAgICB2YXIgZGVmZXJyZWQgPSBbXTsKCiAgICAvLyBIZWxwZXJzIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBmdW5jdGlvbiBjb250ZXh0dWFsKGZuLCBjdHgpIHsKICAgICAgcmV0dXJuIGZ1bmN0aW9uKGUpIHsKICAgICAgICBmbihlLCBjdHgpOwogICAgICB9OwogICAgfQoKICAgIGZ1bmN0aW9uIGhhbmRsZWQoZWxlbWVudCkgewogICAgICBoYW5kbGVkRWxlbWVudHNbZWxlbWVudC5pZF0gPSBlbGVtZW50OwogICAgfQoKICAgIGZ1bmN0aW9uIGlzSGFuZGxlZChlbGVtZW50KSB7CiAgICAgIHJldHVybiBoYW5kbGVkRWxlbWVudHNbZWxlbWVudC5pZF07CiAgICB9CgogICAgZnVuY3Rpb24gdmlzaXQoZWxlbWVudCwgY3R4KSB7CgogICAgICB2YXIgZ2Z4ID0gZWxlbWVudC5nZng7CgogICAgICAvLyBhdm9pZCBtdWx0aXBsZSByZW5kZXJpbmcgb2YgZWxlbWVudHMKICAgICAgaWYgKGdmeCkgewogICAgICAgIHRocm93IG5ldyBFcnJvcigKICAgICAgICAgIHRyYW5zbGF0ZSgnYWxyZWFkeSByZW5kZXJlZCB7ZWxlbWVudH0nLCB7IGVsZW1lbnQ6IGVsZW1lbnRUb1N0cmluZyhlbGVtZW50KSB9KQogICAgICAgICk7CiAgICAgIH0KCiAgICAgIC8vIGNhbGwgaGFuZGxlcgogICAgICByZXR1cm4gaGFuZGxlci5lbGVtZW50KGVsZW1lbnQsIGN0eCk7CiAgICB9CgogICAgZnVuY3Rpb24gdmlzaXRSb290KGVsZW1lbnQsIGRpYWdyYW0pIHsKICAgICAgcmV0dXJuIGhhbmRsZXIucm9vdChlbGVtZW50LCBkaWFncmFtKTsKICAgIH0KCiAgICBmdW5jdGlvbiB2aXNpdElmRGkoZWxlbWVudCwgY3R4KSB7CgogICAgICB0cnkgewogICAgICAgIHZhciBnZnggPSBlbGVtZW50LmRpICYmIHZpc2l0KGVsZW1lbnQsIGN0eCk7CgogICAgICAgIGhhbmRsZWQoZWxlbWVudCk7CgogICAgICAgIHJldHVybiBnZng7CiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICBsb2dFcnJvcihlLm1lc3NhZ2UsIHsgZWxlbWVudDogZWxlbWVudCwgZXJyb3I6IGUgfSk7CgogICAgICAgIGNvbnNvbGUuZXJyb3IodHJhbnNsYXRlKCdmYWlsZWQgdG8gaW1wb3J0IHtlbGVtZW50fScsIHsgZWxlbWVudDogZWxlbWVudFRvU3RyaW5nKGVsZW1lbnQpIH0pKTsKICAgICAgICBjb25zb2xlLmVycm9yKGUpOwogICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gbG9nRXJyb3IobWVzc2FnZSwgY29udGV4dCkgewogICAgICBoYW5kbGVyLmVycm9yKG1lc3NhZ2UsIGNvbnRleHQpOwogICAgfQoKICAgIC8vIERJIGhhbmRsaW5nIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBmdW5jdGlvbiByZWdpc3RlckRpKGRpKSB7CiAgICAgIHZhciBicG1uRWxlbWVudCA9IGRpLmJwbW5FbGVtZW50OwoKICAgICAgaWYgKGJwbW5FbGVtZW50KSB7CiAgICAgICAgaWYgKGJwbW5FbGVtZW50LmRpKSB7CiAgICAgICAgICBsb2dFcnJvcigKICAgICAgICAgICAgdHJhbnNsYXRlKCdtdWx0aXBsZSBESSBlbGVtZW50cyBkZWZpbmVkIGZvciB7ZWxlbWVudH0nLCB7CiAgICAgICAgICAgICAgZWxlbWVudDogZWxlbWVudFRvU3RyaW5nKGJwbW5FbGVtZW50KQogICAgICAgICAgICB9KSwKICAgICAgICAgICAgeyBlbGVtZW50OiBicG1uRWxlbWVudCB9CiAgICAgICAgICApOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBkaVJlZnMuYmluZChicG1uRWxlbWVudCwgJ2RpJyk7CiAgICAgICAgICBicG1uRWxlbWVudC5kaSA9IGRpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBsb2dFcnJvcigKICAgICAgICAgIHRyYW5zbGF0ZSgnbm8gYnBtbkVsZW1lbnQgcmVmZXJlbmNlZCBpbiB7ZWxlbWVudH0nLCB7CiAgICAgICAgICAgIGVsZW1lbnQ6IGVsZW1lbnRUb1N0cmluZyhkaSkKICAgICAgICAgIH0pLAogICAgICAgICAgeyBlbGVtZW50OiBkaSB9CiAgICAgICAgKTsKICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGhhbmRsZURpYWdyYW0oZGlhZ3JhbSkgewogICAgICBoYW5kbGVQbGFuZShkaWFncmFtLnBsYW5lKTsKICAgIH0KCiAgICBmdW5jdGlvbiBoYW5kbGVQbGFuZShwbGFuZSkgewogICAgICByZWdpc3RlckRpKHBsYW5lKTsKCiAgICAgIGZvckVhY2gocGxhbmUucGxhbmVFbGVtZW50LCBoYW5kbGVQbGFuZUVsZW1lbnQpOwogICAgfQoKICAgIGZ1bmN0aW9uIGhhbmRsZVBsYW5lRWxlbWVudChwbGFuZUVsZW1lbnQpIHsKICAgICAgcmVnaXN0ZXJEaShwbGFuZUVsZW1lbnQpOwogICAgfQoKCiAgICAvLyBTZW1hbnRpYyBoYW5kbGluZyAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgLyoqCiAgICAgKiBIYW5kbGUgZGVmaW5pdGlvbnMgYW5kIHJldHVybiB0aGUgcmVuZGVyZWQgZGlhZ3JhbSAoaWYgYW55KQogICAgICoKICAgICAqIEBwYXJhbSB7TW9kZGxlRWxlbWVudH0gZGVmaW5pdGlvbnMgdG8gd2FsayBhbmQgaW1wb3J0CiAgICAgKiBAcGFyYW0ge01vZGRsZUVsZW1lbnR9IFtkaWFncmFtXSBzcGVjaWZpYyBkaWFncmFtIHRvIGltcG9ydCBhbmQgZGlzcGxheQogICAgICoKICAgICAqIEB0aHJvd3Mge0Vycm9yfSBpZiBubyBkaWFncmFtIHRvIGRpc3BsYXkgY291bGQgYmUgZm91bmQKICAgICAqLwogICAgZnVuY3Rpb24gaGFuZGxlRGVmaW5pdGlvbnMoZGVmaW5pdGlvbnMsIGRpYWdyYW0pIHsKCiAgICAgIC8vIG1ha2Ugc3VyZSB3ZSB3YWxrIHRoZSBjb3JyZWN0IGJwbW5FbGVtZW50CgogICAgICB2YXIgZGlhZ3JhbXMgPSBkZWZpbml0aW9ucy5kaWFncmFtczsKCiAgICAgIGlmIChkaWFncmFtICYmIGRpYWdyYW1zLmluZGV4T2YoZGlhZ3JhbSkgPT09IC0xKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKHRyYW5zbGF0ZSgnZGlhZ3JhbSBub3QgcGFydCBvZiBicG1uOkRlZmluaXRpb25zJykpOwogICAgICB9CgogICAgICBpZiAoIWRpYWdyYW0gJiYgZGlhZ3JhbXMgJiYgZGlhZ3JhbXMubGVuZ3RoKSB7CiAgICAgICAgZGlhZ3JhbSA9IGRpYWdyYW1zWzBdOwogICAgICB9CgogICAgICAvLyBubyBkaWFncmFtIC0+IG5vdGhpbmcgdG8gaW1wb3J0CiAgICAgIGlmICghZGlhZ3JhbSkgewogICAgICAgIHRocm93IG5ldyBFcnJvcih0cmFuc2xhdGUoJ25vIGRpYWdyYW0gdG8gZGlzcGxheScpKTsKICAgICAgfQoKICAgICAgLy8gbG9hZCBESSBmcm9tIHNlbGVjdGVkIGRpYWdyYW0gb25seQogICAgICBoYW5kbGVEaWFncmFtKGRpYWdyYW0pOwoKCiAgICAgIHZhciBwbGFuZSA9IGRpYWdyYW0ucGxhbmU7CgogICAgICBpZiAoIXBsYW5lKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKHRyYW5zbGF0ZSgKICAgICAgICAgICdubyBwbGFuZSBmb3Ige2VsZW1lbnR9JywKICAgICAgICAgIHsgZWxlbWVudDogZWxlbWVudFRvU3RyaW5nKGRpYWdyYW0pIH0KICAgICAgICApKTsKICAgICAgfQoKICAgICAgdmFyIHJvb3RFbGVtZW50ID0gcGxhbmUuYnBtbkVsZW1lbnQ7CgogICAgICAvLyBlbnN1cmUgd2UgZGVmYXVsdCB0byBhIHN1aXRhYmxlIGRpc3BsYXkgY2FuZGlkYXRlIChwcm9jZXNzIG9yIGNvbGxhYm9yYXRpb24pLAogICAgICAvLyBldmVuIGlmIG5vbiBpcyBzcGVjaWZpZWQgaW4gREkKICAgICAgaWYgKCFyb290RWxlbWVudCkgewogICAgICAgIHJvb3RFbGVtZW50ID0gZmluZERpc3BsYXlDYW5kaWRhdGUoZGVmaW5pdGlvbnMpOwoKICAgICAgICBpZiAoIXJvb3RFbGVtZW50KSB7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IodHJhbnNsYXRlKCdubyBwcm9jZXNzIG9yIGNvbGxhYm9yYXRpb24gdG8gZGlzcGxheScpKTsKICAgICAgICB9IGVsc2UgewoKICAgICAgICAgIGxvZ0Vycm9yKAogICAgICAgICAgICB0cmFuc2xhdGUoJ2NvcnJlY3RpbmcgbWlzc2luZyBicG1uRWxlbWVudCBvbiB7cGxhbmV9IHRvIHtyb290RWxlbWVudH0nLCB7CiAgICAgICAgICAgICAgcGxhbmU6IGVsZW1lbnRUb1N0cmluZyhwbGFuZSksCiAgICAgICAgICAgICAgcm9vdEVsZW1lbnQ6IGVsZW1lbnRUb1N0cmluZyhyb290RWxlbWVudCkKICAgICAgICAgICAgfSkKICAgICAgICAgICk7CgogICAgICAgICAgLy8gY29ycmVjdCBESSBvbiB0aGUgZmx5CiAgICAgICAgICBwbGFuZS5icG1uRWxlbWVudCA9IHJvb3RFbGVtZW50OwogICAgICAgICAgcmVnaXN0ZXJEaShwbGFuZSk7CiAgICAgICAgfQogICAgICB9CgoKICAgICAgdmFyIGN0eCA9IHZpc2l0Um9vdChyb290RWxlbWVudCwgcGxhbmUpOwoKICAgICAgaWYgKGlzKHJvb3RFbGVtZW50LCAnYnBtbjpQcm9jZXNzJykpIHsKICAgICAgICBoYW5kbGVQcm9jZXNzKHJvb3RFbGVtZW50LCBjdHgpOwogICAgICB9IGVsc2UgaWYgKGlzKHJvb3RFbGVtZW50LCAnYnBtbjpDb2xsYWJvcmF0aW9uJykpIHsKICAgICAgICBoYW5kbGVDb2xsYWJvcmF0aW9uKHJvb3RFbGVtZW50KTsKCiAgICAgICAgLy8gZm9yY2UgZHJhd2luZyBvZiBldmVyeXRoaW5nIG5vdCB5ZXQgZHJhd24gdGhhdCBpcyBwYXJ0IG9mIHRoZSB0YXJnZXQgREkKICAgICAgICBoYW5kbGVVbmhhbmRsZWRQcm9jZXNzZXMoZGVmaW5pdGlvbnMucm9vdEVsZW1lbnRzLCBjdHgpOwogICAgICB9IGVsc2UgewogICAgICAgIHRocm93IG5ldyBFcnJvcigKICAgICAgICAgIHRyYW5zbGF0ZSgndW5zdXBwb3J0ZWQgYnBtbkVsZW1lbnQgZm9yIHtwbGFuZX06IHtyb290RWxlbWVudH0nLCB7CiAgICAgICAgICAgIHBsYW5lOiBlbGVtZW50VG9TdHJpbmcocGxhbmUpLAogICAgICAgICAgICByb290RWxlbWVudDogZWxlbWVudFRvU3RyaW5nKHJvb3RFbGVtZW50KQogICAgICAgICAgfSkKICAgICAgICApOwogICAgICB9CgogICAgICAvLyBoYW5kbGUgYWxsIGRlZmVycmVkIGVsZW1lbnRzCiAgICAgIGhhbmRsZURlZmVycmVkKCk7CiAgICB9CgogICAgZnVuY3Rpb24gaGFuZGxlRGVmZXJyZWQoKSB7CgogICAgICB2YXIgZm47CgogICAgICAvLyBkcmFpbiBkZWZlcnJlZCB1bnRpbCBlbXB0eQogICAgICB3aGlsZSAoZGVmZXJyZWQubGVuZ3RoKSB7CiAgICAgICAgZm4gPSBkZWZlcnJlZC5zaGlmdCgpOwoKICAgICAgICBmbigpOwogICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gaGFuZGxlUHJvY2Vzcyhwcm9jZXNzLCBjb250ZXh0KSB7CiAgICAgIGhhbmRsZUZsb3dFbGVtZW50c0NvbnRhaW5lcihwcm9jZXNzLCBjb250ZXh0KTsKICAgICAgaGFuZGxlSW9TcGVjaWZpY2F0aW9uKHByb2Nlc3MuaW9TcGVjaWZpY2F0aW9uLCBjb250ZXh0KTsKCiAgICAgIGhhbmRsZUFydGlmYWN0cyhwcm9jZXNzLmFydGlmYWN0cywgY29udGV4dCk7CgogICAgICAvLyBsb2cgcHJvY2VzcyBoYW5kbGVkCiAgICAgIGhhbmRsZWQocHJvY2Vzcyk7CiAgICB9CgogICAgZnVuY3Rpb24gaGFuZGxlVW5oYW5kbGVkUHJvY2Vzc2VzKHJvb3RFbGVtZW50cywgY3R4KSB7CgogICAgICAvLyB3YWxrIHRocm91Z2ggYWxsIHByb2Nlc3NlcyB0aGF0IGhhdmUgbm90IHlldCBiZWVuIGRyYXduIGFuZCBkcmF3IHRoZW0KICAgICAgLy8gaWYgdGhleSBjb250YWluIGxhbmVzIHdpdGggREkgaW5mb3JtYXRpb24uCiAgICAgIC8vIHdlIGRvIHRoaXMgdG8gcGFzcyB0aGUgZnJlZS1mbG9hdGluZyBsYW5lIHRlc3QgY2FzZXMgaW4gdGhlIE1JV0cgdGVzdCBzdWl0ZQogICAgICB2YXIgcHJvY2Vzc2VzID0gZmlsdGVyKHJvb3RFbGVtZW50cywgZnVuY3Rpb24oZSkgewogICAgICAgIHJldHVybiAhaXNIYW5kbGVkKGUpICYmIGlzKGUsICdicG1uOlByb2Nlc3MnKSAmJiBlLmxhbmVTZXRzOwogICAgICB9KTsKCiAgICAgIHByb2Nlc3Nlcy5mb3JFYWNoKGNvbnRleHR1YWwoaGFuZGxlUHJvY2VzcywgY3R4KSk7CiAgICB9CgogICAgZnVuY3Rpb24gaGFuZGxlTWVzc2FnZUZsb3cobWVzc2FnZUZsb3csIGNvbnRleHQpIHsKICAgICAgdmlzaXRJZkRpKG1lc3NhZ2VGbG93LCBjb250ZXh0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBoYW5kbGVNZXNzYWdlRmxvd3MobWVzc2FnZUZsb3dzLCBjb250ZXh0KSB7CiAgICAgIGZvckVhY2gobWVzc2FnZUZsb3dzLCBjb250ZXh0dWFsKGhhbmRsZU1lc3NhZ2VGbG93LCBjb250ZXh0KSk7CiAgICB9CgogICAgZnVuY3Rpb24gaGFuZGxlRGF0YUFzc29jaWF0aW9uKGFzc29jaWF0aW9uLCBjb250ZXh0KSB7CiAgICAgIHZpc2l0SWZEaShhc3NvY2lhdGlvbiwgY29udGV4dCk7CiAgICB9CgogICAgZnVuY3Rpb24gaGFuZGxlRGF0YUlucHV0KGRhdGFJbnB1dCwgY29udGV4dCkgewogICAgICB2aXNpdElmRGkoZGF0YUlucHV0LCBjb250ZXh0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBoYW5kbGVEYXRhT3V0cHV0KGRhdGFPdXRwdXQsIGNvbnRleHQpIHsKICAgICAgdmlzaXRJZkRpKGRhdGFPdXRwdXQsIGNvbnRleHQpOwogICAgfQoKICAgIGZ1bmN0aW9uIGhhbmRsZUFydGlmYWN0KGFydGlmYWN0LCBjb250ZXh0KSB7CgogICAgICAvLyBicG1uOlRleHRBbm5vdGF0aW9uCiAgICAgIC8vIGJwbW46R3JvdXAKICAgICAgLy8gYnBtbjpBc3NvY2lhdGlvbgoKICAgICAgdmlzaXRJZkRpKGFydGlmYWN0LCBjb250ZXh0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBoYW5kbGVBcnRpZmFjdHMoYXJ0aWZhY3RzLCBjb250ZXh0KSB7CgogICAgICBmb3JFYWNoKGFydGlmYWN0cywgZnVuY3Rpb24oZSkgewogICAgICAgIGlmIChpcyhlLCAnYnBtbjpBc3NvY2lhdGlvbicpKSB7CiAgICAgICAgICBkZWZlcnJlZC5wdXNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICBoYW5kbGVBcnRpZmFjdChlLCBjb250ZXh0KTsKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBoYW5kbGVBcnRpZmFjdChlLCBjb250ZXh0KTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQoKICAgIGZ1bmN0aW9uIGhhbmRsZUlvU3BlY2lmaWNhdGlvbihpb1NwZWNpZmljYXRpb24sIGNvbnRleHQpIHsKCiAgICAgIGlmICghaW9TcGVjaWZpY2F0aW9uKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBmb3JFYWNoKGlvU3BlY2lmaWNhdGlvbi5kYXRhSW5wdXRzLCBjb250ZXh0dWFsKGhhbmRsZURhdGFJbnB1dCwgY29udGV4dCkpOwogICAgICBmb3JFYWNoKGlvU3BlY2lmaWNhdGlvbi5kYXRhT3V0cHV0cywgY29udGV4dHVhbChoYW5kbGVEYXRhT3V0cHV0LCBjb250ZXh0KSk7CiAgICB9CgogICAgZnVuY3Rpb24gaGFuZGxlU3ViUHJvY2VzcyhzdWJQcm9jZXNzLCBjb250ZXh0KSB7CiAgICAgIGhhbmRsZUZsb3dFbGVtZW50c0NvbnRhaW5lcihzdWJQcm9jZXNzLCBjb250ZXh0KTsKICAgICAgaGFuZGxlQXJ0aWZhY3RzKHN1YlByb2Nlc3MuYXJ0aWZhY3RzLCBjb250ZXh0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBoYW5kbGVGbG93Tm9kZShmbG93Tm9kZSwgY29udGV4dCkgewogICAgICB2YXIgY2hpbGRDdHggPSB2aXNpdElmRGkoZmxvd05vZGUsIGNvbnRleHQpOwoKICAgICAgaWYgKGlzKGZsb3dOb2RlLCAnYnBtbjpTdWJQcm9jZXNzJykpIHsKICAgICAgICBoYW5kbGVTdWJQcm9jZXNzKGZsb3dOb2RlLCBjaGlsZEN0eCB8fCBjb250ZXh0KTsKICAgICAgfQoKICAgICAgaWYgKGlzKGZsb3dOb2RlLCAnYnBtbjpBY3Rpdml0eScpKSB7CiAgICAgICAgaGFuZGxlSW9TcGVjaWZpY2F0aW9uKGZsb3dOb2RlLmlvU3BlY2lmaWNhdGlvbiwgY29udGV4dCk7CiAgICAgIH0KCiAgICAgIC8vIGRlZmVyIGhhbmRsaW5nIG9mIGFzc29jaWF0aW9ucwogICAgICAvLyBhZmZlY3RlZCB0eXBlczoKICAgICAgLy8KICAgICAgLy8gICAqIGJwbW46QWN0aXZpdHkKICAgICAgLy8gICAqIGJwbW46VGhyb3dFdmVudAogICAgICAvLyAgICogYnBtbjpDYXRjaEV2ZW50CiAgICAgIC8vCiAgICAgIGRlZmVycmVkLnB1c2goZnVuY3Rpb24oKSB7CiAgICAgICAgZm9yRWFjaChmbG93Tm9kZS5kYXRhSW5wdXRBc3NvY2lhdGlvbnMsIGNvbnRleHR1YWwoaGFuZGxlRGF0YUFzc29jaWF0aW9uLCBjb250ZXh0KSk7CiAgICAgICAgZm9yRWFjaChmbG93Tm9kZS5kYXRhT3V0cHV0QXNzb2NpYXRpb25zLCBjb250ZXh0dWFsKGhhbmRsZURhdGFBc3NvY2lhdGlvbiwgY29udGV4dCkpOwogICAgICB9KTsKICAgIH0KCiAgICBmdW5jdGlvbiBoYW5kbGVTZXF1ZW5jZUZsb3coc2VxdWVuY2VGbG93LCBjb250ZXh0KSB7CiAgICAgIHZpc2l0SWZEaShzZXF1ZW5jZUZsb3csIGNvbnRleHQpOwogICAgfQoKICAgIGZ1bmN0aW9uIGhhbmRsZURhdGFFbGVtZW50KGRhdGFPYmplY3QsIGNvbnRleHQpIHsKICAgICAgdmlzaXRJZkRpKGRhdGFPYmplY3QsIGNvbnRleHQpOwogICAgfQoKICAgIGZ1bmN0aW9uIGhhbmRsZUxhbmUobGFuZSwgY29udGV4dCkgewoKICAgICAgZGVmZXJyZWQucHVzaChmdW5jdGlvbigpIHsKCiAgICAgICAgdmFyIG5ld0NvbnRleHQgPSB2aXNpdElmRGkobGFuZSwgY29udGV4dCk7CgogICAgICAgIGlmIChsYW5lLmNoaWxkTGFuZVNldCkgewogICAgICAgICAgaGFuZGxlTGFuZVNldChsYW5lLmNoaWxkTGFuZVNldCwgbmV3Q29udGV4dCB8fCBjb250ZXh0KTsKICAgICAgICB9CgogICAgICAgIHdpcmVGbG93Tm9kZVJlZnMobGFuZSk7CiAgICAgIH0pOwogICAgfQoKICAgIGZ1bmN0aW9uIGhhbmRsZUxhbmVTZXQobGFuZVNldCwgY29udGV4dCkgewogICAgICBmb3JFYWNoKGxhbmVTZXQubGFuZXMsIGNvbnRleHR1YWwoaGFuZGxlTGFuZSwgY29udGV4dCkpOwogICAgfQoKICAgIGZ1bmN0aW9uIGhhbmRsZUxhbmVTZXRzKGxhbmVTZXRzLCBjb250ZXh0KSB7CiAgICAgIGZvckVhY2gobGFuZVNldHMsIGNvbnRleHR1YWwoaGFuZGxlTGFuZVNldCwgY29udGV4dCkpOwogICAgfQoKICAgIGZ1bmN0aW9uIGhhbmRsZUZsb3dFbGVtZW50c0NvbnRhaW5lcihjb250YWluZXIsIGNvbnRleHQpIHsKICAgICAgaGFuZGxlRmxvd0VsZW1lbnRzKGNvbnRhaW5lci5mbG93RWxlbWVudHMsIGNvbnRleHQpOwoKICAgICAgaWYgKGNvbnRhaW5lci5sYW5lU2V0cykgewogICAgICAgIGhhbmRsZUxhbmVTZXRzKGNvbnRhaW5lci5sYW5lU2V0cywgY29udGV4dCk7CiAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBoYW5kbGVGbG93RWxlbWVudHMoZmxvd0VsZW1lbnRzLCBjb250ZXh0KSB7CiAgICAgIGZvckVhY2goZmxvd0VsZW1lbnRzLCBmdW5jdGlvbihlKSB7CiAgICAgICAgaWYgKGlzKGUsICdicG1uOlNlcXVlbmNlRmxvdycpKSB7CiAgICAgICAgICBkZWZlcnJlZC5wdXNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICBoYW5kbGVTZXF1ZW5jZUZsb3coZSwgY29udGV4dCk7CiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgaWYgKGlzKGUsICdicG1uOkJvdW5kYXJ5RXZlbnQnKSkgewogICAgICAgICAgZGVmZXJyZWQudW5zaGlmdChmdW5jdGlvbigpIHsKICAgICAgICAgICAgaGFuZGxlRmxvd05vZGUoZSwgY29udGV4dCk7CiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgaWYgKGlzKGUsICdicG1uOkZsb3dOb2RlJykpIHsKICAgICAgICAgIGhhbmRsZUZsb3dOb2RlKGUsIGNvbnRleHQpOwogICAgICAgIH0gZWxzZSBpZiAoaXMoZSwgJ2JwbW46RGF0YU9iamVjdCcpKSA7IGVsc2UgaWYgKGlzKGUsICdicG1uOkRhdGFTdG9yZVJlZmVyZW5jZScpKSB7CiAgICAgICAgICBoYW5kbGVEYXRhRWxlbWVudChlLCBjb250ZXh0KTsKICAgICAgICB9IGVsc2UgaWYgKGlzKGUsICdicG1uOkRhdGFPYmplY3RSZWZlcmVuY2UnKSkgewogICAgICAgICAgaGFuZGxlRGF0YUVsZW1lbnQoZSwgY29udGV4dCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGxvZ0Vycm9yKAogICAgICAgICAgICB0cmFuc2xhdGUoJ3VucmVjb2duaXplZCBmbG93RWxlbWVudCB7ZWxlbWVudH0gaW4gY29udGV4dCB7Y29udGV4dH0nLCB7CiAgICAgICAgICAgICAgZWxlbWVudDogZWxlbWVudFRvU3RyaW5nKGUpLAogICAgICAgICAgICAgIGNvbnRleHQ6IChjb250ZXh0ID8gZWxlbWVudFRvU3RyaW5nKGNvbnRleHQuYnVzaW5lc3NPYmplY3QpIDogJ251bGwnKQogICAgICAgICAgICB9KSwKICAgICAgICAgICAgeyBlbGVtZW50OiBlLCBjb250ZXh0OiBjb250ZXh0IH0KICAgICAgICAgICk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KCiAgICBmdW5jdGlvbiBoYW5kbGVQYXJ0aWNpcGFudChwYXJ0aWNpcGFudCwgY29udGV4dCkgewogICAgICB2YXIgbmV3Q3R4ID0gdmlzaXRJZkRpKHBhcnRpY2lwYW50LCBjb250ZXh0KTsKCiAgICAgIHZhciBwcm9jZXNzID0gcGFydGljaXBhbnQucHJvY2Vzc1JlZjsKICAgICAgaWYgKHByb2Nlc3MpIHsKICAgICAgICBoYW5kbGVQcm9jZXNzKHByb2Nlc3MsIG5ld0N0eCB8fCBjb250ZXh0KTsKICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGhhbmRsZUNvbGxhYm9yYXRpb24oY29sbGFib3JhdGlvbikgewoKICAgICAgZm9yRWFjaChjb2xsYWJvcmF0aW9uLnBhcnRpY2lwYW50cywgY29udGV4dHVhbChoYW5kbGVQYXJ0aWNpcGFudCkpOwoKICAgICAgaGFuZGxlQXJ0aWZhY3RzKGNvbGxhYm9yYXRpb24uYXJ0aWZhY3RzKTsKCiAgICAgIC8vIGhhbmRsZSBtZXNzYWdlIGZsb3dzIGxhdGVzdCBpbiB0aGUgcHJvY2VzcwogICAgICBkZWZlcnJlZC5wdXNoKGZ1bmN0aW9uKCkgewogICAgICAgIGhhbmRsZU1lc3NhZ2VGbG93cyhjb2xsYWJvcmF0aW9uLm1lc3NhZ2VGbG93cyk7CiAgICAgIH0pOwogICAgfQoKCiAgICBmdW5jdGlvbiB3aXJlRmxvd05vZGVSZWZzKGxhbmUpIHsKCiAgICAgIC8vIHdpcmUgdGhlIHZpcnR1YWwgZmxvd05vZGVSZWZzIDwtPiByZWxhdGlvbnNoaXAKICAgICAgZm9yRWFjaChsYW5lLmZsb3dOb2RlUmVmLCBmdW5jdGlvbihmbG93Tm9kZSkgewogICAgICAgIHZhciBsYW5lcyA9IGZsb3dOb2RlLmdldCgnbGFuZXMnKTsKCiAgICAgICAgaWYgKGxhbmVzKSB7CiAgICAgICAgICBsYW5lcy5wdXNoKGxhbmUpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CgogICAgLy8gQVBJIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICByZXR1cm4gewogICAgICBoYW5kbGVEZWZlcnJlZDogaGFuZGxlRGVmZXJyZWQsCiAgICAgIGhhbmRsZURlZmluaXRpb25zOiBoYW5kbGVEZWZpbml0aW9ucywKICAgICAgaGFuZGxlU3ViUHJvY2VzczogaGFuZGxlU3ViUHJvY2VzcywKICAgICAgcmVnaXN0ZXJEaTogcmVnaXN0ZXJEaQogICAgfTsKICB9CgogIC8qKgogICAqIEltcG9ydCB0aGUgZGVmaW5pdGlvbnMgaW50byBhIGRpYWdyYW0uCiAgICoKICAgKiBFcnJvcnMgYW5kIHdhcm5pbmdzIGFyZSByZXBvcnRlZCB0aHJvdWdoIHRoZSBzcGVjaWZpZWQgY2FsbGJhY2suCiAgICoKICAgKiBAcGFyYW0gIHtkanMuRGlhZ3JhbX0gZGlhZ3JhbQogICAqIEBwYXJhbSAge01vZGRsZUVsZW1lbnQ8RGVmaW5pdGlvbnM+fSBkZWZpbml0aW9ucwogICAqIEBwYXJhbSAge01vZGRsZUVsZW1lbnQ8QlBNTkRpYWdyYW0+fSBbYnBtbkRpYWdyYW1dIHRoZSBkaWFncmFtIHRvIGJlIHJlbmRlcmVkCiAgICogKGlmIG5vdCBwcm92aWRlZCwgdGhlIGZpcnN0IG9uZSB3aWxsIGJlIHJlbmRlcmVkKQogICAqIEBwYXJhbSAge0Z1bmN0aW9ufSBkb25lIHRoZSBjYWxsYmFjaywgaW52b2tlZCB3aXRoIChlcnIsIFsgd2FybmluZyBdKSBvbmNlIHRoZSBpbXBvcnQgaXMgZG9uZQogICAqLwogIGZ1bmN0aW9uIGltcG9ydEJwbW5EaWFncmFtKGRpYWdyYW0sIGRlZmluaXRpb25zLCBicG1uRGlhZ3JhbSwgZG9uZSkgewoKICAgIGlmIChpc0Z1bmN0aW9uKGJwbW5EaWFncmFtKSkgewogICAgICBkb25lID0gYnBtbkRpYWdyYW07CiAgICAgIGJwbW5EaWFncmFtID0gbnVsbDsKICAgIH0KCiAgICB2YXIgaW1wb3J0ZXIsCiAgICAgICAgZXZlbnRCdXMsCiAgICAgICAgdHJhbnNsYXRlOwoKICAgIHZhciBlcnJvciwKICAgICAgICB3YXJuaW5ncyA9IFtdOwoKICAgIC8qKgogICAgICogV2FsayB0aGUgZGlhZ3JhbSBzZW1hbnRpY2FsbHksIGltcG9ydGluZyAoPWRyYXdpbmcpCiAgICAgKiBhbGwgZWxlbWVudHMgeW91IGVuY291bnRlci4KICAgICAqCiAgICAgKiBAcGFyYW0ge01vZGRsZUVsZW1lbnQ8RGVmaW5pdGlvbnM+fSBkZWZpbml0aW9ucwogICAgICogQHBhcmFtIHtNb2RkbGVFbGVtZW50PEJQTU5EaWFncmFtPn0gYnBtbkRpYWdyYW0KICAgICAqLwogICAgZnVuY3Rpb24gcmVuZGVyKGRlZmluaXRpb25zLCBicG1uRGlhZ3JhbSkgewoKICAgICAgdmFyIHZpc2l0b3IgPSB7CgogICAgICAgIHJvb3Q6IGZ1bmN0aW9uKGVsZW1lbnQpIHsKICAgICAgICAgIHJldHVybiBpbXBvcnRlci5hZGQoZWxlbWVudCk7CiAgICAgICAgfSwKCiAgICAgICAgZWxlbWVudDogZnVuY3Rpb24oZWxlbWVudCwgcGFyZW50U2hhcGUpIHsKICAgICAgICAgIHJldHVybiBpbXBvcnRlci5hZGQoZWxlbWVudCwgcGFyZW50U2hhcGUpOwogICAgICAgIH0sCgogICAgICAgIGVycm9yOiBmdW5jdGlvbihtZXNzYWdlLCBjb250ZXh0KSB7CiAgICAgICAgICB3YXJuaW5ncy5wdXNoKHsgbWVzc2FnZTogbWVzc2FnZSwgY29udGV4dDogY29udGV4dCB9KTsKICAgICAgICB9CiAgICAgIH07CgogICAgICB2YXIgd2Fsa2VyID0gbmV3IEJwbW5UcmVlV2Fsa2VyKHZpc2l0b3IsIHRyYW5zbGF0ZSk7CgogICAgICAvLyB0cmF2ZXJzZSBCUE1OIDIuMCBkb2N1bWVudCBtb2RlbCwKICAgICAgLy8gc3RhcnRpbmcgYXQgZGVmaW5pdGlvbnMKICAgICAgd2Fsa2VyLmhhbmRsZURlZmluaXRpb25zKGRlZmluaXRpb25zLCBicG1uRGlhZ3JhbSk7CiAgICB9CgogICAgdHJ5IHsKICAgICAgaW1wb3J0ZXIgPSBkaWFncmFtLmdldCgnYnBtbkltcG9ydGVyJyk7CiAgICAgIGV2ZW50QnVzID0gZGlhZ3JhbS5nZXQoJ2V2ZW50QnVzJyk7CiAgICAgIHRyYW5zbGF0ZSA9IGRpYWdyYW0uZ2V0KCd0cmFuc2xhdGUnKTsKCiAgICAgIGV2ZW50QnVzLmZpcmUoJ2ltcG9ydC5yZW5kZXIuc3RhcnQnLCB7IGRlZmluaXRpb25zOiBkZWZpbml0aW9ucyB9KTsKCiAgICAgIHJlbmRlcihkZWZpbml0aW9ucywgYnBtbkRpYWdyYW0pOwoKICAgICAgZXZlbnRCdXMuZmlyZSgnaW1wb3J0LnJlbmRlci5jb21wbGV0ZScsIHsKICAgICAgICBlcnJvcjogZXJyb3IsCiAgICAgICAgd2FybmluZ3M6IHdhcm5pbmdzCiAgICAgIH0pOwogICAgfSBjYXRjaCAoZSkgewogICAgICBlcnJvciA9IGU7CiAgICB9CgogICAgZG9uZShlcnJvciwgd2FybmluZ3MpOwogIH0KCiAgLyoqCiAgICogSXMgYW4gZWxlbWVudCBvZiB0aGUgZ2l2ZW4gQlBNTiB0eXBlPwogICAqCiAgICogQHBhcmFtICB7ZGpzLm1vZGVsLkJhc2V8TW9kZGxlRWxlbWVudH0gZWxlbWVudAogICAqIEBwYXJhbSAge1N0cmluZ30gdHlwZQogICAqCiAgICogQHJldHVybiB7Qm9vbGVhbn0KICAgKi8KICBmdW5jdGlvbiBpcyQxKGVsZW1lbnQsIHR5cGUpIHsKICAgIHZhciBibyA9IGdldEJ1c2luZXNzT2JqZWN0KGVsZW1lbnQpOwoKICAgIHJldHVybiBibyAmJiAodHlwZW9mIGJvLiRpbnN0YW5jZU9mID09PSAnZnVuY3Rpb24nKSAmJiBiby4kaW5zdGFuY2VPZih0eXBlKTsKICB9CgoKICAvKioKICAgKiBSZXR1cm4gdGhlIGJ1c2luZXNzIG9iamVjdCBmb3IgYSBnaXZlbiBlbGVtZW50LgogICAqCiAgICogQHBhcmFtICB7ZGpzLm1vZGVsLkJhc2V8TW9kZGxlRWxlbWVudH0gZWxlbWVudAogICAqCiAgICogQHJldHVybiB7TW9kZGxlRWxlbWVudH0KICAgKi8KICBmdW5jdGlvbiBnZXRCdXNpbmVzc09iamVjdChlbGVtZW50KSB7CiAgICByZXR1cm4gKGVsZW1lbnQgJiYgZWxlbWVudC5idXNpbmVzc09iamVjdCkgfHwgZWxlbWVudDsKICB9CgogIGZ1bmN0aW9uIGlzRXhwYW5kZWQoZWxlbWVudCkgewoKICAgIGlmIChpcyQxKGVsZW1lbnQsICdicG1uOkNhbGxBY3Rpdml0eScpKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBpZiAoaXMkMShlbGVtZW50LCAnYnBtbjpTdWJQcm9jZXNzJykpIHsKICAgICAgcmV0dXJuICEhZ2V0QnVzaW5lc3NPYmplY3QoZWxlbWVudCkuZGkuaXNFeHBhbmRlZDsKICAgIH0KCiAgICBpZiAoaXMkMShlbGVtZW50LCAnYnBtbjpQYXJ0aWNpcGFudCcpKSB7CiAgICAgIHJldHVybiAhIWdldEJ1c2luZXNzT2JqZWN0KGVsZW1lbnQpLnByb2Nlc3NSZWY7CiAgICB9CgogICAgcmV0dXJuIHRydWU7CiAgfQoKICBmdW5jdGlvbiBpc0V2ZW50U3ViUHJvY2VzcyhlbGVtZW50KSB7CiAgICByZXR1cm4gZWxlbWVudCAmJiAhIWdldEJ1c2luZXNzT2JqZWN0KGVsZW1lbnQpLnRyaWdnZXJlZEJ5RXZlbnQ7CiAgfQoKICBmdW5jdGlvbiBnZXRMYWJlbEF0dHIoc2VtYW50aWMpIHsKICAgIGlmICgKICAgICAgaXMkMShzZW1hbnRpYywgJ2JwbW46Rmxvd0VsZW1lbnQnKSB8fAogICAgICBpcyQxKHNlbWFudGljLCAnYnBtbjpQYXJ0aWNpcGFudCcpIHx8CiAgICAgIGlzJDEoc2VtYW50aWMsICdicG1uOkxhbmUnKSB8fAogICAgICBpcyQxKHNlbWFudGljLCAnYnBtbjpTZXF1ZW5jZUZsb3cnKSB8fAogICAgICBpcyQxKHNlbWFudGljLCAnYnBtbjpNZXNzYWdlRmxvdycpIHx8CiAgICAgIGlzJDEoc2VtYW50aWMsICdicG1uOkRhdGFJbnB1dCcpIHx8CiAgICAgIGlzJDEoc2VtYW50aWMsICdicG1uOkRhdGFPdXRwdXQnKQogICAgKSB7CiAgICAgIHJldHVybiAnbmFtZSc7CiAgICB9CgogICAgaWYgKGlzJDEoc2VtYW50aWMsICdicG1uOlRleHRBbm5vdGF0aW9uJykpIHsKICAgICAgcmV0dXJuICd0ZXh0JzsKICAgIH0KCiAgICBpZiAoaXMkMShzZW1hbnRpYywgJ2JwbW46R3JvdXAnKSkgewogICAgICByZXR1cm4gJ2NhdGVnb3J5VmFsdWVSZWYnOwogICAgfQogIH0KCiAgZnVuY3Rpb24gZ2V0Q2F0ZWdvcnlWYWx1ZShzZW1hbnRpYykgewogICAgdmFyIGNhdGVnb3J5VmFsdWVSZWYgPSBzZW1hbnRpY1snY2F0ZWdvcnlWYWx1ZVJlZiddOwoKICAgIGlmICghY2F0ZWdvcnlWYWx1ZVJlZikgewogICAgICByZXR1cm4gJyc7CiAgICB9CgoKICAgIHJldHVybiBjYXRlZ29yeVZhbHVlUmVmLnZhbHVlIHx8ICcnOwogIH0KCiAgZnVuY3Rpb24gZ2V0TGFiZWwoZWxlbWVudCkgewogICAgdmFyIHNlbWFudGljID0gZWxlbWVudC5idXNpbmVzc09iamVjdCwKICAgICAgICBhdHRyID0gZ2V0TGFiZWxBdHRyKHNlbWFudGljKTsKCiAgICBpZiAoYXR0cikgewoKICAgICAgaWYgKGF0dHIgPT09ICdjYXRlZ29yeVZhbHVlUmVmJykgewoKICAgICAgICByZXR1cm4gZ2V0Q2F0ZWdvcnlWYWx1ZShzZW1hbnRpYyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBzZW1hbnRpY1thdHRyXSB8fCAnJzsKICAgIH0KICB9CgogIC8vIGVsZW1lbnQgdXRpbHMgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAvKioKICAgKiBDaGVja3MgaWYgZXZlbnREZWZpbml0aW9uIG9mIHRoZSBnaXZlbiBlbGVtZW50IG1hdGNoZXMgd2l0aCBzZW1hbnRpYyB0eXBlLgogICAqCiAgICogQHJldHVybiB7Ym9vbGVhbn0gdHJ1ZSBpZiBlbGVtZW50IGlzIG9mIHRoZSBnaXZlbiBzZW1hbnRpYyB0eXBlCiAgICovCiAgZnVuY3Rpb24gaXNUeXBlZEV2ZW50KGV2ZW50LCBldmVudERlZmluaXRpb25UeXBlLCBmaWx0ZXIpIHsKCiAgICBmdW5jdGlvbiBtYXRjaGVzKGRlZmluaXRpb24sIGZpbHRlcikgewogICAgICByZXR1cm4gZXZlcnkoZmlsdGVyLCBmdW5jdGlvbih2YWwsIGtleSkgewoKICAgICAgICAvLyB3ZSB3YW50IGEgPT0gY29udmVyc2lvbiBoZXJlLCB0byBiZSBhYmxlIHRvIGNhdGNoCiAgICAgICAgLy8gdW5kZWZpbmVkID09IGZhbHNlIGFuZCBmcmllbmRzCiAgICAgICAgLyoganNoaW50IC1XMTE2ICovCiAgICAgICAgcmV0dXJuIGRlZmluaXRpb25ba2V5XSA9PSB2YWw7CiAgICAgIH0pOwogICAgfQoKICAgIHJldHVybiBzb21lKGV2ZW50LmV2ZW50RGVmaW5pdGlvbnMsIGZ1bmN0aW9uKGRlZmluaXRpb24pIHsKICAgICAgcmV0dXJuIGRlZmluaXRpb24uJHR5cGUgPT09IGV2ZW50RGVmaW5pdGlvblR5cGUgJiYgbWF0Y2hlcyhldmVudCwgZmlsdGVyKTsKICAgIH0pOwogIH0KCiAgZnVuY3Rpb24gaXNUaHJvd0V2ZW50KGV2ZW50KSB7CiAgICByZXR1cm4gKGV2ZW50LiR0eXBlID09PSAnYnBtbjpJbnRlcm1lZGlhdGVUaHJvd0V2ZW50JykgfHwgKGV2ZW50LiR0eXBlID09PSAnYnBtbjpFbmRFdmVudCcpOwogIH0KCiAgZnVuY3Rpb24gaXNDb2xsZWN0aW9uKGVsZW1lbnQpIHsKICAgIHZhciBkYXRhT2JqZWN0ID0gZWxlbWVudC5kYXRhT2JqZWN0UmVmOwoKICAgIHJldHVybiBlbGVtZW50LmlzQ29sbGVjdGlvbiB8fCAoZGF0YU9iamVjdCAmJiBkYXRhT2JqZWN0LmlzQ29sbGVjdGlvbik7CiAgfQoKICBmdW5jdGlvbiBnZXREaShlbGVtZW50KSB7CiAgICByZXR1cm4gZWxlbWVudC5idXNpbmVzc09iamVjdC5kaTsKICB9CgogIGZ1bmN0aW9uIGdldFNlbWFudGljKGVsZW1lbnQpIHsKICAgIHJldHVybiBlbGVtZW50LmJ1c2luZXNzT2JqZWN0OwogIH0KCgogIC8vIGNvbG9yIGFjY2VzcyAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogIGZ1bmN0aW9uIGdldEZpbGxDb2xvcihlbGVtZW50LCBkZWZhdWx0Q29sb3IpIHsKICAgIHJldHVybiBnZXREaShlbGVtZW50KS5nZXQoJ2Jpb2M6ZmlsbCcpIHx8IGRlZmF1bHRDb2xvciB8fCAnd2hpdGUnOwogIH0KCiAgZnVuY3Rpb24gZ2V0U3Ryb2tlQ29sb3IoZWxlbWVudCwgZGVmYXVsdENvbG9yKSB7CiAgICByZXR1cm4gZ2V0RGkoZWxlbWVudCkuZ2V0KCdiaW9jOnN0cm9rZScpIHx8IGRlZmF1bHRDb2xvciB8fCAnYmxhY2snOwogIH0KCgogIC8vIGNyb3BwaW5nIHBhdGggY3VzdG9taXphdGlvbnMgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICBmdW5jdGlvbiBnZXRDaXJjbGVQYXRoKHNoYXBlKSB7CgogICAgdmFyIGN4ID0gc2hhcGUueCArIHNoYXBlLndpZHRoIC8gMiwKICAgICAgICBjeSA9IHNoYXBlLnkgKyBzaGFwZS5oZWlnaHQgLyAyLAogICAgICAgIHJhZGl1cyA9IHNoYXBlLndpZHRoIC8gMjsKCiAgICB2YXIgY2lyY2xlUGF0aCA9IFsKICAgICAgWydNJywgY3gsIGN5XSwKICAgICAgWydtJywgMCwgLXJhZGl1c10sCiAgICAgIFsnYScsIHJhZGl1cywgcmFkaXVzLCAwLCAxLCAxLCAwLCAyICogcmFkaXVzXSwKICAgICAgWydhJywgcmFkaXVzLCByYWRpdXMsIDAsIDEsIDEsIDAsIC0yICogcmFkaXVzXSwKICAgICAgWyd6J10KICAgIF07CgogICAgcmV0dXJuIGNvbXBvbmVudHNUb1BhdGgoY2lyY2xlUGF0aCk7CiAgfQoKICBmdW5jdGlvbiBnZXRSb3VuZFJlY3RQYXRoKHNoYXBlLCBib3JkZXJSYWRpdXMpIHsKCiAgICB2YXIgeCA9IHNoYXBlLngsCiAgICAgICAgeSA9IHNoYXBlLnksCiAgICAgICAgd2lkdGggPSBzaGFwZS53aWR0aCwKICAgICAgICBoZWlnaHQgPSBzaGFwZS5oZWlnaHQ7CgogICAgdmFyIHJvdW5kUmVjdFBhdGggPSBbCiAgICAgIFsnTScsIHggKyBib3JkZXJSYWRpdXMsIHldLAogICAgICBbJ2wnLCB3aWR0aCAtIGJvcmRlclJhZGl1cyAqIDIsIDBdLAogICAgICBbJ2EnLCBib3JkZXJSYWRpdXMsIGJvcmRlclJhZGl1cywgMCwgMCwgMSwgYm9yZGVyUmFkaXVzLCBib3JkZXJSYWRpdXNdLAogICAgICBbJ2wnLCAwLCBoZWlnaHQgLSBib3JkZXJSYWRpdXMgKiAyXSwKICAgICAgWydhJywgYm9yZGVyUmFkaXVzLCBib3JkZXJSYWRpdXMsIDAsIDAsIDEsIC1ib3JkZXJSYWRpdXMsIGJvcmRlclJhZGl1c10sCiAgICAgIFsnbCcsIGJvcmRlclJhZGl1cyAqIDIgLSB3aWR0aCwgMF0sCiAgICAgIFsnYScsIGJvcmRlclJhZGl1cywgYm9yZGVyUmFkaXVzLCAwLCAwLCAxLCAtYm9yZGVyUmFkaXVzLCAtYm9yZGVyUmFkaXVzXSwKICAgICAgWydsJywgMCwgYm9yZGVyUmFkaXVzICogMiAtIGhlaWdodF0sCiAgICAgIFsnYScsIGJvcmRlclJhZGl1cywgYm9yZGVyUmFkaXVzLCAwLCAwLCAxLCBib3JkZXJSYWRpdXMsIC1ib3JkZXJSYWRpdXNdLAogICAgICBbJ3onXQogICAgXTsKCiAgICByZXR1cm4gY29tcG9uZW50c1RvUGF0aChyb3VuZFJlY3RQYXRoKTsKICB9CgogIGZ1bmN0aW9uIGdldERpYW1vbmRQYXRoKHNoYXBlKSB7CgogICAgdmFyIHdpZHRoID0gc2hhcGUud2lkdGgsCiAgICAgICAgaGVpZ2h0ID0gc2hhcGUuaGVpZ2h0LAogICAgICAgIHggPSBzaGFwZS54LAogICAgICAgIHkgPSBzaGFwZS55LAogICAgICAgIGhhbGZXaWR0aCA9IHdpZHRoIC8gMiwKICAgICAgICBoYWxmSGVpZ2h0ID0gaGVpZ2h0IC8gMjsKCiAgICB2YXIgZGlhbW9uZFBhdGggPSBbCiAgICAgIFsnTScsIHggKyBoYWxmV2lkdGgsIHldLAogICAgICBbJ2wnLCBoYWxmV2lkdGgsIGhhbGZIZWlnaHRdLAogICAgICBbJ2wnLCAtaGFsZldpZHRoLCBoYWxmSGVpZ2h0XSwKICAgICAgWydsJywgLWhhbGZXaWR0aCwgLWhhbGZIZWlnaHRdLAogICAgICBbJ3onXQogICAgXTsKCiAgICByZXR1cm4gY29tcG9uZW50c1RvUGF0aChkaWFtb25kUGF0aCk7CiAgfQoKICBmdW5jdGlvbiBnZXRSZWN0UGF0aChzaGFwZSkgewogICAgdmFyIHggPSBzaGFwZS54LAogICAgICAgIHkgPSBzaGFwZS55LAogICAgICAgIHdpZHRoID0gc2hhcGUud2lkdGgsCiAgICAgICAgaGVpZ2h0ID0gc2hhcGUuaGVpZ2h0OwoKICAgIHZhciByZWN0UGF0aCA9IFsKICAgICAgWydNJywgeCwgeV0sCiAgICAgIFsnbCcsIHdpZHRoLCAwXSwKICAgICAgWydsJywgMCwgaGVpZ2h0XSwKICAgICAgWydsJywgLXdpZHRoLCAwXSwKICAgICAgWyd6J10KICAgIF07CgogICAgcmV0dXJuIGNvbXBvbmVudHNUb1BhdGgocmVjdFBhdGgpOwogIH0KCiAgZnVuY3Rpb24gY3JlYXRlQ29tbW9uanNNb2R1bGUkMShmbiwgbW9kdWxlKSB7CiAgCXJldHVybiBtb2R1bGUgPSB7IGV4cG9ydHM6IHt9IH0sIGZuKG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMpLCBtb2R1bGUuZXhwb3J0czsKICB9CgogIHZhciBoYXRfMSA9IGNyZWF0ZUNvbW1vbmpzTW9kdWxlJDEoZnVuY3Rpb24gKG1vZHVsZSkgewogIHZhciBoYXQgPSBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChiaXRzLCBiYXNlKSB7CiAgICAgIGlmICghYmFzZSkgYmFzZSA9IDE2OwogICAgICBpZiAoYml0cyA9PT0gdW5kZWZpbmVkKSBiaXRzID0gMTI4OwogICAgICBpZiAoYml0cyA8PSAwKSByZXR1cm4gJzAnOwogICAgICAKICAgICAgdmFyIGRpZ2l0cyA9IE1hdGgubG9nKE1hdGgucG93KDIsIGJpdHMpKSAvIE1hdGgubG9nKGJhc2UpOwogICAgICBmb3IgKHZhciBpID0gMjsgZGlnaXRzID09PSBJbmZpbml0eTsgaSAqPSAyKSB7CiAgICAgICAgICBkaWdpdHMgPSBNYXRoLmxvZyhNYXRoLnBvdygyLCBiaXRzIC8gaSkpIC8gTWF0aC5sb2coYmFzZSkgKiBpOwogICAgICB9CiAgICAgIAogICAgICB2YXIgcmVtID0gZGlnaXRzIC0gTWF0aC5mbG9vcihkaWdpdHMpOwogICAgICAKICAgICAgdmFyIHJlcyA9ICcnOwogICAgICAKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBNYXRoLmZsb29yKGRpZ2l0cyk7IGkrKykgewogICAgICAgICAgdmFyIHggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBiYXNlKS50b1N0cmluZyhiYXNlKTsKICAgICAgICAgIHJlcyA9IHggKyByZXM7CiAgICAgIH0KICAgICAgCiAgICAgIGlmIChyZW0pIHsKICAgICAgICAgIHZhciBiID0gTWF0aC5wb3coYmFzZSwgcmVtKTsKICAgICAgICAgIHZhciB4ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogYikudG9TdHJpbmcoYmFzZSk7CiAgICAgICAgICByZXMgPSB4ICsgcmVzOwogICAgICB9CiAgICAgIAogICAgICB2YXIgcGFyc2VkID0gcGFyc2VJbnQocmVzLCBiYXNlKTsKICAgICAgaWYgKHBhcnNlZCAhPT0gSW5maW5pdHkgJiYgcGFyc2VkID49IE1hdGgucG93KDIsIGJpdHMpKSB7CiAgICAgICAgICByZXR1cm4gaGF0KGJpdHMsIGJhc2UpCiAgICAgIH0KICAgICAgZWxzZSByZXR1cm4gcmVzOwogIH07CgogIGhhdC5yYWNrID0gZnVuY3Rpb24gKGJpdHMsIGJhc2UsIGV4cGFuZEJ5KSB7CiAgICAgIHZhciBmbiA9IGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgICAgICB2YXIgaXRlcnMgPSAwOwogICAgICAgICAgZG8gewogICAgICAgICAgICAgIGlmIChpdGVycyArKyA+IDEwKSB7CiAgICAgICAgICAgICAgICAgIGlmIChleHBhbmRCeSkgYml0cyArPSBleHBhbmRCeTsKICAgICAgICAgICAgICAgICAgZWxzZSB0aHJvdyBuZXcgRXJyb3IoJ3RvbyBtYW55IElEIGNvbGxpc2lvbnMsIHVzZSBtb3JlIGJpdHMnKQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAKICAgICAgICAgICAgICB2YXIgaWQgPSBoYXQoYml0cywgYmFzZSk7CiAgICAgICAgICB9IHdoaWxlIChPYmplY3QuaGFzT3duUHJvcGVydHkuY2FsbChoYXRzLCBpZCkpOwogICAgICAgICAgCiAgICAgICAgICBoYXRzW2lkXSA9IGRhdGE7CiAgICAgICAgICByZXR1cm4gaWQ7CiAgICAgIH07CiAgICAgIHZhciBoYXRzID0gZm4uaGF0cyA9IHt9OwogICAgICAKICAgICAgZm4uZ2V0ID0gZnVuY3Rpb24gKGlkKSB7CiAgICAgICAgICByZXR1cm4gZm4uaGF0c1tpZF07CiAgICAgIH07CiAgICAgIAogICAgICBmbi5zZXQgPSBmdW5jdGlvbiAoaWQsIHZhbHVlKSB7CiAgICAgICAgICBmbi5oYXRzW2lkXSA9IHZhbHVlOwogICAgICAgICAgcmV0dXJuIGZuOwogICAgICB9OwogICAgICAKICAgICAgZm4uYml0cyA9IGJpdHMgfHwgMTI4OwogICAgICBmbi5iYXNlID0gYmFzZSB8fCAxNjsKICAgICAgcmV0dXJuIGZuOwogIH07CiAgfSk7CgogIC8qKgogICAqIENyZWF0ZSBhIG5ldyBpZCBnZW5lcmF0b3IgLyBjYWNoZSBpbnN0YW5jZS4KICAgKgogICAqIFlvdSBtYXkgb3B0aW9uYWxseSBwcm92aWRlIGEgc2VlZCB0aGF0IGlzIHVzZWQgaW50ZXJuYWxseS4KICAgKgogICAqIEBwYXJhbSB7U2VlZH0gc2VlZAogICAqLwoKICBmdW5jdGlvbiBJZHMoc2VlZCkgewogICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIElkcykpIHsKICAgICAgcmV0dXJuIG5ldyBJZHMoc2VlZCk7CiAgICB9CgogICAgc2VlZCA9IHNlZWQgfHwgWzEyOCwgMzYsIDFdOwogICAgdGhpcy5fc2VlZCA9IHNlZWQubGVuZ3RoID8gaGF0XzEucmFjayhzZWVkWzBdLCBzZWVkWzFdLCBzZWVkWzJdKSA6IHNlZWQ7CiAgfQogIC8qKgogICAqIEdlbmVyYXRlIGEgbmV4dCBpZC4KICAgKgogICAqIEBwYXJhbSB7T2JqZWN0fSBbZWxlbWVudF0gZWxlbWVudCB0byBiaW5kIHRoZSBpZCB0bwogICAqCiAgICogQHJldHVybiB7U3RyaW5nfSBpZAogICAqLwoKICBJZHMucHJvdG90eXBlLm5leHQgPSBmdW5jdGlvbiAoZWxlbWVudCkgewogICAgcmV0dXJuIHRoaXMuX3NlZWQoZWxlbWVudCB8fCB0cnVlKTsKICB9OwogIC8qKgogICAqIEdlbmVyYXRlIGEgbmV4dCBpZCB3aXRoIGEgZ2l2ZW4gcHJlZml4LgogICAqCiAgICogQHBhcmFtIHtPYmplY3R9IFtlbGVtZW50XSBlbGVtZW50IHRvIGJpbmQgdGhlIGlkIHRvCiAgICoKICAgKiBAcmV0dXJuIHtTdHJpbmd9IGlkCiAgICovCgoKICBJZHMucHJvdG90eXBlLm5leHRQcmVmaXhlZCA9IGZ1bmN0aW9uIChwcmVmaXgsIGVsZW1lbnQpIHsKICAgIHZhciBpZDsKCiAgICBkbyB7CiAgICAgIGlkID0gcHJlZml4ICsgdGhpcy5uZXh0KHRydWUpOwogICAgfSB3aGlsZSAodGhpcy5hc3NpZ25lZChpZCkpOyAvLyBjbGFpbSB7cHJlZml4fXtyYW5kb219CgoKICAgIHRoaXMuY2xhaW0oaWQsIGVsZW1lbnQpOyAvLyByZXR1cm4KCiAgICByZXR1cm4gaWQ7CiAgfTsKICAvKioKICAgKiBNYW51YWxseSBjbGFpbSBhbiBleGlzdGluZyBpZC4KICAgKgogICAqIEBwYXJhbSB7U3RyaW5nfSBpZAogICAqIEBwYXJhbSB7U3RyaW5nfSBbZWxlbWVudF0gZWxlbWVudCB0aGUgaWQgaXMgY2xhaW1lZCBieQogICAqLwoKCiAgSWRzLnByb3RvdHlwZS5jbGFpbSA9IGZ1bmN0aW9uIChpZCwgZWxlbWVudCkgewogICAgdGhpcy5fc2VlZC5zZXQoaWQsIGVsZW1lbnQgfHwgdHJ1ZSk7CiAgfTsKICAvKioKICAgKiBSZXR1cm5zIHRydWUgaWYgdGhlIGdpdmVuIGlkIGhhcyBhbHJlYWR5IGJlZW4gYXNzaWduZWQuCiAgICoKICAgKiBAcGFyYW0gIHtTdHJpbmd9IGlkCiAgICogQHJldHVybiB7Qm9vbGVhbn0KICAgKi8KCgogIElkcy5wcm90b3R5cGUuYXNzaWduZWQgPSBmdW5jdGlvbiAoaWQpIHsKICAgIHJldHVybiB0aGlzLl9zZWVkLmdldChpZCkgfHwgZmFsc2U7CiAgfTsKICAvKioKICAgKiBVbmNsYWltIGFuIGlkLgogICAqCiAgICogQHBhcmFtICB7U3RyaW5nfSBpZCB0aGUgaWQgdG8gdW5jbGFpbQogICAqLwoKCiAgSWRzLnByb3RvdHlwZS51bmNsYWltID0gZnVuY3Rpb24gKGlkKSB7CiAgICBkZWxldGUgdGhpcy5fc2VlZC5oYXRzW2lkXTsKICB9OwogIC8qKgogICAqIENsZWFyIGFsbCBjbGFpbWVkIGlkcy4KICAgKi8KCgogIElkcy5wcm90b3R5cGUuY2xlYXIgPSBmdW5jdGlvbiAoKSB7CiAgICB2YXIgaGF0cyA9IHRoaXMuX3NlZWQuaGF0cywKICAgICAgICBpZDsKCiAgICBmb3IgKGlkIGluIGhhdHMpIHsKICAgICAgdGhpcy51bmNsYWltKGlkKTsKICAgIH0KICB9OwoKICB2YXIgUkVOREVSRVJfSURTID0gbmV3IElkcygpOwoKICB2YXIgVEFTS19CT1JERVJfUkFESVVTID0gMTA7CiAgdmFyIElOTkVSX09VVEVSX0RJU1QgPSAzOwoKICB2YXIgREVGQVVMVF9GSUxMX09QQUNJVFkgPSAuOTUsCiAgICAgIEhJR0hfRklMTF9PUEFDSVRZID0gLjM1OwoKCiAgZnVuY3Rpb24gQnBtblJlbmRlcmVyKAogICAgICBjb25maWcsIGV2ZW50QnVzLCBzdHlsZXMsIHBhdGhNYXAsCiAgICAgIGNhbnZhcywgdGV4dFJlbmRlcmVyLCBwcmlvcml0eSkgewoKICAgIEJhc2VSZW5kZXJlci5jYWxsKHRoaXMsIGV2ZW50QnVzLCBwcmlvcml0eSk7CgogICAgdmFyIGRlZmF1bHRGaWxsQ29sb3IgPSBjb25maWcgJiYgY29uZmlnLmRlZmF1bHRGaWxsQ29sb3IsCiAgICAgICAgZGVmYXVsdFN0cm9rZUNvbG9yID0gY29uZmlnICYmIGNvbmZpZy5kZWZhdWx0U3Ryb2tlQ29sb3I7CgogICAgdmFyIHJlbmRlcmVySWQgPSBSRU5ERVJFUl9JRFMubmV4dCgpOwoKICAgIHZhciBtYXJrZXJzID0ge307CgogICAgdmFyIGNvbXB1dGVTdHlsZSA9IHN0eWxlcy5jb21wdXRlU3R5bGU7CgogICAgZnVuY3Rpb24gYWRkTWFya2VyKGlkLCBvcHRpb25zKSB7CiAgICAgIHZhciBhdHRycyA9IGFzc2lnbih7CiAgICAgICAgZmlsbDogJ2JsYWNrJywKICAgICAgICBzdHJva2VXaWR0aDogMSwKICAgICAgICBzdHJva2VMaW5lY2FwOiAncm91bmQnLAogICAgICAgIHN0cm9rZURhc2hhcnJheTogJ25vbmUnCiAgICAgIH0sIG9wdGlvbnMuYXR0cnMpOwoKICAgICAgdmFyIHJlZiA9IG9wdGlvbnMucmVmIHx8IHsgeDogMCwgeTogMCB9OwoKICAgICAgdmFyIHNjYWxlID0gb3B0aW9ucy5zY2FsZSB8fCAxOwoKICAgICAgLy8gZml4IGZvciBzYWZhcmkgLyBjaHJvbWUgLyBmaXJlZm94IGJ1ZyBub3QgY29ycmVjdGx5CiAgICAgIC8vIHJlc2V0dGluZyBzdHJva2UgZGFzaCBhcnJheQogICAgICBpZiAoYXR0cnMuc3Ryb2tlRGFzaGFycmF5ID09PSAnbm9uZScpIHsKICAgICAgICBhdHRycy5zdHJva2VEYXNoYXJyYXkgPSBbMTAwMDAsIDFdOwogICAgICB9CgogICAgICB2YXIgbWFya2VyID0gY3JlYXRlKCdtYXJrZXInKTsKCiAgICAgIGF0dHIkMShvcHRpb25zLmVsZW1lbnQsIGF0dHJzKTsKCiAgICAgIGFwcGVuZChtYXJrZXIsIG9wdGlvbnMuZWxlbWVudCk7CgogICAgICBhdHRyJDEobWFya2VyLCB7CiAgICAgICAgaWQ6IGlkLAogICAgICAgIHZpZXdCb3g6ICcwIDAgMjAgMjAnLAogICAgICAgIHJlZlg6IHJlZi54LAogICAgICAgIHJlZlk6IHJlZi55LAogICAgICAgIG1hcmtlcldpZHRoOiAyMCAqIHNjYWxlLAogICAgICAgIG1hcmtlckhlaWdodDogMjAgKiBzY2FsZSwKICAgICAgICBvcmllbnQ6ICdhdXRvJwogICAgICB9KTsKCiAgICAgIHZhciBkZWZzID0gcXVlcnkoJ2RlZnMnLCBjYW52YXMuX3N2Zyk7CgogICAgICBpZiAoIWRlZnMpIHsKICAgICAgICBkZWZzID0gY3JlYXRlKCdkZWZzJyk7CgogICAgICAgIGFwcGVuZChjYW52YXMuX3N2ZywgZGVmcyk7CiAgICAgIH0KCiAgICAgIGFwcGVuZChkZWZzLCBtYXJrZXIpOwoKICAgICAgbWFya2Vyc1tpZF0gPSBtYXJrZXI7CiAgICB9CgogICAgZnVuY3Rpb24gY29sb3JFc2NhcGUoc3RyKSB7CiAgICAgIHJldHVybiBzdHIucmVwbGFjZSgvWygpXHMsI10rL2csICdfJyk7CiAgICB9CgogICAgZnVuY3Rpb24gbWFya2VyKHR5cGUsIGZpbGwsIHN0cm9rZSkgewogICAgICB2YXIgaWQgPSB0eXBlICsgJy0nICsgY29sb3JFc2NhcGUoZmlsbCkgKyAnLScgKyBjb2xvckVzY2FwZShzdHJva2UpICsgJy0nICsgcmVuZGVyZXJJZDsKCiAgICAgIGlmICghbWFya2Vyc1tpZF0pIHsKICAgICAgICBjcmVhdGVNYXJrZXIoaWQsIHR5cGUsIGZpbGwsIHN0cm9rZSk7CiAgICAgIH0KCiAgICAgIHJldHVybiAndXJsKCMnICsgaWQgKyAnKSc7CiAgICB9CgogICAgZnVuY3Rpb24gY3JlYXRlTWFya2VyKGlkLCB0eXBlLCBmaWxsLCBzdHJva2UpIHsKCiAgICAgIGlmICh0eXBlID09PSAnc2VxdWVuY2VmbG93LWVuZCcpIHsKICAgICAgICB2YXIgc2VxdWVuY2VmbG93RW5kID0gY3JlYXRlKCdwYXRoJyk7CiAgICAgICAgYXR0ciQxKHNlcXVlbmNlZmxvd0VuZCwgeyBkOiAnTSAxIDUgTCAxMSAxMCBMIDEgMTUgWicgfSk7CgogICAgICAgIGFkZE1hcmtlcihpZCwgewogICAgICAgICAgZWxlbWVudDogc2VxdWVuY2VmbG93RW5kLAogICAgICAgICAgcmVmOiB7IHg6IDExLCB5OiAxMCB9LAogICAgICAgICAgc2NhbGU6IDAuNSwKICAgICAgICAgIGF0dHJzOiB7CiAgICAgICAgICAgIGZpbGw6IHN0cm9rZSwKICAgICAgICAgICAgc3Ryb2tlOiBzdHJva2UKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQoKICAgICAgaWYgKHR5cGUgPT09ICdtZXNzYWdlZmxvdy1zdGFydCcpIHsKICAgICAgICB2YXIgbWVzc2FnZWZsb3dTdGFydCA9IGNyZWF0ZSgnY2lyY2xlJyk7CiAgICAgICAgYXR0ciQxKG1lc3NhZ2VmbG93U3RhcnQsIHsgY3g6IDYsIGN5OiA2LCByOiAzLjUgfSk7CgogICAgICAgIGFkZE1hcmtlcihpZCwgewogICAgICAgICAgZWxlbWVudDogbWVzc2FnZWZsb3dTdGFydCwKICAgICAgICAgIGF0dHJzOiB7CiAgICAgICAgICAgIGZpbGw6IGZpbGwsCiAgICAgICAgICAgIHN0cm9rZTogc3Ryb2tlCiAgICAgICAgICB9LAogICAgICAgICAgcmVmOiB7IHg6IDYsIHk6IDYgfQogICAgICAgIH0pOwogICAgICB9CgogICAgICBpZiAodHlwZSA9PT0gJ21lc3NhZ2VmbG93LWVuZCcpIHsKICAgICAgICB2YXIgbWVzc2FnZWZsb3dFbmQgPSBjcmVhdGUoJ3BhdGgnKTsKICAgICAgICBhdHRyJDEobWVzc2FnZWZsb3dFbmQsIHsgZDogJ20gMSA1IGwgMCAtMyBsIDcgMyBsIC03IDMgeicgfSk7CgogICAgICAgIGFkZE1hcmtlcihpZCwgewogICAgICAgICAgZWxlbWVudDogbWVzc2FnZWZsb3dFbmQsCiAgICAgICAgICBhdHRyczogewogICAgICAgICAgICBmaWxsOiBmaWxsLAogICAgICAgICAgICBzdHJva2U6IHN0cm9rZSwKICAgICAgICAgICAgc3Ryb2tlTGluZWNhcDogJ2J1dHQnCiAgICAgICAgICB9LAogICAgICAgICAgcmVmOiB7IHg6IDguNSwgeTogNSB9CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIGlmICh0eXBlID09PSAnYXNzb2NpYXRpb24tc3RhcnQnKSB7CiAgICAgICAgdmFyIGFzc29jaWF0aW9uU3RhcnQgPSBjcmVhdGUoJ3BhdGgnKTsKICAgICAgICBhdHRyJDEoYXNzb2NpYXRpb25TdGFydCwgeyBkOiAnTSAxMSA1IEwgMSAxMCBMIDExIDE1JyB9KTsKCiAgICAgICAgYWRkTWFya2VyKGlkLCB7CiAgICAgICAgICBlbGVtZW50OiBhc3NvY2lhdGlvblN0YXJ0LAogICAgICAgICAgYXR0cnM6IHsKICAgICAgICAgICAgZmlsbDogJ25vbmUnLAogICAgICAgICAgICBzdHJva2U6IHN0cm9rZSwKICAgICAgICAgICAgc3Ryb2tlV2lkdGg6IDEuNQogICAgICAgICAgfSwKICAgICAgICAgIHJlZjogeyB4OiAxLCB5OiAxMCB9LAogICAgICAgICAgc2NhbGU6IDAuNQogICAgICAgIH0pOwogICAgICB9CgogICAgICBpZiAodHlwZSA9PT0gJ2Fzc29jaWF0aW9uLWVuZCcpIHsKICAgICAgICB2YXIgYXNzb2NpYXRpb25FbmQgPSBjcmVhdGUoJ3BhdGgnKTsKICAgICAgICBhdHRyJDEoYXNzb2NpYXRpb25FbmQsIHsgZDogJ00gMSA1IEwgMTEgMTAgTCAxIDE1JyB9KTsKCiAgICAgICAgYWRkTWFya2VyKGlkLCB7CiAgICAgICAgICBlbGVtZW50OiBhc3NvY2lhdGlvbkVuZCwKICAgICAgICAgIGF0dHJzOiB7CiAgICAgICAgICAgIGZpbGw6ICdub25lJywKICAgICAgICAgICAgc3Ryb2tlOiBzdHJva2UsCiAgICAgICAgICAgIHN0cm9rZVdpZHRoOiAxLjUKICAgICAgICAgIH0sCiAgICAgICAgICByZWY6IHsgeDogMTIsIHk6IDEwIH0sCiAgICAgICAgICBzY2FsZTogMC41CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIGlmICh0eXBlID09PSAnY29uZGl0aW9uYWwtZmxvdy1tYXJrZXInKSB7CiAgICAgICAgdmFyIGNvbmRpdGlvbmFsZmxvd01hcmtlciA9IGNyZWF0ZSgncGF0aCcpOwogICAgICAgIGF0dHIkMShjb25kaXRpb25hbGZsb3dNYXJrZXIsIHsgZDogJ00gMCAxMCBMIDggNiBMIDE2IDEwIEwgOCAxNCBaJyB9KTsKCiAgICAgICAgYWRkTWFya2VyKGlkLCB7CiAgICAgICAgICBlbGVtZW50OiBjb25kaXRpb25hbGZsb3dNYXJrZXIsCiAgICAgICAgICBhdHRyczogewogICAgICAgICAgICBmaWxsOiBmaWxsLAogICAgICAgICAgICBzdHJva2U6IHN0cm9rZQogICAgICAgICAgfSwKICAgICAgICAgIHJlZjogeyB4OiAtMSwgeTogMTAgfSwKICAgICAgICAgIHNjYWxlOiAwLjUKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgaWYgKHR5cGUgPT09ICdjb25kaXRpb25hbC1kZWZhdWx0LWZsb3ctbWFya2VyJykgewogICAgICAgIHZhciBjb25kaXRpb25hbGRlZmF1bHRmbG93TWFya2VyID0gY3JlYXRlKCdwYXRoJyk7CiAgICAgICAgYXR0ciQxKGNvbmRpdGlvbmFsZGVmYXVsdGZsb3dNYXJrZXIsIHsgZDogJ00gNiA0IEwgMTAgMTYnIH0pOwoKICAgICAgICBhZGRNYXJrZXIoaWQsIHsKICAgICAgICAgIGVsZW1lbnQ6IGNvbmRpdGlvbmFsZGVmYXVsdGZsb3dNYXJrZXIsCiAgICAgICAgICBhdHRyczogewogICAgICAgICAgICBzdHJva2U6IHN0cm9rZQogICAgICAgICAgfSwKICAgICAgICAgIHJlZjogeyB4OiAwLCB5OiAxMCB9LAogICAgICAgICAgc2NhbGU6IDAuNQogICAgICAgIH0pOwogICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gZHJhd0NpcmNsZShwYXJlbnRHZngsIHdpZHRoLCBoZWlnaHQsIG9mZnNldCwgYXR0cnMpIHsKCiAgICAgIGlmIChpc09iamVjdChvZmZzZXQpKSB7CiAgICAgICAgYXR0cnMgPSBvZmZzZXQ7CiAgICAgICAgb2Zmc2V0ID0gMDsKICAgICAgfQoKICAgICAgb2Zmc2V0ID0gb2Zmc2V0IHx8IDA7CgogICAgICBhdHRycyA9IGNvbXB1dGVTdHlsZShhdHRycywgewogICAgICAgIHN0cm9rZTogJ2JsYWNrJywKICAgICAgICBzdHJva2VXaWR0aDogMiwKICAgICAgICBmaWxsOiAnd2hpdGUnCiAgICAgIH0pOwoKICAgICAgaWYgKGF0dHJzLmZpbGwgPT09ICdub25lJykgewogICAgICAgIGRlbGV0ZSBhdHRycy5maWxsT3BhY2l0eTsKICAgICAgfQoKICAgICAgdmFyIGN4ID0gd2lkdGggLyAyLAogICAgICAgICAgY3kgPSBoZWlnaHQgLyAyOwoKICAgICAgdmFyIGNpcmNsZSA9IGNyZWF0ZSgnY2lyY2xlJyk7CiAgICAgIGF0dHIkMShjaXJjbGUsIHsKICAgICAgICBjeDogY3gsCiAgICAgICAgY3k6IGN5LAogICAgICAgIHI6IE1hdGgucm91bmQoKHdpZHRoICsgaGVpZ2h0KSAvIDQgLSBvZmZzZXQpCiAgICAgIH0pOwogICAgICBhdHRyJDEoY2lyY2xlLCBhdHRycyk7CgogICAgICBhcHBlbmQocGFyZW50R2Z4LCBjaXJjbGUpOwoKICAgICAgcmV0dXJuIGNpcmNsZTsKICAgIH0KCiAgICBmdW5jdGlvbiBkcmF3UmVjdChwYXJlbnRHZngsIHdpZHRoLCBoZWlnaHQsIHIsIG9mZnNldCwgYXR0cnMpIHsKCiAgICAgIGlmIChpc09iamVjdChvZmZzZXQpKSB7CiAgICAgICAgYXR0cnMgPSBvZmZzZXQ7CiAgICAgICAgb2Zmc2V0ID0gMDsKICAgICAgfQoKICAgICAgb2Zmc2V0ID0gb2Zmc2V0IHx8IDA7CgogICAgICBhdHRycyA9IGNvbXB1dGVTdHlsZShhdHRycywgewogICAgICAgIHN0cm9rZTogJ2JsYWNrJywKICAgICAgICBzdHJva2VXaWR0aDogMiwKICAgICAgICBmaWxsOiAnd2hpdGUnCiAgICAgIH0pOwoKICAgICAgdmFyIHJlY3QgPSBjcmVhdGUoJ3JlY3QnKTsKICAgICAgYXR0ciQxKHJlY3QsIHsKICAgICAgICB4OiBvZmZzZXQsCiAgICAgICAgeTogb2Zmc2V0LAogICAgICAgIHdpZHRoOiB3aWR0aCAtIG9mZnNldCAqIDIsCiAgICAgICAgaGVpZ2h0OiBoZWlnaHQgLSBvZmZzZXQgKiAyLAogICAgICAgIHJ4OiByLAogICAgICAgIHJ5OiByCiAgICAgIH0pOwogICAgICBhdHRyJDEocmVjdCwgYXR0cnMpOwoKICAgICAgYXBwZW5kKHBhcmVudEdmeCwgcmVjdCk7CgogICAgICByZXR1cm4gcmVjdDsKICAgIH0KCiAgICBmdW5jdGlvbiBkcmF3RGlhbW9uZChwYXJlbnRHZngsIHdpZHRoLCBoZWlnaHQsIGF0dHJzKSB7CgogICAgICB2YXIgeF8yID0gd2lkdGggLyAyOwogICAgICB2YXIgeV8yID0gaGVpZ2h0IC8gMjsKCiAgICAgIHZhciBwb2ludHMgPSBbeyB4OiB4XzIsIHk6IDAgfSwgeyB4OiB3aWR0aCwgeTogeV8yIH0sIHsgeDogeF8yLCB5OiBoZWlnaHQgfSwgeyB4OiAwLCB5OiB5XzIgfV07CgogICAgICB2YXIgcG9pbnRzU3RyaW5nID0gcG9pbnRzLm1hcChmdW5jdGlvbihwb2ludCkgewogICAgICAgIHJldHVybiBwb2ludC54ICsgJywnICsgcG9pbnQueTsKICAgICAgfSkuam9pbignICcpOwoKICAgICAgYXR0cnMgPSBjb21wdXRlU3R5bGUoYXR0cnMsIHsKICAgICAgICBzdHJva2U6ICdibGFjaycsCiAgICAgICAgc3Ryb2tlV2lkdGg6IDIsCiAgICAgICAgZmlsbDogJ3doaXRlJwogICAgICB9KTsKCiAgICAgIHZhciBwb2x5Z29uID0gY3JlYXRlKCdwb2x5Z29uJyk7CiAgICAgIGF0dHIkMShwb2x5Z29uLCB7CiAgICAgICAgcG9pbnRzOiBwb2ludHNTdHJpbmcKICAgICAgfSk7CiAgICAgIGF0dHIkMShwb2x5Z29uLCBhdHRycyk7CgogICAgICBhcHBlbmQocGFyZW50R2Z4LCBwb2x5Z29uKTsKCiAgICAgIHJldHVybiBwb2x5Z29uOwogICAgfQoKICAgIGZ1bmN0aW9uIGRyYXdMaW5lKHBhcmVudEdmeCwgd2F5cG9pbnRzLCBhdHRycykgewogICAgICBhdHRycyA9IGNvbXB1dGVTdHlsZShhdHRycywgWyAnbm8tZmlsbCcgXSwgewogICAgICAgIHN0cm9rZTogJ2JsYWNrJywKICAgICAgICBzdHJva2VXaWR0aDogMiwKICAgICAgICBmaWxsOiAnbm9uZScKICAgICAgfSk7CgogICAgICB2YXIgbGluZSA9IGNyZWF0ZUxpbmUod2F5cG9pbnRzLCBhdHRycyk7CgogICAgICBhcHBlbmQocGFyZW50R2Z4LCBsaW5lKTsKCiAgICAgIHJldHVybiBsaW5lOwogICAgfQoKICAgIGZ1bmN0aW9uIGRyYXdQYXRoKHBhcmVudEdmeCwgZCwgYXR0cnMpIHsKCiAgICAgIGF0dHJzID0gY29tcHV0ZVN0eWxlKGF0dHJzLCBbICduby1maWxsJyBdLCB7CiAgICAgICAgc3Ryb2tlV2lkdGg6IDIsCiAgICAgICAgc3Ryb2tlOiAnYmxhY2snCiAgICAgIH0pOwoKICAgICAgdmFyIHBhdGggPSBjcmVhdGUoJ3BhdGgnKTsKICAgICAgYXR0ciQxKHBhdGgsIHsgZDogZCB9KTsKICAgICAgYXR0ciQxKHBhdGgsIGF0dHJzKTsKCiAgICAgIGFwcGVuZChwYXJlbnRHZngsIHBhdGgpOwoKICAgICAgcmV0dXJuIHBhdGg7CiAgICB9CgogICAgZnVuY3Rpb24gZHJhd01hcmtlcih0eXBlLCBwYXJlbnRHZngsIHBhdGgsIGF0dHJzKSB7CiAgICAgIHJldHVybiBkcmF3UGF0aChwYXJlbnRHZngsIHBhdGgsIGFzc2lnbih7ICdkYXRhLW1hcmtlcic6IHR5cGUgfSwgYXR0cnMpKTsKICAgIH0KCiAgICBmdW5jdGlvbiBhcyh0eXBlKSB7CiAgICAgIHJldHVybiBmdW5jdGlvbihwYXJlbnRHZngsIGVsZW1lbnQpIHsKICAgICAgICByZXR1cm4gaGFuZGxlcnNbdHlwZV0ocGFyZW50R2Z4LCBlbGVtZW50KTsKICAgICAgfTsKICAgIH0KCiAgICBmdW5jdGlvbiByZW5kZXJlcih0eXBlKSB7CiAgICAgIHJldHVybiBoYW5kbGVyc1t0eXBlXTsKICAgIH0KCiAgICBmdW5jdGlvbiByZW5kZXJFdmVudENvbnRlbnQoZWxlbWVudCwgcGFyZW50R2Z4KSB7CgogICAgICB2YXIgZXZlbnQgPSBnZXRTZW1hbnRpYyhlbGVtZW50KTsKICAgICAgdmFyIGlzVGhyb3dpbmcgPSBpc1Rocm93RXZlbnQoZXZlbnQpOwoKICAgICAgaWYgKGV2ZW50LmV2ZW50RGVmaW5pdGlvbnMgJiYgZXZlbnQuZXZlbnREZWZpbml0aW9ucy5sZW5ndGg+MSkgewogICAgICAgIGlmIChldmVudC5wYXJhbGxlbE11bHRpcGxlKSB7CiAgICAgICAgICByZXR1cm4gcmVuZGVyZXIoJ2JwbW46UGFyYWxsZWxNdWx0aXBsZUV2ZW50RGVmaW5pdGlvbicpKHBhcmVudEdmeCwgZWxlbWVudCwgaXNUaHJvd2luZyk7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgcmV0dXJuIHJlbmRlcmVyKCdicG1uOk11bHRpcGxlRXZlbnREZWZpbml0aW9uJykocGFyZW50R2Z4LCBlbGVtZW50LCBpc1Rocm93aW5nKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmIChpc1R5cGVkRXZlbnQoZXZlbnQsICdicG1uOk1lc3NhZ2VFdmVudERlZmluaXRpb24nKSkgewogICAgICAgIHJldHVybiByZW5kZXJlcignYnBtbjpNZXNzYWdlRXZlbnREZWZpbml0aW9uJykocGFyZW50R2Z4LCBlbGVtZW50LCBpc1Rocm93aW5nKTsKICAgICAgfQoKICAgICAgaWYgKGlzVHlwZWRFdmVudChldmVudCwgJ2JwbW46VGltZXJFdmVudERlZmluaXRpb24nKSkgewogICAgICAgIHJldHVybiByZW5kZXJlcignYnBtbjpUaW1lckV2ZW50RGVmaW5pdGlvbicpKHBhcmVudEdmeCwgZWxlbWVudCwgaXNUaHJvd2luZyk7CiAgICAgIH0KCiAgICAgIGlmIChpc1R5cGVkRXZlbnQoZXZlbnQsICdicG1uOkNvbmRpdGlvbmFsRXZlbnREZWZpbml0aW9uJykpIHsKICAgICAgICByZXR1cm4gcmVuZGVyZXIoJ2JwbW46Q29uZGl0aW9uYWxFdmVudERlZmluaXRpb24nKShwYXJlbnRHZngsIGVsZW1lbnQpOwogICAgICB9CgogICAgICBpZiAoaXNUeXBlZEV2ZW50KGV2ZW50LCAnYnBtbjpTaWduYWxFdmVudERlZmluaXRpb24nKSkgewogICAgICAgIHJldHVybiByZW5kZXJlcignYnBtbjpTaWduYWxFdmVudERlZmluaXRpb24nKShwYXJlbnRHZngsIGVsZW1lbnQsIGlzVGhyb3dpbmcpOwogICAgICB9CgogICAgICBpZiAoaXNUeXBlZEV2ZW50KGV2ZW50LCAnYnBtbjpFc2NhbGF0aW9uRXZlbnREZWZpbml0aW9uJykpIHsKICAgICAgICByZXR1cm4gcmVuZGVyZXIoJ2JwbW46RXNjYWxhdGlvbkV2ZW50RGVmaW5pdGlvbicpKHBhcmVudEdmeCwgZWxlbWVudCwgaXNUaHJvd2luZyk7CiAgICAgIH0KCiAgICAgIGlmIChpc1R5cGVkRXZlbnQoZXZlbnQsICdicG1uOkxpbmtFdmVudERlZmluaXRpb24nKSkgewogICAgICAgIHJldHVybiByZW5kZXJlcignYnBtbjpMaW5rRXZlbnREZWZpbml0aW9uJykocGFyZW50R2Z4LCBlbGVtZW50LCBpc1Rocm93aW5nKTsKICAgICAgfQoKICAgICAgaWYgKGlzVHlwZWRFdmVudChldmVudCwgJ2JwbW46RXJyb3JFdmVudERlZmluaXRpb24nKSkgewogICAgICAgIHJldHVybiByZW5kZXJlcignYnBtbjpFcnJvckV2ZW50RGVmaW5pdGlvbicpKHBhcmVudEdmeCwgZWxlbWVudCwgaXNUaHJvd2luZyk7CiAgICAgIH0KCiAgICAgIGlmIChpc1R5cGVkRXZlbnQoZXZlbnQsICdicG1uOkNhbmNlbEV2ZW50RGVmaW5pdGlvbicpKSB7CiAgICAgICAgcmV0dXJuIHJlbmRlcmVyKCdicG1uOkNhbmNlbEV2ZW50RGVmaW5pdGlvbicpKHBhcmVudEdmeCwgZWxlbWVudCwgaXNUaHJvd2luZyk7CiAgICAgIH0KCiAgICAgIGlmIChpc1R5cGVkRXZlbnQoZXZlbnQsICdicG1uOkNvbXBlbnNhdGVFdmVudERlZmluaXRpb24nKSkgewogICAgICAgIHJldHVybiByZW5kZXJlcignYnBtbjpDb21wZW5zYXRlRXZlbnREZWZpbml0aW9uJykocGFyZW50R2Z4LCBlbGVtZW50LCBpc1Rocm93aW5nKTsKICAgICAgfQoKICAgICAgaWYgKGlzVHlwZWRFdmVudChldmVudCwgJ2JwbW46VGVybWluYXRlRXZlbnREZWZpbml0aW9uJykpIHsKICAgICAgICByZXR1cm4gcmVuZGVyZXIoJ2JwbW46VGVybWluYXRlRXZlbnREZWZpbml0aW9uJykocGFyZW50R2Z4LCBlbGVtZW50LCBpc1Rocm93aW5nKTsKICAgICAgfQoKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgZnVuY3Rpb24gcmVuZGVyTGFiZWwocGFyZW50R2Z4LCBsYWJlbCwgb3B0aW9ucykgewoKICAgICAgb3B0aW9ucyA9IGFzc2lnbih7CiAgICAgICAgc2l6ZTogewogICAgICAgICAgd2lkdGg6IDEwMAogICAgICAgIH0KICAgICAgfSwgb3B0aW9ucyk7CgogICAgICB2YXIgdGV4dCA9IHRleHRSZW5kZXJlci5jcmVhdGVUZXh0KGxhYmVsIHx8ICcnLCBvcHRpb25zKTsKCiAgICAgIGNsYXNzZXMkMSh0ZXh0KS5hZGQoJ2Rqcy1sYWJlbCcpOwoKICAgICAgYXBwZW5kKHBhcmVudEdmeCwgdGV4dCk7CgogICAgICByZXR1cm4gdGV4dDsKICAgIH0KCiAgICBmdW5jdGlvbiByZW5kZXJFbWJlZGRlZExhYmVsKHBhcmVudEdmeCwgZWxlbWVudCwgYWxpZ24pIHsKICAgICAgdmFyIHNlbWFudGljID0gZ2V0U2VtYW50aWMoZWxlbWVudCk7CgogICAgICByZXR1cm4gcmVuZGVyTGFiZWwocGFyZW50R2Z4LCBzZW1hbnRpYy5uYW1lLCB7CiAgICAgICAgYm94OiBlbGVtZW50LAogICAgICAgIGFsaWduOiBhbGlnbiwKICAgICAgICBwYWRkaW5nOiA1LAogICAgICAgIHN0eWxlOiB7CiAgICAgICAgICBmaWxsOiBnZXRTdHJva2VDb2xvcihlbGVtZW50LCBkZWZhdWx0U3Ryb2tlQ29sb3IpCiAgICAgICAgfQogICAgICB9KTsKICAgIH0KCiAgICBmdW5jdGlvbiByZW5kZXJFeHRlcm5hbExhYmVsKHBhcmVudEdmeCwgZWxlbWVudCkgewoKICAgICAgdmFyIGJveCA9IHsKICAgICAgICB3aWR0aDogOTAsCiAgICAgICAgaGVpZ2h0OiAzMCwKICAgICAgICB4OiBlbGVtZW50LndpZHRoIC8gMiArIGVsZW1lbnQueCwKICAgICAgICB5OiBlbGVtZW50LmhlaWdodCAvIDIgKyBlbGVtZW50LnkKICAgICAgfTsKCiAgICAgIHJldHVybiByZW5kZXJMYWJlbChwYXJlbnRHZngsIGdldExhYmVsKGVsZW1lbnQpLCB7CiAgICAgICAgYm94OiBib3gsCiAgICAgICAgZml0Qm94OiB0cnVlLAogICAgICAgIHN0eWxlOiBhc3NpZ24oCiAgICAgICAgICB7fSwKICAgICAgICAgIHRleHRSZW5kZXJlci5nZXRFeHRlcm5hbFN0eWxlKCksCiAgICAgICAgICB7CiAgICAgICAgICAgIGZpbGw6IGdldFN0cm9rZUNvbG9yKGVsZW1lbnQsIGRlZmF1bHRTdHJva2VDb2xvcikKICAgICAgICAgIH0KICAgICAgICApCiAgICAgIH0pOwogICAgfQoKICAgIGZ1bmN0aW9uIHJlbmRlckxhbmVMYWJlbChwYXJlbnRHZngsIHRleHQsIGVsZW1lbnQpIHsKICAgICAgdmFyIHRleHRCb3ggPSByZW5kZXJMYWJlbChwYXJlbnRHZngsIHRleHQsIHsKICAgICAgICBib3g6IHsKICAgICAgICAgIGhlaWdodDogMzAsCiAgICAgICAgICB3aWR0aDogZWxlbWVudC5oZWlnaHQKICAgICAgICB9LAogICAgICAgIGFsaWduOiAnY2VudGVyLW1pZGRsZScsCiAgICAgICAgc3R5bGU6IHsKICAgICAgICAgIGZpbGw6IGdldFN0cm9rZUNvbG9yKGVsZW1lbnQsIGRlZmF1bHRTdHJva2VDb2xvcikKICAgICAgICB9CiAgICAgIH0pOwoKICAgICAgdmFyIHRvcCA9IC0xICogZWxlbWVudC5oZWlnaHQ7CgogICAgICB0cmFuc2Zvcm0kMSh0ZXh0Qm94LCAwLCAtdG9wLCAyNzApOwogICAgfQoKICAgIGZ1bmN0aW9uIGNyZWF0ZVBhdGhGcm9tQ29ubmVjdGlvbihjb25uZWN0aW9uKSB7CiAgICAgIHZhciB3YXlwb2ludHMgPSBjb25uZWN0aW9uLndheXBvaW50czsKCiAgICAgIHZhciBwYXRoRGF0YSA9ICdtICAnICsgd2F5cG9pbnRzWzBdLnggKyAnLCcgKyB3YXlwb2ludHNbMF0ueTsKICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPCB3YXlwb2ludHMubGVuZ3RoOyBpKyspIHsKICAgICAgICBwYXRoRGF0YSArPSAnTCcgKyB3YXlwb2ludHNbaV0ueCArICcsJyArIHdheXBvaW50c1tpXS55ICsgJyAnOwogICAgICB9CiAgICAgIHJldHVybiBwYXRoRGF0YTsKICAgIH0KCiAgICB2YXIgaGFuZGxlcnMgPSB0aGlzLmhhbmRsZXJzID0gewogICAgICAnYnBtbjpFdmVudCc6IGZ1bmN0aW9uKHBhcmVudEdmeCwgZWxlbWVudCwgYXR0cnMpIHsKCiAgICAgICAgaWYgKCEoJ2ZpbGxPcGFjaXR5JyBpbiBhdHRycykpIHsKICAgICAgICAgIGF0dHJzLmZpbGxPcGFjaXR5ID0gREVGQVVMVF9GSUxMX09QQUNJVFk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZHJhd0NpcmNsZShwYXJlbnRHZngsIGVsZW1lbnQud2lkdGgsIGVsZW1lbnQuaGVpZ2h0LCBhdHRycyk7CiAgICAgIH0sCiAgICAgICdicG1uOlN0YXJ0RXZlbnQnOiBmdW5jdGlvbihwYXJlbnRHZngsIGVsZW1lbnQpIHsKICAgICAgICB2YXIgYXR0cnMgPSB7CiAgICAgICAgICBmaWxsOiBnZXRGaWxsQ29sb3IoZWxlbWVudCwgZGVmYXVsdEZpbGxDb2xvciksCiAgICAgICAgICBzdHJva2U6IGdldFN0cm9rZUNvbG9yKGVsZW1lbnQsIGRlZmF1bHRTdHJva2VDb2xvcikKICAgICAgICB9OwoKICAgICAgICB2YXIgc2VtYW50aWMgPSBnZXRTZW1hbnRpYyhlbGVtZW50KTsKCiAgICAgICAgaWYgKCFzZW1hbnRpYy5pc0ludGVycnVwdGluZykgewogICAgICAgICAgYXR0cnMgPSB7CiAgICAgICAgICAgIHN0cm9rZURhc2hhcnJheTogJzYnLAogICAgICAgICAgICBzdHJva2VMaW5lY2FwOiAncm91bmQnLAogICAgICAgICAgICBmaWxsOiBnZXRGaWxsQ29sb3IoZWxlbWVudCwgZGVmYXVsdEZpbGxDb2xvciksCiAgICAgICAgICAgIHN0cm9rZTogZ2V0U3Ryb2tlQ29sb3IoZWxlbWVudCwgZGVmYXVsdFN0cm9rZUNvbG9yKQogICAgICAgICAgfTsKICAgICAgICB9CgogICAgICAgIHZhciBjaXJjbGUgPSByZW5kZXJlcignYnBtbjpFdmVudCcpKHBhcmVudEdmeCwgZWxlbWVudCwgYXR0cnMpOwoKICAgICAgICByZW5kZXJFdmVudENvbnRlbnQoZWxlbWVudCwgcGFyZW50R2Z4KTsKCiAgICAgICAgcmV0dXJuIGNpcmNsZTsKICAgICAgfSwKICAgICAgJ2JwbW46TWVzc2FnZUV2ZW50RGVmaW5pdGlvbic6IGZ1bmN0aW9uKHBhcmVudEdmeCwgZWxlbWVudCwgaXNUaHJvd2luZykgewogICAgICAgIHZhciBwYXRoRGF0YSA9IHBhdGhNYXAuZ2V0U2NhbGVkUGF0aCgnRVZFTlRfTUVTU0FHRScsIHsKICAgICAgICAgIHhTY2FsZUZhY3RvcjogMC45LAogICAgICAgICAgeVNjYWxlRmFjdG9yOiAwLjksCiAgICAgICAgICBjb250YWluZXJXaWR0aDogZWxlbWVudC53aWR0aCwKICAgICAgICAgIGNvbnRhaW5lckhlaWdodDogZWxlbWVudC5oZWlnaHQsCiAgICAgICAgICBwb3NpdGlvbjogewogICAgICAgICAgICBteDogMC4yMzUsCiAgICAgICAgICAgIG15OiAwLjMxNQogICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICB2YXIgZmlsbCA9IGlzVGhyb3dpbmcgPyBnZXRTdHJva2VDb2xvcihlbGVtZW50LCBkZWZhdWx0U3Ryb2tlQ29sb3IpIDogZ2V0RmlsbENvbG9yKGVsZW1lbnQsIGRlZmF1bHRGaWxsQ29sb3IpOwogICAgICAgIHZhciBzdHJva2UgPSBpc1Rocm93aW5nID8gZ2V0RmlsbENvbG9yKGVsZW1lbnQsIGRlZmF1bHRGaWxsQ29sb3IpIDogZ2V0U3Ryb2tlQ29sb3IoZWxlbWVudCwgZGVmYXVsdFN0cm9rZUNvbG9yKTsKCiAgICAgICAgdmFyIG1lc3NhZ2VQYXRoID0gZHJhd1BhdGgocGFyZW50R2Z4LCBwYXRoRGF0YSwgewogICAgICAgICAgc3Ryb2tlV2lkdGg6IDEsCiAgICAgICAgICBmaWxsOiBmaWxsLAogICAgICAgICAgc3Ryb2tlOiBzdHJva2UKICAgICAgICB9KTsKCiAgICAgICAgcmV0dXJuIG1lc3NhZ2VQYXRoOwogICAgICB9LAogICAgICAnYnBtbjpUaW1lckV2ZW50RGVmaW5pdGlvbic6IGZ1bmN0aW9uKHBhcmVudEdmeCwgZWxlbWVudCkgewogICAgICAgIHZhciBjaXJjbGUgPSBkcmF3Q2lyY2xlKHBhcmVudEdmeCwgZWxlbWVudC53aWR0aCwgZWxlbWVudC5oZWlnaHQsIDAuMiAqIGVsZW1lbnQuaGVpZ2h0LCB7CiAgICAgICAgICBzdHJva2VXaWR0aDogMiwKICAgICAgICAgIGZpbGw6IGdldEZpbGxDb2xvcihlbGVtZW50LCBkZWZhdWx0RmlsbENvbG9yKSwKICAgICAgICAgIHN0cm9rZTogZ2V0U3Ryb2tlQ29sb3IoZWxlbWVudCwgZGVmYXVsdFN0cm9rZUNvbG9yKQogICAgICAgIH0pOwoKICAgICAgICB2YXIgcGF0aERhdGEgPSBwYXRoTWFwLmdldFNjYWxlZFBhdGgoJ0VWRU5UX1RJTUVSX1dIJywgewogICAgICAgICAgeFNjYWxlRmFjdG9yOiAwLjc1LAogICAgICAgICAgeVNjYWxlRmFjdG9yOiAwLjc1LAogICAgICAgICAgY29udGFpbmVyV2lkdGg6IGVsZW1lbnQud2lkdGgsCiAgICAgICAgICBjb250YWluZXJIZWlnaHQ6IGVsZW1lbnQuaGVpZ2h0LAogICAgICAgICAgcG9zaXRpb246IHsKICAgICAgICAgICAgbXg6IDAuNSwKICAgICAgICAgICAgbXk6IDAuNQogICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICBkcmF3UGF0aChwYXJlbnRHZngsIHBhdGhEYXRhLCB7CiAgICAgICAgICBzdHJva2VXaWR0aDogMiwKICAgICAgICAgIHN0cm9rZUxpbmVjYXA6ICdzcXVhcmUnLAogICAgICAgICAgc3Ryb2tlOiBnZXRTdHJva2VDb2xvcihlbGVtZW50LCBkZWZhdWx0U3Ryb2tlQ29sb3IpCiAgICAgICAgfSk7CgogICAgICAgIGZvciAodmFyIGkgPSAwO2kgPCAxMjsgaSsrKSB7CgogICAgICAgICAgdmFyIGxpbmVQYXRoRGF0YSA9IHBhdGhNYXAuZ2V0U2NhbGVkUGF0aCgnRVZFTlRfVElNRVJfTElORScsIHsKICAgICAgICAgICAgeFNjYWxlRmFjdG9yOiAwLjc1LAogICAgICAgICAgICB5U2NhbGVGYWN0b3I6IDAuNzUsCiAgICAgICAgICAgIGNvbnRhaW5lcldpZHRoOiBlbGVtZW50LndpZHRoLAogICAgICAgICAgICBjb250YWluZXJIZWlnaHQ6IGVsZW1lbnQuaGVpZ2h0LAogICAgICAgICAgICBwb3NpdGlvbjogewogICAgICAgICAgICAgIG14OiAwLjUsCiAgICAgICAgICAgICAgbXk6IDAuNQogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKCiAgICAgICAgICB2YXIgd2lkdGggPSBlbGVtZW50LndpZHRoIC8gMjsKICAgICAgICAgIHZhciBoZWlnaHQgPSBlbGVtZW50LmhlaWdodCAvIDI7CgogICAgICAgICAgZHJhd1BhdGgocGFyZW50R2Z4LCBsaW5lUGF0aERhdGEsIHsKICAgICAgICAgICAgc3Ryb2tlV2lkdGg6IDEsCiAgICAgICAgICAgIHN0cm9rZUxpbmVjYXA6ICdzcXVhcmUnLAogICAgICAgICAgICB0cmFuc2Zvcm06ICdyb3RhdGUoJyArIChpICogMzApICsgJywnICsgaGVpZ2h0ICsgJywnICsgd2lkdGggKyAnKScsCiAgICAgICAgICAgIHN0cm9rZTogZ2V0U3Ryb2tlQ29sb3IoZWxlbWVudCwgZGVmYXVsdFN0cm9rZUNvbG9yKQogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gY2lyY2xlOwogICAgICB9LAogICAgICAnYnBtbjpFc2NhbGF0aW9uRXZlbnREZWZpbml0aW9uJzogZnVuY3Rpb24ocGFyZW50R2Z4LCBldmVudCwgaXNUaHJvd2luZykgewogICAgICAgIHZhciBwYXRoRGF0YSA9IHBhdGhNYXAuZ2V0U2NhbGVkUGF0aCgnRVZFTlRfRVNDQUxBVElPTicsIHsKICAgICAgICAgIHhTY2FsZUZhY3RvcjogMSwKICAgICAgICAgIHlTY2FsZUZhY3RvcjogMSwKICAgICAgICAgIGNvbnRhaW5lcldpZHRoOiBldmVudC53aWR0aCwKICAgICAgICAgIGNvbnRhaW5lckhlaWdodDogZXZlbnQuaGVpZ2h0LAogICAgICAgICAgcG9zaXRpb246IHsKICAgICAgICAgICAgbXg6IDAuNSwKICAgICAgICAgICAgbXk6IDAuMgogICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICB2YXIgZmlsbCA9IGlzVGhyb3dpbmcgPyBnZXRTdHJva2VDb2xvcihldmVudCwgZGVmYXVsdFN0cm9rZUNvbG9yKSA6ICdub25lJzsKCiAgICAgICAgcmV0dXJuIGRyYXdQYXRoKHBhcmVudEdmeCwgcGF0aERhdGEsIHsKICAgICAgICAgIHN0cm9rZVdpZHRoOiAxLAogICAgICAgICAgZmlsbDogZmlsbCwKICAgICAgICAgIHN0cm9rZTogZ2V0U3Ryb2tlQ29sb3IoZXZlbnQsIGRlZmF1bHRTdHJva2VDb2xvcikKICAgICAgICB9KTsKICAgICAgfSwKICAgICAgJ2JwbW46Q29uZGl0aW9uYWxFdmVudERlZmluaXRpb24nOiBmdW5jdGlvbihwYXJlbnRHZngsIGV2ZW50KSB7CiAgICAgICAgdmFyIHBhdGhEYXRhID0gcGF0aE1hcC5nZXRTY2FsZWRQYXRoKCdFVkVOVF9DT05ESVRJT05BTCcsIHsKICAgICAgICAgIHhTY2FsZUZhY3RvcjogMSwKICAgICAgICAgIHlTY2FsZUZhY3RvcjogMSwKICAgICAgICAgIGNvbnRhaW5lcldpZHRoOiBldmVudC53aWR0aCwKICAgICAgICAgIGNvbnRhaW5lckhlaWdodDogZXZlbnQuaGVpZ2h0LAogICAgICAgICAgcG9zaXRpb246IHsKICAgICAgICAgICAgbXg6IDAuNSwKICAgICAgICAgICAgbXk6IDAuMjIyCiAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIHJldHVybiBkcmF3UGF0aChwYXJlbnRHZngsIHBhdGhEYXRhLCB7CiAgICAgICAgICBzdHJva2VXaWR0aDogMSwKICAgICAgICAgIHN0cm9rZTogZ2V0U3Ryb2tlQ29sb3IoZXZlbnQsIGRlZmF1bHRTdHJva2VDb2xvcikKICAgICAgICB9KTsKICAgICAgfSwKICAgICAgJ2JwbW46TGlua0V2ZW50RGVmaW5pdGlvbic6IGZ1bmN0aW9uKHBhcmVudEdmeCwgZXZlbnQsIGlzVGhyb3dpbmcpIHsKICAgICAgICB2YXIgcGF0aERhdGEgPSBwYXRoTWFwLmdldFNjYWxlZFBhdGgoJ0VWRU5UX0xJTksnLCB7CiAgICAgICAgICB4U2NhbGVGYWN0b3I6IDEsCiAgICAgICAgICB5U2NhbGVGYWN0b3I6IDEsCiAgICAgICAgICBjb250YWluZXJXaWR0aDogZXZlbnQud2lkdGgsCiAgICAgICAgICBjb250YWluZXJIZWlnaHQ6IGV2ZW50LmhlaWdodCwKICAgICAgICAgIHBvc2l0aW9uOiB7CiAgICAgICAgICAgIG14OiAwLjU3LAogICAgICAgICAgICBteTogMC4yNjMKICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgdmFyIGZpbGwgPSBpc1Rocm93aW5nID8gZ2V0U3Ryb2tlQ29sb3IoZXZlbnQsIGRlZmF1bHRTdHJva2VDb2xvcikgOiAnbm9uZSc7CgogICAgICAgIHJldHVybiBkcmF3UGF0aChwYXJlbnRHZngsIHBhdGhEYXRhLCB7CiAgICAgICAgICBzdHJva2VXaWR0aDogMSwKICAgICAgICAgIGZpbGw6IGZpbGwsCiAgICAgICAgICBzdHJva2U6IGdldFN0cm9rZUNvbG9yKGV2ZW50LCBkZWZhdWx0U3Ryb2tlQ29sb3IpCiAgICAgICAgfSk7CiAgICAgIH0sCiAgICAgICdicG1uOkVycm9yRXZlbnREZWZpbml0aW9uJzogZnVuY3Rpb24ocGFyZW50R2Z4LCBldmVudCwgaXNUaHJvd2luZykgewogICAgICAgIHZhciBwYXRoRGF0YSA9IHBhdGhNYXAuZ2V0U2NhbGVkUGF0aCgnRVZFTlRfRVJST1InLCB7CiAgICAgICAgICB4U2NhbGVGYWN0b3I6IDEuMSwKICAgICAgICAgIHlTY2FsZUZhY3RvcjogMS4xLAogICAgICAgICAgY29udGFpbmVyV2lkdGg6IGV2ZW50LndpZHRoLAogICAgICAgICAgY29udGFpbmVySGVpZ2h0OiBldmVudC5oZWlnaHQsCiAgICAgICAgICBwb3NpdGlvbjogewogICAgICAgICAgICBteDogMC4yLAogICAgICAgICAgICBteTogMC43MjIKICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgdmFyIGZpbGwgPSBpc1Rocm93aW5nID8gZ2V0U3Ryb2tlQ29sb3IoZXZlbnQsIGRlZmF1bHRTdHJva2VDb2xvcikgOiAnbm9uZSc7CgogICAgICAgIHJldHVybiBkcmF3UGF0aChwYXJlbnRHZngsIHBhdGhEYXRhLCB7CiAgICAgICAgICBzdHJva2VXaWR0aDogMSwKICAgICAgICAgIGZpbGw6IGZpbGwsCiAgICAgICAgICBzdHJva2U6IGdldFN0cm9rZUNvbG9yKGV2ZW50LCBkZWZhdWx0U3Ryb2tlQ29sb3IpCiAgICAgICAgfSk7CiAgICAgIH0sCiAgICAgICdicG1uOkNhbmNlbEV2ZW50RGVmaW5pdGlvbic6IGZ1bmN0aW9uKHBhcmVudEdmeCwgZXZlbnQsIGlzVGhyb3dpbmcpIHsKICAgICAgICB2YXIgcGF0aERhdGEgPSBwYXRoTWFwLmdldFNjYWxlZFBhdGgoJ0VWRU5UX0NBTkNFTF80NScsIHsKICAgICAgICAgIHhTY2FsZUZhY3RvcjogMS4wLAogICAgICAgICAgeVNjYWxlRmFjdG9yOiAxLjAsCiAgICAgICAgICBjb250YWluZXJXaWR0aDogZXZlbnQud2lkdGgsCiAgICAgICAgICBjb250YWluZXJIZWlnaHQ6IGV2ZW50LmhlaWdodCwKICAgICAgICAgIHBvc2l0aW9uOiB7CiAgICAgICAgICAgIG14OiAwLjYzOCwKICAgICAgICAgICAgbXk6IC0wLjA1NQogICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICB2YXIgZmlsbCA9IGlzVGhyb3dpbmcgPyBnZXRTdHJva2VDb2xvcihldmVudCwgZGVmYXVsdFN0cm9rZUNvbG9yKSA6ICdub25lJzsKCiAgICAgICAgdmFyIHBhdGggPSBkcmF3UGF0aChwYXJlbnRHZngsIHBhdGhEYXRhLCB7CiAgICAgICAgICBzdHJva2VXaWR0aDogMSwKICAgICAgICAgIGZpbGw6IGZpbGwsCiAgICAgICAgICBzdHJva2U6IGdldFN0cm9rZUNvbG9yKGV2ZW50LCBkZWZhdWx0U3Ryb2tlQ29sb3IpCiAgICAgICAgfSk7CgogICAgICAgIHJvdGF0ZShwYXRoLCA0NSk7CgogICAgICAgIHJldHVybiBwYXRoOwogICAgICB9LAogICAgICAnYnBtbjpDb21wZW5zYXRlRXZlbnREZWZpbml0aW9uJzogZnVuY3Rpb24ocGFyZW50R2Z4LCBldmVudCwgaXNUaHJvd2luZykgewogICAgICAgIHZhciBwYXRoRGF0YSA9IHBhdGhNYXAuZ2V0U2NhbGVkUGF0aCgnRVZFTlRfQ09NUEVOU0FUSU9OJywgewogICAgICAgICAgeFNjYWxlRmFjdG9yOiAxLAogICAgICAgICAgeVNjYWxlRmFjdG9yOiAxLAogICAgICAgICAgY29udGFpbmVyV2lkdGg6IGV2ZW50LndpZHRoLAogICAgICAgICAgY29udGFpbmVySGVpZ2h0OiBldmVudC5oZWlnaHQsCiAgICAgICAgICBwb3NpdGlvbjogewogICAgICAgICAgICBteDogMC4yMiwKICAgICAgICAgICAgbXk6IDAuNQogICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICB2YXIgZmlsbCA9IGlzVGhyb3dpbmcgPyBnZXRTdHJva2VDb2xvcihldmVudCwgZGVmYXVsdFN0cm9rZUNvbG9yKSA6ICdub25lJzsKCiAgICAgICAgcmV0dXJuIGRyYXdQYXRoKHBhcmVudEdmeCwgcGF0aERhdGEsIHsKICAgICAgICAgIHN0cm9rZVdpZHRoOiAxLAogICAgICAgICAgZmlsbDogZmlsbCwKICAgICAgICAgIHN0cm9rZTogZ2V0U3Ryb2tlQ29sb3IoZXZlbnQsIGRlZmF1bHRTdHJva2VDb2xvcikKICAgICAgICB9KTsKICAgICAgfSwKICAgICAgJ2JwbW46U2lnbmFsRXZlbnREZWZpbml0aW9uJzogZnVuY3Rpb24ocGFyZW50R2Z4LCBldmVudCwgaXNUaHJvd2luZykgewogICAgICAgIHZhciBwYXRoRGF0YSA9IHBhdGhNYXAuZ2V0U2NhbGVkUGF0aCgnRVZFTlRfU0lHTkFMJywgewogICAgICAgICAgeFNjYWxlRmFjdG9yOiAwLjksCiAgICAgICAgICB5U2NhbGVGYWN0b3I6IDAuOSwKICAgICAgICAgIGNvbnRhaW5lcldpZHRoOiBldmVudC53aWR0aCwKICAgICAgICAgIGNvbnRhaW5lckhlaWdodDogZXZlbnQuaGVpZ2h0LAogICAgICAgICAgcG9zaXRpb246IHsKICAgICAgICAgICAgbXg6IDAuNSwKICAgICAgICAgICAgbXk6IDAuMgogICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICB2YXIgZmlsbCA9IGlzVGhyb3dpbmcgPyBnZXRTdHJva2VDb2xvcihldmVudCwgZGVmYXVsdFN0cm9rZUNvbG9yKSA6ICdub25lJzsKCiAgICAgICAgcmV0dXJuIGRyYXdQYXRoKHBhcmVudEdmeCwgcGF0aERhdGEsIHsKICAgICAgICAgIHN0cm9rZVdpZHRoOiAxLAogICAgICAgICAgZmlsbDogZmlsbCwKICAgICAgICAgIHN0cm9rZTogZ2V0U3Ryb2tlQ29sb3IoZXZlbnQsIGRlZmF1bHRTdHJva2VDb2xvcikKICAgICAgICB9KTsKICAgICAgfSwKICAgICAgJ2JwbW46TXVsdGlwbGVFdmVudERlZmluaXRpb24nOiBmdW5jdGlvbihwYXJlbnRHZngsIGV2ZW50LCBpc1Rocm93aW5nKSB7CiAgICAgICAgdmFyIHBhdGhEYXRhID0gcGF0aE1hcC5nZXRTY2FsZWRQYXRoKCdFVkVOVF9NVUxUSVBMRScsIHsKICAgICAgICAgIHhTY2FsZUZhY3RvcjogMS4xLAogICAgICAgICAgeVNjYWxlRmFjdG9yOiAxLjEsCiAgICAgICAgICBjb250YWluZXJXaWR0aDogZXZlbnQud2lkdGgsCiAgICAgICAgICBjb250YWluZXJIZWlnaHQ6IGV2ZW50LmhlaWdodCwKICAgICAgICAgIHBvc2l0aW9uOiB7CiAgICAgICAgICAgIG14OiAwLjIyMiwKICAgICAgICAgICAgbXk6IDAuMzYKICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgdmFyIGZpbGwgPSBpc1Rocm93aW5nID8gZ2V0U3Ryb2tlQ29sb3IoZXZlbnQsIGRlZmF1bHRTdHJva2VDb2xvcikgOiAnbm9uZSc7CgogICAgICAgIHJldHVybiBkcmF3UGF0aChwYXJlbnRHZngsIHBhdGhEYXRhLCB7CiAgICAgICAgICBzdHJva2VXaWR0aDogMSwKICAgICAgICAgIGZpbGw6IGZpbGwKICAgICAgICB9KTsKICAgICAgfSwKICAgICAgJ2JwbW46UGFyYWxsZWxNdWx0aXBsZUV2ZW50RGVmaW5pdGlvbic6IGZ1bmN0aW9uKHBhcmVudEdmeCwgZXZlbnQpIHsKICAgICAgICB2YXIgcGF0aERhdGEgPSBwYXRoTWFwLmdldFNjYWxlZFBhdGgoJ0VWRU5UX1BBUkFMTEVMX01VTFRJUExFJywgewogICAgICAgICAgeFNjYWxlRmFjdG9yOiAxLjIsCiAgICAgICAgICB5U2NhbGVGYWN0b3I6IDEuMiwKICAgICAgICAgIGNvbnRhaW5lcldpZHRoOiBldmVudC53aWR0aCwKICAgICAgICAgIGNvbnRhaW5lckhlaWdodDogZXZlbnQuaGVpZ2h0LAogICAgICAgICAgcG9zaXRpb246IHsKICAgICAgICAgICAgbXg6IDAuNDU4LAogICAgICAgICAgICBteTogMC4xOTQKICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgcmV0dXJuIGRyYXdQYXRoKHBhcmVudEdmeCwgcGF0aERhdGEsIHsKICAgICAgICAgIHN0cm9rZVdpZHRoOiAxLAogICAgICAgICAgZmlsbDogZ2V0U3Ryb2tlQ29sb3IoZXZlbnQsIGRlZmF1bHRTdHJva2VDb2xvciksCiAgICAgICAgICBzdHJva2U6IGdldFN0cm9rZUNvbG9yKGV2ZW50LCBkZWZhdWx0U3Ryb2tlQ29sb3IpCiAgICAgICAgfSk7CiAgICAgIH0sCiAgICAgICdicG1uOkVuZEV2ZW50JzogZnVuY3Rpb24ocGFyZW50R2Z4LCBlbGVtZW50KSB7CiAgICAgICAgdmFyIGNpcmNsZSA9IHJlbmRlcmVyKCdicG1uOkV2ZW50JykocGFyZW50R2Z4LCBlbGVtZW50LCB7CiAgICAgICAgICBzdHJva2VXaWR0aDogNCwKICAgICAgICAgIGZpbGw6IGdldEZpbGxDb2xvcihlbGVtZW50LCBkZWZhdWx0RmlsbENvbG9yKSwKICAgICAgICAgIHN0cm9rZTogZ2V0U3Ryb2tlQ29sb3IoZWxlbWVudCwgZGVmYXVsdFN0cm9rZUNvbG9yKQogICAgICAgIH0pOwoKICAgICAgICByZW5kZXJFdmVudENvbnRlbnQoZWxlbWVudCwgcGFyZW50R2Z4KTsKCiAgICAgICAgcmV0dXJuIGNpcmNsZTsKICAgICAgfSwKICAgICAgJ2JwbW46VGVybWluYXRlRXZlbnREZWZpbml0aW9uJzogZnVuY3Rpb24ocGFyZW50R2Z4LCBlbGVtZW50KSB7CiAgICAgICAgdmFyIGNpcmNsZSA9IGRyYXdDaXJjbGUocGFyZW50R2Z4LCBlbGVtZW50LndpZHRoLCBlbGVtZW50LmhlaWdodCwgOCwgewogICAgICAgICAgc3Ryb2tlV2lkdGg6IDQsCiAgICAgICAgICBmaWxsOiBnZXRTdHJva2VDb2xvcihlbGVtZW50LCBkZWZhdWx0U3Ryb2tlQ29sb3IpLAogICAgICAgICAgc3Ryb2tlOiBnZXRTdHJva2VDb2xvcihlbGVtZW50LCBkZWZhdWx0U3Ryb2tlQ29sb3IpCiAgICAgICAgfSk7CgogICAgICAgIHJldHVybiBjaXJjbGU7CiAgICAgIH0sCiAgICAgICdicG1uOkludGVybWVkaWF0ZUV2ZW50JzogZnVuY3Rpb24ocGFyZW50R2Z4LCBlbGVtZW50KSB7CiAgICAgICAgdmFyIG91dGVyID0gcmVuZGVyZXIoJ2JwbW46RXZlbnQnKShwYXJlbnRHZngsIGVsZW1lbnQsIHsKICAgICAgICAgIHN0cm9rZVdpZHRoOiAxLAogICAgICAgICAgZmlsbDogZ2V0RmlsbENvbG9yKGVsZW1lbnQsIGRlZmF1bHRGaWxsQ29sb3IpLAogICAgICAgICAgc3Ryb2tlOiBnZXRTdHJva2VDb2xvcihlbGVtZW50LCBkZWZhdWx0U3Ryb2tlQ29sb3IpCiAgICAgICAgfSk7CgogICAgICAgIC8qIGlubmVyICovCiAgICAgICAgZHJhd0NpcmNsZShwYXJlbnRHZngsIGVsZW1lbnQud2lkdGgsIGVsZW1lbnQuaGVpZ2h0LCBJTk5FUl9PVVRFUl9ESVNULCB7CiAgICAgICAgICBzdHJva2VXaWR0aDogMSwKICAgICAgICAgIGZpbGw6IGdldEZpbGxDb2xvcihlbGVtZW50LCAnbm9uZScpLAogICAgICAgICAgc3Ryb2tlOiBnZXRTdHJva2VDb2xvcihlbGVtZW50LCBkZWZhdWx0U3Ryb2tlQ29sb3IpCiAgICAgICAgfSk7CgogICAgICAgIHJlbmRlckV2ZW50Q29udGVudChlbGVtZW50LCBwYXJlbnRHZngpOwoKICAgICAgICByZXR1cm4gb3V0ZXI7CiAgICAgIH0sCiAgICAgICdicG1uOkludGVybWVkaWF0ZUNhdGNoRXZlbnQnOiBhcygnYnBtbjpJbnRlcm1lZGlhdGVFdmVudCcpLAogICAgICAnYnBtbjpJbnRlcm1lZGlhdGVUaHJvd0V2ZW50JzogYXMoJ2JwbW46SW50ZXJtZWRpYXRlRXZlbnQnKSwKCiAgICAgICdicG1uOkFjdGl2aXR5JzogZnVuY3Rpb24ocGFyZW50R2Z4LCBlbGVtZW50LCBhdHRycykgewoKICAgICAgICBhdHRycyA9IGF0dHJzIHx8IHt9OwoKICAgICAgICBpZiAoISgnZmlsbE9wYWNpdHknIGluIGF0dHJzKSkgewogICAgICAgICAgYXR0cnMuZmlsbE9wYWNpdHkgPSBERUZBVUxUX0ZJTExfT1BBQ0lUWTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBkcmF3UmVjdChwYXJlbnRHZngsIGVsZW1lbnQud2lkdGgsIGVsZW1lbnQuaGVpZ2h0LCBUQVNLX0JPUkRFUl9SQURJVVMsIGF0dHJzKTsKICAgICAgfSwKCiAgICAgICdicG1uOlRhc2snOiBmdW5jdGlvbihwYXJlbnRHZngsIGVsZW1lbnQpIHsKICAgICAgICB2YXIgYXR0cnMgPSB7CiAgICAgICAgICBmaWxsOiBnZXRGaWxsQ29sb3IoZWxlbWVudCwgZGVmYXVsdEZpbGxDb2xvciksCiAgICAgICAgICBzdHJva2U6IGdldFN0cm9rZUNvbG9yKGVsZW1lbnQsIGRlZmF1bHRTdHJva2VDb2xvcikKICAgICAgICB9OwoKICAgICAgICB2YXIgcmVjdCA9IHJlbmRlcmVyKCdicG1uOkFjdGl2aXR5JykocGFyZW50R2Z4LCBlbGVtZW50LCBhdHRycyk7CgogICAgICAgIHJlbmRlckVtYmVkZGVkTGFiZWwocGFyZW50R2Z4LCBlbGVtZW50LCAnY2VudGVyLW1pZGRsZScpOwogICAgICAgIGF0dGFjaFRhc2tNYXJrZXJzKHBhcmVudEdmeCwgZWxlbWVudCk7CgogICAgICAgIHJldHVybiByZWN0OwogICAgICB9LAogICAgICAnYnBtbjpTZXJ2aWNlVGFzayc6IGZ1bmN0aW9uKHBhcmVudEdmeCwgZWxlbWVudCkgewogICAgICAgIHZhciB0YXNrID0gcmVuZGVyZXIoJ2JwbW46VGFzaycpKHBhcmVudEdmeCwgZWxlbWVudCk7CgogICAgICAgIHZhciBwYXRoRGF0YUJHID0gcGF0aE1hcC5nZXRTY2FsZWRQYXRoKCdUQVNLX1RZUEVfU0VSVklDRScsIHsKICAgICAgICAgIGFic3BvczogewogICAgICAgICAgICB4OiAxMiwKICAgICAgICAgICAgeTogMTgKICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgLyogc2VydmljZSBiZyAqLyBkcmF3UGF0aChwYXJlbnRHZngsIHBhdGhEYXRhQkcsIHsKICAgICAgICAgIHN0cm9rZVdpZHRoOiAxLAogICAgICAgICAgZmlsbDogZ2V0RmlsbENvbG9yKGVsZW1lbnQsIGRlZmF1bHRGaWxsQ29sb3IpLAogICAgICAgICAgc3Ryb2tlOiBnZXRTdHJva2VDb2xvcihlbGVtZW50LCBkZWZhdWx0U3Ryb2tlQ29sb3IpCiAgICAgICAgfSk7CgogICAgICAgIHZhciBmaWxsUGF0aERhdGEgPSBwYXRoTWFwLmdldFNjYWxlZFBhdGgoJ1RBU0tfVFlQRV9TRVJWSUNFX0ZJTEwnLCB7CiAgICAgICAgICBhYnNwb3M6IHsKICAgICAgICAgICAgeDogMTcuMiwKICAgICAgICAgICAgeTogMTgKICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgLyogc2VydmljZSBmaWxsICovIGRyYXdQYXRoKHBhcmVudEdmeCwgZmlsbFBhdGhEYXRhLCB7CiAgICAgICAgICBzdHJva2VXaWR0aDogMCwKICAgICAgICAgIGZpbGw6IGdldEZpbGxDb2xvcihlbGVtZW50LCBkZWZhdWx0RmlsbENvbG9yKQogICAgICAgIH0pOwoKICAgICAgICB2YXIgcGF0aERhdGEgPSBwYXRoTWFwLmdldFNjYWxlZFBhdGgoJ1RBU0tfVFlQRV9TRVJWSUNFJywgewogICAgICAgICAgYWJzcG9zOiB7CiAgICAgICAgICAgIHg6IDE3LAogICAgICAgICAgICB5OiAyMgogICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICAvKiBzZXJ2aWNlICovIGRyYXdQYXRoKHBhcmVudEdmeCwgcGF0aERhdGEsIHsKICAgICAgICAgIHN0cm9rZVdpZHRoOiAxLAogICAgICAgICAgZmlsbDogZ2V0RmlsbENvbG9yKGVsZW1lbnQsIGRlZmF1bHRGaWxsQ29sb3IpLAogICAgICAgICAgc3Ryb2tlOiBnZXRTdHJva2VDb2xvcihlbGVtZW50LCBkZWZhdWx0U3Ryb2tlQ29sb3IpCiAgICAgICAgfSk7CgogICAgICAgIHJldHVybiB0YXNrOwogICAgICB9LAogICAgICAnYnBtbjpVc2VyVGFzayc6IGZ1bmN0aW9uKHBhcmVudEdmeCwgZWxlbWVudCkgewogICAgICAgIHZhciB0YXNrID0gcmVuZGVyZXIoJ2JwbW46VGFzaycpKHBhcmVudEdmeCwgZWxlbWVudCk7CgogICAgICAgIHZhciB4ID0gMTU7CiAgICAgICAgdmFyIHkgPSAxMjsKCiAgICAgICAgdmFyIHBhdGhEYXRhID0gcGF0aE1hcC5nZXRTY2FsZWRQYXRoKCdUQVNLX1RZUEVfVVNFUl8xJywgewogICAgICAgICAgYWJzcG9zOiB7CiAgICAgICAgICAgIHg6IHgsCiAgICAgICAgICAgIHk6IHkKICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgLyogdXNlciBwYXRoICovIGRyYXdQYXRoKHBhcmVudEdmeCwgcGF0aERhdGEsIHsKICAgICAgICAgIHN0cm9rZVdpZHRoOiAwLjUsCiAgICAgICAgICBmaWxsOiBnZXRGaWxsQ29sb3IoZWxlbWVudCwgZGVmYXVsdEZpbGxDb2xvciksCiAgICAgICAgICBzdHJva2U6IGdldFN0cm9rZUNvbG9yKGVsZW1lbnQsIGRlZmF1bHRTdHJva2VDb2xvcikKICAgICAgICB9KTsKCiAgICAgICAgdmFyIHBhdGhEYXRhMiA9IHBhdGhNYXAuZ2V0U2NhbGVkUGF0aCgnVEFTS19UWVBFX1VTRVJfMicsIHsKICAgICAgICAgIGFic3BvczogewogICAgICAgICAgICB4OiB4LAogICAgICAgICAgICB5OiB5CiAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIC8qIHVzZXIyIHBhdGggKi8gZHJhd1BhdGgocGFyZW50R2Z4LCBwYXRoRGF0YTIsIHsKICAgICAgICAgIHN0cm9rZVdpZHRoOiAwLjUsCiAgICAgICAgICBmaWxsOiBnZXRGaWxsQ29sb3IoZWxlbWVudCwgZGVmYXVsdEZpbGxDb2xvciksCiAgICAgICAgICBzdHJva2U6IGdldFN0cm9rZUNvbG9yKGVsZW1lbnQsIGRlZmF1bHRTdHJva2VDb2xvcikKICAgICAgICB9KTsKCiAgICAgICAgdmFyIHBhdGhEYXRhMyA9IHBhdGhNYXAuZ2V0U2NhbGVkUGF0aCgnVEFTS19UWVBFX1VTRVJfMycsIHsKICAgICAgICAgIGFic3BvczogewogICAgICAgICAgICB4OiB4LAogICAgICAgICAgICB5OiB5CiAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIC8qIHVzZXIzIHBhdGggKi8gZHJhd1BhdGgocGFyZW50R2Z4LCBwYXRoRGF0YTMsIHsKICAgICAgICAgIHN0cm9rZVdpZHRoOiAwLjUsCiAgICAgICAgICBmaWxsOiBnZXRTdHJva2VDb2xvcihlbGVtZW50LCBkZWZhdWx0U3Ryb2tlQ29sb3IpLAogICAgICAgICAgc3Ryb2tlOiBnZXRTdHJva2VDb2xvcihlbGVtZW50LCBkZWZhdWx0U3Ryb2tlQ29sb3IpCiAgICAgICAgfSk7CgogICAgICAgIHJldHVybiB0YXNrOwogICAgICB9LAogICAgICAnYnBtbjpNYW51YWxUYXNrJzogZnVuY3Rpb24ocGFyZW50R2Z4LCBlbGVtZW50KSB7CiAgICAgICAgdmFyIHRhc2sgPSByZW5kZXJlcignYnBtbjpUYXNrJykocGFyZW50R2Z4LCBlbGVtZW50KTsKCiAgICAgICAgdmFyIHBhdGhEYXRhID0gcGF0aE1hcC5nZXRTY2FsZWRQYXRoKCdUQVNLX1RZUEVfTUFOVUFMJywgewogICAgICAgICAgYWJzcG9zOiB7CiAgICAgICAgICAgIHg6IDE3LAogICAgICAgICAgICB5OiAxNQogICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICAvKiBtYW51YWwgcGF0aCAqLyBkcmF3UGF0aChwYXJlbnRHZngsIHBhdGhEYXRhLCB7CiAgICAgICAgICBzdHJva2VXaWR0aDogMC41LCAvLyAwLjI1LAogICAgICAgICAgZmlsbDogZ2V0RmlsbENvbG9yKGVsZW1lbnQsIGRlZmF1bHRGaWxsQ29sb3IpLAogICAgICAgICAgc3Ryb2tlOiBnZXRTdHJva2VDb2xvcihlbGVtZW50LCBkZWZhdWx0U3Ryb2tlQ29sb3IpCiAgICAgICAgfSk7CgogICAgICAgIHJldHVybiB0YXNrOwogICAgICB9LAogICAgICAnYnBtbjpTZW5kVGFzayc6IGZ1bmN0aW9uKHBhcmVudEdmeCwgZWxlbWVudCkgewogICAgICAgIHZhciB0YXNrID0gcmVuZGVyZXIoJ2JwbW46VGFzaycpKHBhcmVudEdmeCwgZWxlbWVudCk7CgogICAgICAgIHZhciBwYXRoRGF0YSA9IHBhdGhNYXAuZ2V0U2NhbGVkUGF0aCgnVEFTS19UWVBFX1NFTkQnLCB7CiAgICAgICAgICB4U2NhbGVGYWN0b3I6IDEsCiAgICAgICAgICB5U2NhbGVGYWN0b3I6IDEsCiAgICAgICAgICBjb250YWluZXJXaWR0aDogMjEsCiAgICAgICAgICBjb250YWluZXJIZWlnaHQ6IDE0LAogICAgICAgICAgcG9zaXRpb246IHsKICAgICAgICAgICAgbXg6IDAuMjg1LAogICAgICAgICAgICBteTogMC4zNTcKICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgLyogc2VuZCBwYXRoICovIGRyYXdQYXRoKHBhcmVudEdmeCwgcGF0aERhdGEsIHsKICAgICAgICAgIHN0cm9rZVdpZHRoOiAxLAogICAgICAgICAgZmlsbDogZ2V0U3Ryb2tlQ29sb3IoZWxlbWVudCwgZGVmYXVsdFN0cm9rZUNvbG9yKSwKICAgICAgICAgIHN0cm9rZTogZ2V0RmlsbENvbG9yKGVsZW1lbnQsIGRlZmF1bHRGaWxsQ29sb3IpCiAgICAgICAgfSk7CgogICAgICAgIHJldHVybiB0YXNrOwogICAgICB9LAogICAgICAnYnBtbjpSZWNlaXZlVGFzaycgOiBmdW5jdGlvbihwYXJlbnRHZngsIGVsZW1lbnQpIHsKICAgICAgICB2YXIgc2VtYW50aWMgPSBnZXRTZW1hbnRpYyhlbGVtZW50KTsKCiAgICAgICAgdmFyIHRhc2sgPSByZW5kZXJlcignYnBtbjpUYXNrJykocGFyZW50R2Z4LCBlbGVtZW50KTsKICAgICAgICB2YXIgcGF0aERhdGE7CgogICAgICAgIGlmIChzZW1hbnRpYy5pbnN0YW50aWF0ZSkgewogICAgICAgICAgZHJhd0NpcmNsZShwYXJlbnRHZngsIDI4LCAyOCwgMjAgKiAwLjIyLCB7IHN0cm9rZVdpZHRoOiAxIH0pOwoKICAgICAgICAgIHBhdGhEYXRhID0gcGF0aE1hcC5nZXRTY2FsZWRQYXRoKCdUQVNLX1RZUEVfSU5TVEFOVElBVElOR19TRU5EJywgewogICAgICAgICAgICBhYnNwb3M6IHsKICAgICAgICAgICAgICB4OiA3Ljc3LAogICAgICAgICAgICAgIHk6IDkuNTIKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKCiAgICAgICAgICBwYXRoRGF0YSA9IHBhdGhNYXAuZ2V0U2NhbGVkUGF0aCgnVEFTS19UWVBFX1NFTkQnLCB7CiAgICAgICAgICAgIHhTY2FsZUZhY3RvcjogMC45LAogICAgICAgICAgICB5U2NhbGVGYWN0b3I6IDAuOSwKICAgICAgICAgICAgY29udGFpbmVyV2lkdGg6IDIxLAogICAgICAgICAgICBjb250YWluZXJIZWlnaHQ6IDE0LAogICAgICAgICAgICBwb3NpdGlvbjogewogICAgICAgICAgICAgIG14OiAwLjMsCiAgICAgICAgICAgICAgbXk6IDAuNAogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIC8qIHJlY2VpdmUgcGF0aCAqLyBkcmF3UGF0aChwYXJlbnRHZngsIHBhdGhEYXRhLCB7CiAgICAgICAgICBzdHJva2VXaWR0aDogMSwKICAgICAgICAgIGZpbGw6IGdldEZpbGxDb2xvcihlbGVtZW50LCBkZWZhdWx0RmlsbENvbG9yKSwKICAgICAgICAgIHN0cm9rZTogZ2V0U3Ryb2tlQ29sb3IoZWxlbWVudCwgZGVmYXVsdFN0cm9rZUNvbG9yKQogICAgICAgIH0pOwoKICAgICAgICByZXR1cm4gdGFzazsKICAgICAgfSwKICAgICAgJ2JwbW46U2NyaXB0VGFzayc6IGZ1bmN0aW9uKHBhcmVudEdmeCwgZWxlbWVudCkgewogICAgICAgIHZhciB0YXNrID0gcmVuZGVyZXIoJ2JwbW46VGFzaycpKHBhcmVudEdmeCwgZWxlbWVudCk7CgogICAgICAgIHZhciBwYXRoRGF0YSA9IHBhdGhNYXAuZ2V0U2NhbGVkUGF0aCgnVEFTS19UWVBFX1NDUklQVCcsIHsKICAgICAgICAgIGFic3BvczogewogICAgICAgICAgICB4OiAxNSwKICAgICAgICAgICAgeTogMjAKICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgLyogc2NyaXB0IHBhdGggKi8gZHJhd1BhdGgocGFyZW50R2Z4LCBwYXRoRGF0YSwgewogICAgICAgICAgc3Ryb2tlV2lkdGg6IDEsCiAgICAgICAgICBzdHJva2U6IGdldFN0cm9rZUNvbG9yKGVsZW1lbnQsIGRlZmF1bHRTdHJva2VDb2xvcikKICAgICAgICB9KTsKCiAgICAgICAgcmV0dXJuIHRhc2s7CiAgICAgIH0sCiAgICAgICdicG1uOkJ1c2luZXNzUnVsZVRhc2snOiBmdW5jdGlvbihwYXJlbnRHZngsIGVsZW1lbnQpIHsKICAgICAgICB2YXIgdGFzayA9IHJlbmRlcmVyKCdicG1uOlRhc2snKShwYXJlbnRHZngsIGVsZW1lbnQpOwoKICAgICAgICB2YXIgaGVhZGVyUGF0aERhdGEgPSBwYXRoTWFwLmdldFNjYWxlZFBhdGgoJ1RBU0tfVFlQRV9CVVNJTkVTU19SVUxFX0hFQURFUicsIHsKICAgICAgICAgIGFic3BvczogewogICAgICAgICAgICB4OiA4LAogICAgICAgICAgICB5OiA4CiAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIHZhciBidXNpbmVzc0hlYWRlclBhdGggPSBkcmF3UGF0aChwYXJlbnRHZngsIGhlYWRlclBhdGhEYXRhKTsKICAgICAgICBhdHRyJDEoYnVzaW5lc3NIZWFkZXJQYXRoLCB7CiAgICAgICAgICBzdHJva2VXaWR0aDogMSwKICAgICAgICAgIGZpbGw6IGdldEZpbGxDb2xvcihlbGVtZW50LCAnI2FhYWFhYScpLAogICAgICAgICAgc3Ryb2tlOiBnZXRTdHJva2VDb2xvcihlbGVtZW50LCBkZWZhdWx0U3Ryb2tlQ29sb3IpCiAgICAgICAgfSk7CgogICAgICAgIHZhciBoZWFkZXJEYXRhID0gcGF0aE1hcC5nZXRTY2FsZWRQYXRoKCdUQVNLX1RZUEVfQlVTSU5FU1NfUlVMRV9NQUlOJywgewogICAgICAgICAgYWJzcG9zOiB7CiAgICAgICAgICAgIHg6IDgsCiAgICAgICAgICAgIHk6IDgKICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgdmFyIGJ1c2luZXNzUGF0aCA9IGRyYXdQYXRoKHBhcmVudEdmeCwgaGVhZGVyRGF0YSk7CiAgICAgICAgYXR0ciQxKGJ1c2luZXNzUGF0aCwgewogICAgICAgICAgc3Ryb2tlV2lkdGg6IDEsCiAgICAgICAgICBzdHJva2U6IGdldFN0cm9rZUNvbG9yKGVsZW1lbnQsIGRlZmF1bHRTdHJva2VDb2xvcikKICAgICAgICB9KTsKCiAgICAgICAgcmV0dXJuIHRhc2s7CiAgICAgIH0sCiAgICAgICdicG1uOlN1YlByb2Nlc3MnOiBmdW5jdGlvbihwYXJlbnRHZngsIGVsZW1lbnQsIGF0dHJzKSB7CiAgICAgICAgYXR0cnMgPSBhc3NpZ24oewogICAgICAgICAgZmlsbDogZ2V0RmlsbENvbG9yKGVsZW1lbnQsIGRlZmF1bHRGaWxsQ29sb3IpLAogICAgICAgICAgc3Ryb2tlOiBnZXRTdHJva2VDb2xvcihlbGVtZW50LCBkZWZhdWx0U3Ryb2tlQ29sb3IpCiAgICAgICAgfSwgYXR0cnMpOwoKICAgICAgICB2YXIgcmVjdCA9IHJlbmRlcmVyKCdicG1uOkFjdGl2aXR5JykocGFyZW50R2Z4LCBlbGVtZW50LCBhdHRycyk7CgogICAgICAgIHZhciBleHBhbmRlZCA9IGlzRXhwYW5kZWQoZWxlbWVudCk7CgogICAgICAgIGlmIChpc0V2ZW50U3ViUHJvY2VzcyhlbGVtZW50KSkgewogICAgICAgICAgYXR0ciQxKHJlY3QsIHsKICAgICAgICAgICAgc3Ryb2tlRGFzaGFycmF5OiAnMSwyJwogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICByZW5kZXJFbWJlZGRlZExhYmVsKHBhcmVudEdmeCwgZWxlbWVudCwgZXhwYW5kZWQgPyAnY2VudGVyLXRvcCcgOiAnY2VudGVyLW1pZGRsZScpOwoKICAgICAgICBpZiAoZXhwYW5kZWQpIHsKICAgICAgICAgIGF0dGFjaFRhc2tNYXJrZXJzKHBhcmVudEdmeCwgZWxlbWVudCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGF0dGFjaFRhc2tNYXJrZXJzKHBhcmVudEdmeCwgZWxlbWVudCwgWydTdWJQcm9jZXNzTWFya2VyJ10pOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHJlY3Q7CiAgICAgIH0sCiAgICAgICdicG1uOkFkSG9jU3ViUHJvY2Vzcyc6IGZ1bmN0aW9uKHBhcmVudEdmeCwgZWxlbWVudCkgewogICAgICAgIHJldHVybiByZW5kZXJlcignYnBtbjpTdWJQcm9jZXNzJykocGFyZW50R2Z4LCBlbGVtZW50KTsKICAgICAgfSwKICAgICAgJ2JwbW46VHJhbnNhY3Rpb24nOiBmdW5jdGlvbihwYXJlbnRHZngsIGVsZW1lbnQpIHsKICAgICAgICB2YXIgb3V0ZXIgPSByZW5kZXJlcignYnBtbjpTdWJQcm9jZXNzJykocGFyZW50R2Z4LCBlbGVtZW50KTsKCiAgICAgICAgdmFyIGlubmVyQXR0cnMgPSBzdHlsZXMuc3R5bGUoWyAnbm8tZmlsbCcsICduby1ldmVudHMnIF0sIHsKICAgICAgICAgIHN0cm9rZTogZ2V0U3Ryb2tlQ29sb3IoZWxlbWVudCwgZGVmYXVsdFN0cm9rZUNvbG9yKQogICAgICAgIH0pOwoKICAgICAgICAvKiBpbm5lciBwYXRoICovIGRyYXdSZWN0KHBhcmVudEdmeCwgZWxlbWVudC53aWR0aCwgZWxlbWVudC5oZWlnaHQsIFRBU0tfQk9SREVSX1JBRElVUyAtIDIsIElOTkVSX09VVEVSX0RJU1QsIGlubmVyQXR0cnMpOwoKICAgICAgICByZXR1cm4gb3V0ZXI7CiAgICAgIH0sCiAgICAgICdicG1uOkNhbGxBY3Rpdml0eSc6IGZ1bmN0aW9uKHBhcmVudEdmeCwgZWxlbWVudCkgewogICAgICAgIHJldHVybiByZW5kZXJlcignYnBtbjpTdWJQcm9jZXNzJykocGFyZW50R2Z4LCBlbGVtZW50LCB7CiAgICAgICAgICBzdHJva2VXaWR0aDogNQogICAgICAgIH0pOwogICAgICB9LAogICAgICAnYnBtbjpQYXJ0aWNpcGFudCc6IGZ1bmN0aW9uKHBhcmVudEdmeCwgZWxlbWVudCkgewoKICAgICAgICB2YXIgYXR0cnMgPSB7CiAgICAgICAgICBmaWxsT3BhY2l0eTogREVGQVVMVF9GSUxMX09QQUNJVFksCiAgICAgICAgICBmaWxsOiBnZXRGaWxsQ29sb3IoZWxlbWVudCwgZGVmYXVsdEZpbGxDb2xvciksCiAgICAgICAgICBzdHJva2U6IGdldFN0cm9rZUNvbG9yKGVsZW1lbnQsIGRlZmF1bHRTdHJva2VDb2xvcikKICAgICAgICB9OwoKICAgICAgICB2YXIgbGFuZSA9IHJlbmRlcmVyKCdicG1uOkxhbmUnKShwYXJlbnRHZngsIGVsZW1lbnQsIGF0dHJzKTsKCiAgICAgICAgdmFyIGV4cGFuZGVkUG9vbCA9IGlzRXhwYW5kZWQoZWxlbWVudCk7CgogICAgICAgIGlmIChleHBhbmRlZFBvb2wpIHsKICAgICAgICAgIGRyYXdMaW5lKHBhcmVudEdmeCwgWwogICAgICAgICAgICB7IHg6IDMwLCB5OiAwIH0sCiAgICAgICAgICAgIHsgeDogMzAsIHk6IGVsZW1lbnQuaGVpZ2h0IH0KICAgICAgICAgIF0sIHsKICAgICAgICAgICAgc3Ryb2tlOiBnZXRTdHJva2VDb2xvcihlbGVtZW50LCBkZWZhdWx0U3Ryb2tlQ29sb3IpCiAgICAgICAgICB9KTsKICAgICAgICAgIHZhciB0ZXh0ID0gZ2V0U2VtYW50aWMoZWxlbWVudCkubmFtZTsKICAgICAgICAgIHJlbmRlckxhbmVMYWJlbChwYXJlbnRHZngsIHRleHQsIGVsZW1lbnQpOwogICAgICAgIH0gZWxzZSB7CgogICAgICAgICAgLy8gQ29sbGFwc2VkIHBvb2wgZHJhdyB0ZXh0IGlubGluZQogICAgICAgICAgdmFyIHRleHQyID0gZ2V0U2VtYW50aWMoZWxlbWVudCkubmFtZTsKICAgICAgICAgIHJlbmRlckxhYmVsKHBhcmVudEdmeCwgdGV4dDIsIHsKICAgICAgICAgICAgYm94OiBlbGVtZW50LCBhbGlnbjogJ2NlbnRlci1taWRkbGUnLAogICAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICAgIGZpbGw6IGdldFN0cm9rZUNvbG9yKGVsZW1lbnQsIGRlZmF1bHRTdHJva2VDb2xvcikKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICB2YXIgcGFydGljaXBhbnRNdWx0aXBsaWNpdHkgPSAhIShnZXRTZW1hbnRpYyhlbGVtZW50KS5wYXJ0aWNpcGFudE11bHRpcGxpY2l0eSk7CgogICAgICAgIGlmIChwYXJ0aWNpcGFudE11bHRpcGxpY2l0eSkgewogICAgICAgICAgcmVuZGVyZXIoJ1BhcnRpY2lwYW50TXVsdGlwbGljaXR5TWFya2VyJykocGFyZW50R2Z4LCBlbGVtZW50KTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBsYW5lOwogICAgICB9LAogICAgICAnYnBtbjpMYW5lJzogZnVuY3Rpb24ocGFyZW50R2Z4LCBlbGVtZW50LCBhdHRycykgewogICAgICAgIHZhciByZWN0ID0gZHJhd1JlY3QocGFyZW50R2Z4LCBlbGVtZW50LndpZHRoLCBlbGVtZW50LmhlaWdodCwgMCwgYXNzaWduKHsKICAgICAgICAgIGZpbGw6IGdldEZpbGxDb2xvcihlbGVtZW50LCBkZWZhdWx0RmlsbENvbG9yKSwKICAgICAgICAgIGZpbGxPcGFjaXR5OiBISUdIX0ZJTExfT1BBQ0lUWSwKICAgICAgICAgIHN0cm9rZTogZ2V0U3Ryb2tlQ29sb3IoZWxlbWVudCwgZGVmYXVsdFN0cm9rZUNvbG9yKQogICAgICAgIH0sIGF0dHJzKSk7CgogICAgICAgIHZhciBzZW1hbnRpYyA9IGdldFNlbWFudGljKGVsZW1lbnQpOwoKICAgICAgICBpZiAoc2VtYW50aWMuJHR5cGUgPT09ICdicG1uOkxhbmUnKSB7CiAgICAgICAgICB2YXIgdGV4dCA9IHNlbWFudGljLm5hbWU7CiAgICAgICAgICByZW5kZXJMYW5lTGFiZWwocGFyZW50R2Z4LCB0ZXh0LCBlbGVtZW50KTsKICAgICAgICB9CgogICAgICAgIHJldHVybiByZWN0OwogICAgICB9LAogICAgICAnYnBtbjpJbmNsdXNpdmVHYXRld2F5JzogZnVuY3Rpb24ocGFyZW50R2Z4LCBlbGVtZW50KSB7CiAgICAgICAgdmFyIGRpYW1vbmQgPSByZW5kZXJlcignYnBtbjpHYXRld2F5JykocGFyZW50R2Z4LCBlbGVtZW50KTsKCiAgICAgICAgLyogY2lyY2xlIHBhdGggKi8KICAgICAgICBkcmF3Q2lyY2xlKHBhcmVudEdmeCwgZWxlbWVudC53aWR0aCwgZWxlbWVudC5oZWlnaHQsIGVsZW1lbnQuaGVpZ2h0ICogMC4yNCwgewogICAgICAgICAgc3Ryb2tlV2lkdGg6IDIuNSwKICAgICAgICAgIGZpbGw6IGdldEZpbGxDb2xvcihlbGVtZW50LCBkZWZhdWx0RmlsbENvbG9yKSwKICAgICAgICAgIHN0cm9rZTogZ2V0U3Ryb2tlQ29sb3IoZWxlbWVudCwgZGVmYXVsdFN0cm9rZUNvbG9yKQogICAgICAgIH0pOwoKICAgICAgICByZXR1cm4gZGlhbW9uZDsKICAgICAgfSwKICAgICAgJ2JwbW46RXhjbHVzaXZlR2F0ZXdheSc6IGZ1bmN0aW9uKHBhcmVudEdmeCwgZWxlbWVudCkgewogICAgICAgIHZhciBkaWFtb25kID0gcmVuZGVyZXIoJ2JwbW46R2F0ZXdheScpKHBhcmVudEdmeCwgZWxlbWVudCk7CgogICAgICAgIHZhciBwYXRoRGF0YSA9IHBhdGhNYXAuZ2V0U2NhbGVkUGF0aCgnR0FURVdBWV9FWENMVVNJVkUnLCB7CiAgICAgICAgICB4U2NhbGVGYWN0b3I6IDAuNCwKICAgICAgICAgIHlTY2FsZUZhY3RvcjogMC40LAogICAgICAgICAgY29udGFpbmVyV2lkdGg6IGVsZW1lbnQud2lkdGgsCiAgICAgICAgICBjb250YWluZXJIZWlnaHQ6IGVsZW1lbnQuaGVpZ2h0LAogICAgICAgICAgcG9zaXRpb246IHsKICAgICAgICAgICAgbXg6IDAuMzIsCiAgICAgICAgICAgIG15OiAwLjMKICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgaWYgKChnZXREaShlbGVtZW50KS5pc01hcmtlclZpc2libGUpKSB7CiAgICAgICAgICBkcmF3UGF0aChwYXJlbnRHZngsIHBhdGhEYXRhLCB7CiAgICAgICAgICAgIHN0cm9rZVdpZHRoOiAxLAogICAgICAgICAgICBmaWxsOiBnZXRTdHJva2VDb2xvcihlbGVtZW50LCBkZWZhdWx0U3Ryb2tlQ29sb3IpLAogICAgICAgICAgICBzdHJva2U6IGdldFN0cm9rZUNvbG9yKGVsZW1lbnQsIGRlZmF1bHRTdHJva2VDb2xvcikKICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGRpYW1vbmQ7CiAgICAgIH0sCiAgICAgICdicG1uOkNvbXBsZXhHYXRld2F5JzogZnVuY3Rpb24ocGFyZW50R2Z4LCBlbGVtZW50KSB7CiAgICAgICAgdmFyIGRpYW1vbmQgPSByZW5kZXJlcignYnBtbjpHYXRld2F5JykocGFyZW50R2Z4LCBlbGVtZW50KTsKCiAgICAgICAgdmFyIHBhdGhEYXRhID0gcGF0aE1hcC5nZXRTY2FsZWRQYXRoKCdHQVRFV0FZX0NPTVBMRVgnLCB7CiAgICAgICAgICB4U2NhbGVGYWN0b3I6IDAuNSwKICAgICAgICAgIHlTY2FsZUZhY3RvcjowLjUsCiAgICAgICAgICBjb250YWluZXJXaWR0aDogZWxlbWVudC53aWR0aCwKICAgICAgICAgIGNvbnRhaW5lckhlaWdodDogZWxlbWVudC5oZWlnaHQsCiAgICAgICAgICBwb3NpdGlvbjogewogICAgICAgICAgICBteDogMC40NiwKICAgICAgICAgICAgbXk6IDAuMjYKICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgLyogY29tcGxleCBwYXRoICovIGRyYXdQYXRoKHBhcmVudEdmeCwgcGF0aERhdGEsIHsKICAgICAgICAgIHN0cm9rZVdpZHRoOiAxLAogICAgICAgICAgZmlsbDogZ2V0U3Ryb2tlQ29sb3IoZWxlbWVudCwgZGVmYXVsdFN0cm9rZUNvbG9yKSwKICAgICAgICAgIHN0cm9rZTogZ2V0U3Ryb2tlQ29sb3IoZWxlbWVudCwgZGVmYXVsdFN0cm9rZUNvbG9yKQogICAgICAgIH0pOwoKICAgICAgICByZXR1cm4gZGlhbW9uZDsKICAgICAgfSwKICAgICAgJ2JwbW46UGFyYWxsZWxHYXRld2F5JzogZnVuY3Rpb24ocGFyZW50R2Z4LCBlbGVtZW50KSB7CiAgICAgICAgdmFyIGRpYW1vbmQgPSByZW5kZXJlcignYnBtbjpHYXRld2F5JykocGFyZW50R2Z4LCBlbGVtZW50KTsKCiAgICAgICAgdmFyIHBhdGhEYXRhID0gcGF0aE1hcC5nZXRTY2FsZWRQYXRoKCdHQVRFV0FZX1BBUkFMTEVMJywgewogICAgICAgICAgeFNjYWxlRmFjdG9yOiAwLjYsCiAgICAgICAgICB5U2NhbGVGYWN0b3I6MC42LAogICAgICAgICAgY29udGFpbmVyV2lkdGg6IGVsZW1lbnQud2lkdGgsCiAgICAgICAgICBjb250YWluZXJIZWlnaHQ6IGVsZW1lbnQuaGVpZ2h0LAogICAgICAgICAgcG9zaXRpb246IHsKICAgICAgICAgICAgbXg6IDAuNDYsCiAgICAgICAgICAgIG15OiAwLjIKICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgLyogcGFyYWxsZWwgcGF0aCAqLyBkcmF3UGF0aChwYXJlbnRHZngsIHBhdGhEYXRhLCB7CiAgICAgICAgICBzdHJva2VXaWR0aDogMSwKICAgICAgICAgIGZpbGw6IGdldFN0cm9rZUNvbG9yKGVsZW1lbnQsIGRlZmF1bHRTdHJva2VDb2xvciksCiAgICAgICAgICBzdHJva2U6IGdldFN0cm9rZUNvbG9yKGVsZW1lbnQsIGRlZmF1bHRTdHJva2VDb2xvcikKICAgICAgICB9KTsKCiAgICAgICAgcmV0dXJuIGRpYW1vbmQ7CiAgICAgIH0sCiAgICAgICdicG1uOkV2ZW50QmFzZWRHYXRld2F5JzogZnVuY3Rpb24ocGFyZW50R2Z4LCBlbGVtZW50KSB7CgogICAgICAgIHZhciBzZW1hbnRpYyA9IGdldFNlbWFudGljKGVsZW1lbnQpOwoKICAgICAgICB2YXIgZGlhbW9uZCA9IHJlbmRlcmVyKCdicG1uOkdhdGV3YXknKShwYXJlbnRHZngsIGVsZW1lbnQpOwoKICAgICAgICAvKiBvdXRlciBjaXJjbGUgcGF0aCAqLyBkcmF3Q2lyY2xlKHBhcmVudEdmeCwgZWxlbWVudC53aWR0aCwgZWxlbWVudC5oZWlnaHQsIGVsZW1lbnQuaGVpZ2h0ICogMC4yMCwgewogICAgICAgICAgc3Ryb2tlV2lkdGg6IDEsCiAgICAgICAgICBmaWxsOiAnbm9uZScsCiAgICAgICAgICBzdHJva2U6IGdldFN0cm9rZUNvbG9yKGVsZW1lbnQsIGRlZmF1bHRTdHJva2VDb2xvcikKICAgICAgICB9KTsKCiAgICAgICAgdmFyIHR5cGUgPSBzZW1hbnRpYy5ldmVudEdhdGV3YXlUeXBlOwogICAgICAgIHZhciBpbnN0YW50aWF0ZSA9ICEhc2VtYW50aWMuaW5zdGFudGlhdGU7CgogICAgICAgIGZ1bmN0aW9uIGRyYXdFdmVudCgpIHsKCiAgICAgICAgICB2YXIgcGF0aERhdGEgPSBwYXRoTWFwLmdldFNjYWxlZFBhdGgoJ0dBVEVXQVlfRVZFTlRfQkFTRUQnLCB7CiAgICAgICAgICAgIHhTY2FsZUZhY3RvcjogMC4xOCwKICAgICAgICAgICAgeVNjYWxlRmFjdG9yOiAwLjE4LAogICAgICAgICAgICBjb250YWluZXJXaWR0aDogZWxlbWVudC53aWR0aCwKICAgICAgICAgICAgY29udGFpbmVySGVpZ2h0OiBlbGVtZW50LmhlaWdodCwKICAgICAgICAgICAgcG9zaXRpb246IHsKICAgICAgICAgICAgICBteDogMC4zNiwKICAgICAgICAgICAgICBteTogMC40NAogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKCiAgICAgICAgICB2YXIgYXR0cnMgPSB7CiAgICAgICAgICAgIHN0cm9rZVdpZHRoOiAyLAogICAgICAgICAgICBmaWxsOiBnZXRGaWxsQ29sb3IoZWxlbWVudCwgJ25vbmUnKSwKICAgICAgICAgICAgc3Ryb2tlOiBnZXRTdHJva2VDb2xvcihlbGVtZW50LCBkZWZhdWx0U3Ryb2tlQ29sb3IpCiAgICAgICAgICB9OwoKICAgICAgICAgIC8qIGV2ZW50IHBhdGggKi8gZHJhd1BhdGgocGFyZW50R2Z4LCBwYXRoRGF0YSwgYXR0cnMpOwogICAgICAgIH0KCiAgICAgICAgaWYgKHR5cGUgPT09ICdQYXJhbGxlbCcpIHsKCiAgICAgICAgICB2YXIgcGF0aERhdGEgPSBwYXRoTWFwLmdldFNjYWxlZFBhdGgoJ0dBVEVXQVlfUEFSQUxMRUwnLCB7CiAgICAgICAgICAgIHhTY2FsZUZhY3RvcjogMC40LAogICAgICAgICAgICB5U2NhbGVGYWN0b3I6MC40LAogICAgICAgICAgICBjb250YWluZXJXaWR0aDogZWxlbWVudC53aWR0aCwKICAgICAgICAgICAgY29udGFpbmVySGVpZ2h0OiBlbGVtZW50LmhlaWdodCwKICAgICAgICAgICAgcG9zaXRpb246IHsKICAgICAgICAgICAgICBteDogMC40NzQsCiAgICAgICAgICAgICAgbXk6IDAuMjk2CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwoKICAgICAgICAgIHZhciBwYXJhbGxlbFBhdGggPSBkcmF3UGF0aChwYXJlbnRHZngsIHBhdGhEYXRhKTsKICAgICAgICAgIGF0dHIkMShwYXJhbGxlbFBhdGgsIHsKICAgICAgICAgICAgc3Ryb2tlV2lkdGg6IDEsCiAgICAgICAgICAgIGZpbGw6ICdub25lJwogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIGlmICh0eXBlID09PSAnRXhjbHVzaXZlJykgewoKICAgICAgICAgIGlmICghaW5zdGFudGlhdGUpIHsKICAgICAgICAgICAgdmFyIGlubmVyQ2lyY2xlID0gZHJhd0NpcmNsZShwYXJlbnRHZngsIGVsZW1lbnQud2lkdGgsIGVsZW1lbnQuaGVpZ2h0LCBlbGVtZW50LmhlaWdodCAqIDAuMjYpOwogICAgICAgICAgICBhdHRyJDEoaW5uZXJDaXJjbGUsIHsKICAgICAgICAgICAgICBzdHJva2VXaWR0aDogMSwKICAgICAgICAgICAgICBmaWxsOiAnbm9uZScsCiAgICAgICAgICAgICAgc3Ryb2tlOiBnZXRTdHJva2VDb2xvcihlbGVtZW50LCBkZWZhdWx0U3Ryb2tlQ29sb3IpCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQoKICAgICAgICAgIGRyYXdFdmVudCgpOwogICAgICAgIH0KCgogICAgICAgIHJldHVybiBkaWFtb25kOwogICAgICB9LAogICAgICAnYnBtbjpHYXRld2F5JzogZnVuY3Rpb24ocGFyZW50R2Z4LCBlbGVtZW50KSB7CiAgICAgICAgdmFyIGF0dHJzID0gewogICAgICAgICAgZmlsbDogZ2V0RmlsbENvbG9yKGVsZW1lbnQsIGRlZmF1bHRGaWxsQ29sb3IpLAogICAgICAgICAgZmlsbE9wYWNpdHk6IERFRkFVTFRfRklMTF9PUEFDSVRZLAogICAgICAgICAgc3Ryb2tlOiBnZXRTdHJva2VDb2xvcihlbGVtZW50LCBkZWZhdWx0U3Ryb2tlQ29sb3IpCiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuIGRyYXdEaWFtb25kKHBhcmVudEdmeCwgZWxlbWVudC53aWR0aCwgZWxlbWVudC5oZWlnaHQsIGF0dHJzKTsKICAgICAgfSwKICAgICAgJ2JwbW46U2VxdWVuY2VGbG93JzogZnVuY3Rpb24ocGFyZW50R2Z4LCBlbGVtZW50KSB7CiAgICAgICAgdmFyIHBhdGhEYXRhID0gY3JlYXRlUGF0aEZyb21Db25uZWN0aW9uKGVsZW1lbnQpOwoKICAgICAgICB2YXIgZmlsbCA9IGdldEZpbGxDb2xvcihlbGVtZW50LCBkZWZhdWx0RmlsbENvbG9yKSwKICAgICAgICAgICAgc3Ryb2tlID0gZ2V0U3Ryb2tlQ29sb3IoZWxlbWVudCwgZGVmYXVsdFN0cm9rZUNvbG9yKTsKCiAgICAgICAgdmFyIGF0dHJzID0gewogICAgICAgICAgc3Ryb2tlTGluZWpvaW46ICdyb3VuZCcsCiAgICAgICAgICBtYXJrZXJFbmQ6IG1hcmtlcignc2VxdWVuY2VmbG93LWVuZCcsIGZpbGwsIHN0cm9rZSksCiAgICAgICAgICBzdHJva2U6IGdldFN0cm9rZUNvbG9yKGVsZW1lbnQsIGRlZmF1bHRTdHJva2VDb2xvcikKICAgICAgICB9OwoKICAgICAgICB2YXIgcGF0aCA9IGRyYXdQYXRoKHBhcmVudEdmeCwgcGF0aERhdGEsIGF0dHJzKTsKCiAgICAgICAgdmFyIHNlcXVlbmNlRmxvdyA9IGdldFNlbWFudGljKGVsZW1lbnQpOwoKICAgICAgICB2YXIgc291cmNlOwoKICAgICAgICBpZiAoZWxlbWVudC5zb3VyY2UpIHsKICAgICAgICAgIHNvdXJjZSA9IGVsZW1lbnQuc291cmNlLmJ1c2luZXNzT2JqZWN0OwoKICAgICAgICAgIC8vIGNvbmRpdGlvbmFsIGZsb3cgbWFya2VyCiAgICAgICAgICBpZiAoc2VxdWVuY2VGbG93LmNvbmRpdGlvbkV4cHJlc3Npb24gJiYgc291cmNlLiRpbnN0YW5jZU9mKCdicG1uOkFjdGl2aXR5JykpIHsKICAgICAgICAgICAgYXR0ciQxKHBhdGgsIHsKICAgICAgICAgICAgICBtYXJrZXJTdGFydDogbWFya2VyKCdjb25kaXRpb25hbC1mbG93LW1hcmtlcicsIGZpbGwsIHN0cm9rZSkKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CgogICAgICAgICAgLy8gZGVmYXVsdCBtYXJrZXIKICAgICAgICAgIGlmIChzb3VyY2UuZGVmYXVsdCAmJiAoc291cmNlLiRpbnN0YW5jZU9mKCdicG1uOkdhdGV3YXknKSB8fCBzb3VyY2UuJGluc3RhbmNlT2YoJ2JwbW46QWN0aXZpdHknKSkgJiYKICAgICAgICAgICAgICBzb3VyY2UuZGVmYXVsdCA9PT0gc2VxdWVuY2VGbG93KSB7CiAgICAgICAgICAgIGF0dHIkMShwYXRoLCB7CiAgICAgICAgICAgICAgbWFya2VyU3RhcnQ6IG1hcmtlcignY29uZGl0aW9uYWwtZGVmYXVsdC1mbG93LW1hcmtlcicsIGZpbGwsIHN0cm9rZSkKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gcGF0aDsKICAgICAgfSwKICAgICAgJ2JwbW46QXNzb2NpYXRpb24nOiBmdW5jdGlvbihwYXJlbnRHZngsIGVsZW1lbnQsIGF0dHJzKSB7CgogICAgICAgIHZhciBzZW1hbnRpYyA9IGdldFNlbWFudGljKGVsZW1lbnQpOwoKICAgICAgICB2YXIgZmlsbCA9IGdldEZpbGxDb2xvcihlbGVtZW50LCBkZWZhdWx0RmlsbENvbG9yKSwKICAgICAgICAgICAgc3Ryb2tlID0gZ2V0U3Ryb2tlQ29sb3IoZWxlbWVudCwgZGVmYXVsdFN0cm9rZUNvbG9yKTsKCiAgICAgICAgYXR0cnMgPSBhc3NpZ24oewogICAgICAgICAgc3Ryb2tlRGFzaGFycmF5OiAnMC41LCA1JywKICAgICAgICAgIHN0cm9rZUxpbmVjYXA6ICdyb3VuZCcsCiAgICAgICAgICBzdHJva2VMaW5lam9pbjogJ3JvdW5kJywKICAgICAgICAgIHN0cm9rZTogZ2V0U3Ryb2tlQ29sb3IoZWxlbWVudCwgZGVmYXVsdFN0cm9rZUNvbG9yKQogICAgICAgIH0sIGF0dHJzIHx8IHt9KTsKCiAgICAgICAgaWYgKHNlbWFudGljLmFzc29jaWF0aW9uRGlyZWN0aW9uID09PSAnT25lJyB8fAogICAgICAgICAgICBzZW1hbnRpYy5hc3NvY2lhdGlvbkRpcmVjdGlvbiA9PT0gJ0JvdGgnKSB7CiAgICAgICAgICBhdHRycy5tYXJrZXJFbmQgPSBtYXJrZXIoJ2Fzc29jaWF0aW9uLWVuZCcsIGZpbGwsIHN0cm9rZSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoc2VtYW50aWMuYXNzb2NpYXRpb25EaXJlY3Rpb24gPT09ICdCb3RoJykgewogICAgICAgICAgYXR0cnMubWFya2VyU3RhcnQgPSBtYXJrZXIoJ2Fzc29jaWF0aW9uLXN0YXJ0JywgZmlsbCwgc3Ryb2tlKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBkcmF3TGluZShwYXJlbnRHZngsIGVsZW1lbnQud2F5cG9pbnRzLCBhdHRycyk7CiAgICAgIH0sCiAgICAgICdicG1uOkRhdGFJbnB1dEFzc29jaWF0aW9uJzogZnVuY3Rpb24ocGFyZW50R2Z4LCBlbGVtZW50KSB7CiAgICAgICAgdmFyIGZpbGwgPSBnZXRGaWxsQ29sb3IoZWxlbWVudCwgZGVmYXVsdEZpbGxDb2xvciksCiAgICAgICAgICAgIHN0cm9rZSA9IGdldFN0cm9rZUNvbG9yKGVsZW1lbnQsIGRlZmF1bHRTdHJva2VDb2xvcik7CgogICAgICAgIHJldHVybiByZW5kZXJlcignYnBtbjpBc3NvY2lhdGlvbicpKHBhcmVudEdmeCwgZWxlbWVudCwgewogICAgICAgICAgbWFya2VyRW5kOiBtYXJrZXIoJ2Fzc29jaWF0aW9uLWVuZCcsIGZpbGwsIHN0cm9rZSkKICAgICAgICB9KTsKICAgICAgfSwKICAgICAgJ2JwbW46RGF0YU91dHB1dEFzc29jaWF0aW9uJzogZnVuY3Rpb24ocGFyZW50R2Z4LCBlbGVtZW50KSB7CiAgICAgICAgdmFyIGZpbGwgPSBnZXRGaWxsQ29sb3IoZWxlbWVudCwgZGVmYXVsdEZpbGxDb2xvciksCiAgICAgICAgICAgIHN0cm9rZSA9IGdldFN0cm9rZUNvbG9yKGVsZW1lbnQsIGRlZmF1bHRTdHJva2VDb2xvcik7CgogICAgICAgIHJldHVybiByZW5kZXJlcignYnBtbjpBc3NvY2lhdGlvbicpKHBhcmVudEdmeCwgZWxlbWVudCwgewogICAgICAgICAgbWFya2VyRW5kOiBtYXJrZXIoJ2Fzc29jaWF0aW9uLWVuZCcsIGZpbGwsIHN0cm9rZSkKICAgICAgICB9KTsKICAgICAgfSwKICAgICAgJ2JwbW46TWVzc2FnZUZsb3cnOiBmdW5jdGlvbihwYXJlbnRHZngsIGVsZW1lbnQpIHsKCiAgICAgICAgdmFyIHNlbWFudGljID0gZ2V0U2VtYW50aWMoZWxlbWVudCksCiAgICAgICAgICAgIGRpID0gZ2V0RGkoZWxlbWVudCk7CgogICAgICAgIHZhciBmaWxsID0gZ2V0RmlsbENvbG9yKGVsZW1lbnQsIGRlZmF1bHRGaWxsQ29sb3IpLAogICAgICAgICAgICBzdHJva2UgPSBnZXRTdHJva2VDb2xvcihlbGVtZW50LCBkZWZhdWx0U3Ryb2tlQ29sb3IpOwoKICAgICAgICB2YXIgcGF0aERhdGEgPSBjcmVhdGVQYXRoRnJvbUNvbm5lY3Rpb24oZWxlbWVudCk7CgogICAgICAgIHZhciBhdHRycyA9IHsKICAgICAgICAgIG1hcmtlckVuZDogbWFya2VyKCdtZXNzYWdlZmxvdy1lbmQnLCBmaWxsLCBzdHJva2UpLAogICAgICAgICAgbWFya2VyU3RhcnQ6IG1hcmtlcignbWVzc2FnZWZsb3ctc3RhcnQnLCBmaWxsLCBzdHJva2UpLAogICAgICAgICAgc3Ryb2tlRGFzaGFycmF5OiAnMTAsIDEyJywKICAgICAgICAgIHN0cm9rZUxpbmVjYXA6ICdyb3VuZCcsCiAgICAgICAgICBzdHJva2VMaW5lam9pbjogJ3JvdW5kJywKICAgICAgICAgIHN0cm9rZVdpZHRoOiAnMS41cHgnLAogICAgICAgICAgc3Ryb2tlOiBnZXRTdHJva2VDb2xvcihlbGVtZW50LCBkZWZhdWx0U3Ryb2tlQ29sb3IpCiAgICAgICAgfTsKCiAgICAgICAgdmFyIHBhdGggPSBkcmF3UGF0aChwYXJlbnRHZngsIHBhdGhEYXRhLCBhdHRycyk7CgogICAgICAgIGlmIChzZW1hbnRpYy5tZXNzYWdlUmVmKSB7CiAgICAgICAgICB2YXIgbWlkUG9pbnQgPSBwYXRoLmdldFBvaW50QXRMZW5ndGgocGF0aC5nZXRUb3RhbExlbmd0aCgpIC8gMik7CgogICAgICAgICAgdmFyIG1hcmtlclBhdGhEYXRhID0gcGF0aE1hcC5nZXRTY2FsZWRQYXRoKCdNRVNTQUdFX0ZMT1dfTUFSS0VSJywgewogICAgICAgICAgICBhYnNwb3M6IHsKICAgICAgICAgICAgICB4OiBtaWRQb2ludC54LAogICAgICAgICAgICAgIHk6IG1pZFBvaW50LnkKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CgogICAgICAgICAgdmFyIG1lc3NhZ2VBdHRycyA9IHsgc3Ryb2tlV2lkdGg6IDEgfTsKCiAgICAgICAgICBpZiAoZGkubWVzc2FnZVZpc2libGVLaW5kID09PSAnaW5pdGlhdGluZycpIHsKICAgICAgICAgICAgbWVzc2FnZUF0dHJzLmZpbGwgPSAnd2hpdGUnOwogICAgICAgICAgICBtZXNzYWdlQXR0cnMuc3Ryb2tlID0gJ2JsYWNrJzsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG1lc3NhZ2VBdHRycy5maWxsID0gJyM4ODgnOwogICAgICAgICAgICBtZXNzYWdlQXR0cnMuc3Ryb2tlID0gJ3doaXRlJzsKICAgICAgICAgIH0KCiAgICAgICAgICBkcmF3UGF0aChwYXJlbnRHZngsIG1hcmtlclBhdGhEYXRhLCBtZXNzYWdlQXR0cnMpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHBhdGg7CiAgICAgIH0sCiAgICAgICdicG1uOkRhdGFPYmplY3QnOiBmdW5jdGlvbihwYXJlbnRHZngsIGVsZW1lbnQpIHsKICAgICAgICB2YXIgcGF0aERhdGEgPSBwYXRoTWFwLmdldFNjYWxlZFBhdGgoJ0RBVEFfT0JKRUNUX1BBVEgnLCB7CiAgICAgICAgICB4U2NhbGVGYWN0b3I6IDEsCiAgICAgICAgICB5U2NhbGVGYWN0b3I6IDEsCiAgICAgICAgICBjb250YWluZXJXaWR0aDogZWxlbWVudC53aWR0aCwKICAgICAgICAgIGNvbnRhaW5lckhlaWdodDogZWxlbWVudC5oZWlnaHQsCiAgICAgICAgICBwb3NpdGlvbjogewogICAgICAgICAgICBteDogMC40NzQsCiAgICAgICAgICAgIG15OiAwLjI5NgogICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICB2YXIgZWxlbWVudE9iamVjdCA9IGRyYXdQYXRoKHBhcmVudEdmeCwgcGF0aERhdGEsIHsKICAgICAgICAgIGZpbGw6IGdldEZpbGxDb2xvcihlbGVtZW50LCBkZWZhdWx0RmlsbENvbG9yKSwKICAgICAgICAgIGZpbGxPcGFjaXR5OiBERUZBVUxUX0ZJTExfT1BBQ0lUWSwKICAgICAgICAgIHN0cm9rZTogZ2V0U3Ryb2tlQ29sb3IoZWxlbWVudCwgZGVmYXVsdFN0cm9rZUNvbG9yKQogICAgICAgIH0pOwoKICAgICAgICB2YXIgc2VtYW50aWMgPSBnZXRTZW1hbnRpYyhlbGVtZW50KTsKCiAgICAgICAgaWYgKGlzQ29sbGVjdGlvbihzZW1hbnRpYykpIHsKICAgICAgICAgIHJlbmRlckRhdGFJdGVtQ29sbGVjdGlvbihwYXJlbnRHZngsIGVsZW1lbnQpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGVsZW1lbnRPYmplY3Q7CiAgICAgIH0sCiAgICAgICdicG1uOkRhdGFPYmplY3RSZWZlcmVuY2UnOiBhcygnYnBtbjpEYXRhT2JqZWN0JyksCiAgICAgICdicG1uOkRhdGFJbnB1dCc6IGZ1bmN0aW9uKHBhcmVudEdmeCwgZWxlbWVudCkgewoKICAgICAgICB2YXIgYXJyb3dQYXRoRGF0YSA9IHBhdGhNYXAuZ2V0UmF3UGF0aCgnREFUQV9BUlJPVycpOwoKICAgICAgICAvLyBwYWdlCiAgICAgICAgdmFyIGVsZW1lbnRPYmplY3QgPSByZW5kZXJlcignYnBtbjpEYXRhT2JqZWN0JykocGFyZW50R2Z4LCBlbGVtZW50KTsKCiAgICAgICAgLyogaW5wdXQgYXJyb3cgcGF0aCAqLyBkcmF3UGF0aChwYXJlbnRHZngsIGFycm93UGF0aERhdGEsIHsgc3Ryb2tlV2lkdGg6IDEgfSk7CgogICAgICAgIHJldHVybiBlbGVtZW50T2JqZWN0OwogICAgICB9LAogICAgICAnYnBtbjpEYXRhT3V0cHV0JzogZnVuY3Rpb24ocGFyZW50R2Z4LCBlbGVtZW50KSB7CiAgICAgICAgdmFyIGFycm93UGF0aERhdGEgPSBwYXRoTWFwLmdldFJhd1BhdGgoJ0RBVEFfQVJST1cnKTsKCiAgICAgICAgLy8gcGFnZQogICAgICAgIHZhciBlbGVtZW50T2JqZWN0ID0gcmVuZGVyZXIoJ2JwbW46RGF0YU9iamVjdCcpKHBhcmVudEdmeCwgZWxlbWVudCk7CgogICAgICAgIC8qIG91dHB1dCBhcnJvdyBwYXRoICovIGRyYXdQYXRoKHBhcmVudEdmeCwgYXJyb3dQYXRoRGF0YSwgewogICAgICAgICAgc3Ryb2tlV2lkdGg6IDEsCiAgICAgICAgICBmaWxsOiAnYmxhY2snCiAgICAgICAgfSk7CgogICAgICAgIHJldHVybiBlbGVtZW50T2JqZWN0OwogICAgICB9LAogICAgICAnYnBtbjpEYXRhU3RvcmVSZWZlcmVuY2UnOiBmdW5jdGlvbihwYXJlbnRHZngsIGVsZW1lbnQpIHsKICAgICAgICB2YXIgREFUQV9TVE9SRV9QQVRIID0gcGF0aE1hcC5nZXRTY2FsZWRQYXRoKCdEQVRBX1NUT1JFJywgewogICAgICAgICAgeFNjYWxlRmFjdG9yOiAxLAogICAgICAgICAgeVNjYWxlRmFjdG9yOiAxLAogICAgICAgICAgY29udGFpbmVyV2lkdGg6IGVsZW1lbnQud2lkdGgsCiAgICAgICAgICBjb250YWluZXJIZWlnaHQ6IGVsZW1lbnQuaGVpZ2h0LAogICAgICAgICAgcG9zaXRpb246IHsKICAgICAgICAgICAgbXg6IDAsCiAgICAgICAgICAgIG15OiAwLjEzMwogICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICB2YXIgZWxlbWVudFN0b3JlID0gZHJhd1BhdGgocGFyZW50R2Z4LCBEQVRBX1NUT1JFX1BBVEgsIHsKICAgICAgICAgIHN0cm9rZVdpZHRoOiAyLAogICAgICAgICAgZmlsbDogZ2V0RmlsbENvbG9yKGVsZW1lbnQsIGRlZmF1bHRGaWxsQ29sb3IpLAogICAgICAgICAgZmlsbE9wYWNpdHk6IERFRkFVTFRfRklMTF9PUEFDSVRZLAogICAgICAgICAgc3Ryb2tlOiBnZXRTdHJva2VDb2xvcihlbGVtZW50LCBkZWZhdWx0U3Ryb2tlQ29sb3IpCiAgICAgICAgfSk7CgogICAgICAgIHJldHVybiBlbGVtZW50U3RvcmU7CiAgICAgIH0sCiAgICAgICdicG1uOkJvdW5kYXJ5RXZlbnQnOiBmdW5jdGlvbihwYXJlbnRHZngsIGVsZW1lbnQpIHsKCiAgICAgICAgdmFyIHNlbWFudGljID0gZ2V0U2VtYW50aWMoZWxlbWVudCksCiAgICAgICAgICAgIGNhbmNlbCA9IHNlbWFudGljLmNhbmNlbEFjdGl2aXR5OwoKICAgICAgICB2YXIgYXR0cnMgPSB7CiAgICAgICAgICBzdHJva2VXaWR0aDogMSwKICAgICAgICAgIGZpbGw6IGdldEZpbGxDb2xvcihlbGVtZW50LCBkZWZhdWx0RmlsbENvbG9yKSwKICAgICAgICAgIHN0cm9rZTogZ2V0U3Ryb2tlQ29sb3IoZWxlbWVudCwgZGVmYXVsdFN0cm9rZUNvbG9yKQogICAgICAgIH07CgogICAgICAgIGlmICghY2FuY2VsKSB7CiAgICAgICAgICBhdHRycy5zdHJva2VEYXNoYXJyYXkgPSAnNic7CiAgICAgICAgICBhdHRycy5zdHJva2VMaW5lY2FwID0gJ3JvdW5kJzsKICAgICAgICB9CgogICAgICAgIC8vIGFwcGx5IGZpbGxPcGFjaXR5CiAgICAgICAgdmFyIG91dGVyQXR0cnMgPSBhc3NpZ24oe30sIGF0dHJzLCB7CiAgICAgICAgICBmaWxsT3BhY2l0eTogMQogICAgICAgIH0pOwoKICAgICAgICAvLyBhcHBseSBuby1maWxsCiAgICAgICAgdmFyIGlubmVyQXR0cnMgPSBhc3NpZ24oe30sIGF0dHJzLCB7CiAgICAgICAgICBmaWxsOiAnbm9uZScKICAgICAgICB9KTsKCiAgICAgICAgdmFyIG91dGVyID0gcmVuZGVyZXIoJ2JwbW46RXZlbnQnKShwYXJlbnRHZngsIGVsZW1lbnQsIG91dGVyQXR0cnMpOwoKICAgICAgICAvKiBpbm5lciBwYXRoICovIGRyYXdDaXJjbGUocGFyZW50R2Z4LCBlbGVtZW50LndpZHRoLCBlbGVtZW50LmhlaWdodCwgSU5ORVJfT1VURVJfRElTVCwgaW5uZXJBdHRycyk7CgogICAgICAgIHJlbmRlckV2ZW50Q29udGVudChlbGVtZW50LCBwYXJlbnRHZngpOwoKICAgICAgICByZXR1cm4gb3V0ZXI7CiAgICAgIH0sCiAgICAgICdicG1uOkdyb3VwJzogZnVuY3Rpb24ocGFyZW50R2Z4LCBlbGVtZW50KSB7CgogICAgICAgIHZhciBncm91cCA9IGRyYXdSZWN0KHBhcmVudEdmeCwgZWxlbWVudC53aWR0aCwgZWxlbWVudC5oZWlnaHQsIFRBU0tfQk9SREVSX1JBRElVUywgewogICAgICAgICAgc3Ryb2tlV2lkdGg6IDEsCiAgICAgICAgICBzdHJva2VEYXNoYXJyYXk6ICc4LDMsMSwzJywKICAgICAgICAgIGZpbGw6ICdub25lJywKICAgICAgICAgIHBvaW50ZXJFdmVudHM6ICdub25lJwogICAgICAgIH0pOwoKICAgICAgICByZXR1cm4gZ3JvdXA7CiAgICAgIH0sCiAgICAgICdsYWJlbCc6IGZ1bmN0aW9uKHBhcmVudEdmeCwgZWxlbWVudCkgewogICAgICAgIHJldHVybiByZW5kZXJFeHRlcm5hbExhYmVsKHBhcmVudEdmeCwgZWxlbWVudCk7CiAgICAgIH0sCiAgICAgICdicG1uOlRleHRBbm5vdGF0aW9uJzogZnVuY3Rpb24ocGFyZW50R2Z4LCBlbGVtZW50KSB7CiAgICAgICAgdmFyIHN0eWxlID0gewogICAgICAgICAgJ2ZpbGwnOiAnbm9uZScsCiAgICAgICAgICAnc3Ryb2tlJzogJ25vbmUnCiAgICAgICAgfTsKCiAgICAgICAgdmFyIHRleHRFbGVtZW50ID0gZHJhd1JlY3QocGFyZW50R2Z4LCBlbGVtZW50LndpZHRoLCBlbGVtZW50LmhlaWdodCwgMCwgMCwgc3R5bGUpOwoKICAgICAgICB2YXIgdGV4dFBhdGhEYXRhID0gcGF0aE1hcC5nZXRTY2FsZWRQYXRoKCdURVhUX0FOTk9UQVRJT04nLCB7CiAgICAgICAgICB4U2NhbGVGYWN0b3I6IDEsCiAgICAgICAgICB5U2NhbGVGYWN0b3I6IDEsCiAgICAgICAgICBjb250YWluZXJXaWR0aDogZWxlbWVudC53aWR0aCwKICAgICAgICAgIGNvbnRhaW5lckhlaWdodDogZWxlbWVudC5oZWlnaHQsCiAgICAgICAgICBwb3NpdGlvbjogewogICAgICAgICAgICBteDogMC4wLAogICAgICAgICAgICBteTogMC4wCiAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIGRyYXdQYXRoKHBhcmVudEdmeCwgdGV4dFBhdGhEYXRhLCB7CiAgICAgICAgICBzdHJva2U6IGdldFN0cm9rZUNvbG9yKGVsZW1lbnQsIGRlZmF1bHRTdHJva2VDb2xvcikKICAgICAgICB9KTsKCiAgICAgICAgdmFyIHRleHQgPSBnZXRTZW1hbnRpYyhlbGVtZW50KS50ZXh0IHx8ICcnOwogICAgICAgIHJlbmRlckxhYmVsKHBhcmVudEdmeCwgdGV4dCwgewogICAgICAgICAgYm94OiBlbGVtZW50LAogICAgICAgICAgYWxpZ246ICdsZWZ0LXRvcCcsCiAgICAgICAgICBwYWRkaW5nOiA1LAogICAgICAgICAgc3R5bGU6IHsKICAgICAgICAgICAgZmlsbDogZ2V0U3Ryb2tlQ29sb3IoZWxlbWVudCwgZGVmYXVsdFN0cm9rZUNvbG9yKQogICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICByZXR1cm4gdGV4dEVsZW1lbnQ7CiAgICAgIH0sCiAgICAgICdQYXJ0aWNpcGFudE11bHRpcGxpY2l0eU1hcmtlcic6IGZ1bmN0aW9uKHBhcmVudEdmeCwgZWxlbWVudCkgewogICAgICAgIHZhciBtYXJrZXJQYXRoID0gcGF0aE1hcC5nZXRTY2FsZWRQYXRoKCdNQVJLRVJfUEFSQUxMRUwnLCB7CiAgICAgICAgICB4U2NhbGVGYWN0b3I6IDEsCiAgICAgICAgICB5U2NhbGVGYWN0b3I6IDEsCiAgICAgICAgICBjb250YWluZXJXaWR0aDogZWxlbWVudC53aWR0aCwKICAgICAgICAgIGNvbnRhaW5lckhlaWdodDogZWxlbWVudC5oZWlnaHQsCiAgICAgICAgICBwb3NpdGlvbjogewogICAgICAgICAgICBteDogKChlbGVtZW50LndpZHRoIC8gMikgLyBlbGVtZW50LndpZHRoKSwKICAgICAgICAgICAgbXk6IChlbGVtZW50LmhlaWdodCAtIDE1KSAvIGVsZW1lbnQuaGVpZ2h0CiAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIGRyYXdNYXJrZXIoJ3BhcnRpY2lwYW50LW11bHRpcGxpY2l0eScsIHBhcmVudEdmeCwgbWFya2VyUGF0aCwgewogICAgICAgICAgc3Ryb2tlV2lkdGg6IDEsCiAgICAgICAgICBmaWxsOiBnZXRGaWxsQ29sb3IoZWxlbWVudCwgZGVmYXVsdEZpbGxDb2xvciksCiAgICAgICAgICBzdHJva2U6IGdldFN0cm9rZUNvbG9yKGVsZW1lbnQsIGRlZmF1bHRTdHJva2VDb2xvcikKICAgICAgICB9KTsKICAgICAgfSwKICAgICAgJ1N1YlByb2Nlc3NNYXJrZXInOiBmdW5jdGlvbihwYXJlbnRHZngsIGVsZW1lbnQpIHsKICAgICAgICB2YXIgbWFya2VyUmVjdCA9IGRyYXdSZWN0KHBhcmVudEdmeCwgMTQsIDE0LCAwLCB7CiAgICAgICAgICBzdHJva2VXaWR0aDogMSwKICAgICAgICAgIGZpbGw6IGdldEZpbGxDb2xvcihlbGVtZW50LCBkZWZhdWx0RmlsbENvbG9yKSwKICAgICAgICAgIHN0cm9rZTogZ2V0U3Ryb2tlQ29sb3IoZWxlbWVudCwgZGVmYXVsdFN0cm9rZUNvbG9yKQogICAgICAgIH0pOwoKICAgICAgICAvLyBQcm9jZXNzIG1hcmtlciBpcyBwbGFjZWQgaW4gdGhlIG1pZGRsZSBvZiB0aGUgYm94CiAgICAgICAgLy8gdGhlcmVmb3JlIGZpeGVkIHZhbHVlcyBjYW4gYmUgdXNlZCBoZXJlCiAgICAgICAgdHJhbnNsYXRlKG1hcmtlclJlY3QsIGVsZW1lbnQud2lkdGggLyAyIC0gNy41LCBlbGVtZW50LmhlaWdodCAtIDIwKTsKCiAgICAgICAgdmFyIG1hcmtlclBhdGggPSBwYXRoTWFwLmdldFNjYWxlZFBhdGgoJ01BUktFUl9TVUJfUFJPQ0VTUycsIHsKICAgICAgICAgIHhTY2FsZUZhY3RvcjogMS41LAogICAgICAgICAgeVNjYWxlRmFjdG9yOiAxLjUsCiAgICAgICAgICBjb250YWluZXJXaWR0aDogZWxlbWVudC53aWR0aCwKICAgICAgICAgIGNvbnRhaW5lckhlaWdodDogZWxlbWVudC5oZWlnaHQsCiAgICAgICAgICBwb3NpdGlvbjogewogICAgICAgICAgICBteDogKGVsZW1lbnQud2lkdGggLyAyIC0gNy41KSAvIGVsZW1lbnQud2lkdGgsCiAgICAgICAgICAgIG15OiAoZWxlbWVudC5oZWlnaHQgLSAyMCkgLyBlbGVtZW50LmhlaWdodAogICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICBkcmF3TWFya2VyKCdzdWItcHJvY2VzcycsIHBhcmVudEdmeCwgbWFya2VyUGF0aCwgewogICAgICAgICAgZmlsbDogZ2V0RmlsbENvbG9yKGVsZW1lbnQsIGRlZmF1bHRGaWxsQ29sb3IpLAogICAgICAgICAgc3Ryb2tlOiBnZXRTdHJva2VDb2xvcihlbGVtZW50LCBkZWZhdWx0U3Ryb2tlQ29sb3IpCiAgICAgICAgfSk7CiAgICAgIH0sCiAgICAgICdQYXJhbGxlbE1hcmtlcic6IGZ1bmN0aW9uKHBhcmVudEdmeCwgZWxlbWVudCwgcG9zaXRpb24pIHsKICAgICAgICB2YXIgbWFya2VyUGF0aCA9IHBhdGhNYXAuZ2V0U2NhbGVkUGF0aCgnTUFSS0VSX1BBUkFMTEVMJywgewogICAgICAgICAgeFNjYWxlRmFjdG9yOiAxLAogICAgICAgICAgeVNjYWxlRmFjdG9yOiAxLAogICAgICAgICAgY29udGFpbmVyV2lkdGg6IGVsZW1lbnQud2lkdGgsCiAgICAgICAgICBjb250YWluZXJIZWlnaHQ6IGVsZW1lbnQuaGVpZ2h0LAogICAgICAgICAgcG9zaXRpb246IHsKICAgICAgICAgICAgbXg6ICgoZWxlbWVudC53aWR0aCAvIDIgKyBwb3NpdGlvbi5wYXJhbGxlbCkgLyBlbGVtZW50LndpZHRoKSwKICAgICAgICAgICAgbXk6IChlbGVtZW50LmhlaWdodCAtIDIwKSAvIGVsZW1lbnQuaGVpZ2h0CiAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIGRyYXdNYXJrZXIoJ3BhcmFsbGVsJywgcGFyZW50R2Z4LCBtYXJrZXJQYXRoLCB7CiAgICAgICAgICBmaWxsOiBnZXRGaWxsQ29sb3IoZWxlbWVudCwgZGVmYXVsdEZpbGxDb2xvciksCiAgICAgICAgICBzdHJva2U6IGdldFN0cm9rZUNvbG9yKGVsZW1lbnQsIGRlZmF1bHRTdHJva2VDb2xvcikKICAgICAgICB9KTsKICAgICAgfSwKICAgICAgJ1NlcXVlbnRpYWxNYXJrZXInOiBmdW5jdGlvbihwYXJlbnRHZngsIGVsZW1lbnQsIHBvc2l0aW9uKSB7CiAgICAgICAgdmFyIG1hcmtlclBhdGggPSBwYXRoTWFwLmdldFNjYWxlZFBhdGgoJ01BUktFUl9TRVFVRU5USUFMJywgewogICAgICAgICAgeFNjYWxlRmFjdG9yOiAxLAogICAgICAgICAgeVNjYWxlRmFjdG9yOiAxLAogICAgICAgICAgY29udGFpbmVyV2lkdGg6IGVsZW1lbnQud2lkdGgsCiAgICAgICAgICBjb250YWluZXJIZWlnaHQ6IGVsZW1lbnQuaGVpZ2h0LAogICAgICAgICAgcG9zaXRpb246IHsKICAgICAgICAgICAgbXg6ICgoZWxlbWVudC53aWR0aCAvIDIgKyBwb3NpdGlvbi5zZXEpIC8gZWxlbWVudC53aWR0aCksCiAgICAgICAgICAgIG15OiAoZWxlbWVudC5oZWlnaHQgLSAxOSkgLyBlbGVtZW50LmhlaWdodAogICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICBkcmF3TWFya2VyKCdzZXF1ZW50aWFsJywgcGFyZW50R2Z4LCBtYXJrZXJQYXRoLCB7CiAgICAgICAgICBmaWxsOiBnZXRGaWxsQ29sb3IoZWxlbWVudCwgZGVmYXVsdEZpbGxDb2xvciksCiAgICAgICAgICBzdHJva2U6IGdldFN0cm9rZUNvbG9yKGVsZW1lbnQsIGRlZmF1bHRTdHJva2VDb2xvcikKICAgICAgICB9KTsKICAgICAgfSwKICAgICAgJ0NvbXBlbnNhdGlvbk1hcmtlcic6IGZ1bmN0aW9uKHBhcmVudEdmeCwgZWxlbWVudCwgcG9zaXRpb24pIHsKICAgICAgICB2YXIgbWFya2VyTWF0aCA9IHBhdGhNYXAuZ2V0U2NhbGVkUGF0aCgnTUFSS0VSX0NPTVBFTlNBVElPTicsIHsKICAgICAgICAgIHhTY2FsZUZhY3RvcjogMSwKICAgICAgICAgIHlTY2FsZUZhY3RvcjogMSwKICAgICAgICAgIGNvbnRhaW5lcldpZHRoOiBlbGVtZW50LndpZHRoLAogICAgICAgICAgY29udGFpbmVySGVpZ2h0OiBlbGVtZW50LmhlaWdodCwKICAgICAgICAgIHBvc2l0aW9uOiB7CiAgICAgICAgICAgIG14OiAoKGVsZW1lbnQud2lkdGggLyAyICsgcG9zaXRpb24uY29tcGVuc2F0aW9uKSAvIGVsZW1lbnQud2lkdGgpLAogICAgICAgICAgICBteTogKGVsZW1lbnQuaGVpZ2h0IC0gMTMpIC8gZWxlbWVudC5oZWlnaHQKICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgZHJhd01hcmtlcignY29tcGVuc2F0aW9uJywgcGFyZW50R2Z4LCBtYXJrZXJNYXRoLCB7CiAgICAgICAgICBzdHJva2VXaWR0aDogMSwKICAgICAgICAgIGZpbGw6IGdldEZpbGxDb2xvcihlbGVtZW50LCBkZWZhdWx0RmlsbENvbG9yKSwKICAgICAgICAgIHN0cm9rZTogZ2V0U3Ryb2tlQ29sb3IoZWxlbWVudCwgZGVmYXVsdFN0cm9rZUNvbG9yKQogICAgICAgIH0pOwogICAgICB9LAogICAgICAnTG9vcE1hcmtlcic6IGZ1bmN0aW9uKHBhcmVudEdmeCwgZWxlbWVudCwgcG9zaXRpb24pIHsKICAgICAgICB2YXIgbWFya2VyUGF0aCA9IHBhdGhNYXAuZ2V0U2NhbGVkUGF0aCgnTUFSS0VSX0xPT1AnLCB7CiAgICAgICAgICB4U2NhbGVGYWN0b3I6IDEsCiAgICAgICAgICB5U2NhbGVGYWN0b3I6IDEsCiAgICAgICAgICBjb250YWluZXJXaWR0aDogZWxlbWVudC53aWR0aCwKICAgICAgICAgIGNvbnRhaW5lckhlaWdodDogZWxlbWVudC5oZWlnaHQsCiAgICAgICAgICBwb3NpdGlvbjogewogICAgICAgICAgICBteDogKChlbGVtZW50LndpZHRoIC8gMiArIHBvc2l0aW9uLmxvb3ApIC8gZWxlbWVudC53aWR0aCksCiAgICAgICAgICAgIG15OiAoZWxlbWVudC5oZWlnaHQgLSA3KSAvIGVsZW1lbnQuaGVpZ2h0CiAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIGRyYXdNYXJrZXIoJ2xvb3AnLCBwYXJlbnRHZngsIG1hcmtlclBhdGgsIHsKICAgICAgICAgIHN0cm9rZVdpZHRoOiAxLAogICAgICAgICAgZmlsbDogZ2V0RmlsbENvbG9yKGVsZW1lbnQsIGRlZmF1bHRGaWxsQ29sb3IpLAogICAgICAgICAgc3Ryb2tlOiBnZXRTdHJva2VDb2xvcihlbGVtZW50LCBkZWZhdWx0U3Ryb2tlQ29sb3IpLAogICAgICAgICAgc3Ryb2tlTGluZWNhcDogJ3JvdW5kJywKICAgICAgICAgIHN0cm9rZU1pdGVybGltaXQ6IDAuNQogICAgICAgIH0pOwogICAgICB9LAogICAgICAnQWRob2NNYXJrZXInOiBmdW5jdGlvbihwYXJlbnRHZngsIGVsZW1lbnQsIHBvc2l0aW9uKSB7CiAgICAgICAgdmFyIG1hcmtlclBhdGggPSBwYXRoTWFwLmdldFNjYWxlZFBhdGgoJ01BUktFUl9BREhPQycsIHsKICAgICAgICAgIHhTY2FsZUZhY3RvcjogMSwKICAgICAgICAgIHlTY2FsZUZhY3RvcjogMSwKICAgICAgICAgIGNvbnRhaW5lcldpZHRoOiBlbGVtZW50LndpZHRoLAogICAgICAgICAgY29udGFpbmVySGVpZ2h0OiBlbGVtZW50LmhlaWdodCwKICAgICAgICAgIHBvc2l0aW9uOiB7CiAgICAgICAgICAgIG14OiAoKGVsZW1lbnQud2lkdGggLyAyICsgcG9zaXRpb24uYWRob2MpIC8gZWxlbWVudC53aWR0aCksCiAgICAgICAgICAgIG15OiAoZWxlbWVudC5oZWlnaHQgLSAxNSkgLyBlbGVtZW50LmhlaWdodAogICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICBkcmF3TWFya2VyKCdhZGhvYycsIHBhcmVudEdmeCwgbWFya2VyUGF0aCwgewogICAgICAgICAgc3Ryb2tlV2lkdGg6IDEsCiAgICAgICAgICBmaWxsOiBnZXRTdHJva2VDb2xvcihlbGVtZW50LCBkZWZhdWx0U3Ryb2tlQ29sb3IpLAogICAgICAgICAgc3Ryb2tlOiBnZXRTdHJva2VDb2xvcihlbGVtZW50LCBkZWZhdWx0U3Ryb2tlQ29sb3IpCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH07CgogICAgZnVuY3Rpb24gYXR0YWNoVGFza01hcmtlcnMocGFyZW50R2Z4LCBlbGVtZW50LCB0YXNrTWFya2VycykgewogICAgICB2YXIgb2JqID0gZ2V0U2VtYW50aWMoZWxlbWVudCk7CgogICAgICB2YXIgc3VicHJvY2VzcyA9IHRhc2tNYXJrZXJzICYmIHRhc2tNYXJrZXJzLmluZGV4T2YoJ1N1YlByb2Nlc3NNYXJrZXInKSAhPT0gLTE7CiAgICAgIHZhciBwb3NpdGlvbjsKCiAgICAgIGlmIChzdWJwcm9jZXNzKSB7CiAgICAgICAgcG9zaXRpb24gPSB7CiAgICAgICAgICBzZXE6IC0yMSwKICAgICAgICAgIHBhcmFsbGVsOiAtMjIsCiAgICAgICAgICBjb21wZW5zYXRpb246IC00MiwKICAgICAgICAgIGxvb3A6IC0xOCwKICAgICAgICAgIGFkaG9jOiAxMAogICAgICAgIH07CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcG9zaXRpb24gPSB7CiAgICAgICAgICBzZXE6IC0zLAogICAgICAgICAgcGFyYWxsZWw6IC02LAogICAgICAgICAgY29tcGVuc2F0aW9uOiAtMjcsCiAgICAgICAgICBsb29wOiAwLAogICAgICAgICAgYWRob2M6IDEwCiAgICAgICAgfTsKICAgICAgfQoKICAgICAgZm9yRWFjaCh0YXNrTWFya2VycywgZnVuY3Rpb24obWFya2VyKSB7CiAgICAgICAgcmVuZGVyZXIobWFya2VyKShwYXJlbnRHZngsIGVsZW1lbnQsIHBvc2l0aW9uKTsKICAgICAgfSk7CgogICAgICBpZiAob2JqLmlzRm9yQ29tcGVuc2F0aW9uKSB7CiAgICAgICAgcmVuZGVyZXIoJ0NvbXBlbnNhdGlvbk1hcmtlcicpKHBhcmVudEdmeCwgZWxlbWVudCwgcG9zaXRpb24pOwogICAgICB9CgogICAgICBpZiAob2JqLiR0eXBlID09PSAnYnBtbjpBZEhvY1N1YlByb2Nlc3MnKSB7CiAgICAgICAgcmVuZGVyZXIoJ0FkaG9jTWFya2VyJykocGFyZW50R2Z4LCBlbGVtZW50LCBwb3NpdGlvbik7CiAgICAgIH0KCiAgICAgIHZhciBsb29wQ2hhcmFjdGVyaXN0aWNzID0gb2JqLmxvb3BDaGFyYWN0ZXJpc3RpY3MsCiAgICAgICAgICBpc1NlcXVlbnRpYWwgPSBsb29wQ2hhcmFjdGVyaXN0aWNzICYmIGxvb3BDaGFyYWN0ZXJpc3RpY3MuaXNTZXF1ZW50aWFsOwoKICAgICAgaWYgKGxvb3BDaGFyYWN0ZXJpc3RpY3MpIHsKCiAgICAgICAgaWYgKGlzU2VxdWVudGlhbCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICByZW5kZXJlcignTG9vcE1hcmtlcicpKHBhcmVudEdmeCwgZWxlbWVudCwgcG9zaXRpb24pOwogICAgICAgIH0KCiAgICAgICAgaWYgKGlzU2VxdWVudGlhbCA9PT0gZmFsc2UpIHsKICAgICAgICAgIHJlbmRlcmVyKCdQYXJhbGxlbE1hcmtlcicpKHBhcmVudEdmeCwgZWxlbWVudCwgcG9zaXRpb24pOwogICAgICAgIH0KCiAgICAgICAgaWYgKGlzU2VxdWVudGlhbCA9PT0gdHJ1ZSkgewogICAgICAgICAgcmVuZGVyZXIoJ1NlcXVlbnRpYWxNYXJrZXInKShwYXJlbnRHZngsIGVsZW1lbnQsIHBvc2l0aW9uKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiByZW5kZXJEYXRhSXRlbUNvbGxlY3Rpb24ocGFyZW50R2Z4LCBlbGVtZW50KSB7CgogICAgICB2YXIgeVBvc2l0aW9uID0gKGVsZW1lbnQuaGVpZ2h0IC0gMTYpIC8gZWxlbWVudC5oZWlnaHQ7CgogICAgICB2YXIgcGF0aERhdGEgPSBwYXRoTWFwLmdldFNjYWxlZFBhdGgoJ0RBVEFfT0JKRUNUX0NPTExFQ1RJT05fUEFUSCcsIHsKICAgICAgICB4U2NhbGVGYWN0b3I6IDEsCiAgICAgICAgeVNjYWxlRmFjdG9yOiAxLAogICAgICAgIGNvbnRhaW5lcldpZHRoOiBlbGVtZW50LndpZHRoLAogICAgICAgIGNvbnRhaW5lckhlaWdodDogZWxlbWVudC5oZWlnaHQsCiAgICAgICAgcG9zaXRpb246IHsKICAgICAgICAgIG14OiAwLjQ1MSwKICAgICAgICAgIG15OiB5UG9zaXRpb24KICAgICAgICB9CiAgICAgIH0pOwoKICAgICAgLyogY29sbGVjdGlvbiBwYXRoICovIGRyYXdQYXRoKHBhcmVudEdmeCwgcGF0aERhdGEsIHsKICAgICAgICBzdHJva2VXaWR0aDogMgogICAgICB9KTsKICAgIH0KCgogICAgLy8gZXh0ZW5zaW9uIEFQSSwgdXNlIGF0IHlvdXIgb3duIHJpc2sKICAgIHRoaXMuX2RyYXdQYXRoID0gZHJhd1BhdGg7CgogIH0KCgogIGluaGVyaXRzX2Jyb3dzZXIoQnBtblJlbmRlcmVyLCBCYXNlUmVuZGVyZXIpOwoKICBCcG1uUmVuZGVyZXIuJGluamVjdCA9IFsKICAgICdjb25maWcuYnBtblJlbmRlcmVyJywKICAgICdldmVudEJ1cycsCiAgICAnc3R5bGVzJywKICAgICdwYXRoTWFwJywKICAgICdjYW52YXMnLAogICAgJ3RleHRSZW5kZXJlcicKICBdOwoKCiAgQnBtblJlbmRlcmVyLnByb3RvdHlwZS5jYW5SZW5kZXIgPSBmdW5jdGlvbihlbGVtZW50KSB7CiAgICByZXR1cm4gaXMkMShlbGVtZW50LCAnYnBtbjpCYXNlRWxlbWVudCcpOwogIH07CgogIEJwbW5SZW5kZXJlci5wcm90b3R5cGUuZHJhd1NoYXBlID0gZnVuY3Rpb24ocGFyZW50R2Z4LCBlbGVtZW50KSB7CiAgICB2YXIgdHlwZSA9IGVsZW1lbnQudHlwZTsKICAgIHZhciBoID0gdGhpcy5oYW5kbGVyc1t0eXBlXTsKCiAgICAvKiBqc2hpbnQgLVcwNDAgKi8KICAgIHJldHVybiBoKHBhcmVudEdmeCwgZWxlbWVudCk7CiAgfTsKCiAgQnBtblJlbmRlcmVyLnByb3RvdHlwZS5kcmF3Q29ubmVjdGlvbiA9IGZ1bmN0aW9uKHBhcmVudEdmeCwgZWxlbWVudCkgewogICAgdmFyIHR5cGUgPSBlbGVtZW50LnR5cGU7CiAgICB2YXIgaCA9IHRoaXMuaGFuZGxlcnNbdHlwZV07CgogICAgLyoganNoaW50IC1XMDQwICovCiAgICByZXR1cm4gaChwYXJlbnRHZngsIGVsZW1lbnQpOwogIH07CgogIEJwbW5SZW5kZXJlci5wcm90b3R5cGUuZ2V0U2hhcGVQYXRoID0gZnVuY3Rpb24oZWxlbWVudCkgewoKICAgIGlmIChpcyQxKGVsZW1lbnQsICdicG1uOkV2ZW50JykpIHsKICAgICAgcmV0dXJuIGdldENpcmNsZVBhdGgoZWxlbWVudCk7CiAgICB9CgogICAgaWYgKGlzJDEoZWxlbWVudCwgJ2JwbW46QWN0aXZpdHknKSkgewogICAgICByZXR1cm4gZ2V0Um91bmRSZWN0UGF0aChlbGVtZW50LCBUQVNLX0JPUkRFUl9SQURJVVMpOwogICAgfQoKICAgIGlmIChpcyQxKGVsZW1lbnQsICdicG1uOkdhdGV3YXknKSkgewogICAgICByZXR1cm4gZ2V0RGlhbW9uZFBhdGgoZWxlbWVudCk7CiAgICB9CgogICAgcmV0dXJuIGdldFJlY3RQYXRoKGVsZW1lbnQpOwogIH07CgogIHZhciBERUZBVUxUX0JPWF9QQURESU5HID0gMDsKCiAgdmFyIERFRkFVTFRfTEFCRUxfU0laRSA9IHsKICAgIHdpZHRoOiAxNTAsCiAgICBoZWlnaHQ6IDUwCiAgfTsKCgogIGZ1bmN0aW9uIHBhcnNlQWxpZ24oYWxpZ24pIHsKCiAgICB2YXIgcGFydHMgPSBhbGlnbi5zcGxpdCgnLScpOwoKICAgIHJldHVybiB7CiAgICAgIGhvcml6b250YWw6IHBhcnRzWzBdIHx8ICdjZW50ZXInLAogICAgICB2ZXJ0aWNhbDogcGFydHNbMV0gfHwgJ3RvcCcKICAgIH07CiAgfQoKICBmdW5jdGlvbiBwYXJzZVBhZGRpbmcocGFkZGluZykgewoKICAgIGlmIChpc09iamVjdChwYWRkaW5nKSkgewogICAgICByZXR1cm4gYXNzaWduKHsgdG9wOiAwLCBsZWZ0OiAwLCByaWdodDogMCwgYm90dG9tOiAwIH0sIHBhZGRpbmcpOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIHsKICAgICAgICB0b3A6IHBhZGRpbmcsCiAgICAgICAgbGVmdDogcGFkZGluZywKICAgICAgICByaWdodDogcGFkZGluZywKICAgICAgICBib3R0b206IHBhZGRpbmcKICAgICAgfTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIGdldFRleHRCQm94KHRleHQsIGZha2VUZXh0KSB7CgogICAgZmFrZVRleHQudGV4dENvbnRlbnQgPSB0ZXh0OwoKICAgIHZhciB0ZXh0QkJveDsKCiAgICB0cnkgewogICAgICB2YXIgYmJveCwKICAgICAgICAgIGVtcHR5TGluZSA9IHRleHQgPT09ICcnOwoKICAgICAgLy8gYWRkIGR1bW15IHRleHQsIHdoZW4gbGluZSBpcyBlbXB0eSB0bwogICAgICAvLyBkZXRlcm1pbmUgY29ycmVjdCBoZWlnaHQKICAgICAgZmFrZVRleHQudGV4dENvbnRlbnQgPSBlbXB0eUxpbmUgPyAnZHVtbXknIDogdGV4dDsKCiAgICAgIHRleHRCQm94ID0gZmFrZVRleHQuZ2V0QkJveCgpOwoKICAgICAgLy8gdGFrZSB0ZXh0IHJlbmRlcmluZyByZWxhdGVkIGhvcml6b250YWwKICAgICAgLy8gcGFkZGluZyBpbnRvIGFjY291bnQKICAgICAgYmJveCA9IHsKICAgICAgICB3aWR0aDogdGV4dEJCb3gud2lkdGggKyB0ZXh0QkJveC54ICogMiwKICAgICAgICBoZWlnaHQ6IHRleHRCQm94LmhlaWdodAogICAgICB9OwoKICAgICAgaWYgKGVtcHR5TGluZSkgewoKICAgICAgICAvLyBjb3JyZWN0IHdpZHRoCiAgICAgICAgYmJveC53aWR0aCA9IDA7CiAgICAgIH0KCiAgICAgIHJldHVybiBiYm94OwogICAgfSBjYXRjaCAoZSkgewogICAgICByZXR1cm4geyB3aWR0aDogMCwgaGVpZ2h0OiAwIH07CiAgICB9CiAgfQoKCiAgLyoqCiAgICogTGF5b3V0IHRoZSBuZXh0IGxpbmUgYW5kIHJldHVybiB0aGUgbGF5b3V0ZWQgZWxlbWVudC4KICAgKgogICAqIEFsdGVycyB0aGUgbGluZXMgcGFzc2VkLgogICAqCiAgICogQHBhcmFtICB7QXJyYXk8U3RyaW5nPn0gbGluZXMKICAgKiBAcmV0dXJuIHtPYmplY3R9IHRoZSBsaW5lIGRlc2NyaXB0b3IsIGFuIG9iamVjdCB7IHdpZHRoLCBoZWlnaHQsIHRleHQgfQogICAqLwogIGZ1bmN0aW9uIGxheW91dE5leHQobGluZXMsIG1heFdpZHRoLCBmYWtlVGV4dCkgewoKICAgIHZhciBvcmlnaW5hbExpbmUgPSBsaW5lcy5zaGlmdCgpLAogICAgICAgIGZpdExpbmUgPSBvcmlnaW5hbExpbmU7CgogICAgdmFyIHRleHRCQm94OwoKICAgIGZvciAoOzspIHsKICAgICAgdGV4dEJCb3ggPSBnZXRUZXh0QkJveChmaXRMaW5lLCBmYWtlVGV4dCk7CgogICAgICB0ZXh0QkJveC53aWR0aCA9IGZpdExpbmUgPyB0ZXh0QkJveC53aWR0aCA6IDA7CgogICAgICAvLyB0cnkgdG8gZml0CiAgICAgIGlmIChmaXRMaW5lID09PSAnICcgfHwgZml0TGluZSA9PT0gJycgfHwgdGV4dEJCb3gud2lkdGggPCBNYXRoLnJvdW5kKG1heFdpZHRoKSB8fCBmaXRMaW5lLmxlbmd0aCA8IDIpIHsKICAgICAgICByZXR1cm4gZml0KGxpbmVzLCBmaXRMaW5lLCBvcmlnaW5hbExpbmUsIHRleHRCQm94KTsKICAgICAgfQoKICAgICAgZml0TGluZSA9IHNob3J0ZW5MaW5lKGZpdExpbmUsIHRleHRCQm94LndpZHRoLCBtYXhXaWR0aCk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBmaXQobGluZXMsIGZpdExpbmUsIG9yaWdpbmFsTGluZSwgdGV4dEJCb3gpIHsKICAgIGlmIChmaXRMaW5lLmxlbmd0aCA8IG9yaWdpbmFsTGluZS5sZW5ndGgpIHsKICAgICAgdmFyIHJlbWFpbmRlciA9IG9yaWdpbmFsTGluZS5zbGljZShmaXRMaW5lLmxlbmd0aCkudHJpbSgpOwoKICAgICAgbGluZXMudW5zaGlmdChyZW1haW5kZXIpOwogICAgfQoKICAgIHJldHVybiB7CiAgICAgIHdpZHRoOiB0ZXh0QkJveC53aWR0aCwKICAgICAgaGVpZ2h0OiB0ZXh0QkJveC5oZWlnaHQsCiAgICAgIHRleHQ6IGZpdExpbmUKICAgIH07CiAgfQoKCiAgLyoqCiAgICogU2hvcnRlbnMgYSBsaW5lIGJhc2VkIG9uIHNwYWNpbmcgYW5kIGh5cGhlbnMuCiAgICogUmV0dXJucyB0aGUgc2hvcnRlbmVkIHJlc3VsdCBvbiBzdWNjZXNzLgogICAqCiAgICogQHBhcmFtICB7U3RyaW5nfSBsaW5lCiAgICogQHBhcmFtICB7TnVtYmVyfSBtYXhMZW5ndGggdGhlIG1heGltdW0gY2hhcmFjdGVycyBvZiB0aGUgc3RyaW5nCiAgICogQHJldHVybiB7U3RyaW5nfSB0aGUgc2hvcnRlbmVkIHN0cmluZwogICAqLwogIGZ1bmN0aW9uIHNlbWFudGljU2hvcnRlbihsaW5lLCBtYXhMZW5ndGgpIHsKICAgIHZhciBwYXJ0cyA9IGxpbmUuc3BsaXQoLyhcc3wtKS9nKSwKICAgICAgICBwYXJ0LAogICAgICAgIHNob3J0ZW5lZFBhcnRzID0gW10sCiAgICAgICAgbGVuZ3RoID0gMDsKCiAgICAvLyB0cnkgdG8gc2hvcnRlbiB2aWEgc3BhY2VzICsgaHlwaGVucwogICAgaWYgKHBhcnRzLmxlbmd0aCA+IDEpIHsKICAgICAgd2hpbGUgKChwYXJ0ID0gcGFydHMuc2hpZnQoKSkpIHsKICAgICAgICBpZiAocGFydC5sZW5ndGggKyBsZW5ndGggPCBtYXhMZW5ndGgpIHsKICAgICAgICAgIHNob3J0ZW5lZFBhcnRzLnB1c2gocGFydCk7CiAgICAgICAgICBsZW5ndGggKz0gcGFydC5sZW5ndGg7CiAgICAgICAgfSBlbHNlIHsKCiAgICAgICAgICAvLyByZW1vdmUgcHJldmlvdXMgcGFydCwgdG9vIGlmIGh5cGhlbiBkb2VzIG5vdCBmaXQgYW55bW9yZQogICAgICAgICAgaWYgKHBhcnQgPT09ICctJykgewogICAgICAgICAgICBzaG9ydGVuZWRQYXJ0cy5wb3AoKTsKICAgICAgICAgIH0KCiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gc2hvcnRlbmVkUGFydHMuam9pbignJyk7CiAgfQoKCiAgZnVuY3Rpb24gc2hvcnRlbkxpbmUobGluZSwgd2lkdGgsIG1heFdpZHRoKSB7CiAgICB2YXIgbGVuZ3RoID0gTWF0aC5tYXgobGluZS5sZW5ndGggKiAobWF4V2lkdGggLyB3aWR0aCksIDEpOwoKICAgIC8vIHRyeSB0byBzaG9ydGVuIHNlbWFudGljYWxseSAoaS5lLiBiYXNlZCBvbiBzcGFjZXMgYW5kIGh5cGhlbnMpCiAgICB2YXIgc2hvcnRlbmVkTGluZSA9IHNlbWFudGljU2hvcnRlbihsaW5lLCBsZW5ndGgpOwoKICAgIGlmICghc2hvcnRlbmVkTGluZSkgewoKICAgICAgLy8gZm9yY2Ugc2hvcnRlbiBieSBjdXR0aW5nIHRoZSBsb25nIHdvcmQKICAgICAgc2hvcnRlbmVkTGluZSA9IGxpbmUuc2xpY2UoMCwgTWF0aC5tYXgoTWF0aC5yb3VuZChsZW5ndGggLSAxKSwgMSkpOwogICAgfQoKICAgIHJldHVybiBzaG9ydGVuZWRMaW5lOwogIH0KCgogIGZ1bmN0aW9uIGdldEhlbHBlclN2ZygpIHsKICAgIHZhciBoZWxwZXJTdmcgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGVscGVyLXN2ZycpOwoKICAgIGlmICghaGVscGVyU3ZnKSB7CiAgICAgIGhlbHBlclN2ZyA9IGNyZWF0ZSgnc3ZnJyk7CgogICAgICBhdHRyJDEoaGVscGVyU3ZnLCB7CiAgICAgICAgaWQ6ICdoZWxwZXItc3ZnJywKICAgICAgICB3aWR0aDogMCwKICAgICAgICBoZWlnaHQ6IDAsCiAgICAgICAgc3R5bGU6ICd2aXNpYmlsaXR5OiBoaWRkZW47IHBvc2l0aW9uOiBmaXhlZCcKICAgICAgfSk7CgogICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGhlbHBlclN2Zyk7CiAgICB9CgogICAgcmV0dXJuIGhlbHBlclN2ZzsKICB9CgoKICAvKioKICAgKiBDcmVhdGVzIGEgbmV3IGxhYmVsIHV0aWxpdHkKICAgKgogICAqIEBwYXJhbSB7T2JqZWN0fSBjb25maWcKICAgKiBAcGFyYW0ge0RpbWVuc2lvbnN9IGNvbmZpZy5zaXplCiAgICogQHBhcmFtIHtOdW1iZXJ9IGNvbmZpZy5wYWRkaW5nCiAgICogQHBhcmFtIHtPYmplY3R9IGNvbmZpZy5zdHlsZQogICAqIEBwYXJhbSB7U3RyaW5nfSBjb25maWcuYWxpZ24KICAgKi8KICBmdW5jdGlvbiBUZXh0KGNvbmZpZykgewoKICAgIHRoaXMuX2NvbmZpZyA9IGFzc2lnbih7fSwgewogICAgICBzaXplOiBERUZBVUxUX0xBQkVMX1NJWkUsCiAgICAgIHBhZGRpbmc6IERFRkFVTFRfQk9YX1BBRERJTkcsCiAgICAgIHN0eWxlOiB7fSwKICAgICAgYWxpZ246ICdjZW50ZXItdG9wJwogICAgfSwgY29uZmlnIHx8IHt9KTsKICB9CgogIC8qKgogICAqIFJldHVybnMgdGhlIGxheW91dGVkIHRleHQgYXMgYW4gU1ZHIGVsZW1lbnQuCiAgICoKICAgKiBAcGFyYW0ge1N0cmluZ30gdGV4dAogICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zCiAgICoKICAgKiBAcmV0dXJuIHtTVkdFbGVtZW50fQogICAqLwogIFRleHQucHJvdG90eXBlLmNyZWF0ZVRleHQgPSBmdW5jdGlvbih0ZXh0LCBvcHRpb25zKSB7CiAgICByZXR1cm4gdGhpcy5sYXlvdXRUZXh0KHRleHQsIG9wdGlvbnMpLmVsZW1lbnQ7CiAgfTsKCiAgLyoqCiAgICogUmV0dXJucyBhIGxhYmVscyBsYXlvdXRlZCBkaW1lbnNpb25zLgogICAqCiAgICogQHBhcmFtIHtTdHJpbmd9IHRleHQgdG8gbGF5b3V0CiAgICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMKICAgKgogICAqIEByZXR1cm4ge0RpbWVuc2lvbnN9CiAgICovCiAgVGV4dC5wcm90b3R5cGUuZ2V0RGltZW5zaW9ucyA9IGZ1bmN0aW9uKHRleHQsIG9wdGlvbnMpIHsKICAgIHJldHVybiB0aGlzLmxheW91dFRleHQodGV4dCwgb3B0aW9ucykuZGltZW5zaW9uczsKICB9OwoKICAvKioKICAgKiBDcmVhdGVzIGFuZCByZXR1cm5zIGEgbGFiZWwgYW5kIGl0cyBib3VuZGluZyBib3guCiAgICoKICAgKiBAbWV0aG9kIFRleHQjY3JlYXRlVGV4dAogICAqCiAgICogQHBhcmFtIHtTdHJpbmd9IHRleHQgdGhlIHRleHQgdG8gcmVuZGVyIG9uIHRoZSBsYWJlbAogICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zCiAgICogQHBhcmFtIHtTdHJpbmd9IG9wdGlvbnMuYWxpZ24gaG93IHRvIGFsaWduIGluIHRoZSBib3VuZGluZyBib3guCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQW55IG9mIHsgJ2NlbnRlci1taWRkbGUnLCAnY2VudGVyLXRvcCcgfSwKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0cyB0byAnY2VudGVyLXRvcCcuCiAgICogQHBhcmFtIHtTdHJpbmd9IG9wdGlvbnMuc3R5bGUgc3R5bGUgdG8gYmUgYXBwbGllZCB0byB0aGUgdGV4dAogICAqIEBwYXJhbSB7Ym9vbGVhbn0gb3B0aW9ucy5maXRCb3ggaW5kaWNhdGVzIGlmIGJveCB3aWxsIGJlIHJlY2FsY3VsYXRlZCB0bwogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZml0IHRleHQKICAgKgogICAqIEByZXR1cm4ge09iamVjdH0geyBlbGVtZW50LCBkaW1lbnNpb25zIH0KICAgKi8KICBUZXh0LnByb3RvdHlwZS5sYXlvdXRUZXh0ID0gZnVuY3Rpb24odGV4dCwgb3B0aW9ucykgewogICAgdmFyIGJveCA9IGFzc2lnbih7fSwgdGhpcy5fY29uZmlnLnNpemUsIG9wdGlvbnMuYm94KSwKICAgICAgICBzdHlsZSA9IGFzc2lnbih7fSwgdGhpcy5fY29uZmlnLnN0eWxlLCBvcHRpb25zLnN0eWxlKSwKICAgICAgICBhbGlnbiA9IHBhcnNlQWxpZ24ob3B0aW9ucy5hbGlnbiB8fCB0aGlzLl9jb25maWcuYWxpZ24pLAogICAgICAgIHBhZGRpbmcgPSBwYXJzZVBhZGRpbmcob3B0aW9ucy5wYWRkaW5nICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLnBhZGRpbmcgOiB0aGlzLl9jb25maWcucGFkZGluZyksCiAgICAgICAgZml0Qm94ID0gb3B0aW9ucy5maXRCb3ggfHwgZmFsc2U7CgogICAgdmFyIGxpbmVIZWlnaHQgPSBnZXRMaW5lSGVpZ2h0KHN0eWxlKTsKCiAgICB2YXIgbGluZXMgPSB0ZXh0LnNwbGl0KC9ccj9cbi9nKSwKICAgICAgICBsYXlvdXRlZCA9IFtdOwoKICAgIHZhciBtYXhXaWR0aCA9IGJveC53aWR0aCAtIHBhZGRpbmcubGVmdCAtIHBhZGRpbmcucmlnaHQ7CgogICAgLy8gZW5zdXJlIGNvcnJlY3QgcmVuZGVyaW5nIGJ5IGF0dGFjaGluZyBoZWxwZXIgdGV4dCBub2RlIHRvIGludmlzaWJsZSBTVkcKICAgIHZhciBoZWxwZXJUZXh0ID0gY3JlYXRlKCd0ZXh0Jyk7CiAgICBhdHRyJDEoaGVscGVyVGV4dCwgeyB4OiAwLCB5OiAwIH0pOwogICAgYXR0ciQxKGhlbHBlclRleHQsIHN0eWxlKTsKCiAgICB2YXIgaGVscGVyU3ZnID0gZ2V0SGVscGVyU3ZnKCk7CgogICAgYXBwZW5kKGhlbHBlclN2ZywgaGVscGVyVGV4dCk7CgogICAgd2hpbGUgKGxpbmVzLmxlbmd0aCkgewogICAgICBsYXlvdXRlZC5wdXNoKGxheW91dE5leHQobGluZXMsIG1heFdpZHRoLCBoZWxwZXJUZXh0KSk7CiAgICB9CgogICAgaWYgKGFsaWduLnZlcnRpY2FsID09PSAnbWlkZGxlJykgewogICAgICBwYWRkaW5nLnRvcCA9IHBhZGRpbmcuYm90dG9tID0gMDsKICAgIH0KCiAgICB2YXIgdG90YWxIZWlnaHQgPSByZWR1Y2UobGF5b3V0ZWQsIGZ1bmN0aW9uKHN1bSwgbGluZSwgaWR4KSB7CiAgICAgIHJldHVybiBzdW0gKyAobGluZUhlaWdodCB8fCBsaW5lLmhlaWdodCk7CiAgICB9LCAwKSArIHBhZGRpbmcudG9wICsgcGFkZGluZy5ib3R0b207CgogICAgdmFyIG1heExpbmVXaWR0aCA9IHJlZHVjZShsYXlvdXRlZCwgZnVuY3Rpb24oc3VtLCBsaW5lLCBpZHgpIHsKICAgICAgcmV0dXJuIGxpbmUud2lkdGggPiBzdW0gPyBsaW5lLndpZHRoIDogc3VtOwogICAgfSwgMCk7CgogICAgLy8gdGhlIHkgcG9zaXRpb24gb2YgdGhlIG5leHQgbGluZQogICAgdmFyIHkgPSBwYWRkaW5nLnRvcDsKCiAgICBpZiAoYWxpZ24udmVydGljYWwgPT09ICdtaWRkbGUnKSB7CiAgICAgIHkgKz0gKGJveC5oZWlnaHQgLSB0b3RhbEhlaWdodCkgLyAyOwogICAgfQoKICAgIC8vIG1hZ2ljIG51bWJlciBpbml0aWFsIG9mZnNldAogICAgeSAtPSAobGluZUhlaWdodCB8fCBsYXlvdXRlZFswXS5oZWlnaHQpIC8gNDsKCgogICAgdmFyIHRleHRFbGVtZW50ID0gY3JlYXRlKCd0ZXh0Jyk7CgogICAgYXR0ciQxKHRleHRFbGVtZW50LCBzdHlsZSk7CgogICAgLy8gbGF5b3V0IGVhY2ggbGluZSB0YWtpbmcgaW50byBhY2NvdW50IHRoYXQgcGFyZW50CiAgICAvLyBzaGFwZSBtaWdodCByZXNpemUgdG8gZml0IHRleHQgc2l6ZQogICAgZm9yRWFjaChsYXlvdXRlZCwgZnVuY3Rpb24obGluZSkgewoKICAgICAgdmFyIHg7CgogICAgICB5ICs9IChsaW5lSGVpZ2h0IHx8IGxpbmUuaGVpZ2h0KTsKCiAgICAgIHN3aXRjaCAoYWxpZ24uaG9yaXpvbnRhbCkgewogICAgICBjYXNlICdsZWZ0JzoKICAgICAgICB4ID0gcGFkZGluZy5sZWZ0OwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAncmlnaHQnOgogICAgICAgIHggPSAoKGZpdEJveCA/IG1heExpbmVXaWR0aCA6IG1heFdpZHRoKQogICAgICAgICAgLSBwYWRkaW5nLnJpZ2h0IC0gbGluZS53aWR0aCk7CiAgICAgICAgYnJlYWs7CgogICAgICBkZWZhdWx0OgoKICAgICAgICAvLyBha2EgY2VudGVyCiAgICAgICAgeCA9IE1hdGgubWF4KCgoKGZpdEJveCA/IG1heExpbmVXaWR0aCA6IG1heFdpZHRoKQogICAgICAgICAgLSBsaW5lLndpZHRoKSAvIDIgKyBwYWRkaW5nLmxlZnQpLCAwKTsKICAgICAgfQoKICAgICAgdmFyIHRzcGFuID0gY3JlYXRlKCd0c3BhbicpOwogICAgICBhdHRyJDEodHNwYW4sIHsgeDogeCwgeTogeSB9KTsKCiAgICAgIHRzcGFuLnRleHRDb250ZW50ID0gbGluZS50ZXh0OwoKICAgICAgYXBwZW5kKHRleHRFbGVtZW50LCB0c3Bhbik7CiAgICB9KTsKCiAgICByZW1vdmUkMShoZWxwZXJUZXh0KTsKCiAgICB2YXIgZGltZW5zaW9ucyA9IHsKICAgICAgd2lkdGg6IG1heExpbmVXaWR0aCwKICAgICAgaGVpZ2h0OiB0b3RhbEhlaWdodAogICAgfTsKCiAgICByZXR1cm4gewogICAgICBkaW1lbnNpb25zOiBkaW1lbnNpb25zLAogICAgICBlbGVtZW50OiB0ZXh0RWxlbWVudAogICAgfTsKICB9OwoKCiAgZnVuY3Rpb24gZ2V0TGluZUhlaWdodChzdHlsZSkgewogICAgaWYgKCdmb250U2l6ZScgaW4gc3R5bGUgJiYgJ2xpbmVIZWlnaHQnIGluIHN0eWxlKSB7CiAgICAgIHJldHVybiBzdHlsZS5saW5lSGVpZ2h0ICogcGFyc2VJbnQoc3R5bGUuZm9udFNpemUsIDEwKTsKICAgIH0KICB9CgogIHZhciBERUZBVUxUX0ZPTlRfU0laRSA9IDEyOwogIHZhciBMSU5FX0hFSUdIVF9SQVRJTyA9IDEuMjsKCiAgdmFyIE1JTl9URVhUX0FOTk9UQVRJT05fSEVJR0hUID0gMzA7CgoKICBmdW5jdGlvbiBUZXh0UmVuZGVyZXIoY29uZmlnKSB7CgogICAgdmFyIGRlZmF1bHRTdHlsZSA9IGFzc2lnbih7CiAgICAgIGZvbnRGYW1pbHk6ICdBcmlhbCwgc2Fucy1zZXJpZicsCiAgICAgIGZvbnRTaXplOiBERUZBVUxUX0ZPTlRfU0laRSwKICAgICAgZm9udFdlaWdodDogJ25vcm1hbCcsCiAgICAgIGxpbmVIZWlnaHQ6IExJTkVfSEVJR0hUX1JBVElPCiAgICB9LCBjb25maWcgJiYgY29uZmlnLmRlZmF1bHRTdHlsZSB8fCB7fSk7CgogICAgdmFyIGZvbnRTaXplID0gcGFyc2VJbnQoZGVmYXVsdFN0eWxlLmZvbnRTaXplLCAxMCkgLSAxOwoKICAgIHZhciBleHRlcm5hbFN0eWxlID0gYXNzaWduKHt9LCBkZWZhdWx0U3R5bGUsIHsKICAgICAgZm9udFNpemU6IGZvbnRTaXplCiAgICB9LCBjb25maWcgJiYgY29uZmlnLmV4dGVybmFsU3R5bGUgfHwge30pOwoKICAgIHZhciB0ZXh0VXRpbCA9IG5ldyBUZXh0KHsKICAgICAgc3R5bGU6IGRlZmF1bHRTdHlsZQogICAgfSk7CgogICAgLyoqCiAgICAgKiBHZXQgdGhlIG5ldyBib3VuZHMgb2YgYW4gZXh0ZXJuYWxseSByZW5kZXJlZCwKICAgICAqIGxheW91dGVkIGxhYmVsLgogICAgICoKICAgICAqIEBwYXJhbSAge0JvdW5kc30gYm91bmRzCiAgICAgKiBAcGFyYW0gIHtTdHJpbmd9IHRleHQKICAgICAqCiAgICAgKiBAcmV0dXJuIHtCb3VuZHN9CiAgICAgKi8KICAgIHRoaXMuZ2V0RXh0ZXJuYWxMYWJlbEJvdW5kcyA9IGZ1bmN0aW9uKGJvdW5kcywgdGV4dCkgewoKICAgICAgdmFyIGxheW91dGVkRGltZW5zaW9ucyA9IHRleHRVdGlsLmdldERpbWVuc2lvbnModGV4dCwgewogICAgICAgIGJveDogewogICAgICAgICAgd2lkdGg6IDkwLAogICAgICAgICAgaGVpZ2h0OiAzMCwKICAgICAgICAgIHg6IGJvdW5kcy53aWR0aCAvIDIgKyBib3VuZHMueCwKICAgICAgICAgIHk6IGJvdW5kcy5oZWlnaHQgLyAyICsgYm91bmRzLnkKICAgICAgICB9LAogICAgICAgIHN0eWxlOiBleHRlcm5hbFN0eWxlCiAgICAgIH0pOwoKICAgICAgLy8gcmVzaXplIGxhYmVsIHNoYXBlIHRvIGZpdCBsYWJlbCB0ZXh0CiAgICAgIHJldHVybiB7CiAgICAgICAgeDogTWF0aC5yb3VuZChib3VuZHMueCArIGJvdW5kcy53aWR0aCAvIDIgLSBsYXlvdXRlZERpbWVuc2lvbnMud2lkdGggLyAyKSwKICAgICAgICB5OiBNYXRoLnJvdW5kKGJvdW5kcy55KSwKICAgICAgICB3aWR0aDogTWF0aC5jZWlsKGxheW91dGVkRGltZW5zaW9ucy53aWR0aCksCiAgICAgICAgaGVpZ2h0OiBNYXRoLmNlaWwobGF5b3V0ZWREaW1lbnNpb25zLmhlaWdodCkKICAgICAgfTsKCiAgICB9OwoKICAgIC8qKgogICAgICogR2V0IHRoZSBuZXcgYm91bmRzIG9mIHRleHQgYW5ub3RhdGlvbi4KICAgICAqCiAgICAgKiBAcGFyYW0gIHtCb3VuZHN9IGJvdW5kcwogICAgICogQHBhcmFtICB7U3RyaW5nfSB0ZXh0CiAgICAgKgogICAgICogQHJldHVybiB7Qm91bmRzfQogICAgICovCiAgICB0aGlzLmdldFRleHRBbm5vdGF0aW9uQm91bmRzID0gZnVuY3Rpb24oYm91bmRzLCB0ZXh0KSB7CgogICAgICB2YXIgbGF5b3V0ZWREaW1lbnNpb25zID0gdGV4dFV0aWwuZ2V0RGltZW5zaW9ucyh0ZXh0LCB7CiAgICAgICAgYm94OiBib3VuZHMsCiAgICAgICAgc3R5bGU6IGRlZmF1bHRTdHlsZSwKICAgICAgICBhbGlnbjogJ2xlZnQtdG9wJywKICAgICAgICBwYWRkaW5nOiA1CiAgICAgIH0pOwoKICAgICAgcmV0dXJuIHsKICAgICAgICB4OiBib3VuZHMueCwKICAgICAgICB5OiBib3VuZHMueSwKICAgICAgICB3aWR0aDogYm91bmRzLndpZHRoLAogICAgICAgIGhlaWdodDogTWF0aC5tYXgoTUlOX1RFWFRfQU5OT1RBVElPTl9IRUlHSFQsIE1hdGgucm91bmQobGF5b3V0ZWREaW1lbnNpb25zLmhlaWdodCkpCiAgICAgIH07CiAgICB9OwoKICAgIC8qKgogICAgICogQ3JlYXRlIGEgbGF5b3V0ZWQgdGV4dCBlbGVtZW50LgogICAgICoKICAgICAqIEBwYXJhbSB7U3RyaW5nfSB0ZXh0CiAgICAgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnNdCiAgICAgKgogICAgICogQHJldHVybiB7U1ZHRWxlbWVudH0gcmVuZGVyZWQgdGV4dAogICAgICovCiAgICB0aGlzLmNyZWF0ZVRleHQgPSBmdW5jdGlvbih0ZXh0LCBvcHRpb25zKSB7CiAgICAgIHJldHVybiB0ZXh0VXRpbC5jcmVhdGVUZXh0KHRleHQsIG9wdGlvbnMgfHwge30pOwogICAgfTsKCiAgICAvKioKICAgICAqIEdldCBkZWZhdWx0IHRleHQgc3R5bGUuCiAgICAgKi8KICAgIHRoaXMuZ2V0RGVmYXVsdFN0eWxlID0gZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiBkZWZhdWx0U3R5bGU7CiAgICB9OwoKICAgIC8qKgogICAgICogR2V0IHRoZSBleHRlcm5hbCB0ZXh0IHN0eWxlLgogICAgICovCiAgICB0aGlzLmdldEV4dGVybmFsU3R5bGUgPSBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIGV4dGVybmFsU3R5bGU7CiAgICB9OwoKICB9CgogIFRleHRSZW5kZXJlci4kaW5qZWN0ID0gWwogICAgJ2NvbmZpZy50ZXh0UmVuZGVyZXInCiAgXTsKCiAgLyoqCiAgICogTWFwIGNvbnRhaW5pbmcgU1ZHIHBhdGhzIG5lZWRlZCBieSBCcG1uUmVuZGVyZXIuCiAgICovCgogIGZ1bmN0aW9uIFBhdGhNYXAoKSB7CgogICAgLyoqCiAgICAgKiBDb250YWlucyBhIG1hcCBvZiBwYXRoIGVsZW1lbnRzCiAgICAgKgogICAgICogPGgxPlBhdGggZGVmaW5pdGlvbjwvaDE+CiAgICAgKiBBIHBhcmFtZXRlcml6ZWQgcGF0aCBpcyBkZWZpbmVkIGxpa2UgdGhpczoKICAgICAqIDxwcmU+CiAgICAgKiAnR0FURVdBWV9QQVJBTExFTCc6IHsKICAgICAqICAgZDogJ20ge214fSx7bXl9IHtlLngwfSwwIDAse2UueDF9IHtlLngxfSwwIDAse2UueTB9IC17ZS54MX0sMCAwLHtlLnkxfSAnICsKICAgICAgICAgICAgJy17ZS54MH0sMCAwLC17ZS55MX0gLXtlLngxfSwwIDAsLXtlLnkwfSB7ZS54MX0sMCB6JywKICAgICAqICAgaGVpZ2h0OiAxNy41LAogICAgICogICB3aWR0aDogIDE3LjUsCiAgICAgKiAgIGhlaWdodEVsZW1lbnRzOiBbMi41LCA3LjVdLAogICAgICogICB3aWR0aEVsZW1lbnRzOiBbMi41LCA3LjVdCiAgICAgKiB9CiAgICAgKiA8L3ByZT4KICAgICAqIDxwPkl0J3MgaW1wb3J0YW50IHRvIHNwZWNpZnkgYSBjb3JyZWN0IDxiPmhlaWdodCBhbmQgd2lkdGg8L2I+IGZvciB0aGUgcGF0aCBhcyB0aGUgc2NhbGluZwogICAgICogaXMgYmFzZWQgb24gdGhlIHJhdGlvIGJldHdlZW4gdGhlIHNwZWNpZmllZCBoZWlnaHQgYW5kIHdpZHRoIGluIHRoaXMgb2JqZWN0IGFuZCB0aGUKICAgICAqIGhlaWdodCBhbmQgd2lkdGggdGhhdCBpcyBzZXQgYXMgc2NhbGUgdGFyZ2V0IChOb3RlIHgseSBjb29yZGluYXRlcyB3aWxsIGJlIHNjYWxlZCB3aXRoCiAgICAgKiBpbmRpdmlkdWFsIHJhdGlvcykuPC9wPgogICAgICogPHA+VGhlICc8Yj5oZWlnaHRFbGVtZW50czwvYj4nIGFuZCAnPGI+d2lkdGhFbGVtZW50czwvYj4nIGFycmF5IG11c3QgY29udGFpbiB0aGUgdmFsdWVzIHRoYXQgd2lsbCBiZSBzY2FsZWQuCiAgICAgKiBUaGUgc2NhbGluZyBpcyBiYXNlZCBvbiB0aGUgY29tcHV0ZWQgcmF0aW9zLgogICAgICogQ29vcmRpbmF0ZXMgb24gdGhlIHkgYXhpcyBzaG91bGQgYmUgaW4gdGhlIDxiPmhlaWdodEVsZW1lbnQ8L2I+J3MgYXJyYXksIHRoZXkgd2lsbCBiZSBzY2FsZWQgdXNpbmcKICAgICAqIHRoZSBjb21wdXRlZCByYXRpbyBjb2VmZmljaWVudC4KICAgICAqIEluIHRoZSBwYXJhbWV0ZXJpemVkIHBhdGggdGhlIHNjYWxlZCB2YWx1ZXMgY2FuIGJlIGFjY2Vzc2VkIHRocm91Z2ggdGhlICdlJyBvYmplY3QgaW4ge30gYnJhY2tldHMuCiAgICAgKiAgIDx1bD4KICAgICAqICAgIDxsaT5UaGUgdmFsdWVzIGZvciB0aGUgeSBheGlzIGNhbiBiZSBhY2Nlc3NlZCBpbiB0aGUgcGF0aCBzdHJpbmcgdXNpbmcge2UueTB9LCB7ZS55MX0sIC4uLi48L2xpPgogICAgICogICAgPGxpPlRoZSB2YWx1ZXMgZm9yIHRoZSB4IGF4aXMgY2FuIGJlIGFjY2Vzc2VkIGluIHRoZSBwYXRoIHN0cmluZyB1c2luZyB7ZS54MH0sIHtlLngxfSwgLi4uLjwvbGk+CiAgICAgKiAgIDwvdWw+CiAgICAgKiAgIFRoZSBudW1iZXJzIHgwLCB4MSByZXNwZWN0aXZlbHkgeTAsIHkxLCAuLi4gbWFwIHRvIHRoZSBjb3JyZXNwb25kaW5nIGFycmF5IGluZGV4LgogICAgICogPC9wPgogICAgICovCiAgICB0aGlzLnBhdGhNYXAgPSB7CiAgICAgICdFVkVOVF9NRVNTQUdFJzogewogICAgICAgIGQ6ICdtIHtteH0se215fSBsIDAse2UueTF9IGwge2UueDF9LDAgbCAwLC17ZS55MX0geiBsIHtlLngwfSx7ZS55MH0gbCB7ZS54MH0sLXtlLnkwfScsCiAgICAgICAgaGVpZ2h0OiAzNiwKICAgICAgICB3aWR0aDogIDM2LAogICAgICAgIGhlaWdodEVsZW1lbnRzOiBbNiwgMTRdLAogICAgICAgIHdpZHRoRWxlbWVudHM6IFsxMC41LCAyMV0KICAgICAgfSwKICAgICAgJ0VWRU5UX1NJR05BTCc6IHsKICAgICAgICBkOiAnTSB7bXh9LHtteX0gbCB7ZS54MH0se2UueTB9IGwgLXtlLngxfSwwIFonLAogICAgICAgIGhlaWdodDogMzYsCiAgICAgICAgd2lkdGg6IDM2LAogICAgICAgIGhlaWdodEVsZW1lbnRzOiBbMThdLAogICAgICAgIHdpZHRoRWxlbWVudHM6IFsxMCwgMjBdCiAgICAgIH0sCiAgICAgICdFVkVOVF9FU0NBTEFUSU9OJzogewogICAgICAgIGQ6ICdNIHtteH0se215fSBsIHtlLngwfSx7ZS55MH0gbCAte2UueDB9LC17ZS55MX0gbCAte2UueDB9LHtlLnkxfSBaJywKICAgICAgICBoZWlnaHQ6IDM2LAogICAgICAgIHdpZHRoOiAzNiwKICAgICAgICBoZWlnaHRFbGVtZW50czogWzIwLCA3XSwKICAgICAgICB3aWR0aEVsZW1lbnRzOiBbOF0KICAgICAgfSwKICAgICAgJ0VWRU5UX0NPTkRJVElPTkFMJzogewogICAgICAgIGQ6ICdNIHtlLngwfSx7ZS55MH0gbCB7ZS54MX0sMCBsIDAse2UueTJ9IGwgLXtlLngxfSwwIFogJyArCiAgICAgICAgICAgJ00ge2UueDJ9LHtlLnkzfSBsIHtlLngwfSwwICcgKwogICAgICAgICAgICdNIHtlLngyfSx7ZS55NH0gbCB7ZS54MH0sMCAnICsKICAgICAgICAgICAnTSB7ZS54Mn0se2UueTV9IGwge2UueDB9LDAgJyArCiAgICAgICAgICAgJ00ge2UueDJ9LHtlLnk2fSBsIHtlLngwfSwwICcgKwogICAgICAgICAgICdNIHtlLngyfSx7ZS55N30gbCB7ZS54MH0sMCAnICsKICAgICAgICAgICAnTSB7ZS54Mn0se2UueTh9IGwge2UueDB9LDAgJywKICAgICAgICBoZWlnaHQ6IDM2LAogICAgICAgIHdpZHRoOiAgMzYsCiAgICAgICAgaGVpZ2h0RWxlbWVudHM6IFs4LjUsIDE0LjUsIDE4LCAxMS41LCAxNC41LCAxNy41LCAyMC41LCAyMy41LCAyNi41XSwKICAgICAgICB3aWR0aEVsZW1lbnRzOiAgWzEwLjUsIDE0LjUsIDEyLjVdCiAgICAgIH0sCiAgICAgICdFVkVOVF9MSU5LJzogewogICAgICAgIGQ6ICdtIHtteH0se215fSAwLHtlLnkwfSAte2UueDF9LDAgMCx7ZS55MX0ge2UueDF9LDAgMCx7ZS55MH0ge2UueDB9LC17ZS55Mn0gLXtlLngwfSwte2UueTJ9IHonLAogICAgICAgIGhlaWdodDogMzYsCiAgICAgICAgd2lkdGg6IDM2LAogICAgICAgIGhlaWdodEVsZW1lbnRzOiBbNC40Mzc1LCA2Ljc1LCA3LjgxMjVdLAogICAgICAgIHdpZHRoRWxlbWVudHM6IFs5Ljg0Mzc1LCAxMy41XQogICAgICB9LAogICAgICAnRVZFTlRfRVJST1InOiB7CiAgICAgICAgZDogJ20ge214fSx7bXl9IHtlLngwfSwte2UueTB9IHtlLngxfSwte2UueTF9IHtlLngyfSx7ZS55Mn0ge2UueDN9LC17ZS55M30gLXtlLng0fSx7ZS55NH0gLXtlLng1fSwte2UueTV9IHonLAogICAgICAgIGhlaWdodDogMzYsCiAgICAgICAgd2lkdGg6IDM2LAogICAgICAgIGhlaWdodEVsZW1lbnRzOiBbMC4wMjMsIDguNzM3LCA4LjE1MSwgMTYuNTY0LCAxMC41OTEsIDguNzE0XSwKICAgICAgICB3aWR0aEVsZW1lbnRzOiBbMC4wODUsIDYuNjcyLCA2Ljk3LCA0LjI3MywgNS4zMzcsIDYuNjM2XQogICAgICB9LAogICAgICAnRVZFTlRfQ0FOQ0VMXzQ1JzogewogICAgICAgIGQ6ICdtIHtteH0se215fSAte2UueDF9LDAgMCx7ZS54MH0ge2UueDF9LDAgMCx7ZS55MX0ge2UueDB9LDAgJyArCiAgICAgICAgICAnMCwte2UueTF9IHtlLngxfSwwIDAsLXtlLnkwfSAte2UueDF9LDAgMCwte2UueTF9IC17ZS54MH0sMCB6JywKICAgICAgICBoZWlnaHQ6IDM2LAogICAgICAgIHdpZHRoOiAzNiwKICAgICAgICBoZWlnaHRFbGVtZW50czogWzQuNzUsIDguNV0sCiAgICAgICAgd2lkdGhFbGVtZW50czogWzQuNzUsIDguNV0KICAgICAgfSwKICAgICAgJ0VWRU5UX0NPTVBFTlNBVElPTic6IHsKICAgICAgICBkOiAnbSB7bXh9LHtteX0ge2UueDB9LC17ZS55MH0gMCx7ZS55MX0geiBtIHtlLngxfSwte2UueTJ9IHtlLngyfSwte2UueTN9IDAse2UueTF9IC17ZS54Mn0sLXtlLnkzfSB6JywKICAgICAgICBoZWlnaHQ6IDM2LAogICAgICAgIHdpZHRoOiAzNiwKICAgICAgICBoZWlnaHRFbGVtZW50czogWzYuNSwgMTMsIDAuNCwgNi4xXSwKICAgICAgICB3aWR0aEVsZW1lbnRzOiBbOSwgOS4zLCA4LjddCiAgICAgIH0sCiAgICAgICdFVkVOVF9USU1FUl9XSCc6IHsKICAgICAgICBkOiAnTSB7bXh9LHtteX0gbCB7ZS54MH0sLXtlLnkwfSBtIC17ZS54MH0se2UueTB9IGwge2UueDF9LHtlLnkxfSAnLAogICAgICAgIGhlaWdodDogMzYsCiAgICAgICAgd2lkdGg6ICAzNiwKICAgICAgICBoZWlnaHRFbGVtZW50czogWzEwLCAyXSwKICAgICAgICB3aWR0aEVsZW1lbnRzOiBbMywgN10KICAgICAgfSwKICAgICAgJ0VWRU5UX1RJTUVSX0xJTkUnOiB7CiAgICAgICAgZDogICdNIHtteH0se215fSAnICsKICAgICAgICAgICAgJ20ge2UueDB9LHtlLnkwfSBsIC17ZS54MX0se2UueTF9ICcsCiAgICAgICAgaGVpZ2h0OiAzNiwKICAgICAgICB3aWR0aDogIDM2LAogICAgICAgIGhlaWdodEVsZW1lbnRzOiBbMTAsIDNdLAogICAgICAgIHdpZHRoRWxlbWVudHM6IFswLCAwXQogICAgICB9LAogICAgICAnRVZFTlRfTVVMVElQTEUnOiB7CiAgICAgICAgZDonbSB7bXh9LHtteX0ge2UueDF9LC17ZS55MH0ge2UueDF9LHtlLnkwfSAte2UueDB9LHtlLnkxfSAte2UueDJ9LDAgeicsCiAgICAgICAgaGVpZ2h0OiAzNiwKICAgICAgICB3aWR0aDogIDM2LAogICAgICAgIGhlaWdodEVsZW1lbnRzOiBbNi4yODA5OSwgMTIuNTYxOTldLAogICAgICAgIHdpZHRoRWxlbWVudHM6IFszLjE0MDUsIDkuNDIxNDksIDEyLjU2MTk4XQogICAgICB9LAogICAgICAnRVZFTlRfUEFSQUxMRUxfTVVMVElQTEUnOiB7CiAgICAgICAgZDonbSB7bXh9LHtteX0ge2UueDB9LDAgMCx7ZS55MX0ge2UueDF9LDAgMCx7ZS55MH0gLXtlLngxfSwwIDAse2UueTF9ICcgKwogICAgICAgICAgJy17ZS54MH0sMCAwLC17ZS55MX0gLXtlLngxfSwwIDAsLXtlLnkwfSB7ZS54MX0sMCB6JywKICAgICAgICBoZWlnaHQ6IDM2LAogICAgICAgIHdpZHRoOiAgMzYsCiAgICAgICAgaGVpZ2h0RWxlbWVudHM6IFsyLjU2MjI4LCA3LjY4NjgzXSwKICAgICAgICB3aWR0aEVsZW1lbnRzOiBbMi41NjIyOCwgNy42ODY4M10KICAgICAgfSwKICAgICAgJ0dBVEVXQVlfRVhDTFVTSVZFJzogewogICAgICAgIGQ6J20ge214fSx7bXl9IHtlLngwfSx7ZS55MH0ge2UueDF9LHtlLnkwfSB7ZS54Mn0sMCB7ZS54NH0se2UueTJ9ICcgKwogICAgICAgICAgICAgICAgICAgICAgJ3tlLng0fSx7ZS55MX0ge2UueDJ9LDAge2UueDF9LHtlLnkzfSB7ZS54MH0se2UueTN9ICcgKwogICAgICAgICAgICAgICAgICAgICAgJ3tlLngzfSwwIHtlLng1fSx7ZS55MX0ge2UueDV9LHtlLnkyfSB7ZS54M30sMCB6JywKICAgICAgICBoZWlnaHQ6IDE3LjUsCiAgICAgICAgd2lkdGg6ICAxNy41LAogICAgICAgIGhlaWdodEVsZW1lbnRzOiBbOC41LCA2LjUzMTIsIC02LjUzMTIsIC04LjVdLAogICAgICAgIHdpZHRoRWxlbWVudHM6ICBbNi41LCAtNi41LCAzLCAtMywgNSwgLTVdCiAgICAgIH0sCiAgICAgICdHQVRFV0FZX1BBUkFMTEVMJzogewogICAgICAgIGQ6J20ge214fSx7bXl9IDAse2UueTF9IC17ZS54MX0sMCAwLHtlLnkwfSB7ZS54MX0sMCAwLHtlLnkxfSB7ZS54MH0sMCAnICsKICAgICAgICAgICcwLC17ZS55MX0ge2UueDF9LDAgMCwte2UueTB9IC17ZS54MX0sMCAwLC17ZS55MX0gLXtlLngwfSwwIHonLAogICAgICAgIGhlaWdodDogMzAsCiAgICAgICAgd2lkdGg6ICAzMCwKICAgICAgICBoZWlnaHRFbGVtZW50czogWzUsIDEyLjVdLAogICAgICAgIHdpZHRoRWxlbWVudHM6IFs1LCAxMi41XQogICAgICB9LAogICAgICAnR0FURVdBWV9FVkVOVF9CQVNFRCc6IHsKICAgICAgICBkOidtIHtteH0se215fSB7ZS54MH0se2UueTB9IHtlLngwfSx7ZS55MX0ge2UueDF9LHtlLnkyfSB7ZS54Mn0sMCB6JywKICAgICAgICBoZWlnaHQ6IDExLAogICAgICAgIHdpZHRoOiAgMTEsCiAgICAgICAgaGVpZ2h0RWxlbWVudHM6IFstNiwgNiwgMTIsIC0xMl0sCiAgICAgICAgd2lkdGhFbGVtZW50czogWzksIC0zLCAtMTJdCiAgICAgIH0sCiAgICAgICdHQVRFV0FZX0NPTVBMRVgnOiB7CiAgICAgICAgZDonbSB7bXh9LHtteX0gMCx7ZS55MH0gLXtlLngwfSwte2UueTF9IC17ZS54MX0se2UueTJ9IHtlLngwfSx7ZS55MX0gLXtlLngyfSwwIDAse2UueTN9ICcgKwogICAgICAgICAgJ3tlLngyfSwwICAte2UueDB9LHtlLnkxfSBsIHtlLngxfSx7ZS55Mn0ge2UueDB9LC17ZS55MX0gMCx7ZS55MH0ge2UueDN9LDAgMCwte2UueTB9IHtlLngwfSx7ZS55MX0gJyArCiAgICAgICAgICAne2UueDF9LC17ZS55Mn0gLXtlLngwfSwte2UueTF9IHtlLngyfSwwIDAsLXtlLnkzfSAte2UueDJ9LDAge2UueDB9LC17ZS55MX0gLXtlLngxfSwte2UueTJ9ICcgKwogICAgICAgICAgJy17ZS54MH0se2UueTF9IDAsLXtlLnkwfSAte2UueDN9LDAgeicsCiAgICAgICAgaGVpZ2h0OiAxNy4xMjUsCiAgICAgICAgd2lkdGg6ICAxNy4xMjUsCiAgICAgICAgaGVpZ2h0RWxlbWVudHM6IFs0Ljg3NSwgMy40Mzc1LCAyLjEyNSwgM10sCiAgICAgICAgd2lkdGhFbGVtZW50czogWzMuNDM3NSwgMi4xMjUsIDQuODc1LCAzXQogICAgICB9LAogICAgICAnREFUQV9PQkpFQ1RfUEFUSCc6IHsKICAgICAgICBkOidtIDAsMCB7ZS54MX0sMCB7ZS54MH0se2UueTB9IDAse2UueTF9IC17ZS54Mn0sMCAwLC17ZS55Mn0ge2UueDF9LDAgMCx7ZS55MH0ge2UueDB9LDAnLAogICAgICAgIGhlaWdodDogNjEsCiAgICAgICAgd2lkdGg6ICA1MSwKICAgICAgICBoZWlnaHRFbGVtZW50czogWzEwLCA1MCwgNjBdLAogICAgICAgIHdpZHRoRWxlbWVudHM6IFsxMCwgNDAsIDUwLCA2MF0KICAgICAgfSwKICAgICAgJ0RBVEFfT0JKRUNUX0NPTExFQ1RJT05fUEFUSCc6IHsKICAgICAgICBkOidtIHtteH0sIHtteX0gJyArCiAgICAgICAgICAnbSAgMCAxNSAgbCAwIC0xNSAnICsKICAgICAgICAgICdtICA0IDE1ICBsIDAgLTE1ICcgKwogICAgICAgICAgJ20gIDQgMTUgIGwgMCAtMTUgJywKICAgICAgICBoZWlnaHQ6IDYxLAogICAgICAgIHdpZHRoOiAgNTEsCiAgICAgICAgaGVpZ2h0RWxlbWVudHM6IFsxMl0sCiAgICAgICAgd2lkdGhFbGVtZW50czogWzEsIDYsIDEyLCAxNV0KICAgICAgfSwKICAgICAgJ0RBVEFfQVJST1cnOiB7CiAgICAgICAgZDonbSA1LDkgOSwwIDAsLTMgNSw1IC01LDUgMCwtMyAtOSwwIHonLAogICAgICAgIGhlaWdodDogNjEsCiAgICAgICAgd2lkdGg6ICA1MSwKICAgICAgICBoZWlnaHRFbGVtZW50czogW10sCiAgICAgICAgd2lkdGhFbGVtZW50czogW10KICAgICAgfSwKICAgICAgJ0RBVEFfU1RPUkUnOiB7CiAgICAgICAgZDonbSAge214fSx7bXl9ICcgKwogICAgICAgICAgJ2wgIDAse2UueTJ9ICcgKwogICAgICAgICAgJ2MgIHtlLngwfSx7ZS55MX0ge2UueDF9LHtlLnkxfSAge2UueDJ9LDAgJyArCiAgICAgICAgICAnbCAgMCwte2UueTJ9ICcgKwogICAgICAgICAgJ2MgLXtlLngwfSwte2UueTF9IC17ZS54MX0sLXtlLnkxfSAte2UueDJ9LDAnICsKICAgICAgICAgICdjICB7ZS54MH0se2UueTF9IHtlLngxfSx7ZS55MX0gIHtlLngyfSwwICcgKwogICAgICAgICAgJ20gIC17ZS54Mn0se2UueTB9JyArCiAgICAgICAgICAnYyAge2UueDB9LHtlLnkxfSB7ZS54MX0se2UueTF9IHtlLngyfSwwJyArCiAgICAgICAgICAnbSAgLXtlLngyfSx7ZS55MH0nICsKICAgICAgICAgICdjICB7ZS54MH0se2UueTF9IHtlLngxfSx7ZS55MX0gIHtlLngyfSwwJywKICAgICAgICBoZWlnaHQ6IDYxLAogICAgICAgIHdpZHRoOiAgNjEsCiAgICAgICAgaGVpZ2h0RWxlbWVudHM6IFs3LCAxMCwgNDVdLAogICAgICAgIHdpZHRoRWxlbWVudHM6ICBbMiwgNTgsIDYwXQogICAgICB9LAogICAgICAnVEVYVF9BTk5PVEFUSU9OJzogewogICAgICAgIGQ6ICdtIHtteH0sIHtteX0gbSAxMCwwIGwgLTEwLDAgbCAwLHtlLnkwfSBsIDEwLDAnLAogICAgICAgIGhlaWdodDogMzAsCiAgICAgICAgd2lkdGg6IDEwLAogICAgICAgIGhlaWdodEVsZW1lbnRzOiBbMzBdLAogICAgICAgIHdpZHRoRWxlbWVudHM6IFsxMF0KICAgICAgfSwKICAgICAgJ01BUktFUl9TVUJfUFJPQ0VTUyc6IHsKICAgICAgICBkOiAnbXtteH0se215fSBtIDcsMiBsIDAsMTAgbSAtNSwtNSBsIDEwLDAnLAogICAgICAgIGhlaWdodDogMTAsCiAgICAgICAgd2lkdGg6IDEwLAogICAgICAgIGhlaWdodEVsZW1lbnRzOiBbXSwKICAgICAgICB3aWR0aEVsZW1lbnRzOiBbXQogICAgICB9LAogICAgICAnTUFSS0VSX1BBUkFMTEVMJzogewogICAgICAgIGQ6ICdte214fSx7bXl9IG0gMywyIGwgMCwxMCBtIDMsLTEwIGwgMCwxMCBtIDMsLTEwIGwgMCwxMCcsCiAgICAgICAgaGVpZ2h0OiAxMCwKICAgICAgICB3aWR0aDogMTAsCiAgICAgICAgaGVpZ2h0RWxlbWVudHM6IFtdLAogICAgICAgIHdpZHRoRWxlbWVudHM6IFtdCiAgICAgIH0sCiAgICAgICdNQVJLRVJfU0VRVUVOVElBTCc6IHsKICAgICAgICBkOiAnbXtteH0se215fSBtIDAsMyBsIDEwLDAgbSAtMTAsMyBsIDEwLDAgbSAtMTAsMyBsIDEwLDAnLAogICAgICAgIGhlaWdodDogMTAsCiAgICAgICAgd2lkdGg6IDEwLAogICAgICAgIGhlaWdodEVsZW1lbnRzOiBbXSwKICAgICAgICB3aWR0aEVsZW1lbnRzOiBbXQogICAgICB9LAogICAgICAnTUFSS0VSX0NPTVBFTlNBVElPTic6IHsKICAgICAgICBkOiAnbSB7bXh9LHtteX0gNywtNSAwLDEwIHogbSA3LjEsLTAuMyA2LjksLTQuNyAwLDEwIC02LjksLTQuNyB6JywKICAgICAgICBoZWlnaHQ6IDEwLAogICAgICAgIHdpZHRoOiAyMSwKICAgICAgICBoZWlnaHRFbGVtZW50czogW10sCiAgICAgICAgd2lkdGhFbGVtZW50czogW10KICAgICAgfSwKICAgICAgJ01BUktFUl9MT09QJzogewogICAgICAgIGQ6ICdtIHtteH0se215fSBjIDMuNTI2OTc5LDAgNi4zODYxNjEsLTIuODI5ODU4IDYuMzg2MTYxLC02LjMyMDY2MSAwLC0zLjQ5MDgwNiAtMi44NTkxODIsLTYuMzIwNjYxICcgKwogICAgICAgICAgJy02LjM4NjE2MSwtNi4zMjA2NjEgLTMuNTI2OTc4LDAgLTYuMzg2MTYsMi44Mjk4NTUgLTYuMzg2MTYsNi4zMjA2NjEgMCwxLjc0NTQwMiAnICsKICAgICAgICAgICcwLjcxNDc5NywzLjMyNTU2NyAxLjg3MDQ2Myw0LjQ2OTM4MSAwLjU3NzgzNCwwLjU3MTkwOCAxLjI2NTg4NSwxLjAzNDcyOCAyLjAyOTkxNiwxLjM1NDU3ICcgKwogICAgICAgICAgJ2wgLTAuNzE4MTYzLC0zLjkwOTc5MyBtIDAuNzE4MTYzLDMuOTA5NzkzIC0zLjg4NTIxMSwwLjgwMjkwMicsCiAgICAgICAgaGVpZ2h0OiAxMy45LAogICAgICAgIHdpZHRoOiAxMy43LAogICAgICAgIGhlaWdodEVsZW1lbnRzOiBbXSwKICAgICAgICB3aWR0aEVsZW1lbnRzOiBbXQogICAgICB9LAogICAgICAnTUFSS0VSX0FESE9DJzogewogICAgICAgIGQ6ICdtIHtteH0se215fSBtIDAuODQ0NjEsMi42NDQxMSBjIDEuMDU1MzMsLTEuMjM3ODA5OTYgMi42NDMzNywtMi4wNzg4MiA0LjI5NjUzLC0xLjk3OTk3OTk2IDIuMDUxNjMsMC4wODA1ICcgKwogICAgICAgICAgJzMuODU1NzksMS4xNTgwMyA1Ljc2MDgyLDEuNzkxMDcgMS4wNjM4NSwwLjM0MTM5OTk2IDIuMjQ0NTQsMC4xNDM4IDMuMTg3NTksLTAuNDM3NjcgMC42MTc0MywtMC4zMzY0MiAnICsKICAgICAgICAgICcxLjI3NzUsLTAuNjQwNzggMS43NTQyLC0xLjE3NTExIDAsMC41NjAyMyAwLDEuMTIwNDYgMCwxLjY4MDcgLTAuOTg3MDYsMC45NjIzNzk5NiAtMi4yOTc5MiwxLjYyMzkzOTk2ICcgKwogICAgICAgICAgJy0zLjY5MTgsMS42NjE4MTk5NiAtMS4yNDQ1OSwwLjA5MjcgLTIuNDY2NzEsLTAuMjQ5MSAtMy41OTUwNSwtMC43NDgxMiAtMS4zNTc4OSwtMC41NTk2NSAnICsKICAgICAgICAgICctMi43NTEzMywtMS4zMzQzNjk5NiAtNC4yNzAyNywtMS4xODEyMTk5NiAtMS4zNzc0MSwwLjE0NjAxIC0yLjQxODQyLDEuMTM2ODU5OTYgLTMuNDQyODgsMS45Njc4Mjk5NiB6JywKICAgICAgICBoZWlnaHQ6IDQsCiAgICAgICAgd2lkdGg6IDE1LAogICAgICAgIGhlaWdodEVsZW1lbnRzOiBbXSwKICAgICAgICB3aWR0aEVsZW1lbnRzOiBbXQogICAgICB9LAogICAgICAnVEFTS19UWVBFX1NFTkQnOiB7CiAgICAgICAgZDogJ20ge214fSx7bXl9IGwgMCx7ZS55MX0gbCB7ZS54MX0sMCBsIDAsLXtlLnkxfSB6IGwge2UueDB9LHtlLnkwfSBsIHtlLngwfSwte2UueTB9JywKICAgICAgICBoZWlnaHQ6IDE0LAogICAgICAgIHdpZHRoOiAgMjEsCiAgICAgICAgaGVpZ2h0RWxlbWVudHM6IFs2LCAxNF0sCiAgICAgICAgd2lkdGhFbGVtZW50czogWzEwLjUsIDIxXQogICAgICB9LAogICAgICAnVEFTS19UWVBFX1NDUklQVCc6IHsKICAgICAgICBkOiAnbSB7bXh9LHtteX0gYyA5Ljk2NjU1MywtNi4yNzI3NiAtOC4wMDA5MjYsLTcuOTE5MzIgMi45Njg5NjgsLTE0LjkzOCBsIC04LjgwMjcyOCwwICcgKwogICAgICAgICAgJ2MgLTEwLjk2OTg5NCw3LjAxODY4IDYuOTk3NTg1LDguNjY1MjQgLTIuOTY4OTY3LDE0LjkzOCB6ICcgKwogICAgICAgICAgJ20gLTcsLTEyIGwgNSwwICcgKwogICAgICAgICAgJ20gLTQuNSwzIGwgNC41LDAgJyArCiAgICAgICAgICAnbSAtMywzIGwgNSwwJyArCiAgICAgICAgICAnbSAtNCwzIGwgNSwwJywKICAgICAgICBoZWlnaHQ6IDE1LAogICAgICAgIHdpZHRoOiAgMTIuNiwKICAgICAgICBoZWlnaHRFbGVtZW50czogWzYsIDE0XSwKICAgICAgICB3aWR0aEVsZW1lbnRzOiBbMTAuNSwgMjFdCiAgICAgIH0sCiAgICAgICdUQVNLX1RZUEVfVVNFUl8xJzogewogICAgICAgIGQ6ICdtIHtteH0se215fSBjIDAuOTA5LC0wLjg0NSAxLjU5NCwtMi4wNDkgMS41OTQsLTMuMzg1IDAsLTIuNTU0IC0xLjgwNSwtNC42MjE5OTk5OSAnICsKICAgICAgICAgICctNC4zNTcsLTQuNjIxOTk5OTkgLTIuNTUxOTk5OTgsMCAtNC4yODc5OTk5OCwyLjA2Nzk5OTk5IC00LjI4Nzk5OTk4LDQuNjIxOTk5OTkgMCwxLjM0OCAnICsKICAgICAgICAgICcwLjk3NCwyLjU2MiAxLjg5NTk5OTk4LDMuNDA1IC0wLjUyODk5OTk4LDAuMTg3IC01LjY2OSwyLjA5NyAtNS43OTQsNC43NTYwMDA1IHYgNi43MTggJyArCiAgICAgICAgICAnaCAxNyB2IC02LjcxOCBjIDAsLTIuMjk4MDAwNSAtNS41Mjc5OTk2LC00LjU5NTAwMDUgLTYuMDUwOTk5NiwtNC43NzYwMDA1IHonICsKICAgICAgICAgICdtIC04LDYgbCAwLDUuNSBtIDExLDAgbCAwLC01JwogICAgICB9LAogICAgICAnVEFTS19UWVBFX1VTRVJfMic6IHsKICAgICAgICBkOiAnbSB7bXh9LHtteX0gbSAyLjE2MiwxLjAwOSBjIDAsMi40NDcwMDA1IC0yLjE1OCw0LjQzMTAwMDUgLTQuODIxLDQuNDMxMDAwNSAnICsKICAgICAgICAgICctMi42NjQ5OTk5OCwwIC00LjgyMiwtMS45ODEgLTQuODIyLC00LjQzMTAwMDUgJwogICAgICB9LAogICAgICAnVEFTS19UWVBFX1VTRVJfMyc6IHsKICAgICAgICBkOiAnbSB7bXh9LHtteX0gbSAtNi45LC0zLjgwIGMgMCwwIDIuMjUwOTk5OTgsLTIuMzU4IDQuMjczOTk5OTgsLTEuMTc3IDIuMDI0LDEuMTgxIDQuMjIxLDEuNTM3ICcgKwogICAgICAgICAgJzQuMTI0LDAuOTY1IC0wLjA5OCwtMC41NyAtMC4xMTcsLTMuNzkwOTk5OTkgLTQuMTkxLC00LjEzNTk5OTk5IC0zLjU3NDk5OTk4LDAuMDAxICcgKwogICAgICAgICAgJy00LjIwNzk5OTk4LDMuMzY2OTk5OTkgLTQuMjA2OTk5OTgsNC4zNDc5OTk5OSB6JwogICAgICB9LAogICAgICAnVEFTS19UWVBFX01BTlVBTCc6IHsKICAgICAgICBkOiAnbSB7bXh9LHtteX0gYyAwLjIzNCwtMC4wMSA1LjYwNCwwLjAwOCA4LjAyOSwwLjAwNCAwLjgwOCwwIDEuMjcxLC0wLjE3MiAxLjQxNywtMC43NTIgMC4yMjcsLTAuODk4ICcgKwogICAgICAgICAgJy0wLjMzNCwtMS4zMTQgLTEuMzM4LC0xLjMxNiAtMi40NjcsLTAuMDEgLTcuODg2LC0wLjAwNCAtOC4xMDgsLTAuMDA0IC0wLjAxNCwtMC4wNzkgMC4wMTYsLTAuNTMzIDAsLTAuNjEgJyArCiAgICAgICAgICAnMC4xOTUsLTAuMDQyIDguNTA3LDAuMDA2IDkuNjE2LDAuMDAyIDAuODc3LC0wLjAwNyAxLjM1LC0wLjQzOCAxLjM1MywtMS4yMDggMC4wMDMsLTAuNzY4IC0wLjQ3OSwtMS4wOSAnICsKICAgICAgICAgICctMS4zNSwtMS4wOTEgLTIuOTY4LC0wLjAwMiAtOS42MTksLTAuMDEzIC05LjYxOSwtMC4wMTMgdiAtMC41OTEgYyAwLDAgNS4wNTIsLTAuMDE2IDcuMjI1LC0wLjAxNiAnICsKICAgICAgICAgICcwLjg4OCwtMC4wMDIgMS4zNTQsLTAuNDE2IDEuMzUxLC0xLjE5MyAtMC4wMDYsLTAuNzYxIC0wLjQ5MiwtMS4xOTYgLTEuMzYxLC0xLjE5NiAtMy40NzMsLTAuMDA1ICcgKwogICAgICAgICAgJy0xMC44NiwtMC4wMDMgLTExLjA4Mjk5OTUsLTAuMDAzIC0wLjAyMiwtMC4wNDcgLTAuMDQ1LC0wLjA5NCAtMC4wNjksLTAuMTM5IDAuMzkzOTk5NSwtMC4zMTkgJyArCiAgICAgICAgICAnMi4wNDA5OTk1LC0xLjYyNiAyLjQxNDk5OTUsLTIuMDE3IDAuNDY5LC0wLjQ4NzAwMDUgMC41MTksLTEuMTY1MDAwNSAwLjE2MiwtMS42MDQwMDA1IC0wLjQxNCwtMC41MTEgJyArCiAgICAgICAgICAnLTAuOTczLC0wLjUgLTEuNDgsLTAuMjM2IC0xLjQ2MDk5OTUsMC43NjQgLTYuNTk5OTk5NSwzLjY0MzAwMDUgLTcuNzMyOTk5NSw0LjI3MTAwMDUgLTAuOSwwLjQ5OSAnICsKICAgICAgICAgICctMS41MTYsMS4yNTMgLTEuODgyLDIuMTkgLTAuMzcwMDAwMDIsMC45NSAtMC4xNywyLjAxIC0wLjE2NiwyLjk3OSAwLjAwNCwwLjcxOCAtMC4yNzMwMDAwMiwxLjM0NSAnICsKICAgICAgICAgICctMC4wNTUsMi4wNjMgMC42MjksMi4wODcgMi40MjUsMy4zMTIgNC44NTksMy4zMTggNC42MTc5OTk1LDAuMDE0IDkuMjM3OTk5NSwtMC4xMzkgMTMuODU2OTk5NSwtMC4xNTggJyArCiAgICAgICAgICAnMC43NTUsLTAuMDA0IDEuMTcxLC0wLjMwMSAxLjE4MiwtMS4wMzMgMC4wMTIsLTAuNzU0IC0wLjQyMywtMC45NjkgLTEuMTgzLC0wLjk3MyAtMS43NzgsLTAuMDEgJyArCiAgICAgICAgICAnLTUuODI0LC0wLjAwNCAtNi4wNCwtMC4wMDQgMTBlLTQsLTAuMDg0IDAuMDAzLC0wLjU4NiAxMGUtNCwtMC42NyB6JwogICAgICB9LAogICAgICAnVEFTS19UWVBFX0lOU1RBTlRJQVRJTkdfU0VORCc6IHsKICAgICAgICBkOiAnbSB7bXh9LHtteX0gbCAwLDguNCBsIDEyLjYsMCBsIDAsLTguNCB6IGwgNi4zLDMuNiBsIDYuMywtMy42JwogICAgICB9LAogICAgICAnVEFTS19UWVBFX1NFUlZJQ0UnOiB7CiAgICAgICAgZDogJ20ge214fSx7bXl9IHYgLTEuNzEzMzUgYyAwLjM1MjMyNiwtMC4wNzA1IDAuNzAzOTMyLC0wLjE3ODM4IDEuMDQ3NjI4LC0wLjMyMTMzICcgKwogICAgICAgICAgJzAuMzQ0NDE2LC0wLjE0NDY1IDAuNjY1ODIyLC0wLjMyMTMzIDAuOTY2Mzc3LC0wLjUyMTQ1IGwgMS4xOTQzMSwxLjE4MDA1IDEuNTY3NDg3LC0xLjU3Njg4ICcgKwogICAgICAgICAgJy0xLjE5NTAyOCwtMS4xODAxNCBjIDAuNDAzMzc2LC0wLjYxMzk0IDAuNjgzMDc5LC0xLjI5OTA4IDAuODI1NDQ3LC0yLjAxODI0IGwgMS42MjIxMzMsLTAuMDEgJyArCiAgICAgICAgICAndiAtMi4yMTk2IGwgLTEuNjM2NTE0LDAuMDEgYyAtMC4wNzMzMywtMC4zNTE1MyAtMC4xNzgzMTksLTAuNzAwMjQgLTAuMzIzNTY0LC0xLjA0MzcyICcgKwogICAgICAgICAgJy0wLjE0NTI0NCwtMC4zNDQwNiAtMC4zMjE0MDcsLTAuNjY0NCAtMC41MjI3MzUsLTAuOTYyMTcgbCAxLjEzMTAzNSwtMS4xMzYzMSAtMS41ODMzMDUsLTEuNTYyOTMgJyArCiAgICAgICAgICAnLTEuMTI5NTk4LDEuMTM1ODkgYyAtMC42MTQwNTIsLTAuNDAxMDggLTEuMzAyODgzLC0wLjY4MDkzIC0yLjAyMjYzMywtMC44MjI0NyBsIDAuMDA5MywtMS42MTg1MiAnICsKICAgICAgICAgICdoIC0yLjI0MTE3MyBsIDAuMDA0MiwxLjYzMTI0IGMgLTAuMzUzNzYzLDAuMDczNiAtMC43MDUzNjksMC4xNzk3NyAtMS4wNDk3ODUsMC4zMjM3MSAtMC4zNDQ0MTUsMC4xNDQzNyAnICsKICAgICAgICAgICctMC42NjUxMDIsMC4zMjA5MiAtMC45NjM1MDA2LDAuNTIwNDYgbCAtMS4xNjk4NjI4LC0xLjE1ODIzIC0xLjU2Njc2OTEsMS41NzkyIDEuMTY4NDI2NSwxLjE1NjY5ICcgKwogICAgICAgICAgJ2MgLTAuNDAyNjU3MywwLjYxMjgzIC0wLjY4MzA4LDEuMjk3OTcgLTAuODI0NzI4NywyLjAxNzEzIGwgLTEuNjU4ODA0MSwwLjAwMyB2IDIuMjIxNzQgJyArCiAgICAgICAgICAnbCAxLjY3MjQ2NDgsLTAuMDA2IGMgMC4wNzMzMjcsMC4zNTA3NyAwLjE3OTc1OTgsMC43MDI0MyAwLjMyNDI4NTEsMS4wNDQ3MiAwLjE0NTI0MjgsMC4zNDQ0OCAnICsKICAgICAgICAgICcwLjMyMTQwNjQsMC42NjQ0IDAuNTIyNzMzOSwwLjk2MDY2IGwgLTEuMTk5MzQzMSwxLjE5NzIzIDEuNTg0MDI1NiwxLjU2MDExIDEuMTk2NDY2OCwtMS4xOTM0OCAnICsKICAgICAgICAgICdjIDAuNjE0MDUxNywwLjQwMzQ2IDEuMzAyODgyNywwLjY4MjMyIDIuMDIzMzUxNywwLjgyMzMxIGwgNy4xOWUtNCwxLjY5ODkyIGggMi4yMjY4NDggeiAnICsKICAgICAgICAgICdtIDAuMjIxNDYyLC0zLjk5NTcgYyAtMS43ODg5NDgsMC43NTAyIC0zLjg1NzYsLTAuMDkyOCAtNC42MDk3MDU1LC0xLjg3NDM4IC0wLjc1MjEwNjUsLTEuNzgzMjEgJyArCiAgICAgICAgICAnMC4wOTA1OTgsLTMuODQ2MjcgMS44ODAyNjQ1LC00LjU5NjA0IDEuNzg4MjMsLTAuNzQ5MzYgMy44NTY4ODEsMC4wOTI5IDQuNjA4OTg3LDEuODc0MzcgJyArCiAgICAgICAgICAnMC43NTIxMDYsMS43ODE2NSAtMC4wOTA2LDMuODQ2MTIgLTEuODc5NTQ2LDQuNTk2MDUgeicKICAgICAgfSwKICAgICAgJ1RBU0tfVFlQRV9TRVJWSUNFX0ZJTEwnOiB7CiAgICAgICAgZDogJ20ge214fSx7bXl9IGMgLTEuNzg4OTQ4LDAuNzUwMiAtMy44NTc2LC0wLjA5MjggLTQuNjA5NzA1NSwtMS44NzQzOCAtMC43NTIxMDY1LC0xLjc4MzIxICcgKwogICAgICAgICAgJzAuMDkwNTk4LC0zLjg0NjI3IDEuODgwMjY0NSwtNC41OTYwNCAxLjc4ODIzLC0wLjc0OTM2IDMuODU2ODgxLDAuMDkyOSA0LjYwODk4NywxLjg3NDM3ICcgKwogICAgICAgICAgJzAuNzUyMTA2LDEuNzgxNjUgLTAuMDkwNiwzLjg0NjEyIC0xLjg3OTU0Niw0LjU5NjA1IHonCiAgICAgIH0sCiAgICAgICdUQVNLX1RZUEVfQlVTSU5FU1NfUlVMRV9IRUFERVInOiB7CiAgICAgICAgZDogJ20ge214fSx7bXl9IDAsNCAyMCwwIDAsLTQgeicKICAgICAgfSwKICAgICAgJ1RBU0tfVFlQRV9CVVNJTkVTU19SVUxFX01BSU4nOiB7CiAgICAgICAgZDogJ20ge214fSx7bXl9IDAsMTIgMjAsMCAwLC0xMiB6JyArCiAgICAgICAgICAnbSAwLDggbCAyMCwwICcgKwogICAgICAgICAgJ20gLTEzLC00IGwgMCw4JwogICAgICB9LAogICAgICAnTUVTU0FHRV9GTE9XX01BUktFUic6IHsKICAgICAgICBkOiAnbSB7bXh9LHtteX0gbSAtMTAuNSAsLTcgbCAwLDE0IGwgMjEsMCBsIDAsLTE0IHogbCAxMC41LDYgbCAxMC41LC02JwogICAgICB9CiAgICB9OwoKICAgIHRoaXMuZ2V0UmF3UGF0aCA9IGZ1bmN0aW9uIGdldFJhd1BhdGgocGF0aElkKSB7CiAgICAgIHJldHVybiB0aGlzLnBhdGhNYXBbcGF0aElkXS5kOwogICAgfTsKCiAgICAvKioKICAgICAqIFNjYWxlcyB0aGUgcGF0aCB0byB0aGUgZ2l2ZW4gaGVpZ2h0IGFuZCB3aWR0aC4KICAgICAqIDxoMT5Vc2UgY2FzZTwvaDE+CiAgICAgKiA8cD5Vc2UgY2FzZSBpcyB0byBzY2FsZSB0aGUgY29udGVudCBvZiBlbGVtZW50cyAoZXZlbnQsIGdhdGV3YXlzKSBiYXNlZAogICAgICogb24gdGhlIGVsZW1lbnQgYm91bmRpbmcgYm94J3Mgc2l6ZS4KICAgICAqIDwvcD4KICAgICAqIDxoMT5XaHkgbm90IHRyYW5zZm9ybTwvaDE+CiAgICAgKiA8cD5TY2FsaW5nIGEgcGF0aCB3aXRoIHRyYW5zZm9ybSgpIHdpbGwgYWxzbyBzY2FsZSB0aGUgc3Ryb2tlIGFuZCBJRSBkb2VzIG5vdCBzdXBwb3J0CiAgICAgKiB0aGUgb3B0aW9uICdub24tc2NhbGluZy1zdHJva2UnIHRvIHByZXZlbnQgdGhpcy4KICAgICAqIEFsc28gdGhlcmUgYXJlIHVzZSBjYXNlcyB3aGVyZSBvbmx5IHNvbWUgcGFydHMgb2YgYSBwYXRoIHNob3VsZCBiZQogICAgICogc2NhbGVkLjwvcD4KICAgICAqCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gcGF0aElkIFRoZSBJRCBvZiB0aGUgcGF0aC4KICAgICAqIEBwYXJhbSB7T2JqZWN0fSBwYXJhbSA8cD4KICAgICAqICAgRXhhbXBsZSBwYXJhbSBvYmplY3Qgc2NhbGVzIHRoZSBwYXRoIHRvIDYwJSBzaXplIG9mIHRoZSBjb250YWluZXIgKGRhdGEud2lkdGgsIGRhdGEuaGVpZ2h0KS4KICAgICAqICAgPHByZT4KICAgICAqICAgewogICAgICogICAgIHhTY2FsZUZhY3RvcjogMC42LAogICAgICogICAgIHlTY2FsZUZhY3RvcjowLjYsCiAgICAgKiAgICAgY29udGFpbmVyV2lkdGg6IGRhdGEud2lkdGgsCiAgICAgKiAgICAgY29udGFpbmVySGVpZ2h0OiBkYXRhLmhlaWdodCwKICAgICAqICAgICBwb3NpdGlvbjogewogICAgICogICAgICAgbXg6IDAuNDYsCiAgICAgKiAgICAgICBteTogMC4yLAogICAgICogICAgIH0KICAgICAqICAgfQogICAgICogICA8L3ByZT4KICAgICAqICAgPHVsPgogICAgICogICAgPGxpPnRhcmdldHBhdGh3aWR0aCA9IHhTY2FsZUZhY3RvciAqIGNvbnRhaW5lcldpZHRoPC9saT4KICAgICAqICAgIDxsaT50YXJnZXRwYXRoaGVpZ2h0ID0geVNjYWxlRmFjdG9yICogY29udGFpbmVySGVpZ2h0PC9saT4KICAgICAqICAgIDxsaT5Qb3NpdGlvbiBpcyB1c2VkIHRvIHNldCB0aGUgc3RhcnRpbmcgY29vcmRpbmF0ZSBvZiB0aGUgcGF0aC4gTSBpcyBjb21wdXRlZDoKICAgICAgKiAgICA8dWw+CiAgICAgICogICAgICA8bGk+cG9zaXRpb24ueCAqIGNvbnRhaW5lcldpZHRoPC9saT4KICAgICAgKiAgICAgIDxsaT5wb3NpdGlvbi55ICogY29udGFpbmVySGVpZ2h0PC9saT4KICAgICAgKiAgICA8L3VsPgogICAgICAqICAgIENlbnRlciBvZiB0aGUgY29udGFpbmVyIDxwcmU+IHBvc2l0aW9uOiB7CiAgICAgKiAgICAgICBteDogMC41LAogICAgICogICAgICAgbXk6IDAuNSwKICAgICAqICAgICB9PC9wcmU+CiAgICAgKiAgICAgVXBwZXIgbGVmdCBjb3JuZXIgb2YgdGhlIGNvbnRhaW5lcgogICAgICogICAgIDxwcmU+IHBvc2l0aW9uOiB7CiAgICAgKiAgICAgICBteDogMC4wLAogICAgICogICAgICAgbXk6IDAuMCwKICAgICAqICAgICB9PC9wcmU+CiAgICAgKiAgICA8L2xpPgogICAgICogICA8L3VsPgogICAgICogPC9wPgogICAgICoKICAgICAqLwogICAgdGhpcy5nZXRTY2FsZWRQYXRoID0gZnVuY3Rpb24gZ2V0U2NhbGVkUGF0aChwYXRoSWQsIHBhcmFtKSB7CiAgICAgIHZhciByYXdQYXRoID0gdGhpcy5wYXRoTWFwW3BhdGhJZF07CgogICAgICAvLyBwb3NpdGlvbmluZwogICAgICAvLyBjb21wdXRlIHRoZSBzdGFydCBwb2ludCBvZiB0aGUgcGF0aAogICAgICB2YXIgbXgsIG15OwoKICAgICAgaWYgKHBhcmFtLmFic3BvcykgewogICAgICAgIG14ID0gcGFyYW0uYWJzcG9zLng7CiAgICAgICAgbXkgPSBwYXJhbS5hYnNwb3MueTsKICAgICAgfSBlbHNlIHsKICAgICAgICBteCA9IHBhcmFtLmNvbnRhaW5lcldpZHRoICogcGFyYW0ucG9zaXRpb24ubXg7CiAgICAgICAgbXkgPSBwYXJhbS5jb250YWluZXJIZWlnaHQgKiBwYXJhbS5wb3NpdGlvbi5teTsKICAgICAgfQoKICAgICAgdmFyIGNvb3JkaW5hdGVzID0ge307IC8vIG1hcCBmb3IgdGhlIHNjYWxlZCBjb29yZGluYXRlcwogICAgICBpZiAocGFyYW0ucG9zaXRpb24pIHsKCiAgICAgICAgLy8gcGF0aAogICAgICAgIHZhciBoZWlnaHRSYXRpbyA9IChwYXJhbS5jb250YWluZXJIZWlnaHQgLyByYXdQYXRoLmhlaWdodCkgKiBwYXJhbS55U2NhbGVGYWN0b3I7CiAgICAgICAgdmFyIHdpZHRoUmF0aW8gPSAocGFyYW0uY29udGFpbmVyV2lkdGggLyByYXdQYXRoLndpZHRoKSAqIHBhcmFtLnhTY2FsZUZhY3RvcjsKCgogICAgICAgIC8vIEFwcGx5IGhlaWdodCByYXRpbwogICAgICAgIGZvciAodmFyIGhlaWdodEluZGV4ID0gMDsgaGVpZ2h0SW5kZXggPCByYXdQYXRoLmhlaWdodEVsZW1lbnRzLmxlbmd0aDsgaGVpZ2h0SW5kZXgrKykgewogICAgICAgICAgY29vcmRpbmF0ZXNbJ3knICsgaGVpZ2h0SW5kZXhdID0gcmF3UGF0aC5oZWlnaHRFbGVtZW50c1toZWlnaHRJbmRleF0gKiBoZWlnaHRSYXRpbzsKICAgICAgICB9CgogICAgICAgIC8vIEFwcGx5IHdpZHRoIHJhdGlvCiAgICAgICAgZm9yICh2YXIgd2lkdGhJbmRleCA9IDA7IHdpZHRoSW5kZXggPCByYXdQYXRoLndpZHRoRWxlbWVudHMubGVuZ3RoOyB3aWR0aEluZGV4KyspIHsKICAgICAgICAgIGNvb3JkaW5hdGVzWyd4JyArIHdpZHRoSW5kZXhdID0gcmF3UGF0aC53aWR0aEVsZW1lbnRzW3dpZHRoSW5kZXhdICogd2lkdGhSYXRpbzsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIC8vIEFwcGx5IHZhbHVlIHRvIHJhdyBwYXRoCiAgICAgIHZhciBwYXRoID0gZm9ybWF0KAogICAgICAgIHJhd1BhdGguZCwgewogICAgICAgICAgbXg6IG14LAogICAgICAgICAgbXk6IG15LAogICAgICAgICAgZTogY29vcmRpbmF0ZXMKICAgICAgICB9CiAgICAgICk7CiAgICAgIHJldHVybiBwYXRoOwogICAgfTsKICB9CgogIC8vIGhlbHBlcnMgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAvLyBjb3BpZWQgZnJvbSBodHRwczovL2dpdGh1Yi5jb20vYWRvYmUtd2VicGxhdGZvcm0vU25hcC5zdmcvYmxvYi9tYXN0ZXIvc3JjL3N2Zy5qcwogIHZhciB0b2tlblJlZ2V4ID0gL1x7KFtefV0rKVx9L2csCiAgICAgIG9iak5vdGF0aW9uUmVnZXggPSAvKD86KD86XnxcLikoLis/KSg/PVxbfFwufCR8XCgpfFxbKCd8IikoLis/KVwyXF0pKFwoXCkpPy9nOyAvLyBtYXRjaGVzIC54eHh4eCBvciBbInh4eHh4Il0gdG8gcnVuIG92ZXIgb2JqZWN0IHByb3BlcnRpZXMKCiAgZnVuY3Rpb24gcmVwbGFjZXIoYWxsLCBrZXksIG9iaikgewogICAgdmFyIHJlcyA9IG9iajsKICAgIGtleS5yZXBsYWNlKG9iak5vdGF0aW9uUmVnZXgsIGZ1bmN0aW9uKGFsbCwgbmFtZSwgcXVvdGUsIHF1b3RlZE5hbWUsIGlzRnVuYykgewogICAgICBuYW1lID0gbmFtZSB8fCBxdW90ZWROYW1lOwogICAgICBpZiAocmVzKSB7CiAgICAgICAgaWYgKG5hbWUgaW4gcmVzKSB7CiAgICAgICAgICByZXMgPSByZXNbbmFtZV07CiAgICAgICAgfQogICAgICAgIHR5cGVvZiByZXMgPT0gJ2Z1bmN0aW9uJyAmJiBpc0Z1bmMgJiYgKHJlcyA9IHJlcygpKTsKICAgICAgfQogICAgfSk7CiAgICByZXMgPSAocmVzID09IG51bGwgfHwgcmVzID09IG9iaiA/IGFsbCA6IHJlcykgKyAnJzsKCiAgICByZXR1cm4gcmVzOwogIH0KCiAgZnVuY3Rpb24gZm9ybWF0KHN0ciwgb2JqKSB7CiAgICByZXR1cm4gU3RyaW5nKHN0cikucmVwbGFjZSh0b2tlblJlZ2V4LCBmdW5jdGlvbihhbGwsIGtleSkgewogICAgICByZXR1cm4gcmVwbGFjZXIoYWxsLCBrZXksIG9iaik7CiAgICB9KTsKICB9CgogIHZhciBEcmF3TW9kdWxlJDEgPSB7CiAgICBfX2luaXRfXzogWyAnYnBtblJlbmRlcmVyJyBdLAogICAgYnBtblJlbmRlcmVyOiBbICd0eXBlJywgQnBtblJlbmRlcmVyIF0sCiAgICB0ZXh0UmVuZGVyZXI6IFsgJ3R5cGUnLCBUZXh0UmVuZGVyZXIgXSwKICAgIHBhdGhNYXA6IFsgJ3R5cGUnLCBQYXRoTWFwIF0KICB9OwoKICAvKioKICAgKiBBIHNpbXBsZSB0cmFuc2xhdGlvbiBzdHViIHRvIGJlIHVzZWQgZm9yIG11bHRpLWxhbmd1YWdlIHN1cHBvcnQKICAgKiBpbiBkaWFncmFtcy4gQ2FuIGJlIGVhc2lseSByZXBsYWNlZCB3aXRoIGEgbW9yZSBzb3BoaXN0aWNhdGVkCiAgICogc29sdXRpb24uCiAgICoKICAgKiBAZXhhbXBsZQogICAqCiAgICogLy8gdXNlIGl0IGluc2lkZSBhbnkgZGlhZ3JhbSBjb21wb25lbnQgYnkgaW5qZWN0aW5nIGB0cmFuc2xhdGVgLgogICAqCiAgICogZnVuY3Rpb24gTXlTZXJ2aWNlKHRyYW5zbGF0ZSkgewogICAqICAgYWxlcnQodHJhbnNsYXRlKCdIRUxMTyB7eW91fScsIHsgeW91OiAnWW91IScgfSkpOwogICAqIH0KICAgKgogICAqIEBwYXJhbSB7U3RyaW5nfSB0ZW1wbGF0ZSB0byBpbnRlcnBvbGF0ZQogICAqIEBwYXJhbSB7T2JqZWN0fSBbcmVwbGFjZW1lbnRzXSBhIG1hcCB3aXRoIHN1YnN0aXR1dGVzCiAgICoKICAgKiBAcmV0dXJuIHtTdHJpbmd9IHRoZSB0cmFuc2xhdGVkIHN0cmluZwogICAqLwogIGZ1bmN0aW9uIHRyYW5zbGF0ZSQxKHRlbXBsYXRlLCByZXBsYWNlbWVudHMpIHsKCiAgICByZXBsYWNlbWVudHMgPSByZXBsYWNlbWVudHMgfHwge307CgogICAgcmV0dXJuIHRlbXBsYXRlLnJlcGxhY2UoL3soW159XSspfS9nLCBmdW5jdGlvbihfLCBrZXkpIHsKICAgICAgcmV0dXJuIHJlcGxhY2VtZW50c1trZXldIHx8ICd7JyArIGtleSArICd9JzsKICAgIH0pOwogIH0KCiAgdmFyIFRyYW5zbGF0ZU1vZHVsZSA9IHsKICAgIHRyYW5zbGF0ZTogWyAndmFsdWUnLCB0cmFuc2xhdGUkMSBdCiAgfTsKCiAgdmFyIERFRkFVTFRfTEFCRUxfU0laRSQxID0gewogICAgd2lkdGg6IDkwLAogICAgaGVpZ2h0OiAyMAogIH07CgogIHZhciBGTE9XX0xBQkVMX0lOREVOVCA9IDE1OwoKCiAgLyoqCiAgICogUmV0dXJucyB0cnVlIGlmIHRoZSBnaXZlbiBzZW1hbnRpYyBoYXMgYW4gZXh0ZXJuYWwgbGFiZWwKICAgKgogICAqIEBwYXJhbSB7QnBtbkVsZW1lbnR9IHNlbWFudGljCiAgICogQHJldHVybiB7Qm9vbGVhbn0gdHJ1ZSBpZiBoYXMgbGFiZWwKICAgKi8KICBmdW5jdGlvbiBpc0xhYmVsRXh0ZXJuYWwoc2VtYW50aWMpIHsKICAgIHJldHVybiBpcyQxKHNlbWFudGljLCAnYnBtbjpFdmVudCcpIHx8CiAgICAgICAgICAgaXMkMShzZW1hbnRpYywgJ2JwbW46R2F0ZXdheScpIHx8CiAgICAgICAgICAgaXMkMShzZW1hbnRpYywgJ2JwbW46RGF0YVN0b3JlUmVmZXJlbmNlJykgfHwKICAgICAgICAgICBpcyQxKHNlbWFudGljLCAnYnBtbjpEYXRhT2JqZWN0UmVmZXJlbmNlJykgfHwKICAgICAgICAgICBpcyQxKHNlbWFudGljLCAnYnBtbjpEYXRhSW5wdXQnKSB8fAogICAgICAgICAgIGlzJDEoc2VtYW50aWMsICdicG1uOkRhdGFPdXRwdXQnKSB8fAogICAgICAgICAgIGlzJDEoc2VtYW50aWMsICdicG1uOlNlcXVlbmNlRmxvdycpIHx8CiAgICAgICAgICAgaXMkMShzZW1hbnRpYywgJ2JwbW46TWVzc2FnZUZsb3cnKSB8fAogICAgICAgICAgIGlzJDEoc2VtYW50aWMsICdicG1uOkdyb3VwJyk7CiAgfQoKICAvKioKICAgKiBHZXQgdGhlIHBvc2l0aW9uIGZvciBzZXF1ZW5jZSBmbG93IGxhYmVscwogICAqCiAgICogQHBhcmFtICB7QXJyYXk8UG9pbnQ+fSB3YXlwb2ludHMKICAgKiBAcmV0dXJuIHtQb2ludH0gdGhlIGxhYmVsIHBvc2l0aW9uCiAgICovCiAgZnVuY3Rpb24gZ2V0Rmxvd0xhYmVsUG9zaXRpb24od2F5cG9pbnRzKSB7CgogICAgLy8gZ2V0IHRoZSB3YXlwb2ludHMgbWlkCiAgICB2YXIgbWlkID0gd2F5cG9pbnRzLmxlbmd0aCAvIDIgLSAxOwoKICAgIHZhciBmaXJzdCA9IHdheXBvaW50c1tNYXRoLmZsb29yKG1pZCldOwogICAgdmFyIHNlY29uZCA9IHdheXBvaW50c1tNYXRoLmNlaWwobWlkICsgMC4wMSldOwoKICAgIC8vIGdldCBwb3NpdGlvbgogICAgdmFyIHBvc2l0aW9uID0gZ2V0V2F5cG9pbnRzTWlkKHdheXBvaW50cyk7CgogICAgLy8gY2FsY3VsYXRlIGFuZ2xlCiAgICB2YXIgYW5nbGUgPSBNYXRoLmF0YW4oKHNlY29uZC55IC0gZmlyc3QueSkgLyAoc2Vjb25kLnggLSBmaXJzdC54KSk7CgogICAgdmFyIHggPSBwb3NpdGlvbi54LAogICAgICAgIHkgPSBwb3NpdGlvbi55OwoKICAgIGlmIChNYXRoLmFicyhhbmdsZSkgPCBNYXRoLlBJIC8gMikgewogICAgICB5IC09IEZMT1dfTEFCRUxfSU5ERU5UOwogICAgfSBlbHNlIHsKICAgICAgeCArPSBGTE9XX0xBQkVMX0lOREVOVDsKICAgIH0KCiAgICByZXR1cm4geyB4OiB4LCB5OiB5IH07CiAgfQoKCiAgLyoqCiAgICogR2V0IHRoZSBtaWRkbGUgb2YgYSBudW1iZXIgb2Ygd2F5cG9pbnRzCiAgICoKICAgKiBAcGFyYW0gIHtBcnJheTxQb2ludD59IHdheXBvaW50cwogICAqIEByZXR1cm4ge1BvaW50fSB0aGUgbWlkIHBvaW50CiAgICovCiAgZnVuY3Rpb24gZ2V0V2F5cG9pbnRzTWlkKHdheXBvaW50cykgewoKICAgIHZhciBtaWQgPSB3YXlwb2ludHMubGVuZ3RoIC8gMiAtIDE7CgogICAgdmFyIGZpcnN0ID0gd2F5cG9pbnRzW01hdGguZmxvb3IobWlkKV07CiAgICB2YXIgc2Vjb25kID0gd2F5cG9pbnRzW01hdGguY2VpbChtaWQgKyAwLjAxKV07CgogICAgcmV0dXJuIHsKICAgICAgeDogZmlyc3QueCArIChzZWNvbmQueCAtIGZpcnN0LngpIC8gMiwKICAgICAgeTogZmlyc3QueSArIChzZWNvbmQueSAtIGZpcnN0LnkpIC8gMgogICAgfTsKICB9CgoKICBmdW5jdGlvbiBnZXRFeHRlcm5hbExhYmVsTWlkKGVsZW1lbnQpIHsKCiAgICBpZiAoZWxlbWVudC53YXlwb2ludHMpIHsKICAgICAgcmV0dXJuIGdldEZsb3dMYWJlbFBvc2l0aW9uKGVsZW1lbnQud2F5cG9pbnRzKTsKICAgIH0gZWxzZSBpZiAoaXMkMShlbGVtZW50LCAnYnBtbjpHcm91cCcpKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgeDogZWxlbWVudC54ICsgZWxlbWVudC53aWR0aCAvIDIsCiAgICAgICAgeTogZWxlbWVudC55ICsgREVGQVVMVF9MQUJFTF9TSVpFJDEuaGVpZ2h0IC8gMgogICAgICB9OwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIHsKICAgICAgICB4OiBlbGVtZW50LnggKyBlbGVtZW50LndpZHRoIC8gMiwKICAgICAgICB5OiBlbGVtZW50LnkgKyBlbGVtZW50LmhlaWdodCArIERFRkFVTFRfTEFCRUxfU0laRSQxLmhlaWdodCAvIDIKICAgICAgfTsKICAgIH0KICB9CgoKICAvKioKICAgKiBSZXR1cm5zIHRoZSBib3VuZHMgb2YgYW4gZWxlbWVudHMgbGFiZWwsIHBhcnNlZCBmcm9tIHRoZSBlbGVtZW50cyBESSBvcgogICAqIGdlbmVyYXRlZCBmcm9tIGl0cyBib3VuZHMuCiAgICoKICAgKiBAcGFyYW0ge0JwbW5FbGVtZW50fSBzZW1hbnRpYwogICAqIEBwYXJhbSB7ZGpzLm1vZGVsLkJhc2V9IGVsZW1lbnQKICAgKi8KICBmdW5jdGlvbiBnZXRFeHRlcm5hbExhYmVsQm91bmRzKHNlbWFudGljLCBlbGVtZW50KSB7CgogICAgdmFyIG1pZCwKICAgICAgICBzaXplLAogICAgICAgIGJvdW5kcywKICAgICAgICBkaSA9IHNlbWFudGljLmRpLAogICAgICAgIGxhYmVsID0gZGkubGFiZWw7CgogICAgaWYgKGxhYmVsICYmIGxhYmVsLmJvdW5kcykgewogICAgICBib3VuZHMgPSBsYWJlbC5ib3VuZHM7CgogICAgICBzaXplID0gewogICAgICAgIHdpZHRoOiBNYXRoLm1heChERUZBVUxUX0xBQkVMX1NJWkUkMS53aWR0aCwgYm91bmRzLndpZHRoKSwKICAgICAgICBoZWlnaHQ6IGJvdW5kcy5oZWlnaHQKICAgICAgfTsKCiAgICAgIG1pZCA9IHsKICAgICAgICB4OiBib3VuZHMueCArIGJvdW5kcy53aWR0aCAvIDIsCiAgICAgICAgeTogYm91bmRzLnkgKyBib3VuZHMuaGVpZ2h0IC8gMgogICAgICB9OwogICAgfSBlbHNlIHsKCiAgICAgIG1pZCA9IGdldEV4dGVybmFsTGFiZWxNaWQoZWxlbWVudCk7CgogICAgICBzaXplID0gREVGQVVMVF9MQUJFTF9TSVpFJDE7CiAgICB9CgogICAgcmV0dXJuIGFzc2lnbih7CiAgICAgIHg6IG1pZC54IC0gc2l6ZS53aWR0aCAvIDIsCiAgICAgIHk6IG1pZC55IC0gc2l6ZS5oZWlnaHQgLyAyCiAgICB9LCBzaXplKTsKICB9CgogIC8qKgogICAqIFRoaXMgZmlsZSBjb250YWlucyBwb3J0aW9ucyB0aGF0IGdvdCBleHRyYWNlZCBmcm9tIFNuYXAuc3ZnIChsaWNlbnNlZCBBcGFjaGUtMi4wKS4KICAgKgogICAqIEBzZWUgaHR0cHM6Ly9naXRodWIuY29tL2Fkb2JlLXdlYnBsYXRmb3JtL1NuYXAuc3ZnL2Jsb2IvbWFzdGVyL3NyYy9wYXRoLmpzCiAgICovCgogIC8qIGVzbGludCBuby1mYWxsdGhyb3VnaDogIm9mZiIgKi8KCiAgdmFyIG1hdGggPSBNYXRoLAogICAgICBQSSA9IG1hdGguUEk7CgogIGZ1bmN0aW9uIHJvdW5kUG9pbnQocG9pbnQpIHsKCiAgICByZXR1cm4gewogICAgICB4OiBNYXRoLnJvdW5kKHBvaW50LngpLAogICAgICB5OiBNYXRoLnJvdW5kKHBvaW50LnkpCiAgICB9OwogIH0KCgogIC8qKgogICAqIEdldCB0aGUgbWlkIG9mIHRoZSBnaXZlbiBib3VuZHMgb3IgcG9pbnQuCiAgICoKICAgKiBAcGFyYW0ge0JvdW5kc3xQb2ludH0gYm91bmRzCiAgICoKICAgKiBAcmV0dXJuIHtQb2ludH0KICAgKi8KICBmdW5jdGlvbiBnZXRNaWQoYm91bmRzKSB7CiAgICByZXR1cm4gcm91bmRQb2ludCh7CiAgICAgIHg6IGJvdW5kcy54ICsgKGJvdW5kcy53aWR0aCB8fCAwKSAvIDIsCiAgICAgIHk6IGJvdW5kcy55ICsgKGJvdW5kcy5oZWlnaHQgfHwgMCkgLyAyCiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIGVsZW1lbnREYXRhKHNlbWFudGljLCBhdHRycykgewogICAgcmV0dXJuIGFzc2lnbih7CiAgICAgIGlkOiBzZW1hbnRpYy5pZCwKICAgICAgdHlwZTogc2VtYW50aWMuJHR5cGUsCiAgICAgIGJ1c2luZXNzT2JqZWN0OiBzZW1hbnRpYwogICAgfSwgYXR0cnMpOwogIH0KCiAgZnVuY3Rpb24gZ2V0V2F5cG9pbnRzKGJvLCBzb3VyY2UsIHRhcmdldCkgewoKICAgIHZhciB3YXlwb2ludHMgPSBiby5kaS53YXlwb2ludDsKCiAgICBpZiAoIXdheXBvaW50cyB8fCB3YXlwb2ludHMubGVuZ3RoIDwgMikgewogICAgICByZXR1cm4gWyBnZXRNaWQoc291cmNlKSwgZ2V0TWlkKHRhcmdldCkgXTsKICAgIH0KCiAgICByZXR1cm4gd2F5cG9pbnRzLm1hcChmdW5jdGlvbihwKSB7CiAgICAgIHJldHVybiB7IHg6IHAueCwgeTogcC55IH07CiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIG5vdFlldERyYXduKHRyYW5zbGF0ZSwgc2VtYW50aWMsIHJlZlNlbWFudGljLCBwcm9wZXJ0eSkgewogICAgcmV0dXJuIG5ldyBFcnJvcih0cmFuc2xhdGUoJ2VsZW1lbnQge2VsZW1lbnR9IHJlZmVyZW5jZWQgYnkge3JlZmVyZW5jZWR9I3twcm9wZXJ0eX0gbm90IHlldCBkcmF3bicsIHsKICAgICAgZWxlbWVudDogZWxlbWVudFRvU3RyaW5nKHJlZlNlbWFudGljKSwKICAgICAgcmVmZXJlbmNlZDogZWxlbWVudFRvU3RyaW5nKHNlbWFudGljKSwKICAgICAgcHJvcGVydHk6IHByb3BlcnR5CiAgICB9KSk7CiAgfQoKCiAgLyoqCiAgICogQW4gaW1wb3J0ZXIgdGhhdCBhZGRzIGJwbW4gZWxlbWVudHMgdG8gdGhlIGNhbnZhcwogICAqCiAgICogQHBhcmFtIHtFdmVudEJ1c30gZXZlbnRCdXMKICAgKiBAcGFyYW0ge0NhbnZhc30gY2FudmFzCiAgICogQHBhcmFtIHtFbGVtZW50RmFjdG9yeX0gZWxlbWVudEZhY3RvcnkKICAgKiBAcGFyYW0ge0VsZW1lbnRSZWdpc3RyeX0gZWxlbWVudFJlZ2lzdHJ5CiAgICogQHBhcmFtIHtGdW5jdGlvbn0gdHJhbnNsYXRlCiAgICogQHBhcmFtIHtUZXh0UmVuZGVyZXJ9IHRleHRSZW5kZXJlcgogICAqLwogIGZ1bmN0aW9uIEJwbW5JbXBvcnRlcigKICAgICAgZXZlbnRCdXMsIGNhbnZhcywgZWxlbWVudEZhY3RvcnksCiAgICAgIGVsZW1lbnRSZWdpc3RyeSwgdHJhbnNsYXRlLCB0ZXh0UmVuZGVyZXIpIHsKCiAgICB0aGlzLl9ldmVudEJ1cyA9IGV2ZW50QnVzOwogICAgdGhpcy5fY2FudmFzID0gY2FudmFzOwogICAgdGhpcy5fZWxlbWVudEZhY3RvcnkgPSBlbGVtZW50RmFjdG9yeTsKICAgIHRoaXMuX2VsZW1lbnRSZWdpc3RyeSA9IGVsZW1lbnRSZWdpc3RyeTsKICAgIHRoaXMuX3RyYW5zbGF0ZSA9IHRyYW5zbGF0ZTsKICAgIHRoaXMuX3RleHRSZW5kZXJlciA9IHRleHRSZW5kZXJlcjsKICB9CgogIEJwbW5JbXBvcnRlci4kaW5qZWN0ID0gWwogICAgJ2V2ZW50QnVzJywKICAgICdjYW52YXMnLAogICAgJ2VsZW1lbnRGYWN0b3J5JywKICAgICdlbGVtZW50UmVnaXN0cnknLAogICAgJ3RyYW5zbGF0ZScsCiAgICAndGV4dFJlbmRlcmVyJwogIF07CgoKICAvKioKICAgKiBBZGQgYnBtbiBlbGVtZW50IChzZW1hbnRpYykgdG8gdGhlIGNhbnZhcyBvbnRvIHRoZQogICAqIHNwZWNpZmllZCBwYXJlbnQgc2hhcGUuCiAgICovCiAgQnBtbkltcG9ydGVyLnByb3RvdHlwZS5hZGQgPSBmdW5jdGlvbihzZW1hbnRpYywgcGFyZW50RWxlbWVudCkgewoKICAgIHZhciBkaSA9IHNlbWFudGljLmRpLAogICAgICAgIGVsZW1lbnQsCiAgICAgICAgdHJhbnNsYXRlID0gdGhpcy5fdHJhbnNsYXRlLAogICAgICAgIGhpZGRlbjsKCiAgICB2YXIgcGFyZW50SW5kZXg7CgogICAgLy8gUk9PVCBFTEVNRU5UCiAgICAvLyBoYW5kbGUgdGhlIHNwZWNpYWwgY2FzZSB0aGF0IHdlIGRlYWwgd2l0aCBhCiAgICAvLyBpbnZpc2libGUgcm9vdCBlbGVtZW50IChwcm9jZXNzIG9yIGNvbGxhYm9yYXRpb24pCiAgICBpZiAoaXMkMShkaSwgJ2JwbW5kaTpCUE1OUGxhbmUnKSkgewoKICAgICAgLy8gYWRkIGEgdmlydHVhbCBlbGVtZW50IChub3QgYmVpbmcgZHJhd24pCiAgICAgIGVsZW1lbnQgPSB0aGlzLl9lbGVtZW50RmFjdG9yeS5jcmVhdGVSb290KGVsZW1lbnREYXRhKHNlbWFudGljKSk7CgogICAgICB0aGlzLl9jYW52YXMuc2V0Um9vdEVsZW1lbnQoZWxlbWVudCk7CiAgICB9CgogICAgLy8gU0hBUEUKICAgIGVsc2UgaWYgKGlzJDEoZGksICdicG1uZGk6QlBNTlNoYXBlJykpIHsKCiAgICAgIHZhciBjb2xsYXBzZWQgPSAhaXNFeHBhbmRlZChzZW1hbnRpYyk7CiAgICAgIGhpZGRlbiA9IHBhcmVudEVsZW1lbnQgJiYgKHBhcmVudEVsZW1lbnQuaGlkZGVuIHx8IHBhcmVudEVsZW1lbnQuY29sbGFwc2VkKTsKCiAgICAgIHZhciBib3VuZHMgPSBzZW1hbnRpYy5kaS5ib3VuZHM7CgogICAgICBlbGVtZW50ID0gdGhpcy5fZWxlbWVudEZhY3RvcnkuY3JlYXRlU2hhcGUoZWxlbWVudERhdGEoc2VtYW50aWMsIHsKICAgICAgICBjb2xsYXBzZWQ6IGNvbGxhcHNlZCwKICAgICAgICBoaWRkZW46IGhpZGRlbiwKICAgICAgICB4OiBNYXRoLnJvdW5kKGJvdW5kcy54KSwKICAgICAgICB5OiBNYXRoLnJvdW5kKGJvdW5kcy55KSwKICAgICAgICB3aWR0aDogTWF0aC5yb3VuZChib3VuZHMud2lkdGgpLAogICAgICAgIGhlaWdodDogTWF0aC5yb3VuZChib3VuZHMuaGVpZ2h0KQogICAgICB9KSk7CgogICAgICBpZiAoaXMkMShzZW1hbnRpYywgJ2JwbW46Qm91bmRhcnlFdmVudCcpKSB7CiAgICAgICAgdGhpcy5fYXR0YWNoQm91bmRhcnkoc2VtYW50aWMsIGVsZW1lbnQpOwogICAgICB9CgogICAgICAvLyBpbnNlcnQgbGFuZXMgYmVoaW5kIG90aGVyIGZsb3cgbm9kZXMgKGNmLiAjNzI3KQogICAgICBpZiAoaXMkMShzZW1hbnRpYywgJ2JwbW46TGFuZScpKSB7CiAgICAgICAgcGFyZW50SW5kZXggPSAwOwogICAgICB9CgogICAgICBpZiAoaXMkMShzZW1hbnRpYywgJ2JwbW46RGF0YVN0b3JlUmVmZXJlbmNlJykpIHsKCiAgICAgICAgLy8gY2hlY2sgd2hldGhlciBkYXRhIHN0b3JlIGlzIGluc2lkZSBvdXIgb3V0c2lkZSBvZiBpdHMgc2VtYW50aWMgcGFyZW50CiAgICAgICAgaWYgKCFpc1BvaW50SW5zaWRlQkJveChwYXJlbnRFbGVtZW50LCBnZXRNaWQoYm91bmRzKSkpIHsKICAgICAgICAgIHBhcmVudEVsZW1lbnQgPSB0aGlzLl9jYW52YXMuZ2V0Um9vdEVsZW1lbnQoKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuX2NhbnZhcy5hZGRTaGFwZShlbGVtZW50LCBwYXJlbnRFbGVtZW50LCBwYXJlbnRJbmRleCk7CiAgICB9CgogICAgLy8gQ09OTkVDVElPTgogICAgZWxzZSBpZiAoaXMkMShkaSwgJ2JwbW5kaTpCUE1ORWRnZScpKSB7CgogICAgICB2YXIgc291cmNlID0gdGhpcy5fZ2V0U291cmNlKHNlbWFudGljKSwKICAgICAgICAgIHRhcmdldCA9IHRoaXMuX2dldFRhcmdldChzZW1hbnRpYyk7CgogICAgICBoaWRkZW4gPSBwYXJlbnRFbGVtZW50ICYmIChwYXJlbnRFbGVtZW50LmhpZGRlbiB8fCBwYXJlbnRFbGVtZW50LmNvbGxhcHNlZCk7CgogICAgICBlbGVtZW50ID0gdGhpcy5fZWxlbWVudEZhY3RvcnkuY3JlYXRlQ29ubmVjdGlvbihlbGVtZW50RGF0YShzZW1hbnRpYywgewogICAgICAgIGhpZGRlbjogaGlkZGVuLAogICAgICAgIHNvdXJjZTogc291cmNlLAogICAgICAgIHRhcmdldDogdGFyZ2V0LAogICAgICAgIHdheXBvaW50czogZ2V0V2F5cG9pbnRzKHNlbWFudGljLCBzb3VyY2UsIHRhcmdldCkKICAgICAgfSkpOwoKICAgICAgaWYgKGlzJDEoc2VtYW50aWMsICdicG1uOkRhdGFBc3NvY2lhdGlvbicpKSB7CgogICAgICAgIC8vIHJlbmRlciBhbHdheXMgb24gdG9wOyB0aGlzIGVuc3VyZXMgRGF0YUFzc29jaWF0aW9ucwogICAgICAgIC8vIGFyZSByZW5kZXJlZCBjb3JyZWN0bHkgYWNyb3NzIGRpZmZlcmVudCAiaGFja3MiIHBlb3BsZQogICAgICAgIC8vIGxvdmUgdG8gbW9kZWwgc3VjaCBhcyBjcm9zcyBwYXJ0aWNpcGFudCAvIHN1YiBwcm9jZXNzCiAgICAgICAgLy8gYXNzb2NpYXRpb25zCiAgICAgICAgcGFyZW50RWxlbWVudCA9IG51bGw7CiAgICAgIH0KCiAgICAgIC8vIGluc2VydCBzZXF1ZW5jZSBmbG93cyBiZWhpbmQgb3RoZXIgZmxvdyBub2RlcyAoY2YuICM3MjcpCiAgICAgIGlmIChpcyQxKHNlbWFudGljLCAnYnBtbjpTZXF1ZW5jZUZsb3cnKSkgewogICAgICAgIHBhcmVudEluZGV4ID0gMDsKICAgICAgfQoKICAgICAgdGhpcy5fY2FudmFzLmFkZENvbm5lY3Rpb24oZWxlbWVudCwgcGFyZW50RWxlbWVudCwgcGFyZW50SW5kZXgpOwogICAgfSBlbHNlIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKHRyYW5zbGF0ZSgndW5rbm93biBkaSB7ZGl9IGZvciBlbGVtZW50IHtzZW1hbnRpY30nLCB7CiAgICAgICAgZGk6IGVsZW1lbnRUb1N0cmluZyhkaSksCiAgICAgICAgc2VtYW50aWM6IGVsZW1lbnRUb1N0cmluZyhzZW1hbnRpYykKICAgICAgfSkpOwogICAgfQoKICAgIC8vIChvcHRpb25hbCkgTEFCRUwKICAgIGlmIChpc0xhYmVsRXh0ZXJuYWwoc2VtYW50aWMpICYmIGdldExhYmVsKGVsZW1lbnQpKSB7CiAgICAgIHRoaXMuYWRkTGFiZWwoc2VtYW50aWMsIGVsZW1lbnQpOwogICAgfQoKCiAgICB0aGlzLl9ldmVudEJ1cy5maXJlKCdicG1uRWxlbWVudC5hZGRlZCcsIHsgZWxlbWVudDogZWxlbWVudCB9KTsKCiAgICByZXR1cm4gZWxlbWVudDsKICB9OwoKCiAgLyoqCiAgICogQXR0YWNoIHRoZSBib3VuZGFyeSBlbGVtZW50IHRvIHRoZSBnaXZlbiBob3N0CiAgICoKICAgKiBAcGFyYW0ge01vZGRsZUVsZW1lbnR9IGJvdW5kYXJ5U2VtYW50aWMKICAgKiBAcGFyYW0ge2Rqcy5tb2RlbC5CYXNlfSBib3VuZGFyeUVsZW1lbnQKICAgKi8KICBCcG1uSW1wb3J0ZXIucHJvdG90eXBlLl9hdHRhY2hCb3VuZGFyeSA9IGZ1bmN0aW9uKGJvdW5kYXJ5U2VtYW50aWMsIGJvdW5kYXJ5RWxlbWVudCkgewogICAgdmFyIHRyYW5zbGF0ZSA9IHRoaXMuX3RyYW5zbGF0ZTsKICAgIHZhciBob3N0U2VtYW50aWMgPSBib3VuZGFyeVNlbWFudGljLmF0dGFjaGVkVG9SZWY7CgogICAgaWYgKCFob3N0U2VtYW50aWMpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKHRyYW5zbGF0ZSgnbWlzc2luZyB7c2VtYW50aWN9I2F0dGFjaGVkVG9SZWYnLCB7CiAgICAgICAgc2VtYW50aWM6IGVsZW1lbnRUb1N0cmluZyhib3VuZGFyeVNlbWFudGljKQogICAgICB9KSk7CiAgICB9CgogICAgdmFyIGhvc3QgPSB0aGlzLl9lbGVtZW50UmVnaXN0cnkuZ2V0KGhvc3RTZW1hbnRpYy5pZCksCiAgICAgICAgYXR0YWNoZXJzID0gaG9zdCAmJiBob3N0LmF0dGFjaGVyczsKCiAgICBpZiAoIWhvc3QpIHsKICAgICAgdGhyb3cgbm90WWV0RHJhd24odHJhbnNsYXRlLCBib3VuZGFyeVNlbWFudGljLCBob3N0U2VtYW50aWMsICdhdHRhY2hlZFRvUmVmJyk7CiAgICB9CgogICAgLy8gd2lyZSBlbGVtZW50Lmhvc3QgPD4gaG9zdC5hdHRhY2hlcnMKICAgIGJvdW5kYXJ5RWxlbWVudC5ob3N0ID0gaG9zdDsKCiAgICBpZiAoIWF0dGFjaGVycykgewogICAgICBob3N0LmF0dGFjaGVycyA9IGF0dGFjaGVycyA9IFtdOwogICAgfQoKICAgIGlmIChhdHRhY2hlcnMuaW5kZXhPZihib3VuZGFyeUVsZW1lbnQpID09PSAtMSkgewogICAgICBhdHRhY2hlcnMucHVzaChib3VuZGFyeUVsZW1lbnQpOwogICAgfQogIH07CgoKICAvKioKICAgKiBhZGQgbGFiZWwgZm9yIGFuIGVsZW1lbnQKICAgKi8KICBCcG1uSW1wb3J0ZXIucHJvdG90eXBlLmFkZExhYmVsID0gZnVuY3Rpb24oc2VtYW50aWMsIGVsZW1lbnQpIHsKICAgIHZhciBib3VuZHMsCiAgICAgICAgdGV4dCwKICAgICAgICBsYWJlbDsKCiAgICBib3VuZHMgPSBnZXRFeHRlcm5hbExhYmVsQm91bmRzKHNlbWFudGljLCBlbGVtZW50KTsKCiAgICB0ZXh0ID0gZ2V0TGFiZWwoZWxlbWVudCk7CgogICAgaWYgKHRleHQpIHsKCiAgICAgIC8vIGdldCBjb3JyZWN0ZWQgYm91bmRzIGZyb20gYWN0dWFsIGxheW91dGVkIHRleHQKICAgICAgYm91bmRzID0gdGhpcy5fdGV4dFJlbmRlcmVyLmdldEV4dGVybmFsTGFiZWxCb3VuZHMoYm91bmRzLCB0ZXh0KTsKICAgIH0KCiAgICBsYWJlbCA9IHRoaXMuX2VsZW1lbnRGYWN0b3J5LmNyZWF0ZUxhYmVsKGVsZW1lbnREYXRhKHNlbWFudGljLCB7CiAgICAgIGlkOiBzZW1hbnRpYy5pZCArICdfbGFiZWwnLAogICAgICBsYWJlbFRhcmdldDogZWxlbWVudCwKICAgICAgdHlwZTogJ2xhYmVsJywKICAgICAgaGlkZGVuOiBlbGVtZW50LmhpZGRlbiB8fCAhZ2V0TGFiZWwoZWxlbWVudCksCiAgICAgIHg6IE1hdGgucm91bmQoYm91bmRzLngpLAogICAgICB5OiBNYXRoLnJvdW5kKGJvdW5kcy55KSwKICAgICAgd2lkdGg6IE1hdGgucm91bmQoYm91bmRzLndpZHRoKSwKICAgICAgaGVpZ2h0OiBNYXRoLnJvdW5kKGJvdW5kcy5oZWlnaHQpCiAgICB9KSk7CgogICAgcmV0dXJuIHRoaXMuX2NhbnZhcy5hZGRTaGFwZShsYWJlbCwgZWxlbWVudC5wYXJlbnQpOwogIH07CgogIC8qKgogICAqIFJldHVybiB0aGUgZHJhd24gY29ubmVjdGlvbiBlbmQgYmFzZWQgb24gdGhlIGdpdmVuIHNpZGUuCiAgICoKICAgKiBAdGhyb3dzIHtFcnJvcn0gaWYgdGhlIGVuZCBpcyBub3QgeWV0IGRyYXduCiAgICovCiAgQnBtbkltcG9ydGVyLnByb3RvdHlwZS5fZ2V0RW5kID0gZnVuY3Rpb24oc2VtYW50aWMsIHNpZGUpIHsKCiAgICB2YXIgZWxlbWVudCwKICAgICAgICByZWZTZW1hbnRpYywKICAgICAgICB0eXBlID0gc2VtYW50aWMuJHR5cGUsCiAgICAgICAgdHJhbnNsYXRlID0gdGhpcy5fdHJhbnNsYXRlOwoKICAgIHJlZlNlbWFudGljID0gc2VtYW50aWNbc2lkZSArICdSZWYnXTsKCiAgICAvLyBoYW5kbGUgbXlzdGVyaW91cyBpc01hbnkgRGF0YUFzc29jaWF0aW9uI3NvdXJjZVJlZgogICAgaWYgKHNpZGUgPT09ICdzb3VyY2UnICYmIHR5cGUgPT09ICdicG1uOkRhdGFJbnB1dEFzc29jaWF0aW9uJykgewogICAgICByZWZTZW1hbnRpYyA9IHJlZlNlbWFudGljICYmIHJlZlNlbWFudGljWzBdOwogICAgfQoKICAgIC8vIGZpeCBzb3VyY2UgLyB0YXJnZXQgZm9yIERhdGFJbnB1dEFzc29jaWF0aW9uIC8gRGF0YU91dHB1dEFzc29jaWF0aW9uCiAgICBpZiAoc2lkZSA9PT0gJ3NvdXJjZScgJiYgdHlwZSA9PT0gJ2JwbW46RGF0YU91dHB1dEFzc29jaWF0aW9uJyB8fAogICAgICAgIHNpZGUgPT09ICd0YXJnZXQnICYmIHR5cGUgPT09ICdicG1uOkRhdGFJbnB1dEFzc29jaWF0aW9uJykgewoKICAgICAgcmVmU2VtYW50aWMgPSBzZW1hbnRpYy4kcGFyZW50OwogICAgfQoKICAgIGVsZW1lbnQgPSByZWZTZW1hbnRpYyAmJiB0aGlzLl9nZXRFbGVtZW50KHJlZlNlbWFudGljKTsKCiAgICBpZiAoZWxlbWVudCkgewogICAgICByZXR1cm4gZWxlbWVudDsKICAgIH0KCiAgICBpZiAocmVmU2VtYW50aWMpIHsKICAgICAgdGhyb3cgbm90WWV0RHJhd24odHJhbnNsYXRlLCBzZW1hbnRpYywgcmVmU2VtYW50aWMsIHNpZGUgKyAnUmVmJyk7CiAgICB9IGVsc2UgewogICAgICB0aHJvdyBuZXcgRXJyb3IodHJhbnNsYXRlKCd7c2VtYW50aWN9I3tzaWRlfSBSZWYgbm90IHNwZWNpZmllZCcsIHsKICAgICAgICBzZW1hbnRpYzogZWxlbWVudFRvU3RyaW5nKHNlbWFudGljKSwKICAgICAgICBzaWRlOiBzaWRlCiAgICAgIH0pKTsKICAgIH0KICB9OwoKICBCcG1uSW1wb3J0ZXIucHJvdG90eXBlLl9nZXRTb3VyY2UgPSBmdW5jdGlvbihzZW1hbnRpYykgewogICAgcmV0dXJuIHRoaXMuX2dldEVuZChzZW1hbnRpYywgJ3NvdXJjZScpOwogIH07CgogIEJwbW5JbXBvcnRlci5wcm90b3R5cGUuX2dldFRhcmdldCA9IGZ1bmN0aW9uKHNlbWFudGljKSB7CiAgICByZXR1cm4gdGhpcy5fZ2V0RW5kKHNlbWFudGljLCAndGFyZ2V0Jyk7CiAgfTsKCgogIEJwbW5JbXBvcnRlci5wcm90b3R5cGUuX2dldEVsZW1lbnQgPSBmdW5jdGlvbihzZW1hbnRpYykgewogICAgcmV0dXJuIHRoaXMuX2VsZW1lbnRSZWdpc3RyeS5nZXQoc2VtYW50aWMuaWQpOwogIH07CgoKICAvLyBoZWxwZXJzIC8vLy8vLy8vLy8vLy8vLy8vLy8vCgogIGZ1bmN0aW9uIGlzUG9pbnRJbnNpZGVCQm94KGJib3gsIHBvaW50KSB7CiAgICB2YXIgeCA9IHBvaW50LngsCiAgICAgICAgeSA9IHBvaW50Lnk7CgogICAgcmV0dXJuIHggPj0gYmJveC54ICYmCiAgICAgIHggPD0gYmJveC54ICsgYmJveC53aWR0aCAmJgogICAgICB5ID49IGJib3gueSAmJgogICAgICB5IDw9IGJib3gueSArIGJib3guaGVpZ2h0OwogIH0KCiAgdmFyIEltcG9ydE1vZHVsZSA9IHsKICAgIF9fZGVwZW5kc19fOiBbCiAgICAgIFRyYW5zbGF0ZU1vZHVsZQogICAgXSwKICAgIGJwbW5JbXBvcnRlcjogWyAndHlwZScsIEJwbW5JbXBvcnRlciBdCiAgfTsKCiAgdmFyIENvcmVNb2R1bGUkMSA9IHsKICAgIF9fZGVwZW5kc19fOiBbCiAgICAgIERyYXdNb2R1bGUkMSwKICAgICAgSW1wb3J0TW9kdWxlCiAgICBdCiAgfTsKCiAgZnVuY3Rpb24gZ2V0T3JpZ2luYWwoZXZlbnQpIHsKICAgIHJldHVybiBldmVudC5vcmlnaW5hbEV2ZW50IHx8IGV2ZW50LnNyY0V2ZW50OwogIH0KCiAgZnVuY3Rpb24gaXNNYWMoKSB7CiAgICByZXR1cm4gKC9tYWMvaSkudGVzdChuYXZpZ2F0b3IucGxhdGZvcm0pOwogIH0KCiAgZnVuY3Rpb24gaXNQcmltYXJ5QnV0dG9uKGV2ZW50KSB7CgogICAgLy8gYnV0dG9uID09PSAwIC0+IGxlZnQgw6FrYSBwcmltYXJ5IG1vdXNlIGJ1dHRvbgogICAgcmV0dXJuICEoZ2V0T3JpZ2luYWwoZXZlbnQpIHx8IGV2ZW50KS5idXR0b247CiAgfQoKICBmdW5jdGlvbiBoYXNQcmltYXJ5TW9kaWZpZXIoZXZlbnQpIHsKICAgIHZhciBvcmlnaW5hbEV2ZW50ID0gZ2V0T3JpZ2luYWwoZXZlbnQpIHx8IGV2ZW50OwoKICAgIGlmICghaXNQcmltYXJ5QnV0dG9uKGV2ZW50KSkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLy8gVXNlIGFsdCBhcyBwcmltYXJ5IG1vZGlmaWVyIGtleSBmb3IgbWFjIE9TCiAgICBpZiAoaXNNYWMoKSkgewogICAgICByZXR1cm4gb3JpZ2luYWxFdmVudC5tZXRhS2V5OwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIG9yaWdpbmFsRXZlbnQuY3RybEtleTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIGFsbG93QWxsKGUpIHsgcmV0dXJuIHRydWU7IH0KCiAgdmFyIExPV19QUklPUklUWSA9IDUwMDsKCgogIC8qKgogICAqIEEgcGx1Z2luIHRoYXQgcHJvdmlkZXMgaW50ZXJhY3Rpb24gZXZlbnRzIGZvciBkaWFncmFtIGVsZW1lbnRzLgogICAqCiAgICogSXQgZW1pdHMgdGhlIGZvbGxvd2luZyBldmVudHM6CiAgICoKICAgKiAgICogZWxlbWVudC5jbGljawogICAqICAgKiBlbGVtZW50LmNvbnRleHRtZW51CiAgICogICAqIGVsZW1lbnQuZGJsY2xpY2sKICAgKiAgICogZWxlbWVudC5ob3ZlcgogICAqICAgKiBlbGVtZW50Lm1vdXNlZG93bgogICAqICAgKiBlbGVtZW50Lm1vdXNlbW92ZQogICAqICAgKiBlbGVtZW50Lm1vdXNldXAKICAgKiAgICogZWxlbWVudC5vdXQKICAgKgogICAqIEVhY2ggZXZlbnQgaXMgYSB0dXBsZSB7IGVsZW1lbnQsIGdmeCwgb3JpZ2luYWxFdmVudCB9LgogICAqCiAgICogQ2FuY2VsaW5nIHRoZSBldmVudCB2aWEgRXZlbnQjcHJldmVudERlZmF1bHQoKQogICAqIHByZXZlbnRzIHRoZSBvcmlnaW5hbCBET00gb3BlcmF0aW9uLgogICAqCiAgICogQHBhcmFtIHtFdmVudEJ1c30gZXZlbnRCdXMKICAgKi8KICBmdW5jdGlvbiBJbnRlcmFjdGlvbkV2ZW50cyhldmVudEJ1cywgZWxlbWVudFJlZ2lzdHJ5LCBzdHlsZXMpIHsKCiAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgLyoqCiAgICAgKiBGaXJlIGFuIGludGVyYWN0aW9uIGV2ZW50LgogICAgICoKICAgICAqIEBwYXJhbSB7U3RyaW5nfSB0eXBlIGxvY2FsIGV2ZW50IG5hbWUsIGUuZy4gZWxlbWVudC5jbGljay4KICAgICAqIEBwYXJhbSB7RE9NRXZlbnR9IGV2ZW50IG5hdGl2ZSBldmVudAogICAgICogQHBhcmFtIHtkanMubW9kZWwuQmFzZX0gW2VsZW1lbnRdIHRoZSBkaWFncmFtIGVsZW1lbnQgdG8gZW1pdCB0aGUgZXZlbnQgb247CiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdHMgdG8gdGhlIGV2ZW50IHRhcmdldAogICAgICovCiAgICBmdW5jdGlvbiBmaXJlKHR5cGUsIGV2ZW50LCBlbGVtZW50KSB7CgogICAgICBpZiAoaXNJZ25vcmVkKHR5cGUsIGV2ZW50KSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIHRhcmdldCwgZ2Z4LCByZXR1cm5WYWx1ZTsKCiAgICAgIGlmICghZWxlbWVudCkgewogICAgICAgIHRhcmdldCA9IGV2ZW50LmRlbGVnYXRlVGFyZ2V0IHx8IGV2ZW50LnRhcmdldDsKCiAgICAgICAgaWYgKHRhcmdldCkgewogICAgICAgICAgZ2Z4ID0gdGFyZ2V0OwogICAgICAgICAgZWxlbWVudCA9IGVsZW1lbnRSZWdpc3RyeS5nZXQoZ2Z4KTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZ2Z4ID0gZWxlbWVudFJlZ2lzdHJ5LmdldEdyYXBoaWNzKGVsZW1lbnQpOwogICAgICB9CgogICAgICBpZiAoIWdmeCB8fCAhZWxlbWVudCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgcmV0dXJuVmFsdWUgPSBldmVudEJ1cy5maXJlKHR5cGUsIHsKICAgICAgICBlbGVtZW50OiBlbGVtZW50LAogICAgICAgIGdmeDogZ2Z4LAogICAgICAgIG9yaWdpbmFsRXZlbnQ6IGV2ZW50CiAgICAgIH0pOwoKICAgICAgaWYgKHJldHVyblZhbHVlID09PSBmYWxzZSkgewogICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpOwogICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIH0KICAgIH0KCiAgICAvLyBUT0RPKG5pa2t1KTogZG9jdW1lbnQgdGhpcwogICAgdmFyIGhhbmRsZXJzID0ge307CgogICAgZnVuY3Rpb24gbW91c2VIYW5kbGVyKGxvY2FsRXZlbnROYW1lKSB7CiAgICAgIHJldHVybiBoYW5kbGVyc1tsb2NhbEV2ZW50TmFtZV07CiAgICB9CgogICAgZnVuY3Rpb24gaXNJZ25vcmVkKGxvY2FsRXZlbnROYW1lLCBldmVudCkgewoKICAgICAgdmFyIGZpbHRlciA9IGlnbm9yZWRGaWx0ZXJzW2xvY2FsRXZlbnROYW1lXSB8fCBpc1ByaW1hcnlCdXR0b247CgogICAgICAvLyBvbmx5IHJlYWN0IG9uIGxlZnQgbW91c2UgYnV0dG9uIGludGVyYWN0aW9ucwogICAgICAvLyBleGNlcHQgZm9yIGludGVyYWN0aW9uIGV2ZW50cyB0aGF0IGFyZSBlbmFibGVkCiAgICAgIC8vIGZvciBzZWN1bmRhcnkgbW91c2UgYnV0dG9uCiAgICAgIHJldHVybiAhZmlsdGVyKGV2ZW50KTsKICAgIH0KCiAgICB2YXIgYmluZGluZ3MgPSB7CiAgICAgIGNsaWNrOiAnZWxlbWVudC5jbGljaycsCiAgICAgIGNvbnRleHRtZW51OiAnZWxlbWVudC5jb250ZXh0bWVudScsCiAgICAgIGRibGNsaWNrOiAnZWxlbWVudC5kYmxjbGljaycsCiAgICAgIG1vdXNlZG93bjogJ2VsZW1lbnQubW91c2Vkb3duJywKICAgICAgbW91c2Vtb3ZlOiAnZWxlbWVudC5tb3VzZW1vdmUnLAogICAgICBtb3VzZW92ZXI6ICdlbGVtZW50LmhvdmVyJywKICAgICAgbW91c2VvdXQ6ICdlbGVtZW50Lm91dCcsCiAgICAgIG1vdXNldXA6ICdlbGVtZW50Lm1vdXNldXAnLAogICAgfTsKCiAgICB2YXIgaWdub3JlZEZpbHRlcnMgPSB7CiAgICAgICdlbGVtZW50LmNvbnRleHRtZW51JzogYWxsb3dBbGwKICAgIH07CgoKICAgIC8vIG1hbnVhbCBldmVudCB0cmlnZ2VyIC8vLy8vLy8vLy8KCiAgICAvKioKICAgICAqIFRyaWdnZXIgYW4gaW50ZXJhY3Rpb24gZXZlbnQgKGJhc2VkIG9uIGEgbmF0aXZlIGRvbSBldmVudCkKICAgICAqIG9uIHRoZSB0YXJnZXQgc2hhcGUgb3IgY29ubmVjdGlvbi4KICAgICAqCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gZXZlbnROYW1lIHRoZSBuYW1lIG9mIHRoZSB0cmlnZ2VyZWQgRE9NIGV2ZW50CiAgICAgKiBAcGFyYW0ge01vdXNlRXZlbnR9IGV2ZW50CiAgICAgKiBAcGFyYW0ge2Rqcy5tb2RlbC5CYXNlfSB0YXJnZXRFbGVtZW50CiAgICAgKi8KICAgIGZ1bmN0aW9uIHRyaWdnZXJNb3VzZUV2ZW50KGV2ZW50TmFtZSwgZXZlbnQsIHRhcmdldEVsZW1lbnQpIHsKCiAgICAgIC8vIGkuZS4gZWxlbWVudC5tb3VzZWRvd24uLi4KICAgICAgdmFyIGxvY2FsRXZlbnROYW1lID0gYmluZGluZ3NbZXZlbnROYW1lXTsKCiAgICAgIGlmICghbG9jYWxFdmVudE5hbWUpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ3VubWFwcGVkIERPTSBldmVudCBuYW1lIDwnICsgZXZlbnROYW1lICsgJz4nKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGZpcmUobG9jYWxFdmVudE5hbWUsIGV2ZW50LCB0YXJnZXRFbGVtZW50KTsKICAgIH0KCgogICAgdmFyIEVMRU1FTlRfU0VMRUNUT1IgPSAnc3ZnLCAuZGpzLWVsZW1lbnQnOwoKICAgIC8vIGV2ZW50IGhhbmRsaW5nIC8vLy8vLy8KCiAgICBmdW5jdGlvbiByZWdpc3RlckV2ZW50KG5vZGUsIGV2ZW50LCBsb2NhbEV2ZW50LCBpZ25vcmVkRmlsdGVyKSB7CgogICAgICB2YXIgaGFuZGxlciA9IGhhbmRsZXJzW2xvY2FsRXZlbnRdID0gZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgICBmaXJlKGxvY2FsRXZlbnQsIGV2ZW50KTsKICAgICAgfTsKCiAgICAgIGlmIChpZ25vcmVkRmlsdGVyKSB7CiAgICAgICAgaWdub3JlZEZpbHRlcnNbbG9jYWxFdmVudF0gPSBpZ25vcmVkRmlsdGVyOwogICAgICB9CgogICAgICBoYW5kbGVyLiRkZWxlZ2F0ZSA9IGRlbGVnYXRlRXZlbnRzLmJpbmQobm9kZSwgRUxFTUVOVF9TRUxFQ1RPUiwgZXZlbnQsIGhhbmRsZXIpOwogICAgfQoKICAgIGZ1bmN0aW9uIHVucmVnaXN0ZXJFdmVudChub2RlLCBldmVudCwgbG9jYWxFdmVudCkgewoKICAgICAgdmFyIGhhbmRsZXIgPSBtb3VzZUhhbmRsZXIobG9jYWxFdmVudCk7CgogICAgICBpZiAoIWhhbmRsZXIpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGRlbGVnYXRlRXZlbnRzLnVuYmluZChub2RlLCBldmVudCwgaGFuZGxlci4kZGVsZWdhdGUpOwogICAgfQoKICAgIGZ1bmN0aW9uIHJlZ2lzdGVyRXZlbnRzKHN2ZykgewogICAgICBmb3JFYWNoKGJpbmRpbmdzLCBmdW5jdGlvbih2YWwsIGtleSkgewogICAgICAgIHJlZ2lzdGVyRXZlbnQoc3ZnLCBrZXksIHZhbCk7CiAgICAgIH0pOwogICAgfQoKICAgIGZ1bmN0aW9uIHVucmVnaXN0ZXJFdmVudHMoc3ZnKSB7CiAgICAgIGZvckVhY2goYmluZGluZ3MsIGZ1bmN0aW9uKHZhbCwga2V5KSB7CiAgICAgICAgdW5yZWdpc3RlckV2ZW50KHN2Zywga2V5LCB2YWwpOwogICAgICB9KTsKICAgIH0KCiAgICBldmVudEJ1cy5vbignY2FudmFzLmRlc3Ryb3knLCBmdW5jdGlvbihldmVudCkgewogICAgICB1bnJlZ2lzdGVyRXZlbnRzKGV2ZW50LnN2Zyk7CiAgICB9KTsKCiAgICBldmVudEJ1cy5vbignY2FudmFzLmluaXQnLCBmdW5jdGlvbihldmVudCkgewogICAgICByZWdpc3RlckV2ZW50cyhldmVudC5zdmcpOwogICAgfSk7CgoKICAgIC8vIGhpdCBib3ggdXBkYXRpbmcgLy8vLy8vLy8vLy8vLy8vLwoKICAgIGV2ZW50QnVzLm9uKFsgJ3NoYXBlLmFkZGVkJywgJ2Nvbm5lY3Rpb24uYWRkZWQnIF0sIGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgIHZhciBlbGVtZW50ID0gZXZlbnQuZWxlbWVudCwKICAgICAgICAgIGdmeCA9IGV2ZW50LmdmeDsKCiAgICAgIGV2ZW50QnVzLmZpcmUoJ2ludGVyYWN0aW9uRXZlbnRzLmNyZWF0ZUhpdCcsIHsgZWxlbWVudDogZWxlbWVudCwgZ2Z4OiBnZnggfSk7CiAgICB9KTsKCiAgICAvLyBVcGRhdGUgZGpzLWhpdCBvbiBjaGFuZ2UuCiAgICAvLyBBIGxvdyBwcmlvcnRpdHkgaXMgbmVjZXNzYXJ5LCBiZWNhdXNlIGRqcy1oaXQgb2YgbGFiZWxzIGhhcyB0byBiZSB1cGRhdGVkCiAgICAvLyBhZnRlciB0aGUgbGFiZWwgYm91bmRzIGhhdmUgYmVlbiB1cGRhdGVkIGluIHRoZSByZW5kZXJlci4KICAgIGV2ZW50QnVzLm9uKFsKICAgICAgJ3NoYXBlLmNoYW5nZWQnLAogICAgICAnY29ubmVjdGlvbi5jaGFuZ2VkJwogICAgXSwgTE9XX1BSSU9SSVRZLCBmdW5jdGlvbihldmVudCkgewoKICAgICAgdmFyIGVsZW1lbnQgPSBldmVudC5lbGVtZW50LAogICAgICAgICAgZ2Z4ID0gZXZlbnQuZ2Z4OwoKICAgICAgZXZlbnRCdXMuZmlyZSgnaW50ZXJhY3Rpb25FdmVudHMudXBkYXRlSGl0JywgeyBlbGVtZW50OiBlbGVtZW50LCBnZng6IGdmeCB9KTsKICAgIH0pOwoKICAgIGV2ZW50QnVzLm9uKCdpbnRlcmFjdGlvbkV2ZW50cy5jcmVhdGVIaXQnLCBMT1dfUFJJT1JJVFksIGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgIHZhciBlbGVtZW50ID0gZXZlbnQuZWxlbWVudCwKICAgICAgICAgIGdmeCA9IGV2ZW50LmdmeDsKCiAgICAgIHNlbGYuY3JlYXRlRGVmYXVsdEhpdChlbGVtZW50LCBnZngpOwogICAgfSk7CgogICAgZXZlbnRCdXMub24oJ2ludGVyYWN0aW9uRXZlbnRzLnVwZGF0ZUhpdCcsIGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgIHZhciBlbGVtZW50ID0gZXZlbnQuZWxlbWVudCwKICAgICAgICAgIGdmeCA9IGV2ZW50LmdmeDsKCiAgICAgIHNlbGYudXBkYXRlRGVmYXVsdEhpdChlbGVtZW50LCBnZngpOwogICAgfSk7CgoKICAgIC8vIGhpdCBzdHlsZXMgLy8vLy8vLy8vLy8vCgogICAgdmFyIFNUUk9LRV9ISVRfU1RZTEUgPSBjcmVhdGVIaXRTdHlsZSgnZGpzLWhpdCBkanMtaGl0LXN0cm9rZScpOwoKICAgIHZhciBDTElDS19TVFJPS0VfSElUX1NUWUxFID0gY3JlYXRlSGl0U3R5bGUoJ2Rqcy1oaXQgZGpzLWhpdC1jbGljay1zdHJva2UnKTsKCiAgICB2YXIgQUxMX0hJVF9TVFlMRSA9IGNyZWF0ZUhpdFN0eWxlKCdkanMtaGl0IGRqcy1oaXQtYWxsJyk7CgogICAgdmFyIEhJVF9UWVBFUyA9IHsKICAgICAgJ2FsbCc6IEFMTF9ISVRfU1RZTEUsCiAgICAgICdjbGljay1zdHJva2UnOiBDTElDS19TVFJPS0VfSElUX1NUWUxFLAogICAgICAnc3Ryb2tlJzogU1RST0tFX0hJVF9TVFlMRQogICAgfTsKCiAgICBmdW5jdGlvbiBjcmVhdGVIaXRTdHlsZShjbGFzc05hbWVzLCBhdHRycykgewoKICAgICAgYXR0cnMgPSBhc3NpZ24oewogICAgICAgIHN0cm9rZTogJ3doaXRlJywKICAgICAgICBzdHJva2VXaWR0aDogMTUKICAgICAgfSwgYXR0cnMgfHwge30pOwoKICAgICAgcmV0dXJuIHN0eWxlcy5jbHMoY2xhc3NOYW1lcywgWyAnbm8tZmlsbCcsICduby1ib3JkZXInIF0sIGF0dHJzKTsKICAgIH0KCgogICAgLy8gc3R5bGUgaGVscGVycyAvLy8vLy8vLy8vLy8vLy8KCiAgICBmdW5jdGlvbiBhcHBseVN0eWxlKGhpdCwgdHlwZSkgewoKICAgICAgdmFyIGF0dHJzID0gSElUX1RZUEVTW3R5cGVdOwoKICAgICAgaWYgKCFhdHRycykgewogICAgICAgIHRocm93IG5ldyBFcnJvcignaW52YWxpZCBoaXQgdHlwZSA8JyArIHR5cGUgKyAnPicpOwogICAgICB9CgogICAgICBhdHRyJDEoaGl0LCBhdHRycyk7CgogICAgICByZXR1cm4gaGl0OwogICAgfQoKICAgIGZ1bmN0aW9uIGFwcGVuZEhpdChnZngsIGhpdCkgewogICAgICBhcHBlbmQoZ2Z4LCBoaXQpOwogICAgfQoKCiAgICAvLyBBUEkKCiAgICAvKioKICAgICAqIFJlbW92ZSBoaW50cyBvbiB0aGUgZ2l2ZW4gZ3JhcGhpY3MuCiAgICAgKgogICAgICogQHBhcmFtIHtTVkdFbGVtZW50fSBnZngKICAgICAqLwogICAgdGhpcy5yZW1vdmVIaXRzID0gZnVuY3Rpb24oZ2Z4KSB7CiAgICAgIHZhciBoaXRzID0gYWxsKCcuZGpzLWhpdCcsIGdmeCk7CgogICAgICBmb3JFYWNoKGhpdHMsIHJlbW92ZSQxKTsKICAgIH07CgogICAgLyoqCiAgICAgKiBDcmVhdGUgZGVmYXVsdCBoaXQgZm9yIHRoZSBnaXZlbiBlbGVtZW50LgogICAgICoKICAgICAqIEBwYXJhbSB7ZGpzLm1vZGVsLkJhc2V9IGVsZW1lbnQKICAgICAqIEBwYXJhbSB7U1ZHRWxlbWVudH0gZ2Z4CiAgICAgKgogICAgICogQHJldHVybiB7U1ZHRWxlbWVudH0gY3JlYXRlZCBoaXQKICAgICAqLwogICAgdGhpcy5jcmVhdGVEZWZhdWx0SGl0ID0gZnVuY3Rpb24oZWxlbWVudCwgZ2Z4KSB7CiAgICAgIHZhciB3YXlwb2ludHMgPSBlbGVtZW50LndheXBvaW50cywKICAgICAgICAgIGlzRnJhbWUgPSBlbGVtZW50LmlzRnJhbWUsCiAgICAgICAgICBib3hUeXBlOwoKICAgICAgaWYgKHdheXBvaW50cykgewogICAgICAgIHJldHVybiB0aGlzLmNyZWF0ZVdheXBvaW50c0hpdChnZngsIHdheXBvaW50cyk7CiAgICAgIH0gZWxzZSB7CgogICAgICAgIGJveFR5cGUgPSBpc0ZyYW1lID8gJ3N0cm9rZScgOiAnYWxsJzsKCiAgICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlQm94SGl0KGdmeCwgYm94VHlwZSwgewogICAgICAgICAgd2lkdGg6IGVsZW1lbnQud2lkdGgsCiAgICAgICAgICBoZWlnaHQ6IGVsZW1lbnQuaGVpZ2h0CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH07CgogICAgLyoqCiAgICAgKiBDcmVhdGUgaGl0cyBmb3IgdGhlIGdpdmVuIHdheXBvaW50cy4KICAgICAqCiAgICAgKiBAcGFyYW0ge1NWR0VsZW1lbnR9IGdmeAogICAgICogQHBhcmFtIHtBcnJheTxQb2ludD59IHdheXBvaW50cwogICAgICoKICAgICAqIEByZXR1cm4ge1NWR0VsZW1lbnR9CiAgICAgKi8KICAgIHRoaXMuY3JlYXRlV2F5cG9pbnRzSGl0ID0gZnVuY3Rpb24oZ2Z4LCB3YXlwb2ludHMpIHsKCiAgICAgIHZhciBoaXQgPSBjcmVhdGVMaW5lKHdheXBvaW50cyk7CgogICAgICBhcHBseVN0eWxlKGhpdCwgJ3N0cm9rZScpOwoKICAgICAgYXBwZW5kSGl0KGdmeCwgaGl0KTsKCiAgICAgIHJldHVybiBoaXQ7CiAgICB9OwoKICAgIC8qKgogICAgICogQ3JlYXRlIGhpdHMgZm9yIGEgYm94LgogICAgICoKICAgICAqIEBwYXJhbSB7U1ZHRWxlbWVudH0gZ2Z4CiAgICAgKiBAcGFyYW0ge1N0cmluZ30gaGl0VHlwZQogICAgICogQHBhcmFtIHtPYmplY3R9IGF0dHJzCiAgICAgKgogICAgICogQHJldHVybiB7U1ZHRWxlbWVudH0KICAgICAqLwogICAgdGhpcy5jcmVhdGVCb3hIaXQgPSBmdW5jdGlvbihnZngsIHR5cGUsIGF0dHJzKSB7CgogICAgICBhdHRycyA9IGFzc2lnbih7CiAgICAgICAgeDogMCwKICAgICAgICB5OiAwCiAgICAgIH0sIGF0dHJzKTsKCiAgICAgIHZhciBoaXQgPSBjcmVhdGUoJ3JlY3QnKTsKCiAgICAgIGFwcGx5U3R5bGUoaGl0LCB0eXBlKTsKCiAgICAgIGF0dHIkMShoaXQsIGF0dHJzKTsKCiAgICAgIGFwcGVuZEhpdChnZngsIGhpdCk7CgogICAgICByZXR1cm4gaGl0OwogICAgfTsKCiAgICAvKioKICAgICAqIFVwZGF0ZSBkZWZhdWx0IGhpdCBvZiB0aGUgZWxlbWVudC4KICAgICAqCiAgICAgKiBAcGFyYW0gIHtkanMubW9kZWwuQmFzZX0gZWxlbWVudAogICAgICogQHBhcmFtICB7U1ZHRWxlbWVudH0gZ2Z4CiAgICAgKgogICAgICogQHJldHVybiB7U1ZHRWxlbWVudH0gdXBkYXRlZCBoaXQKICAgICAqLwogICAgdGhpcy51cGRhdGVEZWZhdWx0SGl0ID0gZnVuY3Rpb24oZWxlbWVudCwgZ2Z4KSB7CgogICAgICB2YXIgaGl0ID0gcXVlcnkoJy5kanMtaGl0JywgZ2Z4KTsKCiAgICAgIGlmICghaGl0KSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAoZWxlbWVudC53YXlwb2ludHMpIHsKICAgICAgICB1cGRhdGVMaW5lKGhpdCwgZWxlbWVudC53YXlwb2ludHMpOwogICAgICB9IGVsc2UgewogICAgICAgIGF0dHIkMShoaXQsIHsKICAgICAgICAgIHdpZHRoOiBlbGVtZW50LndpZHRoLAogICAgICAgICAgaGVpZ2h0OiBlbGVtZW50LmhlaWdodAogICAgICAgIH0pOwogICAgICB9CgogICAgICByZXR1cm4gaGl0OwogICAgfTsKCiAgICB0aGlzLmZpcmUgPSBmaXJlOwoKICAgIHRoaXMudHJpZ2dlck1vdXNlRXZlbnQgPSB0cmlnZ2VyTW91c2VFdmVudDsKCiAgICB0aGlzLm1vdXNlSGFuZGxlciA9IG1vdXNlSGFuZGxlcjsKCiAgICB0aGlzLnJlZ2lzdGVyRXZlbnQgPSByZWdpc3RlckV2ZW50OwogICAgdGhpcy51bnJlZ2lzdGVyRXZlbnQgPSB1bnJlZ2lzdGVyRXZlbnQ7CiAgfQoKCiAgSW50ZXJhY3Rpb25FdmVudHMuJGluamVjdCA9IFsKICAgICdldmVudEJ1cycsCiAgICAnZWxlbWVudFJlZ2lzdHJ5JywKICAgICdzdHlsZXMnCiAgXTsKCgogIC8qKgogICAqIEFuIGV2ZW50IGluZGljYXRpbmcgdGhhdCB0aGUgbW91c2UgaG92ZXJlZCBvdmVyIGFuIGVsZW1lbnQKICAgKgogICAqIEBldmVudCBlbGVtZW50LmhvdmVyCiAgICoKICAgKiBAdHlwZSB7T2JqZWN0fQogICAqIEBwcm9wZXJ0eSB7ZGpzLm1vZGVsLkJhc2V9IGVsZW1lbnQKICAgKiBAcHJvcGVydHkge1NWR0VsZW1lbnR9IGdmeAogICAqIEBwcm9wZXJ0eSB7RXZlbnR9IG9yaWdpbmFsRXZlbnQKICAgKi8KCiAgLyoqCiAgICogQW4gZXZlbnQgaW5kaWNhdGluZyB0aGF0IHRoZSBtb3VzZSBoYXMgbGVmdCBhbiBlbGVtZW50CiAgICoKICAgKiBAZXZlbnQgZWxlbWVudC5vdXQKICAgKgogICAqIEB0eXBlIHtPYmplY3R9CiAgICogQHByb3BlcnR5IHtkanMubW9kZWwuQmFzZX0gZWxlbWVudAogICAqIEBwcm9wZXJ0eSB7U1ZHRWxlbWVudH0gZ2Z4CiAgICogQHByb3BlcnR5IHtFdmVudH0gb3JpZ2luYWxFdmVudAogICAqLwoKICAvKioKICAgKiBBbiBldmVudCBpbmRpY2F0aW5nIHRoYXQgdGhlIG1vdXNlIGhhcyBjbGlja2VkIGFuIGVsZW1lbnQKICAgKgogICAqIEBldmVudCBlbGVtZW50LmNsaWNrCiAgICoKICAgKiBAdHlwZSB7T2JqZWN0fQogICAqIEBwcm9wZXJ0eSB7ZGpzLm1vZGVsLkJhc2V9IGVsZW1lbnQKICAgKiBAcHJvcGVydHkge1NWR0VsZW1lbnR9IGdmeAogICAqIEBwcm9wZXJ0eSB7RXZlbnR9IG9yaWdpbmFsRXZlbnQKICAgKi8KCiAgLyoqCiAgICogQW4gZXZlbnQgaW5kaWNhdGluZyB0aGF0IHRoZSBtb3VzZSBoYXMgZG91YmxlIGNsaWNrZWQgYW4gZWxlbWVudAogICAqCiAgICogQGV2ZW50IGVsZW1lbnQuZGJsY2xpY2sKICAgKgogICAqIEB0eXBlIHtPYmplY3R9CiAgICogQHByb3BlcnR5IHtkanMubW9kZWwuQmFzZX0gZWxlbWVudAogICAqIEBwcm9wZXJ0eSB7U1ZHRWxlbWVudH0gZ2Z4CiAgICogQHByb3BlcnR5IHtFdmVudH0gb3JpZ2luYWxFdmVudAogICAqLwoKICAvKioKICAgKiBBbiBldmVudCBpbmRpY2F0aW5nIHRoYXQgdGhlIG1vdXNlIGhhcyBnb25lIGRvd24gb24gYW4gZWxlbWVudC4KICAgKgogICAqIEBldmVudCBlbGVtZW50Lm1vdXNlZG93bgogICAqCiAgICogQHR5cGUge09iamVjdH0KICAgKiBAcHJvcGVydHkge2Rqcy5tb2RlbC5CYXNlfSBlbGVtZW50CiAgICogQHByb3BlcnR5IHtTVkdFbGVtZW50fSBnZngKICAgKiBAcHJvcGVydHkge0V2ZW50fSBvcmlnaW5hbEV2ZW50CiAgICovCgogIC8qKgogICAqIEFuIGV2ZW50IGluZGljYXRpbmcgdGhhdCB0aGUgbW91c2UgaGFzIGdvbmUgdXAgb24gYW4gZWxlbWVudC4KICAgKgogICAqIEBldmVudCBlbGVtZW50Lm1vdXNldXAKICAgKgogICAqIEB0eXBlIHtPYmplY3R9CiAgICogQHByb3BlcnR5IHtkanMubW9kZWwuQmFzZX0gZWxlbWVudAogICAqIEBwcm9wZXJ0eSB7U1ZHRWxlbWVudH0gZ2Z4CiAgICogQHByb3BlcnR5IHtFdmVudH0gb3JpZ2luYWxFdmVudAogICAqLwoKICAvKioKICAgKiBBbiBldmVudCBpbmRpY2F0aW5nIHRoYXQgdGhlIGNvbnRleHQgbWVudSBhY3Rpb24gaXMgdHJpZ2dlcmVkCiAgICogdmlhIG1vdXNlIG9yIHRvdWNoIGNvbnRyb2xzLgogICAqCiAgICogQGV2ZW50IGVsZW1lbnQuY29udGV4dG1lbnUKICAgKgogICAqIEB0eXBlIHtPYmplY3R9CiAgICogQHByb3BlcnR5IHtkanMubW9kZWwuQmFzZX0gZWxlbWVudAogICAqIEBwcm9wZXJ0eSB7U1ZHRWxlbWVudH0gZ2Z4CiAgICogQHByb3BlcnR5IHtFdmVudH0gb3JpZ2luYWxFdmVudAogICAqLwoKICB2YXIgSW50ZXJhY3Rpb25FdmVudHNNb2R1bGUgPSB7CiAgICBfX2luaXRfXzogWyAnaW50ZXJhY3Rpb25FdmVudHMnIF0sCiAgICBpbnRlcmFjdGlvbkV2ZW50czogWyAndHlwZScsIEludGVyYWN0aW9uRXZlbnRzIF0KICB9OwoKICB2YXIgTE9XX1BSSU9SSVRZJDEgPSA1MDA7CgoKICAvKioKICAgKiBAY2xhc3MKICAgKgogICAqIEEgcGx1Z2luIHRoYXQgYWRkcyBhbiBvdXRsaW5lIHRvIHNoYXBlcyBhbmQgY29ubmVjdGlvbnMgdGhhdCBtYXkgYmUgYWN0aXZhdGVkIGFuZCBzdHlsZWQKICAgKiB2aWEgQ1NTIGNsYXNzZXMuCiAgICoKICAgKiBAcGFyYW0ge0V2ZW50QnVzfSBldmVudEJ1cwogICAqIEBwYXJhbSB7U3R5bGVzfSBzdHlsZXMKICAgKiBAcGFyYW0ge0VsZW1lbnRSZWdpc3RyeX0gZWxlbWVudFJlZ2lzdHJ5CiAgICovCiAgZnVuY3Rpb24gT3V0bGluZShldmVudEJ1cywgc3R5bGVzLCBlbGVtZW50UmVnaXN0cnkpIHsKCiAgICB0aGlzLm9mZnNldCA9IDY7CgogICAgdmFyIE9VVExJTkVfU1RZTEUgPSBzdHlsZXMuY2xzKCdkanMtb3V0bGluZScsIFsgJ25vLWZpbGwnIF0pOwoKICAgIHZhciBzZWxmID0gdGhpczsKCiAgICBmdW5jdGlvbiBjcmVhdGVPdXRsaW5lKGdmeCwgYm91bmRzKSB7CiAgICAgIHZhciBvdXRsaW5lID0gY3JlYXRlKCdyZWN0Jyk7CgogICAgICBhdHRyJDEob3V0bGluZSwgYXNzaWduKHsKICAgICAgICB4OiAxMCwKICAgICAgICB5OiAxMCwKICAgICAgICB3aWR0aDogMTAwLAogICAgICAgIGhlaWdodDogMTAwCiAgICAgIH0sIE9VVExJTkVfU1RZTEUpKTsKCiAgICAgIGFwcGVuZChnZngsIG91dGxpbmUpOwoKICAgICAgcmV0dXJuIG91dGxpbmU7CiAgICB9CgogICAgLy8gQSBsb3cgcHJpb3J0aXR5IGlzIG5lY2Vzc2FyeSwgYmVjYXVzZSBvdXRsaW5lcyBvZiBsYWJlbHMgaGF2ZSB0byBiZSB1cGRhdGVkCiAgICAvLyBhZnRlciB0aGUgbGFiZWwgYm91bmRzIGhhdmUgYmVlbiB1cGRhdGVkIGluIHRoZSByZW5kZXJlci4KICAgIGV2ZW50QnVzLm9uKFsgJ3NoYXBlLmFkZGVkJywgJ3NoYXBlLmNoYW5nZWQnIF0sIExPV19QUklPUklUWSQxLCBmdW5jdGlvbihldmVudCkgewogICAgICB2YXIgZWxlbWVudCA9IGV2ZW50LmVsZW1lbnQsCiAgICAgICAgICBnZnggPSBldmVudC5nZng7CgogICAgICB2YXIgb3V0bGluZSA9IHF1ZXJ5KCcuZGpzLW91dGxpbmUnLCBnZngpOwoKICAgICAgaWYgKCFvdXRsaW5lKSB7CiAgICAgICAgb3V0bGluZSA9IGNyZWF0ZU91dGxpbmUoZ2Z4KTsKICAgICAgfQoKICAgICAgc2VsZi51cGRhdGVTaGFwZU91dGxpbmUob3V0bGluZSwgZWxlbWVudCk7CiAgICB9KTsKCiAgICBldmVudEJ1cy5vbihbICdjb25uZWN0aW9uLmFkZGVkJywgJ2Nvbm5lY3Rpb24uY2hhbmdlZCcgXSwgZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgdmFyIGVsZW1lbnQgPSBldmVudC5lbGVtZW50LAogICAgICAgICAgZ2Z4ID0gZXZlbnQuZ2Z4OwoKICAgICAgdmFyIG91dGxpbmUgPSBxdWVyeSgnLmRqcy1vdXRsaW5lJywgZ2Z4KTsKCiAgICAgIGlmICghb3V0bGluZSkgewogICAgICAgIG91dGxpbmUgPSBjcmVhdGVPdXRsaW5lKGdmeCk7CiAgICAgIH0KCiAgICAgIHNlbGYudXBkYXRlQ29ubmVjdGlvbk91dGxpbmUob3V0bGluZSwgZWxlbWVudCk7CiAgICB9KTsKICB9CgoKICAvKioKICAgKiBVcGRhdGVzIHRoZSBvdXRsaW5lIG9mIGEgc2hhcGUgcmVzcGVjdGluZyB0aGUgZGltZW5zaW9uIG9mIHRoZQogICAqIGVsZW1lbnQgYW5kIGFuIG91dGxpbmUgb2Zmc2V0LgogICAqCiAgICogQHBhcmFtICB7U1ZHRWxlbWVudH0gb3V0bGluZQogICAqIEBwYXJhbSAge2Rqcy5tb2RlbC5CYXNlfSBlbGVtZW50CiAgICovCiAgT3V0bGluZS5wcm90b3R5cGUudXBkYXRlU2hhcGVPdXRsaW5lID0gZnVuY3Rpb24ob3V0bGluZSwgZWxlbWVudCkgewoKICAgIGF0dHIkMShvdXRsaW5lLCB7CiAgICAgIHg6IC10aGlzLm9mZnNldCwKICAgICAgeTogLXRoaXMub2Zmc2V0LAogICAgICB3aWR0aDogZWxlbWVudC53aWR0aCArIHRoaXMub2Zmc2V0ICogMiwKICAgICAgaGVpZ2h0OiBlbGVtZW50LmhlaWdodCArIHRoaXMub2Zmc2V0ICogMgogICAgfSk7CgogIH07CgoKICAvKioKICAgKiBVcGRhdGVzIHRoZSBvdXRsaW5lIG9mIGEgY29ubmVjdGlvbiByZXNwZWN0aW5nIHRoZSBib3VuZGluZyBib3ggb2YKICAgKiB0aGUgY29ubmVjdGlvbiBhbmQgYW4gb3V0bGluZSBvZmZzZXQuCiAgICoKICAgKiBAcGFyYW0gIHtTVkdFbGVtZW50fSBvdXRsaW5lCiAgICogQHBhcmFtICB7ZGpzLm1vZGVsLkJhc2V9IGVsZW1lbnQKICAgKi8KICBPdXRsaW5lLnByb3RvdHlwZS51cGRhdGVDb25uZWN0aW9uT3V0bGluZSA9IGZ1bmN0aW9uKG91dGxpbmUsIGNvbm5lY3Rpb24pIHsKCiAgICB2YXIgYmJveCA9IGdldEJCb3goY29ubmVjdGlvbik7CgogICAgYXR0ciQxKG91dGxpbmUsIHsKICAgICAgeDogYmJveC54IC0gdGhpcy5vZmZzZXQsCiAgICAgIHk6IGJib3gueSAtIHRoaXMub2Zmc2V0LAogICAgICB3aWR0aDogYmJveC53aWR0aCArIHRoaXMub2Zmc2V0ICogMiwKICAgICAgaGVpZ2h0OiBiYm94LmhlaWdodCArIHRoaXMub2Zmc2V0ICogMgogICAgfSk7CgogIH07CgoKICBPdXRsaW5lLiRpbmplY3QgPSBbJ2V2ZW50QnVzJywgJ3N0eWxlcycsICdlbGVtZW50UmVnaXN0cnknXTsKCiAgdmFyIE91dGxpbmVNb2R1bGUgPSB7CiAgICBfX2luaXRfXzogWyAnb3V0bGluZScgXSwKICAgIG91dGxpbmU6IFsgJ3R5cGUnLCBPdXRsaW5lIF0KICB9OwoKICAvKioKICAgKiBBIHNlcnZpY2UgdGhhdCBvZmZlcnMgdGhlIGN1cnJlbnQgc2VsZWN0aW9uIGluIGEgZGlhZ3JhbS4KICAgKiBPZmZlcnMgdGhlIGFwaSB0byBjb250cm9sIHRoZSBzZWxlY3Rpb24sIHRvby4KICAgKgogICAqIEBjbGFzcwogICAqCiAgICogQHBhcmFtIHtFdmVudEJ1c30gZXZlbnRCdXMgdGhlIGV2ZW50IGJ1cwogICAqLwogIGZ1bmN0aW9uIFNlbGVjdGlvbihldmVudEJ1cykgewoKICAgIHRoaXMuX2V2ZW50QnVzID0gZXZlbnRCdXM7CgogICAgdGhpcy5fc2VsZWN0ZWRFbGVtZW50cyA9IFtdOwoKICAgIHZhciBzZWxmID0gdGhpczsKCiAgICBldmVudEJ1cy5vbihbICdzaGFwZS5yZW1vdmUnLCAnY29ubmVjdGlvbi5yZW1vdmUnIF0sIGZ1bmN0aW9uKGUpIHsKICAgICAgdmFyIGVsZW1lbnQgPSBlLmVsZW1lbnQ7CiAgICAgIHNlbGYuZGVzZWxlY3QoZWxlbWVudCk7CiAgICB9KTsKCiAgICBldmVudEJ1cy5vbihbICdkaWFncmFtLmNsZWFyJyBdLCBmdW5jdGlvbihlKSB7CiAgICAgIHNlbGYuc2VsZWN0KG51bGwpOwogICAgfSk7CiAgfQoKICBTZWxlY3Rpb24uJGluamVjdCA9IFsgJ2V2ZW50QnVzJyBdOwoKCiAgU2VsZWN0aW9uLnByb3RvdHlwZS5kZXNlbGVjdCA9IGZ1bmN0aW9uKGVsZW1lbnQpIHsKICAgIHZhciBzZWxlY3RlZEVsZW1lbnRzID0gdGhpcy5fc2VsZWN0ZWRFbGVtZW50czsKCiAgICB2YXIgaWR4ID0gc2VsZWN0ZWRFbGVtZW50cy5pbmRleE9mKGVsZW1lbnQpOwoKICAgIGlmIChpZHggIT09IC0xKSB7CiAgICAgIHZhciBvbGRTZWxlY3Rpb24gPSBzZWxlY3RlZEVsZW1lbnRzLnNsaWNlKCk7CgogICAgICBzZWxlY3RlZEVsZW1lbnRzLnNwbGljZShpZHgsIDEpOwoKICAgICAgdGhpcy5fZXZlbnRCdXMuZmlyZSgnc2VsZWN0aW9uLmNoYW5nZWQnLCB7IG9sZFNlbGVjdGlvbjogb2xkU2VsZWN0aW9uLCBuZXdTZWxlY3Rpb246IHNlbGVjdGVkRWxlbWVudHMgfSk7CiAgICB9CiAgfTsKCgogIFNlbGVjdGlvbi5wcm90b3R5cGUuZ2V0ID0gZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gdGhpcy5fc2VsZWN0ZWRFbGVtZW50czsKICB9OwoKICBTZWxlY3Rpb24ucHJvdG90eXBlLmlzU2VsZWN0ZWQgPSBmdW5jdGlvbihlbGVtZW50KSB7CiAgICByZXR1cm4gdGhpcy5fc2VsZWN0ZWRFbGVtZW50cy5pbmRleE9mKGVsZW1lbnQpICE9PSAtMTsKICB9OwoKCiAgLyoqCiAgICogVGhpcyBtZXRob2Qgc2VsZWN0cyBvbmUgb3IgbW9yZSBlbGVtZW50cyBvbiB0aGUgZGlhZ3JhbS4KICAgKgogICAqIEJ5IHBhc3NpbmcgYW4gYWRkaXRpb25hbCBhZGQgcGFyYW1ldGVyIHlvdSBjYW4gZGVjaWRlIHdoZXRoZXIgb3Igbm90IHRoZSBlbGVtZW50KHMpCiAgICogc2hvdWxkIGJlIGFkZGVkIHRvIHRoZSBhbHJlYWR5IGV4aXN0aW5nIHNlbGVjdGlvbiBvciBub3QuCiAgICoKICAgKiBAbWV0aG9kIFNlbGVjdGlvbiNzZWxlY3QKICAgKgogICAqIEBwYXJhbSAge09iamVjdHxPYmplY3RbXX0gZWxlbWVudHMgZWxlbWVudCBvciBhcnJheSBvZiBlbGVtZW50cyB0byBiZSBzZWxlY3RlZAogICAqIEBwYXJhbSAge2Jvb2xlYW59IFthZGRdIHdoZXRoZXIgdGhlIGVsZW1lbnQocykgc2hvdWxkIGJlIGFwcGVuZGVkIHRvIHRoZSBjdXJyZW50IHNlbGVjdGlvbiwgZGVmYXVsdHMgdG8gZmFsc2UKICAgKi8KICBTZWxlY3Rpb24ucHJvdG90eXBlLnNlbGVjdCA9IGZ1bmN0aW9uKGVsZW1lbnRzLCBhZGQpIHsKICAgIHZhciBzZWxlY3RlZEVsZW1lbnRzID0gdGhpcy5fc2VsZWN0ZWRFbGVtZW50cywKICAgICAgICBvbGRTZWxlY3Rpb24gPSBzZWxlY3RlZEVsZW1lbnRzLnNsaWNlKCk7CgogICAgaWYgKCFpc0FycmF5KGVsZW1lbnRzKSkgewogICAgICBlbGVtZW50cyA9IGVsZW1lbnRzID8gWyBlbGVtZW50cyBdIDogW107CiAgICB9CgogICAgLy8gc2VsZWN0aW9uIG1heSBiZSBjbGVhcmVkIGJ5IHBhc3NpbmcgYW4gZW1wdHkgYXJyYXkgb3IgbnVsbAogICAgLy8gdG8gdGhlIG1ldGhvZAogICAgaWYgKGFkZCkgewogICAgICBmb3JFYWNoKGVsZW1lbnRzLCBmdW5jdGlvbihlbGVtZW50KSB7CiAgICAgICAgaWYgKHNlbGVjdGVkRWxlbWVudHMuaW5kZXhPZihlbGVtZW50KSAhPT0gLTEpIHsKCiAgICAgICAgICAvLyBhbHJlYWR5IHNlbGVjdGVkCiAgICAgICAgICByZXR1cm47CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHNlbGVjdGVkRWxlbWVudHMucHVzaChlbGVtZW50KTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5fc2VsZWN0ZWRFbGVtZW50cyA9IHNlbGVjdGVkRWxlbWVudHMgPSBlbGVtZW50cy5zbGljZSgpOwogICAgfQoKICAgIHRoaXMuX2V2ZW50QnVzLmZpcmUoJ3NlbGVjdGlvbi5jaGFuZ2VkJywgeyBvbGRTZWxlY3Rpb246IG9sZFNlbGVjdGlvbiwgbmV3U2VsZWN0aW9uOiBzZWxlY3RlZEVsZW1lbnRzIH0pOwogIH07CgogIHZhciBNQVJLRVJfSE9WRVIgPSAnaG92ZXInLAogICAgICBNQVJLRVJfU0VMRUNURUQgPSAnc2VsZWN0ZWQnOwoKCiAgLyoqCiAgICogQSBwbHVnaW4gdGhhdCBhZGRzIGEgdmlzaWJsZSBzZWxlY3Rpb24gVUkgdG8gc2hhcGVzIGFuZCBjb25uZWN0aW9ucwogICAqIGJ5IGFwcGVuZGluZyB0aGUgPGNvZGU+aG92ZXI8L2NvZGU+IGFuZCA8Y29kZT5zZWxlY3RlZDwvY29kZT4gY2xhc3NlcyB0byB0aGVtLgogICAqCiAgICogQGNsYXNzCiAgICoKICAgKiBNYWtlcyBlbGVtZW50cyBzZWxlY3RhYmxlLCB0b28uCiAgICoKICAgKiBAcGFyYW0ge0V2ZW50QnVzfSBldmVudHMKICAgKiBAcGFyYW0ge1NlbGVjdGlvblNlcnZpY2V9IHNlbGVjdGlvbgogICAqIEBwYXJhbSB7Q2FudmFzfSBjYW52YXMKICAgKi8KICBmdW5jdGlvbiBTZWxlY3Rpb25WaXN1YWxzKGV2ZW50cywgY2FudmFzLCBzZWxlY3Rpb24sIHN0eWxlcykgewoKICAgIHRoaXMuX211bHRpU2VsZWN0aW9uQm94ID0gbnVsbDsKCiAgICBmdW5jdGlvbiBhZGRNYXJrZXIoZSwgY2xzKSB7CiAgICAgIGNhbnZhcy5hZGRNYXJrZXIoZSwgY2xzKTsKICAgIH0KCiAgICBmdW5jdGlvbiByZW1vdmVNYXJrZXIoZSwgY2xzKSB7CiAgICAgIGNhbnZhcy5yZW1vdmVNYXJrZXIoZSwgY2xzKTsKICAgIH0KCiAgICBldmVudHMub24oJ2VsZW1lbnQuaG92ZXInLCBmdW5jdGlvbihldmVudCkgewogICAgICBhZGRNYXJrZXIoZXZlbnQuZWxlbWVudCwgTUFSS0VSX0hPVkVSKTsKICAgIH0pOwoKICAgIGV2ZW50cy5vbignZWxlbWVudC5vdXQnLCBmdW5jdGlvbihldmVudCkgewogICAgICByZW1vdmVNYXJrZXIoZXZlbnQuZWxlbWVudCwgTUFSS0VSX0hPVkVSKTsKICAgIH0pOwoKICAgIGV2ZW50cy5vbignc2VsZWN0aW9uLmNoYW5nZWQnLCBmdW5jdGlvbihldmVudCkgewoKICAgICAgZnVuY3Rpb24gZGVzZWxlY3QocykgewogICAgICAgIHJlbW92ZU1hcmtlcihzLCBNQVJLRVJfU0VMRUNURUQpOwogICAgICB9CgogICAgICBmdW5jdGlvbiBzZWxlY3QocykgewogICAgICAgIGFkZE1hcmtlcihzLCBNQVJLRVJfU0VMRUNURUQpOwogICAgICB9CgogICAgICB2YXIgb2xkU2VsZWN0aW9uID0gZXZlbnQub2xkU2VsZWN0aW9uLAogICAgICAgICAgbmV3U2VsZWN0aW9uID0gZXZlbnQubmV3U2VsZWN0aW9uOwoKICAgICAgZm9yRWFjaChvbGRTZWxlY3Rpb24sIGZ1bmN0aW9uKGUpIHsKICAgICAgICBpZiAobmV3U2VsZWN0aW9uLmluZGV4T2YoZSkgPT09IC0xKSB7CiAgICAgICAgICBkZXNlbGVjdChlKTsKICAgICAgICB9CiAgICAgIH0pOwoKICAgICAgZm9yRWFjaChuZXdTZWxlY3Rpb24sIGZ1bmN0aW9uKGUpIHsKICAgICAgICBpZiAob2xkU2VsZWN0aW9uLmluZGV4T2YoZSkgPT09IC0xKSB7CiAgICAgICAgICBzZWxlY3QoZSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0pOwogIH0KCiAgU2VsZWN0aW9uVmlzdWFscy4kaW5qZWN0ID0gWwogICAgJ2V2ZW50QnVzJywKICAgICdjYW52YXMnLAogICAgJ3NlbGVjdGlvbicsCiAgICAnc3R5bGVzJwogIF07CgogIGZ1bmN0aW9uIFNlbGVjdGlvbkJlaGF2aW9yKAogICAgICBldmVudEJ1cywgc2VsZWN0aW9uLCBjYW52YXMsCiAgICAgIGVsZW1lbnRSZWdpc3RyeSkgewoKICAgIGV2ZW50QnVzLm9uKCdjcmVhdGUuZW5kJywgNTAwLCBmdW5jdGlvbihlKSB7CgogICAgICB2YXIgY29udGV4dCA9IGUuY29udGV4dCwKICAgICAgICAgIGNhbkV4ZWN1dGUgPSBjb250ZXh0LmNhbkV4ZWN1dGUsCiAgICAgICAgICBlbGVtZW50cyA9IGNvbnRleHQuZWxlbWVudHMsCiAgICAgICAgICBoaW50cyA9IGNvbnRleHQuaGludHMgfHwge30sCiAgICAgICAgICBhdXRvU2VsZWN0ID0gaGludHMuYXV0b1NlbGVjdDsKCiAgICAgIC8vIHNlbGVjdCBlbGVtZW50cyBhZnRlciB0aGV5IGhhdmUgYmVlbiBjcmVhdGVkCiAgICAgIGlmIChjYW5FeGVjdXRlKSB7CiAgICAgICAgaWYgKGF1dG9TZWxlY3QgPT09IGZhbHNlKSB7CgogICAgICAgICAgLy8gc2VsZWN0IG5vIGVsZW1lbnRzCiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBpZiAoaXNBcnJheShhdXRvU2VsZWN0KSkgewogICAgICAgICAgc2VsZWN0aW9uLnNlbGVjdChhdXRvU2VsZWN0KTsKICAgICAgICB9IGVsc2UgewoKICAgICAgICAgIC8vIHNlbGVjdCBhbGwgZWxlbWVudHMgYnkgZGVmYXVsdAogICAgICAgICAgc2VsZWN0aW9uLnNlbGVjdChlbGVtZW50cyk7CiAgICAgICAgfQogICAgICB9CiAgICB9KTsKCiAgICBldmVudEJ1cy5vbignY29ubmVjdC5lbmQnLCA1MDAsIGZ1bmN0aW9uKGUpIHsKCiAgICAgIC8vIHNlbGVjdCB0aGUgY29ubmVjdCBlbmQgdGFyZ2V0CiAgICAgIC8vIGFmdGVyIGEgY29ubmVjdCBvcGVyYXRpb24KICAgICAgaWYgKGUuY29udGV4dC5jYW5FeGVjdXRlICYmIGUuY29udGV4dC50YXJnZXQpIHsKICAgICAgICBzZWxlY3Rpb24uc2VsZWN0KGUuY29udGV4dC50YXJnZXQpOwogICAgICB9CiAgICB9KTsKCiAgICBldmVudEJ1cy5vbignc2hhcGUubW92ZS5lbmQnLCA1MDAsIGZ1bmN0aW9uKGUpIHsKICAgICAgdmFyIHByZXZpb3VzU2VsZWN0aW9uID0gZS5wcmV2aW91c1NlbGVjdGlvbiB8fCBbXTsKCiAgICAgIHZhciBzaGFwZSA9IGVsZW1lbnRSZWdpc3RyeS5nZXQoZS5jb250ZXh0LnNoYXBlLmlkKTsKCiAgICAgIC8vIG1ha2Ugc3VyZSBhdCBsZWFzdCB0aGUgbWFpbiBtb3ZlZCBlbGVtZW50IGlzIGJlaW5nCiAgICAgIC8vIHNlbGVjdGVkIGFmdGVyIGEgbW92ZSBvcGVyYXRpb24KICAgICAgdmFyIGluU2VsZWN0aW9uID0gZmluZChwcmV2aW91c1NlbGVjdGlvbiwgZnVuY3Rpb24oc2VsZWN0ZWRTaGFwZSkgewogICAgICAgIHJldHVybiBzaGFwZS5pZCA9PT0gc2VsZWN0ZWRTaGFwZS5pZDsKICAgICAgfSk7CgogICAgICBpZiAoIWluU2VsZWN0aW9uKSB7CiAgICAgICAgc2VsZWN0aW9uLnNlbGVjdChzaGFwZSk7CiAgICAgIH0KICAgIH0pOwoKICAgIC8vIFNoaWZ0ICsgY2xpY2sgc2VsZWN0aW9uCiAgICBldmVudEJ1cy5vbignZWxlbWVudC5jbGljaycsIGZ1bmN0aW9uKGV2ZW50KSB7CgogICAgICB2YXIgZWxlbWVudCA9IGV2ZW50LmVsZW1lbnQ7CgogICAgICAvLyBkbyBub3Qgc2VsZWN0IHRoZSByb290IGVsZW1lbnQKICAgICAgLy8gb3IgY29ubmVjdGlvbnMKICAgICAgaWYgKGVsZW1lbnQgPT09IGNhbnZhcy5nZXRSb290RWxlbWVudCgpKSB7CiAgICAgICAgZWxlbWVudCA9IG51bGw7CiAgICAgIH0KCiAgICAgIHZhciBpc1NlbGVjdGVkID0gc2VsZWN0aW9uLmlzU2VsZWN0ZWQoZWxlbWVudCksCiAgICAgICAgICBpc011bHRpU2VsZWN0ID0gc2VsZWN0aW9uLmdldCgpLmxlbmd0aCA+IDE7CgogICAgICAvLyBtb3VzZS1ldmVudDogU0VMRUNUSU9OX0tFWQogICAgICB2YXIgYWRkID0gaGFzUHJpbWFyeU1vZGlmaWVyKGV2ZW50KTsKCiAgICAgIC8vIHNlbGVjdCBPUiBkZXNlbGVjdCBlbGVtZW50IGluIG11bHRpIHNlbGVjdGlvbgogICAgICBpZiAoaXNTZWxlY3RlZCAmJiBpc011bHRpU2VsZWN0KSB7CiAgICAgICAgaWYgKGFkZCkgewogICAgICAgICAgcmV0dXJuIHNlbGVjdGlvbi5kZXNlbGVjdChlbGVtZW50KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmV0dXJuIHNlbGVjdGlvbi5zZWxlY3QoZWxlbWVudCk7CiAgICAgICAgfQogICAgICB9IGVsc2UKICAgICAgaWYgKCFpc1NlbGVjdGVkKSB7CiAgICAgICAgc2VsZWN0aW9uLnNlbGVjdChlbGVtZW50LCBhZGQpOwogICAgICB9IGVsc2UgewogICAgICAgIHNlbGVjdGlvbi5kZXNlbGVjdChlbGVtZW50KTsKICAgICAgfQogICAgfSk7CiAgfQoKICBTZWxlY3Rpb25CZWhhdmlvci4kaW5qZWN0ID0gWwogICAgJ2V2ZW50QnVzJywKICAgICdzZWxlY3Rpb24nLAogICAgJ2NhbnZhcycsCiAgICAnZWxlbWVudFJlZ2lzdHJ5JwogIF07CgogIHZhciBTZWxlY3Rpb25Nb2R1bGUgPSB7CiAgICBfX2luaXRfXzogWyAnc2VsZWN0aW9uVmlzdWFscycsICdzZWxlY3Rpb25CZWhhdmlvcicgXSwKICAgIF9fZGVwZW5kc19fOiBbCiAgICAgIEludGVyYWN0aW9uRXZlbnRzTW9kdWxlLAogICAgICBPdXRsaW5lTW9kdWxlCiAgICBdLAogICAgc2VsZWN0aW9uOiBbICd0eXBlJywgU2VsZWN0aW9uIF0sCiAgICBzZWxlY3Rpb25WaXN1YWxzOiBbICd0eXBlJywgU2VsZWN0aW9uVmlzdWFscyBdLAogICAgc2VsZWN0aW9uQmVoYXZpb3I6IFsgJ3R5cGUnLCBTZWxlY3Rpb25CZWhhdmlvciBdCiAgfTsKCiAgLyoqCiAgICogVXRpbCB0aGF0IHByb3ZpZGVzIHVuaXF1ZSBJRHMuCiAgICoKICAgKiBAY2xhc3MgZGpzLnV0aWwuSWRHZW5lcmF0b3IKICAgKiBAY29uc3RydWN0b3IKICAgKiBAbWVtYmVyT2YgZGpzLnV0aWwKICAgKgogICAqIFRoZSBpZHMgY2FuIGJlIGN1c3RvbWl6ZWQgdmlhIGEgZ2l2ZW4gcHJlZml4IGFuZCBjb250YWluIGEgcmFuZG9tIHZhbHVlIHRvIGF2b2lkIGNvbGxpc2lvbnMuCiAgICoKICAgKiBAcGFyYW0ge1N0cmluZ30gcHJlZml4IGEgcHJlZml4IHRvIHByZXBlbmQgdG8gZ2VuZXJhdGVkIGlkcyAoZm9yIGJldHRlciByZWFkYWJpbGl0eSkKICAgKi8KICBmdW5jdGlvbiBJZEdlbmVyYXRvcihwcmVmaXgpIHsKCiAgICB0aGlzLl9jb3VudGVyID0gMDsKICAgIHRoaXMuX3ByZWZpeCA9IChwcmVmaXggPyBwcmVmaXggKyAnLScgOiAnJykgKyBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMDAwMDAwMDAwKSArICctJzsKICB9CgogIC8qKgogICAqIFJldHVybnMgYSBuZXh0IHVuaXF1ZSBJRC4KICAgKgogICAqIEBtZXRob2QgZGpzLnV0aWwuSWRHZW5lcmF0b3IjbmV4dAogICAqCiAgICogQHJldHVybnMge1N0cmluZ30gdGhlIGlkCiAgICovCiAgSWRHZW5lcmF0b3IucHJvdG90eXBlLm5leHQgPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiB0aGlzLl9wcmVmaXggKyAoKyt0aGlzLl9jb3VudGVyKTsKICB9OwoKICAvLyBkb2N1bWVudCB3aWRlIHVuaXF1ZSBvdmVybGF5IGlkcwogIHZhciBpZHMgPSBuZXcgSWRHZW5lcmF0b3IoJ292Jyk7CgogIHZhciBMT1dfUFJJT1JJVFkkMiA9IDUwMDsKCgogIC8qKgogICAqIEEgc2VydmljZSB0aGF0IGFsbG93cyB1c2VycyB0byBhdHRhY2ggb3ZlcmxheXMgdG8gZGlhZ3JhbSBlbGVtZW50cy4KICAgKgogICAqIFRoZSBvdmVybGF5IHNlcnZpY2Ugd2lsbCB0YWtlIGNhcmUgb2Ygb3ZlcmxheSBwb3NpdGlvbmluZyBkdXJpbmcgdXBkYXRlcy4KICAgKgogICAqIEBleGFtcGxlCiAgICoKICAgKiAvLyBhZGQgYSBwaW5rIGJhZGdlIG9uIHRoZSB0b3AgbGVmdCBvZiB0aGUgc2hhcGUKICAgKiBvdmVybGF5cy5hZGQoc29tZVNoYXBlLCB7CiAgICogICBwb3NpdGlvbjogewogICAqICAgICB0b3A6IC01LAogICAqICAgICBsZWZ0OiAtNQogICAqICAgfSwKICAgKiAgIGh0bWw6ICc8ZGl2IHN0eWxlPSJ3aWR0aDogMTBweDsgYmFja2dyb3VuZDogZnVjaHNpYTsgY29sb3I6IHdoaXRlOyI+MDwvZGl2PicKICAgKiB9KTsKICAgKgogICAqIC8vIG9yIGFkZCB2aWEgc2hhcGUgaWQKICAgKgogICAqIG92ZXJsYXlzLmFkZCgnc29tZS1lbGVtZW50LWlkJywgewogICAqICAgcG9zaXRpb246IHsKICAgKiAgICAgdG9wOiAtNSwKICAgKiAgICAgbGVmdDogLTUKICAgKiAgIH0KICAgKiAgIGh0bWw6ICc8ZGl2IHN0eWxlPSJ3aWR0aDogMTBweDsgYmFja2dyb3VuZDogZnVjaHNpYTsgY29sb3I6IHdoaXRlOyI+MDwvZGl2PicKICAgKiB9KTsKICAgKgogICAqIC8vIG9yIGFkZCB3aXRoIG9wdGlvbmFsIHR5cGUKICAgKgogICAqIG92ZXJsYXlzLmFkZChzb21lU2hhcGUsICdiYWRnZScsIHsKICAgKiAgIHBvc2l0aW9uOiB7CiAgICogICAgIHRvcDogLTUsCiAgICogICAgIGxlZnQ6IC01CiAgICogICB9CiAgICogICBodG1sOiAnPGRpdiBzdHlsZT0id2lkdGg6IDEwcHg7IGJhY2tncm91bmQ6IGZ1Y2hzaWE7IGNvbG9yOiB3aGl0ZTsiPjA8L2Rpdj4nCiAgICogfSk7CiAgICoKICAgKgogICAqIC8vIHJlbW92ZSBhbiBvdmVybGF5CiAgICoKICAgKiB2YXIgaWQgPSBvdmVybGF5cy5hZGQoLi4uKTsKICAgKiBvdmVybGF5cy5yZW1vdmUoaWQpOwogICAqCiAgICoKICAgKiBZb3UgbWF5IGNvbmZpZ3VyZSBvdmVybGF5IGRlZmF1bHRzIGR1cmluZyB0b29sIGJ5IHByb3ZpZGluZyBhIGBjb25maWdgIG1vZHVsZQogICAqIHdpdGggYG92ZXJsYXlzLmRlZmF1bHRzYCBhcyBhbiBlbnRyeToKICAgKgogICAqIHsKICAgKiAgIG92ZXJsYXlzOiB7CiAgICogICAgIGRlZmF1bHRzOiB7CiAgICogICAgICAgc2hvdzogewogICAqICAgICAgICAgbWluWm9vbTogMC43LAogICAqICAgICAgICAgbWF4Wm9vbTogNS4wCiAgICogICAgICAgfSwKICAgKiAgICAgICBzY2FsZTogewogICAqICAgICAgICAgbWluOiAxCiAgICogICAgICAgfQogICAqICAgICB9CiAgICogfQogICAqCiAgICogQHBhcmFtIHtPYmplY3R9IGNvbmZpZwogICAqIEBwYXJhbSB7RXZlbnRCdXN9IGV2ZW50QnVzCiAgICogQHBhcmFtIHtDYW52YXN9IGNhbnZhcwogICAqIEBwYXJhbSB7RWxlbWVudFJlZ2lzdHJ5fSBlbGVtZW50UmVnaXN0cnkKICAgKi8KICBmdW5jdGlvbiBPdmVybGF5cyhjb25maWcsIGV2ZW50QnVzLCBjYW52YXMsIGVsZW1lbnRSZWdpc3RyeSkgewoKICAgIHRoaXMuX2V2ZW50QnVzID0gZXZlbnRCdXM7CiAgICB0aGlzLl9jYW52YXMgPSBjYW52YXM7CiAgICB0aGlzLl9lbGVtZW50UmVnaXN0cnkgPSBlbGVtZW50UmVnaXN0cnk7CgogICAgdGhpcy5faWRzID0gaWRzOwoKICAgIHRoaXMuX292ZXJsYXlEZWZhdWx0cyA9IGFzc2lnbih7CgogICAgICAvLyBubyBzaG93IGNvbnN0cmFpbnRzCiAgICAgIHNob3c6IG51bGwsCgogICAgICAvLyBhbHdheXMgc2NhbGUKICAgICAgc2NhbGU6IHRydWUKICAgIH0sIGNvbmZpZyAmJiBjb25maWcuZGVmYXVsdHMpOwoKICAgIC8qKgogICAgICogTWFwcGluZyBvdmVybGF5SWQgLT4gb3ZlcmxheQogICAgICovCiAgICB0aGlzLl9vdmVybGF5cyA9IHt9OwoKICAgIC8qKgogICAgICogTWFwcGluZyBlbGVtZW50SWQgLT4gb3ZlcmxheSBjb250YWluZXIKICAgICAqLwogICAgdGhpcy5fb3ZlcmxheUNvbnRhaW5lcnMgPSBbXTsKCiAgICAvLyByb290IGh0bWwgZWxlbWVudCBmb3IgYWxsIG92ZXJsYXlzCiAgICB0aGlzLl9vdmVybGF5Um9vdCA9IGNyZWF0ZVJvb3QoY2FudmFzLmdldENvbnRhaW5lcigpKTsKCiAgICB0aGlzLl9pbml0KCk7CiAgfQoKCiAgT3ZlcmxheXMuJGluamVjdCA9IFsKICAgICdjb25maWcub3ZlcmxheXMnLAogICAgJ2V2ZW50QnVzJywKICAgICdjYW52YXMnLAogICAgJ2VsZW1lbnRSZWdpc3RyeScKICBdOwoKCiAgLyoqCiAgICogUmV0dXJucyB0aGUgb3ZlcmxheSB3aXRoIHRoZSBzcGVjaWZpZWQgaWQgb3IgYSBsaXN0IG9mIG92ZXJsYXlzCiAgICogZm9yIGFuIGVsZW1lbnQgd2l0aCBhIGdpdmVuIHR5cGUuCiAgICoKICAgKiBAZXhhbXBsZQogICAqCiAgICogLy8gcmV0dXJuIHRoZSBzaW5nbGUgb3ZlcmxheSB3aXRoIHRoZSBnaXZlbiBpZAogICAqIG92ZXJsYXlzLmdldCgnc29tZS1pZCcpOwogICAqCiAgICogLy8gcmV0dXJuIGFsbCBvdmVybGF5cyBmb3IgdGhlIHNoYXBlCiAgICogb3ZlcmxheXMuZ2V0KHsgZWxlbWVudDogc29tZVNoYXBlIH0pOwogICAqCiAgICogLy8gcmV0dXJuIGFsbCBvdmVybGF5cyBvbiBzaGFwZSB3aXRoIHR5cGUgJ2JhZGdlJwogICAqIG92ZXJsYXlzLmdldCh7IGVsZW1lbnQ6IHNvbWVTaGFwZSwgdHlwZTogJ2JhZGdlJyB9KTsKICAgKgogICAqIC8vIHNoYXBlIGNhbiBhbHNvIGJlIHNwZWNpZmllZCBhcyBpZAogICAqIG92ZXJsYXlzLmdldCh7IGVsZW1lbnQ6ICdlbGVtZW50LWlkJywgdHlwZTogJ2JhZGdlJyB9KTsKICAgKgogICAqCiAgICogQHBhcmFtIHtPYmplY3R9IHNlYXJjaAogICAqIEBwYXJhbSB7U3RyaW5nfSBbc2VhcmNoLmlkXQogICAqIEBwYXJhbSB7U3RyaW5nfGRqcy5tb2RlbC5CYXNlfSBbc2VhcmNoLmVsZW1lbnRdCiAgICogQHBhcmFtIHtTdHJpbmd9IFtzZWFyY2gudHlwZV0KICAgKgogICAqIEByZXR1cm4ge09iamVjdHxBcnJheTxPYmplY3Q+fSB0aGUgb3ZlcmxheShzKQogICAqLwogIE92ZXJsYXlzLnByb3RvdHlwZS5nZXQgPSBmdW5jdGlvbihzZWFyY2gpIHsKCiAgICBpZiAoaXNTdHJpbmcoc2VhcmNoKSkgewogICAgICBzZWFyY2ggPSB7IGlkOiBzZWFyY2ggfTsKICAgIH0KCiAgICBpZiAoaXNTdHJpbmcoc2VhcmNoLmVsZW1lbnQpKSB7CiAgICAgIHNlYXJjaC5lbGVtZW50ID0gdGhpcy5fZWxlbWVudFJlZ2lzdHJ5LmdldChzZWFyY2guZWxlbWVudCk7CiAgICB9CgogICAgaWYgKHNlYXJjaC5lbGVtZW50KSB7CiAgICAgIHZhciBjb250YWluZXIgPSB0aGlzLl9nZXRPdmVybGF5Q29udGFpbmVyKHNlYXJjaC5lbGVtZW50LCB0cnVlKTsKCiAgICAgIC8vIHJldHVybiBhIGxpc3Qgb2Ygb3ZlcmxheXMgd2hlbiBzZWFyY2hpbmcgYnkgZWxlbWVudCAoK3R5cGUpCiAgICAgIGlmIChjb250YWluZXIpIHsKICAgICAgICByZXR1cm4gc2VhcmNoLnR5cGUgPyBmaWx0ZXIoY29udGFpbmVyLm92ZXJsYXlzLCBtYXRjaFBhdHRlcm4oeyB0eXBlOiBzZWFyY2gudHlwZSB9KSkgOiBjb250YWluZXIub3ZlcmxheXMuc2xpY2UoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gW107CiAgICAgIH0KICAgIH0gZWxzZQogICAgaWYgKHNlYXJjaC50eXBlKSB7CiAgICAgIHJldHVybiBmaWx0ZXIodGhpcy5fb3ZlcmxheXMsIG1hdGNoUGF0dGVybih7IHR5cGU6IHNlYXJjaC50eXBlIH0pKTsKICAgIH0gZWxzZSB7CgogICAgICAvLyByZXR1cm4gc2luZ2xlIGVsZW1lbnQgd2hlbiBzZWFyY2hpbmcgYnkgaWQKICAgICAgcmV0dXJuIHNlYXJjaC5pZCA/IHRoaXMuX292ZXJsYXlzW3NlYXJjaC5pZF0gOiBudWxsOwogICAgfQogIH07CgogIC8qKgogICAqIEFkZHMgYSBIVE1MIG92ZXJsYXkgdG8gYW4gZWxlbWVudC4KICAgKgogICAqIEBwYXJhbSB7U3RyaW5nfGRqcy5tb2RlbC5CYXNlfSAgIGVsZW1lbnQgICBhdHRhY2ggb3ZlcmxheSB0byB0aGlzIHNoYXBlCiAgICogQHBhcmFtIHtTdHJpbmd9ICAgICAgICAgICAgICAgICAgW3R5cGVdICAgIG9wdGlvbmFsIHR5cGUgdG8gYXNzaWduIHRvIHRoZSBvdmVybGF5CiAgICogQHBhcmFtIHtPYmplY3R9ICAgICAgICAgICAgICAgICAgb3ZlcmxheSAgIHRoZSBvdmVybGF5IGNvbmZpZ3VyYXRpb24KICAgKgogICAqIEBwYXJhbSB7U3RyaW5nfERPTUVsZW1lbnR9ICAgICAgIG92ZXJsYXkuaHRtbCAgICAgICAgICAgICAgICAgaHRtbCBlbGVtZW50IHRvIHVzZSBhcyBhbiBvdmVybGF5CiAgICogQHBhcmFtIHtPYmplY3R9ICAgICAgICAgICAgICAgICAgW292ZXJsYXkuc2hvd10gICAgICAgICAgICAgICBzaG93IGNvbmZpZ3VyYXRpb24KICAgKiBAcGFyYW0ge051bWJlcn0gICAgICAgICAgICAgICAgICBbb3ZlcmxheS5zaG93Lm1pblpvb21dICAgICAgIG1pbmltYWwgem9vbSBsZXZlbCB0byBzaG93IHRoZSBvdmVybGF5CiAgICogQHBhcmFtIHtOdW1iZXJ9ICAgICAgICAgICAgICAgICAgW292ZXJsYXkuc2hvdy5tYXhab29tXSAgICAgICBtYXhpbXVtIHpvb20gbGV2ZWwgdG8gc2hvdyB0aGUgb3ZlcmxheQogICAqIEBwYXJhbSB7T2JqZWN0fSAgICAgICAgICAgICAgICAgIG92ZXJsYXkucG9zaXRpb24gICAgICAgICAgICAgd2hlcmUgdG8gYXR0YWNoIHRoZSBvdmVybGF5CiAgICogQHBhcmFtIHtOdW1iZXJ9ICAgICAgICAgICAgICAgICAgW292ZXJsYXkucG9zaXRpb24ubGVmdF0gICAgICByZWxhdGl2ZSB0byBlbGVtZW50IGJib3ggbGVmdCBhdHRhY2htZW50CiAgICogQHBhcmFtIHtOdW1iZXJ9ICAgICAgICAgICAgICAgICAgW292ZXJsYXkucG9zaXRpb24udG9wXSAgICAgICByZWxhdGl2ZSB0byBlbGVtZW50IGJib3ggdG9wIGF0dGFjaG1lbnQKICAgKiBAcGFyYW0ge051bWJlcn0gICAgICAgICAgICAgICAgICBbb3ZlcmxheS5wb3NpdGlvbi5ib3R0b21dICAgIHJlbGF0aXZlIHRvIGVsZW1lbnQgYmJveCBib3R0b20gYXR0YWNobWVudAogICAqIEBwYXJhbSB7TnVtYmVyfSAgICAgICAgICAgICAgICAgIFtvdmVybGF5LnBvc2l0aW9uLnJpZ2h0XSAgICAgcmVsYXRpdmUgdG8gZWxlbWVudCBiYm94IHJpZ2h0IGF0dGFjaG1lbnQKICAgKiBAcGFyYW0ge0Jvb2xlYW58T2JqZWN0fSAgICAgICAgICBbb3ZlcmxheS5zY2FsZT10cnVlXSAgICAgICAgIGZhbHNlIHRvIHByZXNlcnZlIHRoZSBzYW1lIHNpemUgcmVnYXJkbGVzcyBvZgogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlhZ3JhbSB6b29tCiAgICogQHBhcmFtIHtOdW1iZXJ9ICAgICAgICAgICAgICAgICAgW292ZXJsYXkuc2NhbGUubWluXQogICAqIEBwYXJhbSB7TnVtYmVyfSAgICAgICAgICAgICAgICAgIFtvdmVybGF5LnNjYWxlLm1heF0KICAgKgogICAqIEByZXR1cm4ge1N0cmluZ30gICAgICAgICAgICAgICAgIGlkIHRoYXQgbWF5IGJlIHVzZWQgdG8gcmVmZXJlbmNlIHRoZSBvdmVybGF5IGZvciB1cGRhdGUgb3IgcmVtb3ZhbAogICAqLwogIE92ZXJsYXlzLnByb3RvdHlwZS5hZGQgPSBmdW5jdGlvbihlbGVtZW50LCB0eXBlLCBvdmVybGF5KSB7CgogICAgaWYgKGlzT2JqZWN0KHR5cGUpKSB7CiAgICAgIG92ZXJsYXkgPSB0eXBlOwogICAgICB0eXBlID0gbnVsbDsKICAgIH0KCiAgICBpZiAoIWVsZW1lbnQuaWQpIHsKICAgICAgZWxlbWVudCA9IHRoaXMuX2VsZW1lbnRSZWdpc3RyeS5nZXQoZWxlbWVudCk7CiAgICB9CgogICAgaWYgKCFvdmVybGF5LnBvc2l0aW9uKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcignbXVzdCBzcGVjaWZpeSBvdmVybGF5IHBvc2l0aW9uJyk7CiAgICB9CgogICAgaWYgKCFvdmVybGF5Lmh0bWwpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdtdXN0IHNwZWNpZml5IG92ZXJsYXkgaHRtbCcpOwogICAgfQoKICAgIGlmICghZWxlbWVudCkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ2ludmFsaWQgZWxlbWVudCBzcGVjaWZpZWQnKTsKICAgIH0KCiAgICB2YXIgaWQgPSB0aGlzLl9pZHMubmV4dCgpOwoKICAgIG92ZXJsYXkgPSBhc3NpZ24oe30sIHRoaXMuX292ZXJsYXlEZWZhdWx0cywgb3ZlcmxheSwgewogICAgICBpZDogaWQsCiAgICAgIHR5cGU6IHR5cGUsCiAgICAgIGVsZW1lbnQ6IGVsZW1lbnQsCiAgICAgIGh0bWw6IG92ZXJsYXkuaHRtbAogICAgfSk7CgogICAgdGhpcy5fYWRkT3ZlcmxheShvdmVybGF5KTsKCiAgICByZXR1cm4gaWQ7CiAgfTsKCgogIC8qKgogICAqIFJlbW92ZSBhbiBvdmVybGF5IHdpdGggdGhlIGdpdmVuIGlkIG9yIGFsbCBvdmVybGF5cyBtYXRjaGluZyB0aGUgZ2l2ZW4gZmlsdGVyLgogICAqCiAgICogQHNlZSBPdmVybGF5cyNnZXQgZm9yIGZpbHRlciBvcHRpb25zLgogICAqCiAgICogQHBhcmFtIHtTdHJpbmd9IFtpZF0KICAgKiBAcGFyYW0ge09iamVjdH0gW2ZpbHRlcl0KICAgKi8KICBPdmVybGF5cy5wcm90b3R5cGUucmVtb3ZlID0gZnVuY3Rpb24oZmlsdGVyKSB7CgogICAgdmFyIG92ZXJsYXlzID0gdGhpcy5nZXQoZmlsdGVyKSB8fCBbXTsKCiAgICBpZiAoIWlzQXJyYXkob3ZlcmxheXMpKSB7CiAgICAgIG92ZXJsYXlzID0gWyBvdmVybGF5cyBdOwogICAgfQoKICAgIHZhciBzZWxmID0gdGhpczsKCiAgICBmb3JFYWNoKG92ZXJsYXlzLCBmdW5jdGlvbihvdmVybGF5KSB7CgogICAgICB2YXIgY29udGFpbmVyID0gc2VsZi5fZ2V0T3ZlcmxheUNvbnRhaW5lcihvdmVybGF5LmVsZW1lbnQsIHRydWUpOwoKICAgICAgaWYgKG92ZXJsYXkpIHsKICAgICAgICByZW1vdmUob3ZlcmxheS5odG1sKTsKICAgICAgICByZW1vdmUob3ZlcmxheS5odG1sQ29udGFpbmVyKTsKCiAgICAgICAgZGVsZXRlIG92ZXJsYXkuaHRtbENvbnRhaW5lcjsKICAgICAgICBkZWxldGUgb3ZlcmxheS5lbGVtZW50OwoKICAgICAgICBkZWxldGUgc2VsZi5fb3ZlcmxheXNbb3ZlcmxheS5pZF07CiAgICAgIH0KCiAgICAgIGlmIChjb250YWluZXIpIHsKICAgICAgICB2YXIgaWR4ID0gY29udGFpbmVyLm92ZXJsYXlzLmluZGV4T2Yob3ZlcmxheSk7CiAgICAgICAgaWYgKGlkeCAhPT0gLTEpIHsKICAgICAgICAgIGNvbnRhaW5lci5vdmVybGF5cy5zcGxpY2UoaWR4LCAxKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0pOwoKICB9OwoKCiAgT3ZlcmxheXMucHJvdG90eXBlLnNob3cgPSBmdW5jdGlvbigpIHsKICAgIHNldFZpc2libGUodGhpcy5fb3ZlcmxheVJvb3QpOwogIH07CgoKICBPdmVybGF5cy5wcm90b3R5cGUuaGlkZSA9IGZ1bmN0aW9uKCkgewogICAgc2V0VmlzaWJsZSh0aGlzLl9vdmVybGF5Um9vdCwgZmFsc2UpOwogIH07CgogIE92ZXJsYXlzLnByb3RvdHlwZS5jbGVhciA9IGZ1bmN0aW9uKCkgewogICAgdGhpcy5fb3ZlcmxheXMgPSB7fTsKCiAgICB0aGlzLl9vdmVybGF5Q29udGFpbmVycyA9IFtdOwoKICAgIGNsZWFyKHRoaXMuX292ZXJsYXlSb290KTsKICB9OwoKICBPdmVybGF5cy5wcm90b3R5cGUuX3VwZGF0ZU92ZXJsYXlDb250YWluZXIgPSBmdW5jdGlvbihjb250YWluZXIpIHsKICAgIHZhciBlbGVtZW50ID0gY29udGFpbmVyLmVsZW1lbnQsCiAgICAgICAgaHRtbCA9IGNvbnRhaW5lci5odG1sOwoKICAgIC8vIHVwZGF0ZSBjb250YWluZXIgbGVmdCx0b3AgYWNjb3JkaW5nIHRvIHRoZSBlbGVtZW50cyB4LHkgY29vcmRpbmF0ZXMKICAgIC8vIHRoaXMgZW5zdXJlcyB3ZSBjYW4gYXR0YWNoIGNoaWxkIGVsZW1lbnRzIHJlbGF0aXZlIHRvIHRoaXMgY29udGFpbmVyCgogICAgdmFyIHggPSBlbGVtZW50LngsCiAgICAgICAgeSA9IGVsZW1lbnQueTsKCiAgICBpZiAoZWxlbWVudC53YXlwb2ludHMpIHsKICAgICAgdmFyIGJib3ggPSBnZXRCQm94KGVsZW1lbnQpOwogICAgICB4ID0gYmJveC54OwogICAgICB5ID0gYmJveC55OwogICAgfQoKICAgIHNldFBvc2l0aW9uKGh0bWwsIHgsIHkpOwoKICAgIGF0dHIoY29udGFpbmVyLmh0bWwsICdkYXRhLWNvbnRhaW5lci1pZCcsIGVsZW1lbnQuaWQpOwogIH07CgoKICBPdmVybGF5cy5wcm90b3R5cGUuX3VwZGF0ZU92ZXJsYXkgPSBmdW5jdGlvbihvdmVybGF5KSB7CgogICAgdmFyIHBvc2l0aW9uID0gb3ZlcmxheS5wb3NpdGlvbiwKICAgICAgICBodG1sQ29udGFpbmVyID0gb3ZlcmxheS5odG1sQ29udGFpbmVyLAogICAgICAgIGVsZW1lbnQgPSBvdmVybGF5LmVsZW1lbnQ7CgogICAgLy8gdXBkYXRlIG92ZXJsYXkgaHRtbCByZWxhdGl2ZSB0byBzaGFwZSBiZWNhdXNlCiAgICAvLyBpdCBpcyBhbHJlYWR5IHBvc2l0aW9uZWQgb24gdGhlIGVsZW1lbnQKCiAgICAvLyB1cGRhdGUgcmVsYXRpdmUKICAgIHZhciBsZWZ0ID0gcG9zaXRpb24ubGVmdCwKICAgICAgICB0b3AgPSBwb3NpdGlvbi50b3A7CgogICAgaWYgKHBvc2l0aW9uLnJpZ2h0ICE9PSB1bmRlZmluZWQpIHsKCiAgICAgIHZhciB3aWR0aDsKCiAgICAgIGlmIChlbGVtZW50LndheXBvaW50cykgewogICAgICAgIHdpZHRoID0gZ2V0QkJveChlbGVtZW50KS53aWR0aDsKICAgICAgfSBlbHNlIHsKICAgICAgICB3aWR0aCA9IGVsZW1lbnQud2lkdGg7CiAgICAgIH0KCiAgICAgIGxlZnQgPSBwb3NpdGlvbi5yaWdodCAqIC0xICsgd2lkdGg7CiAgICB9CgogICAgaWYgKHBvc2l0aW9uLmJvdHRvbSAhPT0gdW5kZWZpbmVkKSB7CgogICAgICB2YXIgaGVpZ2h0OwoKICAgICAgaWYgKGVsZW1lbnQud2F5cG9pbnRzKSB7CiAgICAgICAgaGVpZ2h0ID0gZ2V0QkJveChlbGVtZW50KS5oZWlnaHQ7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaGVpZ2h0ID0gZWxlbWVudC5oZWlnaHQ7CiAgICAgIH0KCiAgICAgIHRvcCA9IHBvc2l0aW9uLmJvdHRvbSAqIC0xICsgaGVpZ2h0OwogICAgfQoKICAgIHNldFBvc2l0aW9uKGh0bWxDb250YWluZXIsIGxlZnQgfHwgMCwgdG9wIHx8IDApOwogIH07CgoKICBPdmVybGF5cy5wcm90b3R5cGUuX2NyZWF0ZU92ZXJsYXlDb250YWluZXIgPSBmdW5jdGlvbihlbGVtZW50KSB7CiAgICB2YXIgaHRtbCA9IGRvbWlmeSgnPGRpdiBjbGFzcz0iZGpzLW92ZXJsYXlzIiBzdHlsZT0icG9zaXRpb246IGFic29sdXRlIiAvPicpOwoKICAgIHRoaXMuX292ZXJsYXlSb290LmFwcGVuZENoaWxkKGh0bWwpOwoKICAgIHZhciBjb250YWluZXIgPSB7CiAgICAgIGh0bWw6IGh0bWwsCiAgICAgIGVsZW1lbnQ6IGVsZW1lbnQsCiAgICAgIG92ZXJsYXlzOiBbXQogICAgfTsKCiAgICB0aGlzLl91cGRhdGVPdmVybGF5Q29udGFpbmVyKGNvbnRhaW5lcik7CgogICAgdGhpcy5fb3ZlcmxheUNvbnRhaW5lcnMucHVzaChjb250YWluZXIpOwoKICAgIHJldHVybiBjb250YWluZXI7CiAgfTsKCgogIE92ZXJsYXlzLnByb3RvdHlwZS5fdXBkYXRlUm9vdCA9IGZ1bmN0aW9uKHZpZXdib3gpIHsKICAgIHZhciBzY2FsZSA9IHZpZXdib3guc2NhbGUgfHwgMTsKCiAgICB2YXIgbWF0cml4ID0gJ21hdHJpeCgnICsKICAgIFsKICAgICAgc2NhbGUsCiAgICAgIDAsCiAgICAgIDAsCiAgICAgIHNjYWxlLAogICAgICAtMSAqIHZpZXdib3gueCAqIHNjYWxlLAogICAgICAtMSAqIHZpZXdib3gueSAqIHNjYWxlCiAgICBdLmpvaW4oJywnKSArCiAgICAnKSc7CgogICAgc2V0VHJhbnNmb3JtKHRoaXMuX292ZXJsYXlSb290LCBtYXRyaXgpOwogIH07CgoKICBPdmVybGF5cy5wcm90b3R5cGUuX2dldE92ZXJsYXlDb250YWluZXIgPSBmdW5jdGlvbihlbGVtZW50LCByYXcpIHsKICAgIHZhciBjb250YWluZXIgPSBmaW5kKHRoaXMuX292ZXJsYXlDb250YWluZXJzLCBmdW5jdGlvbihjKSB7CiAgICAgIHJldHVybiBjLmVsZW1lbnQgPT09IGVsZW1lbnQ7CiAgICB9KTsKCgogICAgaWYgKCFjb250YWluZXIgJiYgIXJhdykgewogICAgICByZXR1cm4gdGhpcy5fY3JlYXRlT3ZlcmxheUNvbnRhaW5lcihlbGVtZW50KTsKICAgIH0KCiAgICByZXR1cm4gY29udGFpbmVyOwogIH07CgoKICBPdmVybGF5cy5wcm90b3R5cGUuX2FkZE92ZXJsYXkgPSBmdW5jdGlvbihvdmVybGF5KSB7CgogICAgdmFyIGlkID0gb3ZlcmxheS5pZCwKICAgICAgICBlbGVtZW50ID0gb3ZlcmxheS5lbGVtZW50LAogICAgICAgIGh0bWwgPSBvdmVybGF5Lmh0bWwsCiAgICAgICAgaHRtbENvbnRhaW5lciwKICAgICAgICBvdmVybGF5Q29udGFpbmVyOwoKICAgIC8vIHVud3JhcCBqcXVlcnkgKGZvciB0aG9zZSB3aG8gbmVlZCBpdCkKICAgIGlmIChodG1sLmdldCAmJiBodG1sLmNvbnN0cnVjdG9yLnByb3RvdHlwZS5qcXVlcnkpIHsKICAgICAgaHRtbCA9IGh0bWwuZ2V0KDApOwogICAgfQoKICAgIC8vIGNyZWF0ZSBwcm9wZXIgaHRtbCBlbGVtZW50cyBmcm9tCiAgICAvLyBvdmVybGF5IEhUTUwgc3RyaW5ncwogICAgaWYgKGlzU3RyaW5nKGh0bWwpKSB7CiAgICAgIGh0bWwgPSBkb21pZnkoaHRtbCk7CiAgICB9CgogICAgb3ZlcmxheUNvbnRhaW5lciA9IHRoaXMuX2dldE92ZXJsYXlDb250YWluZXIoZWxlbWVudCk7CgogICAgaHRtbENvbnRhaW5lciA9IGRvbWlmeSgnPGRpdiBjbGFzcz0iZGpzLW92ZXJsYXkiIGRhdGEtb3ZlcmxheS1pZD0iJyArIGlkICsgJyIgc3R5bGU9InBvc2l0aW9uOiBhYnNvbHV0ZSI+Jyk7CgogICAgaHRtbENvbnRhaW5lci5hcHBlbmRDaGlsZChodG1sKTsKCiAgICBpZiAob3ZlcmxheS50eXBlKSB7CiAgICAgIGNsYXNzZXMoaHRtbENvbnRhaW5lcikuYWRkKCdkanMtb3ZlcmxheS0nICsgb3ZlcmxheS50eXBlKTsKICAgIH0KCiAgICBvdmVybGF5Lmh0bWxDb250YWluZXIgPSBodG1sQ29udGFpbmVyOwoKICAgIG92ZXJsYXlDb250YWluZXIub3ZlcmxheXMucHVzaChvdmVybGF5KTsKICAgIG92ZXJsYXlDb250YWluZXIuaHRtbC5hcHBlbmRDaGlsZChodG1sQ29udGFpbmVyKTsKCiAgICB0aGlzLl9vdmVybGF5c1tpZF0gPSBvdmVybGF5OwoKICAgIHRoaXMuX3VwZGF0ZU92ZXJsYXkob3ZlcmxheSk7CiAgICB0aGlzLl91cGRhdGVPdmVybGF5VmlzaWJpbHR5KG92ZXJsYXksIHRoaXMuX2NhbnZhcy52aWV3Ym94KCkpOwogIH07CgoKICBPdmVybGF5cy5wcm90b3R5cGUuX3VwZGF0ZU92ZXJsYXlWaXNpYmlsdHkgPSBmdW5jdGlvbihvdmVybGF5LCB2aWV3Ym94KSB7CiAgICB2YXIgc2hvdyA9IG92ZXJsYXkuc2hvdywKICAgICAgICBtaW5ab29tID0gc2hvdyAmJiBzaG93Lm1pblpvb20sCiAgICAgICAgbWF4Wm9vbSA9IHNob3cgJiYgc2hvdy5tYXhab29tLAogICAgICAgIGh0bWxDb250YWluZXIgPSBvdmVybGF5Lmh0bWxDb250YWluZXIsCiAgICAgICAgdmlzaWJsZSA9IHRydWU7CgogICAgaWYgKHNob3cpIHsKICAgICAgaWYgKAogICAgICAgIChpc0RlZmluZWQobWluWm9vbSkgJiYgbWluWm9vbSA+IHZpZXdib3guc2NhbGUpIHx8CiAgICAgICAgKGlzRGVmaW5lZChtYXhab29tKSAmJiBtYXhab29tIDwgdmlld2JveC5zY2FsZSkKICAgICAgKSB7CiAgICAgICAgdmlzaWJsZSA9IGZhbHNlOwogICAgICB9CgogICAgICBzZXRWaXNpYmxlKGh0bWxDb250YWluZXIsIHZpc2libGUpOwogICAgfQoKICAgIHRoaXMuX3VwZGF0ZU92ZXJsYXlTY2FsZShvdmVybGF5LCB2aWV3Ym94KTsKICB9OwoKCiAgT3ZlcmxheXMucHJvdG90eXBlLl91cGRhdGVPdmVybGF5U2NhbGUgPSBmdW5jdGlvbihvdmVybGF5LCB2aWV3Ym94KSB7CiAgICB2YXIgc2hvdWxkU2NhbGUgPSBvdmVybGF5LnNjYWxlLAogICAgICAgIG1pblNjYWxlLAogICAgICAgIG1heFNjYWxlLAogICAgICAgIGh0bWxDb250YWluZXIgPSBvdmVybGF5Lmh0bWxDb250YWluZXI7CgogICAgdmFyIHNjYWxlLCB0cmFuc2Zvcm0gPSAnJzsKCiAgICBpZiAoc2hvdWxkU2NhbGUgIT09IHRydWUpIHsKCiAgICAgIGlmIChzaG91bGRTY2FsZSA9PT0gZmFsc2UpIHsKICAgICAgICBtaW5TY2FsZSA9IDE7CiAgICAgICAgbWF4U2NhbGUgPSAxOwogICAgICB9IGVsc2UgewogICAgICAgIG1pblNjYWxlID0gc2hvdWxkU2NhbGUubWluOwogICAgICAgIG1heFNjYWxlID0gc2hvdWxkU2NhbGUubWF4OwogICAgICB9CgogICAgICBpZiAoaXNEZWZpbmVkKG1pblNjYWxlKSAmJiB2aWV3Ym94LnNjYWxlIDwgbWluU2NhbGUpIHsKICAgICAgICBzY2FsZSA9ICgxIC8gdmlld2JveC5zY2FsZSB8fCAxKSAqIG1pblNjYWxlOwogICAgICB9CgogICAgICBpZiAoaXNEZWZpbmVkKG1heFNjYWxlKSAmJiB2aWV3Ym94LnNjYWxlID4gbWF4U2NhbGUpIHsKICAgICAgICBzY2FsZSA9ICgxIC8gdmlld2JveC5zY2FsZSB8fCAxKSAqIG1heFNjYWxlOwogICAgICB9CiAgICB9CgogICAgaWYgKGlzRGVmaW5lZChzY2FsZSkpIHsKICAgICAgdHJhbnNmb3JtID0gJ3NjYWxlKCcgKyBzY2FsZSArICcsJyArIHNjYWxlICsgJyknOwogICAgfQoKICAgIHNldFRyYW5zZm9ybShodG1sQ29udGFpbmVyLCB0cmFuc2Zvcm0pOwogIH07CgoKICBPdmVybGF5cy5wcm90b3R5cGUuX3VwZGF0ZU92ZXJsYXlzVmlzaWJpbHR5ID0gZnVuY3Rpb24odmlld2JveCkgewoKICAgIHZhciBzZWxmID0gdGhpczsKCiAgICBmb3JFYWNoKHRoaXMuX292ZXJsYXlzLCBmdW5jdGlvbihvdmVybGF5KSB7CiAgICAgIHNlbGYuX3VwZGF0ZU92ZXJsYXlWaXNpYmlsdHkob3ZlcmxheSwgdmlld2JveCk7CiAgICB9KTsKICB9OwoKCiAgT3ZlcmxheXMucHJvdG90eXBlLl9pbml0ID0gZnVuY3Rpb24oKSB7CgogICAgdmFyIGV2ZW50QnVzID0gdGhpcy5fZXZlbnRCdXM7CgogICAgdmFyIHNlbGYgPSB0aGlzOwoKCiAgICAvLyBzY3JvbGwvem9vbSBpbnRlZ3JhdGlvbgoKICAgIGZ1bmN0aW9uIHVwZGF0ZVZpZXdib3godmlld2JveCkgewogICAgICBzZWxmLl91cGRhdGVSb290KHZpZXdib3gpOwogICAgICBzZWxmLl91cGRhdGVPdmVybGF5c1Zpc2liaWx0eSh2aWV3Ym94KTsKCiAgICAgIHNlbGYuc2hvdygpOwogICAgfQoKICAgIGV2ZW50QnVzLm9uKCdjYW52YXMudmlld2JveC5jaGFuZ2luZycsIGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgIHNlbGYuaGlkZSgpOwogICAgfSk7CgogICAgZXZlbnRCdXMub24oJ2NhbnZhcy52aWV3Ym94LmNoYW5nZWQnLCBmdW5jdGlvbihldmVudCkgewogICAgICB1cGRhdGVWaWV3Ym94KGV2ZW50LnZpZXdib3gpOwogICAgfSk7CgoKICAgIC8vIHJlbW92ZSBpbnRlZ3JhdGlvbgoKICAgIGV2ZW50QnVzLm9uKFsgJ3NoYXBlLnJlbW92ZScsICdjb25uZWN0aW9uLnJlbW92ZScgXSwgZnVuY3Rpb24oZSkgewogICAgICB2YXIgZWxlbWVudCA9IGUuZWxlbWVudDsKICAgICAgdmFyIG92ZXJsYXlzID0gc2VsZi5nZXQoeyBlbGVtZW50OiBlbGVtZW50IH0pOwoKICAgICAgZm9yRWFjaChvdmVybGF5cywgZnVuY3Rpb24obykgewogICAgICAgIHNlbGYucmVtb3ZlKG8uaWQpOwogICAgICB9KTsKCiAgICAgIHZhciBjb250YWluZXIgPSBzZWxmLl9nZXRPdmVybGF5Q29udGFpbmVyKGVsZW1lbnQpOwoKICAgICAgaWYgKGNvbnRhaW5lcikgewogICAgICAgIHJlbW92ZShjb250YWluZXIuaHRtbCk7CiAgICAgICAgdmFyIGkgPSBzZWxmLl9vdmVybGF5Q29udGFpbmVycy5pbmRleE9mKGNvbnRhaW5lcik7CiAgICAgICAgaWYgKGkgIT09IC0xKSB7CiAgICAgICAgICBzZWxmLl9vdmVybGF5Q29udGFpbmVycy5zcGxpY2UoaSwgMSk7CiAgICAgICAgfQogICAgICB9CiAgICB9KTsKCgogICAgLy8gbW92ZSBpbnRlZ3JhdGlvbgoKICAgIGV2ZW50QnVzLm9uKCdlbGVtZW50LmNoYW5nZWQnLCBMT1dfUFJJT1JJVFkkMiwgZnVuY3Rpb24oZSkgewogICAgICB2YXIgZWxlbWVudCA9IGUuZWxlbWVudDsKCiAgICAgIHZhciBjb250YWluZXIgPSBzZWxmLl9nZXRPdmVybGF5Q29udGFpbmVyKGVsZW1lbnQsIHRydWUpOwoKICAgICAgaWYgKGNvbnRhaW5lcikgewogICAgICAgIGZvckVhY2goY29udGFpbmVyLm92ZXJsYXlzLCBmdW5jdGlvbihvdmVybGF5KSB7CiAgICAgICAgICBzZWxmLl91cGRhdGVPdmVybGF5KG92ZXJsYXkpOwogICAgICAgIH0pOwoKICAgICAgICBzZWxmLl91cGRhdGVPdmVybGF5Q29udGFpbmVyKGNvbnRhaW5lcik7CiAgICAgIH0KICAgIH0pOwoKCiAgICAvLyBtYXJrZXIgaW50ZWdyYXRpb24sIHNpbXBseSBhZGQgdGhlbSBvbiB0aGUgb3ZlcmxheXMgYXMgY2xhc3NlcywgdG9vLgoKICAgIGV2ZW50QnVzLm9uKCdlbGVtZW50Lm1hcmtlci51cGRhdGUnLCBmdW5jdGlvbihlKSB7CiAgICAgIHZhciBjb250YWluZXIgPSBzZWxmLl9nZXRPdmVybGF5Q29udGFpbmVyKGUuZWxlbWVudCwgdHJ1ZSk7CiAgICAgIGlmIChjb250YWluZXIpIHsKICAgICAgICBjbGFzc2VzKGNvbnRhaW5lci5odG1sKVtlLmFkZCA/ICdhZGQnIDogJ3JlbW92ZSddKGUubWFya2VyKTsKICAgICAgfQogICAgfSk7CgoKICAgIC8vIGNsZWFyIG92ZXJsYXlzIHdpdGggZGlhZ3JhbQoKICAgIGV2ZW50QnVzLm9uKCdkaWFncmFtLmNsZWFyJywgdGhpcy5jbGVhciwgdGhpcyk7CiAgfTsKCgoKICAvLyBoZWxwZXJzIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogIGZ1bmN0aW9uIGNyZWF0ZVJvb3QocGFyZW50Tm9kZSkgewogICAgdmFyIHJvb3QgPSBkb21pZnkoCiAgICAgICc8ZGl2IGNsYXNzPSJkanMtb3ZlcmxheS1jb250YWluZXIiIHN0eWxlPSJwb3NpdGlvbjogYWJzb2x1dGU7IHdpZHRoOiAwOyBoZWlnaHQ6IDA7IiAvPicKICAgICk7CgogICAgcGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUocm9vdCwgcGFyZW50Tm9kZS5maXJzdENoaWxkKTsKCiAgICByZXR1cm4gcm9vdDsKICB9CgogIGZ1bmN0aW9uIHNldFBvc2l0aW9uKGVsLCB4LCB5KSB7CiAgICBhc3NpZ24oZWwuc3R5bGUsIHsgbGVmdDogeCArICdweCcsIHRvcDogeSArICdweCcgfSk7CiAgfQoKICBmdW5jdGlvbiBzZXRWaXNpYmxlKGVsLCB2aXNpYmxlKSB7CiAgICBlbC5zdHlsZS5kaXNwbGF5ID0gdmlzaWJsZSA9PT0gZmFsc2UgPyAnbm9uZScgOiAnJzsKICB9CgogIGZ1bmN0aW9uIHNldFRyYW5zZm9ybShlbCwgdHJhbnNmb3JtKSB7CgogICAgZWwuc3R5bGVbJ3RyYW5zZm9ybS1vcmlnaW4nXSA9ICd0b3AgbGVmdCc7CgogICAgWyAnJywgJy1tcy0nLCAnLXdlYmtpdC0nIF0uZm9yRWFjaChmdW5jdGlvbihwcmVmaXgpIHsKICAgICAgZWwuc3R5bGVbcHJlZml4ICsgJ3RyYW5zZm9ybSddID0gdHJhbnNmb3JtOwogICAgfSk7CiAgfQoKICB2YXIgT3ZlcmxheXNNb2R1bGUgPSB7CiAgICBfX2luaXRfXzogWyAnb3ZlcmxheXMnIF0sCiAgICBvdmVybGF5czogWyAndHlwZScsIE92ZXJsYXlzIF0KICB9OwoKICAvKioKICAgKiBUaGlzIGZpbGUgbXVzdCBub3QgYmUgY2hhbmdlZCBvciBleGNoYW5nZWQuCiAgICoKICAgKiBAc2VlIGh0dHA6Ly9icG1uLmlvL2xpY2Vuc2UgZm9yIG1vcmUgaW5mb3JtYXRpb24uCiAgICovCgoKICAvLyBpbmxpbmVkIC4uLy4uL3Jlc291cmNlcy9sb2dvLnN2ZwogIHZhciBCUE1OSU9fTE9HT19TVkcgPSAnPHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA5NjAgOTYwIj48cGF0aCBmaWxsPSIjZmZmIiBkPSJNOTYwIDYwdjgzOWMwIDMzLTI3IDYxLTYwIDYxSDYwYy0zMyAwLTYwLTI3LTYwLTYwVjYwQzAgMjcgMjcgMCA2MCAwaDgzOWMzNCAwIDYxIDI3IDYxIDYweiIvPjxwYXRoIGZpbGw9IiM1MmI0MTUiIGQ9Ik0yMTcgNTQ4YTIwNSAyMDUgMCAwIDAtMTQ0IDU4IDIwMiAyMDIgMCAwIDAtNCAyODYgMjAyIDIwMiAwIDAgMCAyODUgMyAyMDAgMjAwIDAgMCAwIDQ4LTIxOSAyMDMgMjAzIDAgMCAwLTE4NS0xMjh6TTc1MiA2YTIwNiAyMDYgMCAwIDAtMTkyIDI4NSAyMDYgMjA2IDAgMCAwIDI2OSAxMTEgMjA3IDIwNyAwIDAgMCAxMTEtMjYwQTIwNCAyMDQgMCAwIDAgNzUyIDZ6TTYyIDBBNjIgNjIgMCAwIDAgMCA2MnYzOThsNjAgNDZhMjU5IDI1OSAwIDAgMSA4OS0zNmM1LTI4IDEwLTU3IDE0LTg1bDk5IDIgMTIgODVhMjQ2IDI0NiAwIDAgMSA4OCAzOGw3MC01MiA2OSA3MS01MiA2OGMxNyAzMCAyOSA1OCAzNSA5MGw4NiAxNC0yIDEwMC04NiAxMmEyNDAgMjQwIDAgMCAxLTM4IDg5bDQzIDU4aDQxM2MzNyAwIDYwLTI3IDYwLTYxVjQwN2EyMjAgMjIwIDAgMCAxLTQ0IDQwbDIxIDg1LTkzIDM5LTQ1LTc2YTI1OCAyNTggMCAwIDEtOTggMWwtNDUgNzYtOTQtMzkgMjItODVhMjk4IDI5OCAwIDAgMS03MC02OWwtODYgMjItMzgtOTQgNzYtNDVhMjU4IDI1OCAwIDAgMS0xLTk4bC03Ni00NSA0MC05NCA4NSAyMmEyNzEgMjcxIDAgMCAxIDQxLTQ3eiIvPjwvc3ZnPic7CgogIHZhciBCUE1OSU9fTE9HT19VUkwgPSAnZGF0YTppbWFnZS9zdmcreG1sLCcgKyBlbmNvZGVVUklDb21wb25lbnQoQlBNTklPX0xPR09fU1ZHKTsKCiAgdmFyIEJQTU5JT19JTUcgPSAnPGltZyB3aWR0aD0iNTIiIGhlaWdodD0iNTIiIHNyYz0iJyArIEJQTU5JT19MT0dPX1VSTCArICciIC8+JzsKCiAgZnVuY3Rpb24gY3NzKGF0dHJzKSB7CiAgICByZXR1cm4gYXR0cnMuam9pbignOycpOwogIH0KCiAgdmFyIExJR0hUQk9YX1NUWUxFUyA9IGNzcyhbCiAgICAnei1pbmRleDogMTAwMScsCiAgICAncG9zaXRpb246IGZpeGVkJywKICAgICd0b3A6IDAnLAogICAgJ2xlZnQ6IDAnLAogICAgJ3JpZ2h0OiAwJywKICAgICdib3R0b206IDAnCiAgXSk7CgogIHZhciBCQUNLRFJPUF9TVFlMRVMgPSBjc3MoWwogICAgJ3dpZHRoOiAxMDAlJywKICAgICdoZWlnaHQ6IDEwMCUnLAogICAgJ2JhY2tncm91bmQ6IHJnYmEoMCwwLDAsMC4yKScKICBdKTsKCiAgdmFyIE5PVElDRV9TVFlMRVMgPSBjc3MoWwogICAgJ3Bvc2l0aW9uOiBhYnNvbHV0ZScsCiAgICAnbGVmdDogNTAlJywKICAgICd0b3A6IDQwJScsCiAgICAnbWFyZ2luOiAwIC0xMzBweCcsCiAgICAnd2lkdGg6IDI2MHB4JywKICAgICdwYWRkaW5nOiAxMHB4JywKICAgICdiYWNrZ3JvdW5kOiB3aGl0ZScsCiAgICAnYm9yZGVyOiBzb2xpZCAxcHggI0FBQScsCiAgICAnYm9yZGVyLXJhZGl1czogM3B4JywKICAgICdmb250LWZhbWlseTogSGVsdmV0aWNhLCBBcmlhbCwgc2Fucy1zZXJpZicsCiAgICAnZm9udC1zaXplOiAxNHB4JywKICAgICdsaW5lLWhlaWdodDogMS4yZW0nCiAgXSk7CgogIHZhciBMSUdIVEJPWF9NQVJLVVAgPQogICAgJzxkaXYgY2xhc3M9ImJqcy1wb3dlcmVkLWJ5LWxpZ2h0Ym94IiBzdHlsZT0iJyArIExJR0hUQk9YX1NUWUxFUyArICciPicgKwogICAgICAnPGRpdiBjbGFzcz0iYmFja2Ryb3AiIHN0eWxlPSInICsgQkFDS0RST1BfU1RZTEVTICsgJyI+PC9kaXY+JyArCiAgICAgICc8ZGl2IGNsYXNzPSJub3RpY2UiIHN0eWxlPSInICsgTk9USUNFX1NUWUxFUyArICciPicgKwogICAgICAgICc8YSBocmVmPSJodHRwOi8vYnBtbi5pbyIgdGFyZ2V0PSJfYmxhbmsiIHN0eWxlPSJmbG9hdDogbGVmdDsgbWFyZ2luLXJpZ2h0OiAxMHB4Ij4nICsKICAgICAgICAgIEJQTU5JT19JTUcgKwogICAgICAgICc8L2E+JyArCiAgICAgICAgJ1dlYi1iYXNlZCB0b29saW5nIGZvciBCUE1OLCBETU4gYW5kIENNTU4gZGlhZ3JhbXMgJyArCiAgICAgICAgJ3Bvd2VyZWQgYnkgPGEgaHJlZj0iaHR0cDovL2JwbW4uaW8iIHRhcmdldD0iX2JsYW5rIj5icG1uLmlvPC9hPi4nICsKICAgICAgJzwvZGl2PicgKwogICAgJzwvZGl2Pic7CgoKICB2YXIgbGlnaHRib3g7CgogIGZ1bmN0aW9uIG9wZW4oKSB7CgogICAgaWYgKCFsaWdodGJveCkgewogICAgICBsaWdodGJveCA9IGRvbWlmeShMSUdIVEJPWF9NQVJLVVApOwoKICAgICAgZGVsZWdhdGVFdmVudHMuYmluZChsaWdodGJveCwgJy5iYWNrZHJvcCcsICdjbGljaycsIGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChsaWdodGJveCk7CiAgICAgIH0pOwogICAgfQoKICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQobGlnaHRib3gpOwogIH0KCiAgLyoqCiAgICogVGhlIGNvZGUgaW4gdGhlIDxwcm9qZWN0LWxvZ28+PC9wcm9qZWN0LWxvZ28+IGFyZWEKICAgKiBtdXN0IG5vdCBiZSBjaGFuZ2VkLgogICAqCiAgICogQHNlZSBodHRwOi8vYnBtbi5pby9saWNlbnNlIGZvciBtb3JlIGluZm9ybWF0aW9uLgogICAqLwoKCiAgZnVuY3Rpb24gY2hlY2tWYWxpZGF0aW9uRXJyb3IoZXJyKSB7CgogICAgLy8gY2hlY2sgaWYgd2UgY2FuIGhlbHAgdGhlIHVzZXIgYnkgaW5kaWNhdGluZyB3cm9uZyBCUE1OIDIuMCB4bWwKICAgIC8vIChpbiBjYXNlIGhlIG9yIHRoZSBleHBvcnRpbmcgdG9vbCBkaWQgbm90IGdldCB0aGF0IHJpZ2h0KQoKICAgIHZhciBwYXR0ZXJuID0gL3VucGFyc2FibGUgY29udGVudCA8KFtePl0rKT4gZGV0ZWN0ZWQoW1xzXFNdKikkLzsKICAgIHZhciBtYXRjaCA9IHBhdHRlcm4uZXhlYyhlcnIubWVzc2FnZSk7CgogICAgaWYgKG1hdGNoKSB7CiAgICAgIGVyci5tZXNzYWdlID0KICAgICAgICAndW5wYXJzYWJsZSBjb250ZW50IDwnICsgbWF0Y2hbMV0gKyAnPiBkZXRlY3RlZDsgJyArCiAgICAgICAgJ3RoaXMgbWF5IGluZGljYXRlIGFuIGludmFsaWQgQlBNTiAyLjAgZGlhZ3JhbSBmaWxlJyArIG1hdGNoWzJdOwogICAgfQoKICAgIHJldHVybiBlcnI7CiAgfQoKICB2YXIgREVGQVVMVF9PUFRJT05TID0gewogICAgd2lkdGg6ICcxMDAlJywKICAgIGhlaWdodDogJzEwMCUnLAogICAgcG9zaXRpb246ICdyZWxhdGl2ZScKICB9OwoKCiAgLyoqCiAgICogRW5zdXJlIHRoZSBwYXNzZWQgYXJndW1lbnQgaXMgYSBwcm9wZXIgdW5pdCAoZGVmYXVsdGluZyB0byBweCkKICAgKi8KICBmdW5jdGlvbiBlbnN1cmVVbml0KHZhbCkgewogICAgcmV0dXJuIHZhbCArIChpc051bWJlcih2YWwpID8gJ3B4JyA6ICcnKTsKICB9CgoKICAvKioKICAgKiBGaW5kIEJQTU5EaWFncmFtIGluIGRlZmluaXRpb25zIGJ5IElECiAgICoKICAgKiBAcGFyYW0ge01vZGRsZUVsZW1lbnQ8RGVmaW5pdGlvbnM+fSBkZWZpbml0aW9ucwogICAqIEBwYXJhbSB7U3RyaW5nfSBkaWFncmFtSWQKICAgKgogICAqIEByZXR1cm4ge01vZGRsZUVsZW1lbnQ8QlBNTkRpYWdyYW0+fG51bGx9CiAgICovCiAgZnVuY3Rpb24gZmluZEJQTU5EaWFncmFtKGRlZmluaXRpb25zLCBkaWFncmFtSWQpIHsKICAgIGlmICghZGlhZ3JhbUlkKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIHJldHVybiBmaW5kKGRlZmluaXRpb25zLmRpYWdyYW1zLCBmdW5jdGlvbihlbGVtZW50KSB7CiAgICAgIHJldHVybiBlbGVtZW50LmlkID09PSBkaWFncmFtSWQ7CiAgICB9KSB8fCBudWxsOwogIH0KCiAgLyoqCiAgICogQSB2aWV3ZXIgZm9yIEJQTU4gMi4wIGRpYWdyYW1zLgogICAqCiAgICogSGF2ZSBhIGxvb2sgYXQge0BsaW5rIE5hdmlnYXRlZFZpZXdlcn0gb3Ige0BsaW5rIE1vZGVsZXJ9IGZvciBidW5kbGVzIHRoYXQgaW5jbHVkZQogICAqIGFkZGl0aW9uYWwgZmVhdHVyZXMuCiAgICoKICAgKgogICAqICMjIEV4dGVuZGluZyB0aGUgVmlld2VyCiAgICoKICAgKiBJbiBvcmRlciB0byBleHRlbmQgdGhlIHZpZXdlciBwYXNzIGV4dGVuc2lvbiBtb2R1bGVzIHRvIGJvb3RzdHJhcCB2aWEgdGhlCiAgICogYGFkZGl0aW9uYWxNb2R1bGVzYCBvcHRpb24uIEFuIGV4dGVuc2lvbiBtb2R1bGUgaXMgYW4gb2JqZWN0IHRoYXQgZXhwb3NlcwogICAqIG5hbWVkIHNlcnZpY2VzLgogICAqCiAgICogVGhlIGZvbGxvd2luZyBleGFtcGxlIGRlcGljdHMgdGhlIGludGVncmF0aW9uIG9mIGEgc2ltcGxlCiAgICogbG9nZ2luZyBjb21wb25lbnQgdGhhdCBpbnRlZ3JhdGVzIHdpdGggaW50ZXJhY3Rpb24gZXZlbnRzOgogICAqCiAgICoKICAgKiBgYGBqYXZhc2NyaXB0CiAgICoKICAgKiAvLyBsb2dnaW5nIGNvbXBvbmVudAogICAqIGZ1bmN0aW9uIEludGVyYWN0aW9uTG9nZ2VyKGV2ZW50QnVzKSB7CiAgICogICBldmVudEJ1cy5vbignZWxlbWVudC5ob3ZlcicsIGZ1bmN0aW9uKGV2ZW50KSB7CiAgICogICAgIGNvbnNvbGUubG9nKCkKICAgKiAgIH0pCiAgICogfQogICAqCiAgICogSW50ZXJhY3Rpb25Mb2dnZXIuJGluamVjdCA9IFsgJ2V2ZW50QnVzJyBdOyAvLyBtaW5pZmljYXRpb24gc2F2ZQogICAqCiAgICogLy8gZXh0ZW5zaW9uIG1vZHVsZQogICAqIHZhciBleHRlbnNpb25Nb2R1bGUgPSB7CiAgICogICBfX2luaXRfXzogWyAnaW50ZXJhY3Rpb25Mb2dnZXInIF0sCiAgICogICBpbnRlcmFjdGlvbkxvZ2dlcjogWyAndHlwZScsIEludGVyYWN0aW9uTG9nZ2VyIF0KICAgKiB9OwogICAqCiAgICogLy8gZXh0ZW5kIHRoZSB2aWV3ZXIKICAgKiB2YXIgYnBtblZpZXdlciA9IG5ldyBWaWV3ZXIoeyBhZGRpdGlvbmFsTW9kdWxlczogWyBleHRlbnNpb25Nb2R1bGUgXSB9KTsKICAgKiBicG1uVmlld2VyLmltcG9ydFhNTCguLi4pOwogICAqIGBgYAogICAqCiAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXSBjb25maWd1cmF0aW9uIG9wdGlvbnMgdG8gcGFzcyB0byB0aGUgdmlld2VyCiAgICogQHBhcmFtIHtET01FbGVtZW50fSBbb3B0aW9ucy5jb250YWluZXJdIHRoZSBjb250YWluZXIgdG8gcmVuZGVyIHRoZSB2aWV3ZXIgaW4sIGRlZmF1bHRzIHRvIGJvZHkuCiAgICogQHBhcmFtIHtTdHJpbmd8TnVtYmVyfSBbb3B0aW9ucy53aWR0aF0gdGhlIHdpZHRoIG9mIHRoZSB2aWV3ZXIKICAgKiBAcGFyYW0ge1N0cmluZ3xOdW1iZXJ9IFtvcHRpb25zLmhlaWdodF0gdGhlIGhlaWdodCBvZiB0aGUgdmlld2VyCiAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zLm1vZGRsZUV4dGVuc2lvbnNdIGV4dGVuc2lvbiBwYWNrYWdlcyB0byBwcm92aWRlCiAgICogQHBhcmFtIHtBcnJheTxkaWRpLk1vZHVsZT59IFtvcHRpb25zLm1vZHVsZXNdIGEgbGlzdCBvZiBtb2R1bGVzIHRvIG92ZXJyaWRlIHRoZSBkZWZhdWx0IG1vZHVsZXMKICAgKiBAcGFyYW0ge0FycmF5PGRpZGkuTW9kdWxlPn0gW29wdGlvbnMuYWRkaXRpb25hbE1vZHVsZXNdIGEgbGlzdCBvZiBtb2R1bGVzIHRvIHVzZSB3aXRoIHRoZSBkZWZhdWx0IG1vZHVsZXMKICAgKi8KICBmdW5jdGlvbiBWaWV3ZXIob3B0aW9ucykgewoKICAgIG9wdGlvbnMgPSBhc3NpZ24oe30sIERFRkFVTFRfT1BUSU9OUywgb3B0aW9ucyk7CgogICAgdGhpcy5fbW9kZGxlID0gdGhpcy5fY3JlYXRlTW9kZGxlKG9wdGlvbnMpOwoKICAgIHRoaXMuX2NvbnRhaW5lciA9IHRoaXMuX2NyZWF0ZUNvbnRhaW5lcihvcHRpb25zKTsKCiAgICAvKiA8cHJvamVjdC1sb2dvPiAqLwoKICAgIGFkZFByb2plY3RMb2dvKHRoaXMuX2NvbnRhaW5lcik7CgogICAgLyogPC9wcm9qZWN0LWxvZ28+ICovCgogICAgdGhpcy5faW5pdCh0aGlzLl9jb250YWluZXIsIHRoaXMuX21vZGRsZSwgb3B0aW9ucyk7CiAgfQoKICBpbmhlcml0c19icm93c2VyKFZpZXdlciwgRGlhZ3JhbSk7CgoKICAvKioKICAgKiBQYXJzZSBhbmQgcmVuZGVyIGEgQlBNTiAyLjAgZGlhZ3JhbS4KICAgKgogICAqIE9uY2UgZmluaXNoZWQgdGhlIHZpZXdlciByZXBvcnRzIGJhY2sgdGhlIHJlc3VsdCB0byB0aGUKICAgKiBwcm92aWRlZCBjYWxsYmFjayBmdW5jdGlvbiB3aXRoIChlcnIsIHdhcm5pbmdzKS4KICAgKgogICAqICMjIExpZmUtQ3ljbGUgRXZlbnRzCiAgICoKICAgKiBEdXJpbmcgaW1wb3J0IHRoZSB2aWV3ZXIgd2lsbCBmaXJlIGxpZmUtY3ljbGUgZXZlbnRzOgogICAqCiAgICogICAqIGltcG9ydC5wYXJzZS5zdGFydCAoYWJvdXQgdG8gcmVhZCBtb2RlbCBmcm9tIHhtbCkKICAgKiAgICogaW1wb3J0LnBhcnNlLmNvbXBsZXRlIChtb2RlbCByZWFkOyBtYXkgaGF2ZSB3b3JrZWQgb3Igbm90KQogICAqICAgKiBpbXBvcnQucmVuZGVyLnN0YXJ0IChncmFwaGljYWwgaW1wb3J0IHN0YXJ0KQogICAqICAgKiBpbXBvcnQucmVuZGVyLmNvbXBsZXRlIChncmFwaGljYWwgaW1wb3J0IGZpbmlzaGVkKQogICAqICAgKiBpbXBvcnQuZG9uZSAoZXZlcnl0aGluZyBkb25lKQogICAqCiAgICogWW91IGNhbiB1c2UgdGhlc2UgZXZlbnRzIHRvIGhvb2sgaW50byB0aGUgbGlmZS1jeWNsZS4KICAgKgogICAqIEBwYXJhbSB7U3RyaW5nfSB4bWwgdGhlIEJQTU4gMi4wIHhtbAogICAqIEBwYXJhbSB7TW9kZGxlRWxlbWVudDxCUE1ORGlhZ3JhbT58U3RyaW5nfSBbYnBtbkRpYWdyYW1dIEJQTU4gZGlhZ3JhbSBvciBpZCBvZiBkaWFncmFtIHRvIHJlbmRlciAoaWYgbm90IHByb3ZpZGVkLCB0aGUgZmlyc3Qgb25lIHdpbGwgYmUgcmVuZGVyZWQpCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2RvbmVdIGludm9rZWQgd2l0aCAoZXJyLCB3YXJuaW5ncz1bXSkKICAgKi8KICBWaWV3ZXIucHJvdG90eXBlLmltcG9ydFhNTCA9IGZ1bmN0aW9uKHhtbCwgYnBtbkRpYWdyYW0sIGRvbmUpIHsKCiAgICBpZiAoaXNGdW5jdGlvbihicG1uRGlhZ3JhbSkpIHsKICAgICAgZG9uZSA9IGJwbW5EaWFncmFtOwogICAgICBicG1uRGlhZ3JhbSA9IG51bGw7CiAgICB9CgogICAgLy8gZG9uZSBpcyBvcHRpb25hbAogICAgZG9uZSA9IGRvbmUgfHwgZnVuY3Rpb24oKSB7fTsKCiAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgLy8gaG9vayBpbiBwcmUtcGFyc2UgbGlzdGVuZXJzICsKICAgIC8vIGFsbG93IHhtbCBtYW5pcHVsYXRpb24KICAgIHhtbCA9IHRoaXMuX2VtaXQoJ2ltcG9ydC5wYXJzZS5zdGFydCcsIHsgeG1sOiB4bWwgfSkgfHwgeG1sOwoKICAgIHRoaXMuX21vZGRsZS5mcm9tWE1MKHhtbCwgJ2JwbW46RGVmaW5pdGlvbnMnLCBmdW5jdGlvbihlcnIsIGRlZmluaXRpb25zLCBjb250ZXh0KSB7CgogICAgICAvLyBob29rIGluIHBvc3QgcGFyc2UgbGlzdGVuZXJzICsKICAgICAgLy8gYWxsb3cgZGVmaW5pdGlvbnMgbWFuaXB1bGF0aW9uCiAgICAgIGRlZmluaXRpb25zID0gc2VsZi5fZW1pdCgnaW1wb3J0LnBhcnNlLmNvbXBsZXRlJywgewogICAgICAgIGVycm9yOiBlcnIsCiAgICAgICAgZGVmaW5pdGlvbnM6IGRlZmluaXRpb25zLAogICAgICAgIGNvbnRleHQ6IGNvbnRleHQKICAgICAgfSkgfHwgZGVmaW5pdGlvbnM7CgogICAgICB2YXIgcGFyc2VXYXJuaW5ncyA9IGNvbnRleHQud2FybmluZ3M7CgogICAgICBpZiAoZXJyKSB7CiAgICAgICAgZXJyID0gY2hlY2tWYWxpZGF0aW9uRXJyb3IoZXJyKTsKCiAgICAgICAgc2VsZi5fZW1pdCgnaW1wb3J0LmRvbmUnLCB7IGVycm9yOiBlcnIsIHdhcm5pbmdzOiBwYXJzZVdhcm5pbmdzIH0pOwoKICAgICAgICByZXR1cm4gZG9uZShlcnIsIHBhcnNlV2FybmluZ3MpOwogICAgICB9CgogICAgICBzZWxmLmltcG9ydERlZmluaXRpb25zKGRlZmluaXRpb25zLCBicG1uRGlhZ3JhbSwgZnVuY3Rpb24oZXJyLCBpbXBvcnRXYXJuaW5ncykgewogICAgICAgIHZhciBhbGxXYXJuaW5ncyA9IFtdLmNvbmNhdChwYXJzZVdhcm5pbmdzLCBpbXBvcnRXYXJuaW5ncyB8fCBbXSk7CgogICAgICAgIHNlbGYuX2VtaXQoJ2ltcG9ydC5kb25lJywgeyBlcnJvcjogZXJyLCB3YXJuaW5nczogYWxsV2FybmluZ3MgfSk7CgogICAgICAgIGRvbmUoZXJyLCBhbGxXYXJuaW5ncyk7CiAgICAgIH0pOwogICAgfSk7CiAgfTsKCiAgLyoqCiAgICogSW1wb3J0IHBhcnNlZCBkZWZpbml0aW9ucyBhbmQgcmVuZGVyIGEgQlBNTiAyLjAgZGlhZ3JhbS4KICAgKgogICAqIE9uY2UgZmluaXNoZWQgdGhlIHZpZXdlciByZXBvcnRzIGJhY2sgdGhlIHJlc3VsdCB0byB0aGUKICAgKiBwcm92aWRlZCBjYWxsYmFjayBmdW5jdGlvbiB3aXRoIChlcnIsIHdhcm5pbmdzKS4KICAgKgogICAqICMjIExpZmUtQ3ljbGUgRXZlbnRzCiAgICoKICAgKiBEdXJpbmcgaW1wb3J0IHRoZSB2aWV3ZXIgd2lsbCBmaXJlIGxpZmUtY3ljbGUgZXZlbnRzOgogICAqCiAgICogICAqIGltcG9ydC5yZW5kZXIuc3RhcnQgKGdyYXBoaWNhbCBpbXBvcnQgc3RhcnQpCiAgICogICAqIGltcG9ydC5yZW5kZXIuY29tcGxldGUgKGdyYXBoaWNhbCBpbXBvcnQgZmluaXNoZWQpCiAgICoKICAgKiBZb3UgY2FuIHVzZSB0aGVzZSBldmVudHMgdG8gaG9vayBpbnRvIHRoZSBsaWZlLWN5Y2xlLgogICAqCiAgICogQHBhcmFtIHtNb2RkbGVFbGVtZW50PERlZmluaXRpb25zPn0gZGVmaW5pdGlvbnMgcGFyc2VkIEJQTU4gMi4wIGRlZmluaXRpb25zCiAgICogQHBhcmFtIHtNb2RkbGVFbGVtZW50PEJQTU5EaWFncmFtPnxTdHJpbmd9IFticG1uRGlhZ3JhbV0gQlBNTiBkaWFncmFtIG9yIGlkIG9mIGRpYWdyYW0gdG8gcmVuZGVyIChpZiBub3QgcHJvdmlkZWQsIHRoZSBmaXJzdCBvbmUgd2lsbCBiZSByZW5kZXJlZCkKICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbZG9uZV0gaW52b2tlZCB3aXRoIChlcnIsIHdhcm5pbmdzPVtdKQogICAqLwogIFZpZXdlci5wcm90b3R5cGUuaW1wb3J0RGVmaW5pdGlvbnMgPSBmdW5jdGlvbihkZWZpbml0aW9ucywgYnBtbkRpYWdyYW0sIGRvbmUpIHsKCiAgICBpZiAoaXNGdW5jdGlvbihicG1uRGlhZ3JhbSkpIHsKICAgICAgZG9uZSA9IGJwbW5EaWFncmFtOwogICAgICBicG1uRGlhZ3JhbSA9IG51bGw7CiAgICB9CgogICAgLy8gZG9uZSBpcyBvcHRpb25hbAogICAgZG9uZSA9IGRvbmUgfHwgZnVuY3Rpb24oKSB7fTsKCiAgICB0aGlzLl9zZXREZWZpbml0aW9ucyhkZWZpbml0aW9ucyk7CgogICAgcmV0dXJuIHRoaXMub3BlbihicG1uRGlhZ3JhbSwgZG9uZSk7CiAgfTsKCiAgLyoqCiAgICogT3BlbiBkaWFncmFtIG9mIHByZXZpb3VzbHkgaW1wb3J0ZWQgWE1MLgogICAqCiAgICogT25jZSBmaW5pc2hlZCB0aGUgdmlld2VyIHJlcG9ydHMgYmFjayB0aGUgcmVzdWx0IHRvIHRoZQogICAqIHByb3ZpZGVkIGNhbGxiYWNrIGZ1bmN0aW9uIHdpdGggKGVyciwgd2FybmluZ3MpLgogICAqCiAgICogIyMgTGlmZS1DeWNsZSBFdmVudHMKICAgKgogICAqIER1cmluZyBzd2l0Y2ggdGhlIHZpZXdlciB3aWxsIGZpcmUgbGlmZS1jeWNsZSBldmVudHM6CiAgICoKICAgKiAgICogaW1wb3J0LnJlbmRlci5zdGFydCAoZ3JhcGhpY2FsIGltcG9ydCBzdGFydCkKICAgKiAgICogaW1wb3J0LnJlbmRlci5jb21wbGV0ZSAoZ3JhcGhpY2FsIGltcG9ydCBmaW5pc2hlZCkKICAgKgogICAqIFlvdSBjYW4gdXNlIHRoZXNlIGV2ZW50cyB0byBob29rIGludG8gdGhlIGxpZmUtY3ljbGUuCiAgICoKICAgKiBAcGFyYW0ge1N0cmluZ3xNb2RkbGVFbGVtZW50PEJQTU5EaWFncmFtPn0gW2JwbW5EaWFncmFtT3JJZF0gaWQgb3IgdGhlIGRpYWdyYW0gdG8gb3BlbgogICAqIEBwYXJhbSB7RnVuY3Rpb259IFtkb25lXSBpbnZva2VkIHdpdGggKGVyciwgd2FybmluZ3M9W10pCiAgICovCiAgVmlld2VyLnByb3RvdHlwZS5vcGVuID0gZnVuY3Rpb24oYnBtbkRpYWdyYW1PcklkLCBkb25lKSB7CgogICAgaWYgKGlzRnVuY3Rpb24oYnBtbkRpYWdyYW1PcklkKSkgewogICAgICBkb25lID0gYnBtbkRpYWdyYW1PcklkOwogICAgICBicG1uRGlhZ3JhbU9ySWQgPSBudWxsOwogICAgfQoKICAgIHZhciBkZWZpbml0aW9ucyA9IHRoaXMuX2RlZmluaXRpb25zOwogICAgdmFyIGJwbW5EaWFncmFtID0gYnBtbkRpYWdyYW1PcklkOwoKICAgIC8vIGRvbmUgaXMgb3B0aW9uYWwKICAgIGRvbmUgPSBkb25lIHx8IGZ1bmN0aW9uKCkge307CgogICAgaWYgKCFkZWZpbml0aW9ucykgewogICAgICByZXR1cm4gZG9uZShuZXcgRXJyb3IoJ25vIFhNTCBpbXBvcnRlZCcpKTsKICAgIH0KCiAgICBpZiAodHlwZW9mIGJwbW5EaWFncmFtT3JJZCA9PT0gJ3N0cmluZycpIHsKICAgICAgYnBtbkRpYWdyYW0gPSBmaW5kQlBNTkRpYWdyYW0oZGVmaW5pdGlvbnMsIGJwbW5EaWFncmFtT3JJZCk7CgogICAgICBpZiAoIWJwbW5EaWFncmFtKSB7CiAgICAgICAgcmV0dXJuIGRvbmUobmV3IEVycm9yKCdCUE1ORGlhZ3JhbSA8JyArIGJwbW5EaWFncmFtT3JJZCArICc+IG5vdCBmb3VuZCcpKTsKICAgICAgfQogICAgfQoKICAgIC8vIGNsZWFyIGV4aXN0aW5nIHJlbmRlcmVkIGRpYWdyYW0KICAgIC8vIGNhdGNoIHN5bmNocm9ub3VzIGV4Y2VwdGlvbnMgZHVyaW5nICNjbGVhcigpCiAgICB0cnkgewogICAgICB0aGlzLmNsZWFyKCk7CiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICByZXR1cm4gZG9uZShlcnJvcik7CiAgICB9CgogICAgLy8gcGVyZm9ybSBncmFwaGljYWwgaW1wb3J0CiAgICByZXR1cm4gaW1wb3J0QnBtbkRpYWdyYW0odGhpcywgZGVmaW5pdGlvbnMsIGJwbW5EaWFncmFtLCBkb25lKTsKICB9OwoKICAvKioKICAgKiBFeHBvcnQgdGhlIGN1cnJlbnRseSBkaXNwbGF5ZWQgQlBNTiAyLjAgZGlhZ3JhbSBhcwogICAqIGEgQlBNTiAyLjAgWE1MIGRvY3VtZW50LgogICAqCiAgICogIyMgTGlmZS1DeWNsZSBFdmVudHMKICAgKgogICAqIER1cmluZyBYTUwgc2F2aW5nIHRoZSB2aWV3ZXIgd2lsbCBmaXJlIGxpZmUtY3ljbGUgZXZlbnRzOgogICAqCiAgICogICAqIHNhdmVYTUwuc3RhcnQgKGJlZm9yZSBzZXJpYWxpemF0aW9uKQogICAqICAgKiBzYXZlWE1MLnNlcmlhbGl6ZWQgKGFmdGVyIHhtbCBnZW5lcmF0aW9uKQogICAqICAgKiBzYXZlWE1MLmRvbmUgKGV2ZXJ5dGhpbmcgZG9uZSkKICAgKgogICAqIFlvdSBjYW4gdXNlIHRoZXNlIGV2ZW50cyB0byBob29rIGludG8gdGhlIGxpZmUtY3ljbGUuCiAgICoKICAgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnNdIGV4cG9ydCBvcHRpb25zCiAgICogQHBhcmFtIHtCb29sZWFufSBbb3B0aW9ucy5mb3JtYXQ9ZmFsc2VdIG91dHB1dCBmb3JtYXR0ZWQgWE1MCiAgICogQHBhcmFtIHtCb29sZWFufSBbb3B0aW9ucy5wcmVhbWJsZT10cnVlXSBvdXRwdXQgcHJlYW1ibGUKICAgKgogICAqIEBwYXJhbSB7RnVuY3Rpb259IGRvbmUgaW52b2tlZCB3aXRoIChlcnIsIHhtbCkKICAgKi8KICBWaWV3ZXIucHJvdG90eXBlLnNhdmVYTUwgPSBmdW5jdGlvbihvcHRpb25zLCBkb25lKSB7CgogICAgaWYgKCFkb25lKSB7CiAgICAgIGRvbmUgPSBvcHRpb25zOwogICAgICBvcHRpb25zID0ge307CiAgICB9CgogICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgIHZhciBkZWZpbml0aW9ucyA9IHRoaXMuX2RlZmluaXRpb25zOwoKICAgIGlmICghZGVmaW5pdGlvbnMpIHsKICAgICAgcmV0dXJuIGRvbmUobmV3IEVycm9yKCdubyBkZWZpbml0aW9ucyBsb2FkZWQnKSk7CiAgICB9CgogICAgLy8gYWxsb3cgdG8gZmlkZGxlIGFyb3VuZCB3aXRoIGRlZmluaXRpb25zCiAgICBkZWZpbml0aW9ucyA9IHRoaXMuX2VtaXQoJ3NhdmVYTUwuc3RhcnQnLCB7CiAgICAgIGRlZmluaXRpb25zOiBkZWZpbml0aW9ucwogICAgfSkgfHwgZGVmaW5pdGlvbnM7CgogICAgdGhpcy5fbW9kZGxlLnRvWE1MKGRlZmluaXRpb25zLCBvcHRpb25zLCBmdW5jdGlvbihlcnIsIHhtbCkgewoKICAgICAgdHJ5IHsKICAgICAgICB4bWwgPSBzZWxmLl9lbWl0KCdzYXZlWE1MLnNlcmlhbGl6ZWQnLCB7CiAgICAgICAgICBlcnJvcjogZXJyLAogICAgICAgICAgeG1sOiB4bWwKICAgICAgICB9KSB8fCB4bWw7CgogICAgICAgIHNlbGYuX2VtaXQoJ3NhdmVYTUwuZG9uZScsIHsKICAgICAgICAgIGVycm9yOiBlcnIsCiAgICAgICAgICB4bWw6IHhtbAogICAgICAgIH0pOwogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgY29uc29sZS5lcnJvcignZXJyb3IgaW4gc2F2ZVhNTCBsaWZlLWN5Y2xlIGxpc3RlbmVyJywgZSk7CiAgICAgIH0KCiAgICAgIGRvbmUoZXJyLCB4bWwpOwogICAgfSk7CiAgfTsKCiAgLyoqCiAgICogRXhwb3J0IHRoZSBjdXJyZW50bHkgZGlzcGxheWVkIEJQTU4gMi4wIGRpYWdyYW0gYXMKICAgKiBhbiBTVkcgaW1hZ2UuCiAgICoKICAgKiAjIyBMaWZlLUN5Y2xlIEV2ZW50cwogICAqCiAgICogRHVyaW5nIFNWRyBzYXZpbmcgdGhlIHZpZXdlciB3aWxsIGZpcmUgbGlmZS1jeWNsZSBldmVudHM6CiAgICoKICAgKiAgICogc2F2ZVNWRy5zdGFydCAoYmVmb3JlIHNlcmlhbGl6YXRpb24pCiAgICogICAqIHNhdmVTVkcuZG9uZSAoZXZlcnl0aGluZyBkb25lKQogICAqCiAgICogWW91IGNhbiB1c2UgdGhlc2UgZXZlbnRzIHRvIGhvb2sgaW50byB0aGUgbGlmZS1jeWNsZS4KICAgKgogICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc10KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBkb25lIGludm9rZWQgd2l0aCAoZXJyLCBzdmdTdHIpCiAgICovCiAgVmlld2VyLnByb3RvdHlwZS5zYXZlU1ZHID0gZnVuY3Rpb24ob3B0aW9ucywgZG9uZSkgewoKICAgIGlmICghZG9uZSkgewogICAgICBkb25lID0gb3B0aW9uczsKICAgICAgb3B0aW9ucyA9IHt9OwogICAgfQoKICAgIHRoaXMuX2VtaXQoJ3NhdmVTVkcuc3RhcnQnKTsKCiAgICB2YXIgc3ZnLCBlcnI7CgogICAgdHJ5IHsKICAgICAgdmFyIGNhbnZhcyA9IHRoaXMuZ2V0KCdjYW52YXMnKTsKCiAgICAgIHZhciBjb250ZW50Tm9kZSA9IGNhbnZhcy5nZXREZWZhdWx0TGF5ZXIoKSwKICAgICAgICAgIGRlZnNOb2RlID0gcXVlcnkoJ2RlZnMnLCBjYW52YXMuX3N2Zyk7CgogICAgICB2YXIgY29udGVudHMgPSBpbm5lclNWRyhjb250ZW50Tm9kZSksCiAgICAgICAgICBkZWZzID0gZGVmc05vZGUgPyAnPGRlZnM+JyArIGlubmVyU1ZHKGRlZnNOb2RlKSArICc8L2RlZnM+JyA6ICcnOwoKICAgICAgdmFyIGJib3ggPSBjb250ZW50Tm9kZS5nZXRCQm94KCk7CgogICAgICBzdmcgPQogICAgICAgICc8P3htbCB2ZXJzaW9uPSIxLjAiIGVuY29kaW5nPSJ1dGYtOCI/PlxuJyArCiAgICAgICAgJzwhLS0gY3JlYXRlZCB3aXRoIGJwbW4tanMgLyBodHRwOi8vYnBtbi5pbyAtLT5cbicgKwogICAgICAgICc8IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPlxuJyArCiAgICAgICAgJzxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgJyArCiAgICAgICAgICAgICAnd2lkdGg9IicgKyBiYm94LndpZHRoICsgJyIgaGVpZ2h0PSInICsgYmJveC5oZWlnaHQgKyAnIiAnICsKICAgICAgICAgICAgICd2aWV3Qm94PSInICsgYmJveC54ICsgJyAnICsgYmJveC55ICsgJyAnICsgYmJveC53aWR0aCArICcgJyArIGJib3guaGVpZ2h0ICsgJyIgdmVyc2lvbj0iMS4xIj4nICsKICAgICAgICAgIGRlZnMgKyBjb250ZW50cyArCiAgICAgICAgJzwvc3ZnPic7CiAgICB9IGNhdGNoIChlKSB7CiAgICAgIGVyciA9IGU7CiAgICB9CgogICAgdGhpcy5fZW1pdCgnc2F2ZVNWRy5kb25lJywgewogICAgICBlcnJvcjogZXJyLAogICAgICBzdmc6IHN2ZwogICAgfSk7CgogICAgZG9uZShlcnIsIHN2Zyk7CiAgfTsKCiAgLyoqCiAgICogR2V0IGEgbmFtZWQgZGlhZ3JhbSBzZXJ2aWNlLgogICAqCiAgICogQGV4YW1wbGUKICAgKgogICAqIHZhciBlbGVtZW50UmVnaXN0cnkgPSB2aWV3ZXIuZ2V0KCdlbGVtZW50UmVnaXN0cnknKTsKICAgKiB2YXIgc3RhcnRFdmVudFNoYXBlID0gZWxlbWVudFJlZ2lzdHJ5LmdldCgnU3RhcnRFdmVudF8xJyk7CiAgICoKICAgKiBAcGFyYW0ge1N0cmluZ30gbmFtZQogICAqCiAgICogQHJldHVybiB7T2JqZWN0fSBkaWFncmFtIHNlcnZpY2UgaW5zdGFuY2UKICAgKgogICAqIEBtZXRob2QgVmlld2VyI2dldAogICAqLwoKICAvKioKICAgKiBJbnZva2UgYSBmdW5jdGlvbiBpbiB0aGUgY29udGV4dCBvZiB0aGlzIHZpZXdlci4KICAgKgogICAqIEBleGFtcGxlCiAgICoKICAgKiB2aWV3ZXIuaW52b2tlKGZ1bmN0aW9uKGVsZW1lbnRSZWdpc3RyeSkgewogICAqICAgdmFyIHN0YXJ0RXZlbnRTaGFwZSA9IGVsZW1lbnRSZWdpc3RyeS5nZXQoJ1N0YXJ0RXZlbnRfMScpOwogICAqIH0pOwogICAqCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gZm4gdG8gYmUgaW52b2tlZAogICAqCiAgICogQHJldHVybiB7T2JqZWN0fSB0aGUgZnVuY3Rpb25zIHJldHVybiB2YWx1ZQogICAqCiAgICogQG1ldGhvZCBWaWV3ZXIjaW52b2tlCiAgICovCgoKICBWaWV3ZXIucHJvdG90eXBlLl9zZXREZWZpbml0aW9ucyA9IGZ1bmN0aW9uKGRlZmluaXRpb25zKSB7CiAgICB0aGlzLl9kZWZpbml0aW9ucyA9IGRlZmluaXRpb25zOwogIH07CgogIFZpZXdlci5wcm90b3R5cGUuZ2V0TW9kdWxlcyA9IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIHRoaXMuX21vZHVsZXM7CiAgfTsKCiAgLyoqCiAgICogUmVtb3ZlIGFsbCBkcmF3biBlbGVtZW50cyBmcm9tIHRoZSB2aWV3ZXIuCiAgICoKICAgKiBBZnRlciBjYWxsaW5nIHRoaXMgbWV0aG9kIHRoZSB2aWV3ZXIgY2FuIHN0aWxsCiAgICogYmUgcmV1c2VkIGZvciBvcGVuaW5nIGFub3RoZXIgZGlhZ3JhbS4KICAgKgogICAqIEBtZXRob2QgVmlld2VyI2NsZWFyCiAgICovCiAgVmlld2VyLnByb3RvdHlwZS5jbGVhciA9IGZ1bmN0aW9uKCkgewogICAgaWYgKCF0aGlzLmdldERlZmluaXRpb25zKCkpIHsKCiAgICAgIC8vIG5vIGRpYWdyYW0gdG8gY2xlYXIKICAgICAgcmV0dXJuOwogICAgfQoKICAgIC8vIHJlbW92ZSBidXNpbmVzc09iamVjdCNkaSBiaW5kaW5nCiAgICAvLwogICAgLy8gdGhpcyBpcyBuZWNlc3NhcnksIGFzIHdlIGVzdGFibGlzaCB0aGUgYmluZGluZ3MKICAgIC8vIGluIHRoZSBCcG1uVHJlZVdhbGtlciAoYW5kIGFzc3VtZSBub25lIGFyZSBnaXZlbgogICAgLy8gb24gcmVpbXBvcnQpCiAgICB0aGlzLmdldCgnZWxlbWVudFJlZ2lzdHJ5JykuZm9yRWFjaChmdW5jdGlvbihlbGVtZW50KSB7CiAgICAgIHZhciBibyA9IGVsZW1lbnQuYnVzaW5lc3NPYmplY3Q7CgogICAgICBpZiAoYm8gJiYgYm8uZGkpIHsKICAgICAgICBkZWxldGUgYm8uZGk7CiAgICAgIH0KICAgIH0pOwoKICAgIC8vIHJlbW92ZSBkcmF3biBlbGVtZW50cwogICAgRGlhZ3JhbS5wcm90b3R5cGUuY2xlYXIuY2FsbCh0aGlzKTsKICB9OwoKICAvKioKICAgKiBEZXN0cm95IHRoZSB2aWV3ZXIgaW5zdGFuY2UgYW5kIHJlbW92ZSBhbGwgaXRzCiAgICogcmVtYWluZGVycyBmcm9tIHRoZSBkb2N1bWVudCB0cmVlLgogICAqLwogIFZpZXdlci5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uKCkgewoKICAgIC8vIGRpYWdyYW0gZGVzdHJveQogICAgRGlhZ3JhbS5wcm90b3R5cGUuZGVzdHJveS5jYWxsKHRoaXMpOwoKICAgIC8vIGRvbSBkZXRhY2gKICAgIHJlbW92ZSh0aGlzLl9jb250YWluZXIpOwogIH07CgogIC8qKgogICAqIFJlZ2lzdGVyIGFuIGV2ZW50IGxpc3RlbmVyCiAgICoKICAgKiBSZW1vdmUgYSBwcmV2aW91c2x5IGFkZGVkIGxpc3RlbmVyIHZpYSB7QGxpbmsgI29mZihldmVudCwgY2FsbGJhY2spfS4KICAgKgogICAqIEBwYXJhbSB7U3RyaW5nfSBldmVudAogICAqIEBwYXJhbSB7TnVtYmVyfSBbcHJpb3JpdHldCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sKICAgKiBAcGFyYW0ge09iamVjdH0gW3RoYXRdCiAgICovCiAgVmlld2VyLnByb3RvdHlwZS5vbiA9IGZ1bmN0aW9uKGV2ZW50LCBwcmlvcml0eSwgY2FsbGJhY2ssIHRhcmdldCkgewogICAgcmV0dXJuIHRoaXMuZ2V0KCdldmVudEJ1cycpLm9uKGV2ZW50LCBwcmlvcml0eSwgY2FsbGJhY2ssIHRhcmdldCk7CiAgfTsKCiAgLyoqCiAgICogRGUtcmVnaXN0ZXIgYW4gZXZlbnQgbGlzdGVuZXIKICAgKgogICAqIEBwYXJhbSB7U3RyaW5nfSBldmVudAogICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrCiAgICovCiAgVmlld2VyLnByb3RvdHlwZS5vZmYgPSBmdW5jdGlvbihldmVudCwgY2FsbGJhY2spIHsKICAgIHRoaXMuZ2V0KCdldmVudEJ1cycpLm9mZihldmVudCwgY2FsbGJhY2spOwogIH07CgogIFZpZXdlci5wcm90b3R5cGUuYXR0YWNoVG8gPSBmdW5jdGlvbihwYXJlbnROb2RlKSB7CgogICAgaWYgKCFwYXJlbnROb2RlKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigncGFyZW50Tm9kZSByZXF1aXJlZCcpOwogICAgfQoKICAgIC8vIGVuc3VyZSB3ZSBkZXRhY2ggZnJvbSB0aGUKICAgIC8vIHByZXZpb3VzLCBvbGQgcGFyZW50CiAgICB0aGlzLmRldGFjaCgpOwoKICAgIC8vIHVud3JhcCBqUXVlcnkgaWYgcHJvdmlkZWQKICAgIGlmIChwYXJlbnROb2RlLmdldCAmJiBwYXJlbnROb2RlLmNvbnN0cnVjdG9yLnByb3RvdHlwZS5qcXVlcnkpIHsKICAgICAgcGFyZW50Tm9kZSA9IHBhcmVudE5vZGUuZ2V0KDApOwogICAgfQoKICAgIGlmICh0eXBlb2YgcGFyZW50Tm9kZSA9PT0gJ3N0cmluZycpIHsKICAgICAgcGFyZW50Tm9kZSA9IHF1ZXJ5KHBhcmVudE5vZGUpOwogICAgfQoKICAgIHBhcmVudE5vZGUuYXBwZW5kQ2hpbGQodGhpcy5fY29udGFpbmVyKTsKCiAgICB0aGlzLl9lbWl0KCdhdHRhY2gnLCB7fSk7CgogICAgdGhpcy5nZXQoJ2NhbnZhcycpLnJlc2l6ZWQoKTsKICB9OwoKICBWaWV3ZXIucHJvdG90eXBlLmdldERlZmluaXRpb25zID0gZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gdGhpcy5fZGVmaW5pdGlvbnM7CiAgfTsKCiAgVmlld2VyLnByb3RvdHlwZS5kZXRhY2ggPSBmdW5jdGlvbigpIHsKCiAgICB2YXIgY29udGFpbmVyID0gdGhpcy5fY29udGFpbmVyLAogICAgICAgIHBhcmVudE5vZGUgPSBjb250YWluZXIucGFyZW50Tm9kZTsKCiAgICBpZiAoIXBhcmVudE5vZGUpIHsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIHRoaXMuX2VtaXQoJ2RldGFjaCcsIHt9KTsKCiAgICBwYXJlbnROb2RlLnJlbW92ZUNoaWxkKGNvbnRhaW5lcik7CiAgfTsKCiAgVmlld2VyLnByb3RvdHlwZS5faW5pdCA9IGZ1bmN0aW9uKGNvbnRhaW5lciwgbW9kZGxlLCBvcHRpb25zKSB7CgogICAgdmFyIGJhc2VNb2R1bGVzID0gb3B0aW9ucy5tb2R1bGVzIHx8IHRoaXMuZ2V0TW9kdWxlcygpLAogICAgICAgIGFkZGl0aW9uYWxNb2R1bGVzID0gb3B0aW9ucy5hZGRpdGlvbmFsTW9kdWxlcyB8fCBbXSwKICAgICAgICBzdGF0aWNNb2R1bGVzID0gWwogICAgICAgICAgewogICAgICAgICAgICBicG1uanM6IFsgJ3ZhbHVlJywgdGhpcyBdLAogICAgICAgICAgICBtb2RkbGU6IFsgJ3ZhbHVlJywgbW9kZGxlIF0KICAgICAgICAgIH0KICAgICAgICBdOwoKICAgIHZhciBkaWFncmFtTW9kdWxlcyA9IFtdLmNvbmNhdChzdGF0aWNNb2R1bGVzLCBiYXNlTW9kdWxlcywgYWRkaXRpb25hbE1vZHVsZXMpOwoKICAgIHZhciBkaWFncmFtT3B0aW9ucyA9IGFzc2lnbihvbWl0KG9wdGlvbnMsIFsgJ2FkZGl0aW9uYWxNb2R1bGVzJyBdKSwgewogICAgICBjYW52YXM6IGFzc2lnbih7fSwgb3B0aW9ucy5jYW52YXMsIHsgY29udGFpbmVyOiBjb250YWluZXIgfSksCiAgICAgIG1vZHVsZXM6IGRpYWdyYW1Nb2R1bGVzCiAgICB9KTsKCiAgICAvLyBpbnZva2UgZGlhZ3JhbSBjb25zdHJ1Y3RvcgogICAgRGlhZ3JhbS5jYWxsKHRoaXMsIGRpYWdyYW1PcHRpb25zKTsKCiAgICBpZiAob3B0aW9ucyAmJiBvcHRpb25zLmNvbnRhaW5lcikgewogICAgICB0aGlzLmF0dGFjaFRvKG9wdGlvbnMuY29udGFpbmVyKTsKICAgIH0KICB9OwoKICAvKioKICAgKiBFbWl0IGFuIGV2ZW50IG9uIHRoZSB1bmRlcmx5aW5nIHtAbGluayBFdmVudEJ1c30KICAgKgogICAqIEBwYXJhbSAge1N0cmluZ30gdHlwZQogICAqIEBwYXJhbSAge09iamVjdH0gZXZlbnQKICAgKgogICAqIEByZXR1cm4ge09iamVjdH0gZXZlbnQgcHJvY2Vzc2luZyByZXN1bHQgKGlmIGFueSkKICAgKi8KICBWaWV3ZXIucHJvdG90eXBlLl9lbWl0ID0gZnVuY3Rpb24odHlwZSwgZXZlbnQpIHsKICAgIHJldHVybiB0aGlzLmdldCgnZXZlbnRCdXMnKS5maXJlKHR5cGUsIGV2ZW50KTsKICB9OwoKICBWaWV3ZXIucHJvdG90eXBlLl9jcmVhdGVDb250YWluZXIgPSBmdW5jdGlvbihvcHRpb25zKSB7CgogICAgdmFyIGNvbnRhaW5lciA9IGRvbWlmeSgnPGRpdiBjbGFzcz0iYmpzLWNvbnRhaW5lciI+PC9kaXY+Jyk7CgogICAgYXNzaWduKGNvbnRhaW5lci5zdHlsZSwgewogICAgICB3aWR0aDogZW5zdXJlVW5pdChvcHRpb25zLndpZHRoKSwKICAgICAgaGVpZ2h0OiBlbnN1cmVVbml0KG9wdGlvbnMuaGVpZ2h0KSwKICAgICAgcG9zaXRpb246IG9wdGlvbnMucG9zaXRpb24KICAgIH0pOwoKICAgIHJldHVybiBjb250YWluZXI7CiAgfTsKCiAgVmlld2VyLnByb3RvdHlwZS5fY3JlYXRlTW9kZGxlID0gZnVuY3Rpb24ob3B0aW9ucykgewogICAgdmFyIG1vZGRsZU9wdGlvbnMgPSBhc3NpZ24oe30sIHRoaXMuX21vZGRsZUV4dGVuc2lvbnMsIG9wdGlvbnMubW9kZGxlRXh0ZW5zaW9ucyk7CgogICAgcmV0dXJuIG5ldyBzaW1wbGUobW9kZGxlT3B0aW9ucyk7CiAgfTsKCiAgLy8gbW9kdWxlcyB0aGUgdmlld2VyIGlzIGNvbXBvc2VkIG9mCiAgVmlld2VyLnByb3RvdHlwZS5fbW9kdWxlcyA9IFsKICAgIENvcmVNb2R1bGUkMSwKICAgIFRyYW5zbGF0ZU1vZHVsZSwKICAgIFNlbGVjdGlvbk1vZHVsZSwKICAgIE92ZXJsYXlzTW9kdWxlCiAgXTsKCiAgLy8gZGVmYXVsdCBtb2RkbGUgZXh0ZW5zaW9ucyB0aGUgdmlld2VyIGlzIGNvbXBvc2VkIG9mCiAgVmlld2VyLnByb3RvdHlwZS5fbW9kZGxlRXh0ZW5zaW9ucyA9IHt9OwoKICAvKioKICAgKiBBZGRzIHRoZSBwcm9qZWN0IGxvZ28gdG8gdGhlIGRpYWdyYW0gY29udGFpbmVyIGFzCiAgICogcmVxdWlyZWQgYnkgdGhlIGJwbW4uaW8gbGljZW5zZS4KICAgKgogICAqIEBzZWUgaHR0cDovL2JwbW4uaW8vbGljZW5zZQogICAqCiAgICogQHBhcmFtIHtFbGVtZW50fSBjb250YWluZXIKICAgKi8KICBmdW5jdGlvbiBhZGRQcm9qZWN0TG9nbyhjb250YWluZXIpIHsKICAgIHZhciBpbWcgPSBCUE1OSU9fSU1HOwoKICAgIHZhciBsaW5rTWFya3VwID0KICAgICAgJzxhIGhyZWY9Imh0dHA6Ly9icG1uLmlvIiAnICsKICAgICAgICAgJ3RhcmdldD0iX2JsYW5rIiAnICsKICAgICAgICAgJ2NsYXNzPSJianMtcG93ZXJlZC1ieSIgJyArCiAgICAgICAgICd0aXRsZT0iUG93ZXJlZCBieSBicG1uLmlvIiAnICsKICAgICAgICAgJ3N0eWxlPSJwb3NpdGlvbjogYWJzb2x1dGU7IGJvdHRvbTogMTVweDsgcmlnaHQ6IDE1cHg7IHotaW5kZXg6IDEwMCI+JyArCiAgICAgICAgaW1nICsKICAgICAgJzwvYT4nOwoKICAgIHZhciBsaW5rRWxlbWVudCA9IGRvbWlmeShsaW5rTWFya3VwKTsKCiAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQobGlua0VsZW1lbnQpOwoKICAgIGNvbXBvbmVudEV2ZW50LmJpbmQobGlua0VsZW1lbnQsICdjbGljaycsIGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgIG9wZW4oKTsKCiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICB9KTsKICB9CgogIC8qIDwvcHJvamVjdC1sb2dvPiAqLwoKICByZXR1cm4gVmlld2VyOwoKfSkpOwo="}]}]}